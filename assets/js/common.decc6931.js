"use strict";(globalThis.webpackChunkweb_music_score_org=globalThis.webpackChunkweb_music_score_org||[]).push([[2076],{8478(t,e,i){i.d(e,{A:()=>a});i(6540);var s=i(2303),n=i(4848);function a({children:t,fallback:e}){return(0,s.A)()?(0,n.jsx)(n.Fragment,{children:t?.()}):e??null}},8453(t,e,i){i.d(e,{R:()=>o,x:()=>r});var s=i(6540);const n={},a=s.createContext(n);function o(t){const e=s.useContext(a);return s.useMemo(function(){return"function"==typeof t?t(e):{...e,...t}},[e,t])}function r(t){let e;return e=t.disableParentContext?"function"==typeof t.components?t.components(n):t.components||n:o(t.components),s.createElement(a.Provider,{value:e},t.children)}},9904(t,e,i){i.d(e,{$6:()=>Ls,$e:()=>Ms,B:()=>Si,Bj:()=>rs,C:()=>Gi,CS:()=>Di,E3:()=>Ui,EX:()=>Qe,G0:()=>zt,HD:()=>Ut,Hp:()=>Bt,IM:()=>Rt,JT:()=>Kt,JU:()=>Ht,K8:()=>ee,KU:()=>os,Kd:()=>Pt,Kg:()=>ni,L2:()=>qt,LB:()=>ti,LS:()=>jt,Lw:()=>Xe,MN:()=>Ze,M_:()=>ze,Mo:()=>_t,PC:()=>vs,Pg:()=>ys,Pi:()=>ss,QF:()=>Tt,RS:()=>He,T8:()=>Ft,UI:()=>Te,UM:()=>Mi,VW:()=>fi,Ve:()=>$t,Vt:()=>Ot,Vx:()=>Qt,WN:()=>pi,Xs:()=>Wi,YF:()=>Fe,ZN:()=>xt,Zk:()=>ii,_t:()=>Et,aE:()=>_e,ad:()=>Ii,ai:()=>Be,an:()=>Xt,bE:()=>di,dB:()=>es,e9:()=>hi,fJ:()=>ui,fL:()=>Lt,fP:()=>kt,fn:()=>Zt,hV:()=>Oi,iQ:()=>ke,k_:()=>Ye,lP:()=>oi,m:()=>ws,nh:()=>cs,oA:()=>Vt,oT:()=>Dt,r$:()=>Jt,r6:()=>ji,rM:()=>Ee,t5:()=>bs,tJ:()=>Ki,u1:()=>Ti,uf:()=>Ns,vr:()=>te,w0:()=>hs,wb:()=>bi,wt:()=>Gt,y9:()=>vi,ys:()=>Yt,yx:()=>Li,zJ:()=>Wt,zk:()=>ns});var s=i(7414),n=i(3894),a=i(6362),o=i(4388),r=i(5690),h=i(3721),c=!1,u=75,l=10,d=1.5,g=10,f=.5,m=.5,p=2,C=1.3,I=1.8,A=.8,b=7,y=1.5,v=4,w=2,M=1.25,N=.5,S=4,R=.5,L=3.6,x=5,T=8,P=20,D=class extends r.MusicError{constructor(t){super(r.MusicErrorType.Score,t),Object.setPrototypeOf(this,new.target.prototype),this.name=new.target.name}},B=new n.b1([[0,"data:image/png;base64,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TTpEb2N1bWVudElEPSJnaW1wOmRvY2lkOmdpbXA6NDA3ODVjMzYtNDAxZC00YTZlLTkxODctMDQ1NTI4MmM0ZGY2IgogICB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjhiZTJkYzc1LTVlYjQtNDk0Yy1iNWRlLWQ2MzZkNzZhNjI2YiIKICAgeG1wTU06T3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOmU3YWE0MWNhLTNiYjMtNGU5Yi05NDQxLTllNTNmZTJiZjM5ZiIKICAgZGM6Rm9ybWF0PSJpbWFnZS9wbmciCiAgIEdJTVA6QVBJPSIyLjAiCiAgIEdJTVA6UGxhdGZvcm09IldpbmRvd3MiCiAgIEdJTVA6VGltZVN0YW1wPSIxNjg2NDA4NjA5MzE2NDM4IgogICBHSU1QOlZlcnNpb249IjIuMTAuMzQiCiAgIHRpZmY6T3JpZW50YXRpb249IjEiCiAgIHhtcDpDcmVhdG9yVG9vbD0iR0lNUCAyLjEwIgogICB4bXA6TWV0YWRhdGFEYXRlPSIyMDIzOjA2OjEwVDE3OjUwOjA5KzAzOjAwIgogICB4bXA6TW9kaWZ5RGF0ZT0iMjAyMzowNjoxMFQxNzo1MDowOSswMzowMCI+CiAgIDx4bXBNTTpIaXN0b3J5PgogICAgPHJkZjpTZXE+CiAgICAgPHJkZjpsaQogICAgICBzdEV2dDphY3Rpb249InNhdmVkIgogICAgICBzdEV2dDpjaGFuZ2VkPSIvIgogICAgICBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjI3MzY2YmY0LWVkZDMtNDE5OC05NjJhLWU5ZTM5MTBlNThiZSIKICAgICAgc3RFdnQ6c29mdHdhcmVBZ2VudD0iR2ltcCAyLjEwIChXaW5kb3dzKSIKICAgICAgc3RFdnQ6d2hlbj0iMjAyMi0wOC0yMlQwMjo1NTozNiIvPgogICAgIDxyZGY6bGkKICAgICAgc3RFdnQ6YWN0aW9uPSJzYXZlZCIKICAgICAgc3RFdnQ6Y2hhbmdlZD0iLyIKICAgICAgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDo5NjVlMTM3OS0wZDlmLTQ5ODItYWQ3MC05MzhjOWMzOWE0ZjMiCiAgICAgIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkdpbXAgMi4xMCAoV2luZG93cykiCiAgICAgIHN0RXZ0OndoZW49IjIwMjItMDktMTFUMTY6MzU6MDAiLz4KICAgICA8cmRmOmxpCiAgICAgIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiCiAgICAgIHN0RXZ0OmNoYW5nZWQ9Ii8iCiAgICAgIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6MTBmYmEwYTMtOTI5Yi00NTRlLThjNGMtOGVkOGM4YWJhZGRjIgogICAgICBzdEV2dDpzb2Z0d2FyZUFnZW50PSJHaW1wIDIuMTAgKFdpbmRvd3MpIgogICAgICBzdEV2dDp3aGVuPSIyMDIzLTA2LTEwVDE3OjUwOjA5Ii8+CiAgICA8L3JkZjpTZXE+CiAgIDwveG1wTU06SGlzdG9yeT4KICA8L3JkZjpEZXNjcmlwdGlvbj4KIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAKPD94cGFja2V0IGVuZD0idyI/Ppn4NIQAAAAGYktHRAD/AP8A/6C9p5MAAAAJcEhZcwAALiMAAC4jAXilP3YAAAAHdElNRQfnBgoOMgm5WlWBAAAAGXRFWHRDb21tZW50AENyZWF0ZWQgd2l0aCBHSU1QV4EOFwAACHtJREFUeNrtnXuQVmMcxz+77cauTWUpbGSVu2w3BpnUEBq3chkmBjGayG1GBuNWLtUgw5SJkBkjl4QKg1wyQyarK0lRSlstU20bWam9+OM8O3P6vc8553nOe97tnO18Z84f57zP7XvOc/ndnueFfQx5e6neUmAI0B3oDPwD/AJ8Dvzcml5we+Al4D+gyeOaB1S0BrLHAut9iLqv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"],[1,"data:image/png;base64,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IHhtcE1NOkRvY3VtZW50SUQ9ImdpbXA6ZG9jaWQ6Z2ltcDo0MDc4NWMzNi00MDFkLTRhNmUtOTE4Ny0wNDU1MjgyYzRkZjYiCiAgIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6Nzg3YjYxN2YtMjg1MS00YzhlLTg2MTYtZWM3NGMwYzYwMWVlIgogICB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6ZTdhYTQxY2EtM2JiMy00ZTliLTk0NDEtOWU1M2ZlMmJmMzlmIgogICBkYzpGb3JtYXQ9ImltYWdlL3BuZyIKICAgR0lNUDpBUEk9IjIuMCIKICAgR0lNUDpQbGF0Zm9ybT0iV2luZG93cyIKICAgR0lNUDpUaW1lU3RhbXA9IjE2ODY2MTM5NDcxOTU2ODAiCiAgIEdJTVA6VmVyc2lvbj0iMi4xMC4zNCIKICAgdGlmZjpPcmllbnRhdGlvbj0iMSIKICAgeG1wOkNyZWF0b3JUb29sPSJHSU1QIDIuMTAiCiAgIHhtcDpNZXRhZGF0YURhdGU9IjIwMjM6MDY6MTNUMDI6NTI6MjUrMDM6MDAiCiAgIHhtcDpNb2RpZnlEYXRlPSIyMDIzOjA2OjEzVDAyOjUyOjI1KzAzOjAwIj4KICAgPHhtcE1NOkhpc3Rvcnk+CiAgICA8cmRmOlNlcT4KICAgICA8cmRmOmxpCiAgICAgIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiCiAgICAgIHN0RXZ0OmNoYW5nZWQ9Ii8iCiAgICAgIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6MjczNjZiZjQtZWRkMy00MTk4LTk2MmEtZTllMzkxMGU1OGJlIgogICAgICBzdEV2dDpzb2Z0d2FyZUFnZW50PSJHaW1wIDIuMTAgKFdpbmRvd3MpIgogICAgICBzdEV2dDp3aGVuPSIyMDIyLTA4LTIyVDAyOjU1OjM2Ii8+CiAgICAgPHJkZjpsaQogICAgICBzdEV2dDphY3Rpb249InNhdmVkIgogICAgICBzdEV2dDpjaGFuZ2VkPSIvIgogICAgICBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjk2NWUxMzc5LTBkOWYtNDk4Mi1hZDcwLTkzOGM5YzM5YTRmMyIKICAgICAgc3RFdnQ6c29mdHdhcmVBZ2VudD0iR2ltcCAyLjEwIChXaW5kb3dzKSIKICAgICAgc3RFdnQ6d2hlbj0iMjAyMi0wOS0xMVQxNjozNTowMCIvPgogICAgIDxyZGY6bGkKICAgICAgc3RFdnQ6YWN0aW9uPSJzYXZlZCIKICAgICAgc3RFdnQ6Y2hhbmdlZD0iLyIKICAgICAgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDoxMGZiYTBhMy05MjliLTQ1NGUtOGM0Yy04ZWQ4YzhhYmFkZGMiCiAgICAgIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkdpbXAgMi4xMCAoV2luZG93cykiCiAgICAgIHN0RXZ0OndoZW49IjIwMjMtMDYtMTBUMTc6NTA6MDkiLz4KICAgICA8cmRmOmxpCiAgICAgIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiCiAgICAgIHN0RXZ0OmNoYW5nZWQ9Ii8iCiAgICAgIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6MDBmYjM4YTMtZjZiMi00NjQ1LTliMTYtMjlhNWE0ODZlMjhhIgogICAgICBzdEV2dDpzb2Z0d2FyZUFnZW50PSJHaW1wIDIuMTAgKFdpbmRvd3MpIgogICAgICBzdEV2dDp3aGVuPSIyMDIzLTA2LTEzVDAyOjUyOjI3Ii8+CiAgICA8L3JkZjpTZXE+CiAgIDwveG1wTU06SGlzdG9yeT4KICA8L3JkZjpEZXNjcmlwdGlvbj4KIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAKPD94cGFja2V0IGVuZD0idyI/PsIRrtIAAAAGYktHRAD/AP8A/6C9p5MAAAAJcEhZcwAALiMAAC4jAXilP3YAAAAHdElNRQfnBgwXNBsqJURsAAAAGXRFWHRDb21tZW50AENyZWF0ZWQgd2l0aCBHSU1QV4EOFwAABF9JREFUeNrtmluIF1Ucxz9/E8P1VnnJ9dJWC4Frmq2JJmqolGEILoQvK2gZeXlRCSm1Fx9UEsJQERWsXhRftECs0Gq70EK9ZHlbFyHbds3VVXFX91+7664P81tYhpnfmft//st84TzMzDm/8/vOnPO7nYEMGTJkyJAhQ4YMGSJBLkJZw4FyYAIwDHgU+A9oAxqBv4C7xfyySoBlwKfAFaAb6DG0euAzoAoYXCxEnwH2A60eCGrtFrALGJNWokNEwY6QRO2tFXgPGJAmss8DlyImam/fASPTQHaeGJueBFod8FQhrfSLwM+ynDX8L1/oV+BP4LZY58eBUUAlMB94ycPSvQTMERmJ4jGgwYPh2Qg84VFmGbAP6DTI/aoQS/lzg1JfA2MDyn4ZuGaQvyZJspUGv3oKGBhyjmeBJmWOmxLMJIITiiIXIgwaZgFdylxbDeNHANXAZmAVUBpEiScNe2xRxC/3Y2WuRmUlLRHD1rd/HljvV4F3FAVqYlhNo4B7Pl/wdPEMbmOq/ShwRBH0Vkxb6LAy536fW64HuOpn8vOKoLKYCC9Q5rzs0L/JQxDjyYPkgHYXAW0xGslByrLuFuPUFw0eCI92mmiAQ4LgZoEbYyTcAZxVPsJk271ag7x6cWueCLvhfsyu8LzybKLtersUF9ywxe2BnXBnAZOUJuXZeNv1OSki3LLdzwPrgONuguw+7g7wAHjEoW+vEagAXgeelr1yUSZoCUn4hvJsqMO9byRaWyLGtFkiwOtBJnYzBKcVg/ZuSMIrlHl3RrWMnFK1OqX/q8oXOAisDqFLVxL7xonw9yHk7Q5RoxpuyLdjI3wmhLzBwMqAY0ck4SGcCNeKIQqKOTF84RtxEu4BPgohc2QM467HSRjgqBL5mBDUPU1Rnl1JwqBNUuJqrW0M+OLdYuk8Cdas38Rf4b3FR0HP/nLdZNYaioKbxSVuA6ZGQfoNvNWlO6VvEKxW5O5yGbNc4ml7ZrUtCtLjgGMSdjop9Q+wMIT8GoXwKw79ZxrKUG9r+a8flMoyr5AA4ybwo1QgggYHpZJ6Ou3Ta5IpddvufwEsVWQ2xFisCI1Nypf6RMmsIql4JI0S8bFuSs9UvmCgikeh8b6i8C/KuKOYD+VShzGSwLsprRnByYYYoSqNhE8qCv/kYfxrYjT7jmuPIC+PBWsVsl1YRzBeE45qqWGtwjo1SR0WoZ8a7KAfYa5h7/2OVaPuF1gqtS83srclpi565IAP0c+b7wOz+wPZckOc3Jt0LC52oiXABx7y6VasGnfRYgiwwRAu9raGqPLXQmAGcADvvyN+m9bgXnP4i4E9wN8+KiJ5WQG5QilumnioJP9lwHPANKw/fF7A+fxJw2ms/y9SFdiPBf4Vn9hJNL8T/iFxbyoxgej+m6zBOtnLpXlvhiXcDOyVJV8UCEL4KnBI/OnAtBP0q+ADMTq/SfshrdUFr4TzwJdY9d57WIdYzRIk1GMdeXSQIUOGDBmSwUMtd8u2ArdcUAAAAABJRU5ErkJggg=="],[2,"data:image/png;base64,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"],[3,"data:image/png;base64,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"]]),O=t=>B.getOrDefault(t,"");var E=class t{constructor(t){this.mi=t,(0,a.Mu)(this,"defaultStaffSizePx",1),(0,a.Mu)(this,"defaultStaffSpacePx",1),(0,a.Mu)(this,"defaultFontSizePx",1),(0,a.Mu)(this,"staffSizePx",1),(0,a.Mu)(this,"zoom",1),(0,a.Mu)(this,"staffSpacePx",1),(0,a.Mu)(this,"fontSizePx",1),(0,a.Mu)(this,"scoreEventListener"),(0,a.Mu)(this,"canvas"),(0,a.Mu)(this,"ctx"),(0,a.Mu)(this,"_doc"),(0,a.Mu)(this,"paint",ss.default),(0,a.Mu)(this,"cursorOverlays",new n.b1),(0,a.Mu)(this,"mousePos"),(0,a.Mu)(this,"curStaffPos"),(0,a.Mu)(this,"curObjects"),(0,a.Mu)(this,"hilightedStaffPos"),(0,a.Mu)(this,"hilightedObj"),(0,a.Mu)(this,"usingTouch",!1),(0,a.Mu)(this,"onClickFn"),(0,a.Mu)(this,"onMouseMoveFn"),(0,a.Mu)(this,"onMouseLeaveFn"),(0,a.Mu)(this,"onTouchEndFn"),(0,a.Mu)(this,"imageCache",new n.kM),(0,a.Mu)(this,"isAllDirty",!0),(0,a.Mu)(this,"dirtyOverlays",[]),(0,a.Mu)(this,"needDocUpdate",!0),(0,a.Mu)(this,"needCanvasUpdate",!0),this.defaultFontSizePx=this.fontSizePx=n.L_.FontSize*n.L_.DevicePixelRatio,this.defaultStaffSpacePx=this.staffSpacePx=.3*this.defaultFontSizePx,this.defaultStaffSizePx=this.staffSizePx=4*this.defaultStaffSpacePx,this.onClickFn=this.onClick.bind(this),this.onMouseMoveFn=this.onMouseMove.bind(this),this.onMouseLeaveFn=this.onMouseLeave.bind(this),this.onTouchEndFn=this.onTouchEnd.bind(this)}getMusicInterface(){return this.mi}get doc(){return this._doc}getImageAsset(t,e){var i;return null!=e||(e=""),null==(i=this.imageCache.getOrCreate(t,e,()=>{const i={src:O(t),color:e,loaded:!1,colorized:!1},s=new Image;return s.src=i.src,s.onload=()=>{i.img=s,this.onImageLoaded(i)},s.onerror=()=>{console.error("Failed to load image: "+i.src)},i}))?void 0:i.img}drawAfterImageLoaded(){this.needDocUpdate=!0,this.needCanvasUpdate=!0,this.draw()}onImageLoaded(t){if(t.loaded||!t.img)return;const e=this.paint.getColor(t.color);if(t.colorized||""===e||"black"===e||"#000"===e||"#0000"===e||"#000000"===e||"#00000000"===e)return this.drawAfterImageLoaded(),void(t.loaded=!0);const[i,s,n,a]=ss.colorNameToRGBA(e);if("undefined"==typeof document)return void console.error("Failed to colorize image: document is undefined.");const o=document.createElement("canvas");o.width=t.img.width,o.height=t.img.height;const r=o.getContext("2d");if(null==r)return void console.error("Failed to colorize image: ctx = null.");r.drawImage(t.img,0,0);const h=r.getImageData(0,0,o.width,o.height),c=h.data;for(let u=0;u<c.length;u+=4){const t=c[u],e=c[u+1],a=c[u+2];0!==c[u+3]&&(t<40&&e<40&&a<40&&(c[u+0]=i,c[u+1]=s,c[u+2]=n))}r.putImageData(h,0,0),t.img.src=o.toDataURL("image/png"),t.img.onload=()=>{t.colorized=!0,this.onImageLoaded(t)},t.img.onerror=()=>{console.error("Failed to colorize image.")}}setDocument(t){if(t&&t===this._doc)return;let e=this._doc;this._doc=t,e&&e.removeView(this),t&&t.addView(this),this.needDocUpdate=!0,this.needCanvasUpdate=!0}updateDoc(){var t,e;null==(t=this.doc)||t.requestFullLayout(),null==(e=this.doc)||e.layout(this),this.isAllDirty=!0,this.dirtyOverlays=[],this.cursorOverlays.clear(),this.hilightedObj=void 0,this.hilightedStaffPos=void 0}setPaint(t){this.paint=null!=t?t:ss.default}setZoom(t){if(!n.I8.isFinite(t)||!n.I8.isNumberGt(t,0))throw new D("Invalid zoom: "+t);this.updateSize({zoom:t})}setStaffSize(t){let e;switch(t){case"small":e=this.defaultStaffSizePx/1.5;break;case"medium":case"default":e=this.defaultStaffSizePx;break;case"large":e=1.5*this.defaultStaffSizePx;break;default:e=n.L_.unitToPx(t)*n.L_.DevicePixelRatio}if(!n.I8.isFinite(e)||!n.I8.isNumberGt(e,0))throw new D("Invalid staffSize: "+t);this.updateSize({staffSizePx:e})}updateSize({zoom:t,staffSizePx:e}){var i;this.zoom=null!=t?t:this.zoom,this.staffSizePx=null!=e?e:this.staffSizePx,this.staffSpacePx=this.staffSizePx/4*this.zoom,this.fontSizePx=this.defaultFontSizePx*(this.staffSpacePx/this.defaultStaffSpacePx),null==(i=this.doc)||i.requestFullLayout()}get lineWidthPx(){return.2*this.staffSpacePx}get unitSize(){return this.staffSpacePx}getPaint(){return this.paint}setCanvas(t){var e;this.canvas!==t&&(this.canvas&&(this.canvas.removeEventListener("click",this.onClickFn),this.canvas.removeEventListener("mousemove",this.onMouseMoveFn),this.canvas.removeEventListener("mouseleave",this.onMouseLeaveFn),this.canvas.removeEventListener("touchend",this.onTouchEndFn)),this.canvas=t,t?(this.canvas.addEventListener("click",this.onClickFn),this.canvas.addEventListener("mousemove",this.onMouseMoveFn),this.canvas.addEventListener("mouseleave",this.onMouseLeaveFn),this.canvas.addEventListener("touchend",this.onTouchEndFn),this.canvas.style.position="relative",this.ctx=null!=(e=this.canvas.getContext("2d"))?e:void 0):this.ctx=void 0,this.needCanvasUpdate=!0)}setScoreEventListener(t){this.scoreEventListener=t}needMouseInput(){return void 0!==this.scoreEventListener}getMousePos(t){return new n.l2(t.offsetX,t.offsetY)}updateCurStaffPos(t,e){let i=(s=t,n=this.curStaffPos,!(!s&&!n||s&&n&&s.staff===n.staff&&s.measure===n.measure&&s.diatonicId===n.diatonicId));var s,n;if(i&&this.curStaffPos&&this.scoreEventListener){let{staff:t,measure:e,diatonicId:i,accidental:s}=this.curStaffPos;this.scoreEventListener(new Ms("leave",this.getMusicInterface(),t.row.getMusicInterface(),i)),e&&void 0!==s&&this.scoreEventListener(new vs("leave",this.getMusicInterface(),t.getMusicInterface(),e.getMusicInterface(),i,s))}if(i&&t&&this.scoreEventListener){let{staff:e,measure:i,diatonicId:s,accidental:n}=t;this.scoreEventListener(new Ms("enter",this.getMusicInterface(),e.row.getMusicInterface(),s)),i&&void 0!==n&&this.scoreEventListener(new vs("enter",this.getMusicInterface(),e.getMusicInterface(),i.getMusicInterface(),s,n))}if(e&&t&&this.scoreEventListener){let{staff:e,measure:i,diatonicId:s,accidental:n}=t;this.scoreEventListener(new Ms("click",this.getMusicInterface(),e.row.getMusicInterface(),s)),i&&void 0!==n&&this.scoreEventListener(new vs("click",this.getMusicInterface(),e.getMusicInterface(),i.getMusicInterface(),s,n))}return this.curStaffPos=t,i}updateCurObjects(t,e){let i=(s=t,n=this.curObjects,!(!s&&!n||s&&n&&s.length===n.length&&s.every((t,e)=>t===n[e])));var s,n;return i&&this.curObjects&&this.curObjects.length>0&&this.scoreEventListener&&this.scoreEventListener(new Ns("leave",this.getMusicInterface(),this.curObjects.map(t=>t.getMusicInterface()))),i&&t&&t.length>0&&this.scoreEventListener&&this.scoreEventListener(new Ns("enter",this.getMusicInterface(),t.map(t=>t.getMusicInterface()))),e&&t&&t.length>0&&this.scoreEventListener&&this.scoreEventListener(new Ns("click",this.getMusicInterface(),t.map(t=>t.getMusicInterface()))),this.curObjects=t,i}onClick(t){let{doc:e}=this;if(this.needMouseInput()&&e&&(this.mousePos=this.txFromScreenCoord(this.getMousePos(t)),this.scoreEventListener)){let t=e.pick(this.mousePos.x,this.mousePos.y),i=e.pickStaffPosAt(this.mousePos.x,this.mousePos.y),s=this.updateCurStaffPos(i,!0),n=this.updateCurObjects(t,!0);(s||n)&&this.draw()}}onMouseMove(t){let{doc:e}=this;if(this.needMouseInput()&&e&&(this.mousePos=this.txFromScreenCoord(this.getMousePos(t)),!this.usingTouch)){let t=e.pick(this.mousePos.x,this.mousePos.y),i=e.pickStaffPosAt(this.mousePos.x,this.mousePos.y),s=this.updateCurStaffPos(i,!1),n=this.updateCurObjects(t,!1);(s||n)&&this.draw()}}onMouseLeave(t){if(!this.needMouseInput())return;this.mousePos=void 0;let e=this.updateCurStaffPos(void 0,!1),i=this.updateCurObjects(void 0,!1);(e||i)&&this.draw()}onTouchEnd(t){this.usingTouch=!0}hilightObject(t){this.hilightedObj!==t&&(this.hilightedObj&&this.dirtyOverlays.forEach(t=>{t.ref===this.hilightedObj&&(t.dispose=!0)}),t&&(this.dirtyOverlays=this.dirtyOverlays.filter(e=>e.ref!==t),this.dirtyOverlays.push({rect:new n.rw(t.getRect()),ref:t})),this.hilightedObj=t)}hilightStaffPos(t){this.hilightedStaffPos&&this.dirtyOverlays.forEach(t=>{var e;t.ref===(null==(e=this.hilightedStaffPos)?void 0:e.measure)&&(t.dispose=!0)}),(null==t?void 0:t.measure)&&(this.dirtyOverlays=this.dirtyOverlays.filter(e=>e.ref!==t.measure),this.dirtyOverlays.push({rect:new n.rw(t.measure.getRect()),ref:t.measure})),this.hilightedStaffPos=t}updateCursorOverlay(t,e){this.dirtyOverlays=this.dirtyOverlays.filter(e=>e.ref!==t);const i=this.cursorOverlays.get(t);if(i&&this.dirtyOverlays.push({rect:i.rect,ref:i.ref,dispose:!0}),e){const i={rect:e,ref:t};this.cursorOverlays.set(t,i),this.dirtyOverlays.push(i)}else this.cursorOverlays.delete(t);this.draw()}updateCanvas(){let{canvas:e,doc:i,ctx:s}=this;if(!e||!s)return;let a=1,o=1;if(i){let t=i.getRect();a=t.width+1,o=t.height+1}else{s.save(),s.font=t.NoDocumentFont;const e=s.measureText(t.NoDocumentText);s.restore(),a=Math.ceil(e.width),o=Math.ceil(e.actualBoundingBoxAscent+e.actualBoundingBoxDescent)}e.width=a,e.height=o,e.style.width=a/n.L_.DevicePixelRatio+"px",e.style.height=o/n.L_.DevicePixelRatio+"px"}drawStaticContent(t){var e;null==(e=this.doc)||e.draw(this,t)}drawOverlayContent(t){this.drawHilightStaffPos(t),this.drawHilightObj(t),this.drawCursorOverlays(t)}draw(){this.needDocUpdate&&(this.updateDoc(),this.needDocUpdate=!1),this.needCanvasUpdate&&(this.updateCanvas(),this.needCanvasUpdate=!1);try{let{doc:t}=this;if(!t)return void this.drawNoDoc();if(this.isAllDirty)return this.drawBackground(),this.drawOverlayContent(),this.drawStaticContent(),void(this.isAllDirty=!1);const e=1.5*this.lineWidthPx+.5*this.unitSize;this.dirtyOverlays=this.dirtyOverlays.filter(t=>{this.save();const i=t.rect.inflateCopy(e,e);return this.clipRect(i.left,i.top,i.width,i.height),this.drawBackground(i),this.drawOverlayContent(i),this.drawStaticContent(i),this.restore(),!t.dispose})}catch(t){console.error("Render failed!",t)}}drawNoDoc(){const{canvas:e,ctx:i}=this;e&&i&&(i.save(),i.font=t.NoDocumentFont,i.textBaseline="top",i.fillStyle="#FFF",i.fillRect(0,0,e.width,e.height),i.fillStyle="red",i.fillText(t.NoDocumentText,0,0),i.restore())}drawHilightStaffPos(t){let{mousePos:e,hilightedStaffPos:i,unitSize:s}=this;if(!i)return;let{staff:a,measure:o,diatonicId:r}=i;const h=a.getDiatonicIdY(r),c=a.row.getMeasures(),u=o?o.getRect().left:c[0].getRect().left,l=o?o.getRect().right:c[c.length-1].getRect().right,d=new n.rw(u,h-s,l-u,2*s);t&&!t.intersects(d)||(this.fillColor(this.paint.colors["hilight.staffpos"]).fillRect(d.left,d.top,d.width,d.height),void 0!==e&&this.drawLedgerLines(a,r,e.x))}drawHilightObj(t){var e;let i=null==(e=this.hilightedObj)?void 0:e.getRect();!i||t&&!t.intersects(i)||(this.lineColor(this.paint.colors["hilight.object"]),this.strokeRect(i.left,i.top,i.width,i.height))}drawCursorOverlays(t){for(const[e,i]of this.cursorOverlays)t&&!t.intersects(i.rect)||this.color(this.paint.colors["play.cursor"]).lineWidth(2).strokeLine(i.rect.centerX,i.rect.top,i.rect.centerX,i.rect.bottom)}txFromScreenCoord(t){return t.mul(n.L_.DevicePixelRatio)}txToScreenCoord(t){return t.div(n.L_.DevicePixelRatio)}drawBackground(t){if(this.ctx){const e=this.doc?this.doc.getBackground(this.paint.colors.background):this.paint.colors.background;null!=t||(t=new n.rw(0,0,this.ctx.canvas.width,this.ctx.canvas.height)),this.ctx.canvas.style.background=e,this.ctx.clearRect(t.left,t.top,t.width,t.height)}}drawDebugRect(t){c&&this.color("red").lineWidth(1).strokeRect(t.left,t.top,t.width,t.height)}drawLedgerLines(t,e,i){let{unitSize:s}=this,n=s*L;if(e>=t.topLineDiatonicId+2){for(let a=t.topLineDiatonicId+2;a<=e;a+=2)if(t.containsDiatonicId(a)){let e=t.getDiatonicIdY(a);this.strokeLine(i-n/2,e,i+n/2,e)}}else if(e<=t.bottomLineDiatonicId-2)for(let a=t.bottomLineDiatonicId-2;a>=e;a-=2)if(t.containsDiatonicId(a)){let e=t.getDiatonicIdY(a);this.strokeLine(i-n/2,e,i+n/2,e)}}getRestRect(t){let{unitSize:e}=this,{flagCount:i}=o.NoteLengthProps.get((0,o.validateNoteLength)(t+"n")),s=0,a=0,r=0,h=0;if(o.NoteLengthProps.equals(t,o.NoteLength.Whole))s=e,a=e,r=0,h=e;else if(o.NoteLengthProps.equals(t,o.NoteLength.Half))s=e,a=e,r=e,h=0;else if(o.NoteLengthProps.equals(t,o.NoteLength.Quarter))s=1*e,a=1*e,r=3.2*e,h=3*e;else{let t=1-i%2;s=e*(1+.25*i),a=e*(1+.125*i),r=e*(.5+i-t),h=e*(1+i+t)}return new n.vW(-s,0,a,-r,0,h)}drawRest(t,e,i){let{unitSize:s}=this,{flagCount:n}=o.NoteLengthProps.get((0,o.validateNoteLength)(t+"n"));if(o.NoteLengthProps.equals(t,o.NoteLength.Whole))this.fillRect(e-s,i,2*s,s);else if(o.NoteLengthProps.equals(t,o.NoteLength.Half))this.fillRect(e-s,i-s,2*s,s);else if(o.NoteLengthProps.equals(t,o.NoteLength.Quarter))this.beginPath(),this.moveTo(e-.6*s,i-3.2*s),this.lineTo(e+.7*s,i-1.5*s),this.quadraticCurveTo(e-.8*s,i-.5*s,e+1*s,i+1.5*s),this.lineTo(e-1*s,i-.75*s),this.quadraticCurveTo(e+.2*s,i-1.5*s,e-.6*s,i-3.2*s),this.moveTo(e+1*s,i+1.5*s),this.quadraticCurveTo(e-.8*s,i+1*s,e-.2*s,i+2.8*s),this.bezierCurveTo(e-1.8*s,i+1.5*s,e-.6*s,i-.2*s,e+.9*s,i+1.5*s),this.fill(),this.stroke();else if(n>0){let t=1-n%2,a=t=>e+(.25*-t+.5)*s,o=e=>i+(e+t)*s;this.beginPath(),this.moveTo(a(1+n),o(1+n)),this.lineTo(a(-.5-n),o(-.5-n)),this.stroke();for(let e=0;e<n;e++){let t=n-2*e;this.beginPath(),this.moveTo(a(t-2.5),o(t-2.5)),this.quadraticCurveTo(a(t-.5)+.25*s,o(t-1.5),a(t-1.5)-1.5*s,o(t-1.5)),this.stroke(),this.beginPath(),this.arc(a(t-2)-1.5*s,o(t-2),.5*s,0,2*Math.PI),this.fill()}}}color(t){return this.ctx&&(this.ctx.strokeStyle=this.ctx.fillStyle=this.paint.getColor(t)),this}lineColor(t){return this.ctx&&(this.ctx.strokeStyle=this.paint.getColor(t)),this}fillColor(t){return this.ctx&&(this.ctx.fillStyle=this.paint.getColor(t)),this}lineWidth(t){return this.ctx&&(this.ctx.lineWidth=this.lineWidthPx*(null!=t?t:1)),this}font(t){return this.ctx&&(this.ctx.font=t),this}beginPath(){return this.ctx&&this.ctx.beginPath(),this}stroke(){return this.ctx&&this.ctx.stroke(),this}fill(){return this.ctx&&this.ctx.fill(),this}moveTo(t,e){return this.ctx&&this.ctx.moveTo(t,e),this}lineTo(t,e){return this.ctx&&this.ctx.lineTo(t,e),this}bezierCurveTo(t,e,i,s,n,a){return this.ctx&&this.ctx.bezierCurveTo(t,e,i,s,n,a),this}quadraticCurveTo(t,e,i,s){return this.ctx&&this.ctx.quadraticCurveTo(t,e,i,s),this}fillRect(t,e,i,s){return this.ctx&&this.ctx.fillRect(t,e,i,s),this}setLineDash(t){return this.ctx&&this.ctx.setLineDash(t),this}drawImage(t,e,i,s,n){return this.ctx&&this.ctx.drawImage(t,e,i,s,n),this}ellipse(t,e,i,s,n,a,o){return this.ctx&&this.ctx.ellipse(t,e,i,s,n,a,o),this}clipRect(t,e,i,s){return this.ctx?(this.ctx.beginPath(),this.ctx.rect(t,e,i,s),this.ctx.clip(),this):this}save(){return this.ctx&&this.ctx.save(),this}restore(){return this.ctx&&this.ctx.restore(),this}rect(t,e,i,s){return this.ctx&&this.ctx.rect(t,e,i,s),this}scale(t,e){return this.ctx&&this.ctx.scale(t,e),this}strokeRect(t,e,i,s){return this.ctx&&this.ctx.strokeRect(t,e,i,s),this}fillText(t,e,i){return this.ctx&&this.ctx.fillText(t,e,i),this}getTextWidth(t,e){if(this.ctx){let i=this.ctx.font;this.ctx.font=e;let s=this.ctx.measureText(t);return this.ctx.font=i,s.width}return n.OZ.Dom.getCanvasTextWidth(t,e)}arc(t,e,i,s,n){return this.ctx&&this.ctx.arc(t,e,i,s,n),this}fillCircle(t,e,i){return this.ctx?(this.ctx.beginPath(),this.ctx.arc(t,e,i,0,2*Math.PI),this.ctx.fill(),this):this}strokeLine(t,e,i,s){return this.ctx?(this.ctx.beginPath(),this.ctx.moveTo(t,e),this.ctx.lineTo(i,s),this.ctx.stroke(),this):this}strokePartialLine(t,e,i,s,n,a){if(!this.ctx)return this;let o=t+(i-t)*n,r=e+(s-e)*n,h=t+(i-t)*a,c=e+(s-e)*a;return this.ctx.beginPath(),this.ctx.moveTo(o,r),this.ctx.lineTo(h,c),this.ctx.stroke(),this}drawBracket(t,e){if(!this.ctx)return this;let{left:i,right:s,width:n,top:a,bottom:o,height:r,anchorY:h}=t;switch([")","]","}",">"].includes(e)&&([i,s,n]=[s,i,-n]),e){case"(":case")":this.ctx.beginPath(),this.ctx.moveTo(s,a),this.ctx.bezierCurveTo(i-.2*n,a+.3*r,i-.2*n,a+.7*r,s,o),this.ctx.stroke();break;case"{":case"}":this.ctx.beginPath(),this.ctx.moveTo(s,a),this.ctx.bezierCurveTo(i+.1*n,a,i+.8*n,h,i,h),this.ctx.moveTo(s,o),this.ctx.bezierCurveTo(i+.1*n,o,i+.8*n,h,i,h),this.ctx.stroke();break;case"[":case"]":this.ctx.beginPath(),this.ctx.moveTo(s,a),this.ctx.lineTo(i,a),this.ctx.lineTo(i,o),this.ctx.lineTo(s,o),this.ctx.stroke();break;case"<":case">":this.ctx.beginPath(),this.ctx.moveTo(s,a),this.ctx.lineTo(i,h),this.ctx.lineTo(s,o),this.ctx.stroke()}return this}getSymbolRect(t){const{unitSize:e}=this,i=A*e;switch(t){case 0:default:return n.vW.createCentered(0,0,2.5*e,2.5*e);case 1:case 3:return n.vW.createCentered(0,0,i,i);case 2:return n.vW.createCentered(0,0,3.75*e,2.5*e);case 11:case 10:return n.vW.createCentered(0,0,p*e,C*e);case 13:case 12:return n.vW.createCentered(0,0,I*e,I*e);case 5:return n.vW.createCentered(0,0,2*e,1.25*e);case 6:return n.vW.createCentered(0,0,1.25*e,2*e);case 7:return n.vW.createCentered(0,0,2*e,.25*e);case 8:return n.vW.createCentered(0,0,2.3*e+i,i);case 4:return n.vW.createCentered(0,0,1.1*e,1.3*i)}}drawSymbol(t,e,i=!1,s=!1){if(!this.ctx)return this;let{unitSize:n}=this,{left:a,right:o,top:r,bottom:h,width:c,height:u,anchorX:l,anchorY:d,centerX:g,centerY:f}=e,{leftw:m,rightw:p,toph:C,bottomh:I}=e;switch(i&&([a,o]=[o,a],[m,p]=[p,m],c=-c),s&&([r,h]=[h,r],[C,I]=[I,C],u=-u),t){case 0:default:this.lineWidth(1),this.beginPath(),this.rect(a,r,c,u),this.moveTo(a,h),this.lineTo(o,r),this.moveTo(a,r),this.lineTo(o,h),this.stroke();break;case 1:case 3:this.fillCircle(l,d,c/2);break;case 2:this.lineWidth(1),this.beginPath(),this.moveTo(a,h),this.bezierCurveTo(a,r-u/4,o,r-u/4,o,h),this.bezierCurveTo(o,r,a,r,a,h),this.stroke(),this.fill(),this.fillCircle(g,h-u/5,Math.abs(u/6));break;case 9:this.lineWidth(1),this.beginPath(),this.moveTo(a,r),this.bezierCurveTo(a,.75*r+.25*h,a+1.5*c,.5*r+.5*h,a+.5*c,h),this.stroke();break;case 10:this.beginPath(),this.ellipse(l,d,m,C,-.3,0,2*Math.PI),this.stroke();break;case 11:this.beginPath(),this.ellipse(l,d,m,C,-.3,0,2*Math.PI),this.fill();break;case 12:this.beginPath(),this.lineWidth(2.5),this.moveTo(l,r),this.lineTo(o,d),this.moveTo(a,d),this.lineTo(l,h),this.stroke(),this.beginPath(),this.lineWidth(1),this.moveTo(o,d),this.lineTo(l,h),this.moveTo(l,r),this.lineTo(a,d),this.stroke();break;case 13:this.beginPath(),this.moveTo(l,r),this.lineTo(o,d),this.lineTo(l,h),this.lineTo(a,d),this.lineTo(l,r),this.fill();break;case 5:this.beginPath(),this.moveTo(a,r),this.lineTo(o,f),this.lineTo(a,h),this.stroke();break;case 6:this.beginPath(),this.moveTo(a,h),this.lineTo(g,r),this.lineTo(o,h),this.stroke();break;case 7:this.beginPath(),this.moveTo(a,f),this.lineTo(o,f),this.stroke();break;case 8:this.beginPath(),this.moveTo(a,f),this.lineTo(a+2*n,f),this.stroke(),this.fillCircle(o-u/2,d,u/2);break;case 4:this.beginPath(),this.moveTo(a,r),this.lineTo(g,h),this.lineTo(o,r),this.fill()}return this}};(0,a.Mu)(E,"NoDocumentText","WmsView: No Document!"),(0,a.Mu)(E,"NoDocumentFont","16px Arial");var j=E,k=class{constructor(t){(0,a.Mu)(this,"head"),(0,a.Mu)(this,"tail"),this.head=t,this.tail=[]}getHead(){return this.head}getTails(){return this.tail}addTail(t){this.tail.push(t)}detachTail(t){let e=this.tail.indexOf(t);e>=0&&this.tail.splice(e,1)}},G=class{constructor(t){this.parent=t,(0,a.Mu)(this,"anchoredLayoutObjects",[]),(0,a.Mu)(this,"link"),(0,a.Mu)(this,"userData",{}),(0,a.Mu)(this,"rect",new n.vW),(0,a.Mu)(this,"needRectUpdate",!0)}getParent(){return this.parent}requestRectUpdate(){this.needRectUpdate=!0}updateRect(){}forceRectUpdate(){this.needRectUpdate=!0,this.updateRect(),this.needRectUpdate=!1}getRect(){return this.needRectUpdate&&this.forceRectUpdate(),this.rect}offsetX(t){this.offset(t,0)}offsetY(t){this.offset(0,t)}setLeft(t){this.offset(t-this.getRect().left,0)}setRight(t){this.offset(t-this.getRect().right,0)}setTop(t){this.offset(0,t-this.getRect().top)}setBottom(t){this.offset(0,t-this.getRect().bottom)}setAnchor(t,e){this.offset(t-this.getRect().anchorX,e-this.getRect().anchorY)}setAnchorX(t){this.offset(t-this.getRect().anchorX,0)}setAnchorY(t){this.offset(0,t-this.getRect().anchorY)}setCenter(t,e){this.offset(t-this.getRect().centerX,e-this.getRect().centerY)}setCenterX(t){this.offset(t-this.getRect().centerX,0)}setCenterY(t){this.offset(0,t-this.getRect().centerY)}getShapeRects(){return[this.rect]}addAnchoredLayoutObject(t){this.anchoredLayoutObjects.push(t)}getAnchoredLayoutObjects(){return this.anchoredLayoutObjects}setLink(t){this.link=t}getLink(){return this.link}isLinked(){return null!==this.link}intersects(t){return!t||this.getRect().intersects(t)}},F=class extends G{constructor(t,e,i,s,n){super(t),this.symbol=e,this.flipX=i,this.flipY=s,this.color=n,(0,a.Mu)(this,"mi"),this.mi=this instanceof W?new _e(this):new Qe(this)}getMusicInterface(){return this.mi}pick(t,e){return this.rect.contains(t,e)?[this]:[]}layout(t){this.rect=t.getSymbolRect(this.symbol)}offset(t,e){this.rect.offsetInPlace(t,e)}draw(t,e){this.intersects(e)&&(t.color(this.color),t.drawSymbol(this.symbol,this.rect,this.flipX,this.flipY))}},W=class extends F{constructor(t,e,i){super(t,2,!1,e,i)}getMusicInterface(){return this.mi}},Y=class{constructor(t){this.measure=t,(0,a.Mu)(this,"accidentalByDiatonicId",[])}getAccidentalFromKeySignature(t){let e=this.measure.getKeySignature().getOrderedAccidentalNotes().find(e=>e.diatonicClass===o.Note.getDiatonicClass(t));return e?e.accidental:void 0}setAccidental(t){this.accidentalByDiatonicId[t.diatonicId]=t.accidental}needAccidental(t){var e,i;let s=null!=(i=null!=(e=this.accidentalByDiatonicId[t.diatonicId])?e:this.getAccidentalFromKeySignature(t.diatonicId))?i:0;return t.accidental!==s}},U=class extends G{constructor(t,e,i,s,n){super(t),this.image=e,this.anchorX=i,this.anchorY=s,this.imageScale=n,(0,a.Mu)(this,"mi"),this.mi=new ii(this)}getMusicInterface(){return this.mi}pick(t,e){return this.rect.contains(t,e)?[this]:[]}layout(t){let{anchorX:e,anchorY:i,image:s,imageScale:a}=this,{unitSize:o}=t;try{let t=s.naturalWidth*a*o,r=s.naturalHeight*a*o;this.rect=n.vW.createSections(t*e,t*(1-e),r*i,r*(1-i))}catch(r){this.rect=new n.vW}}offset(t,e){this.rect.offsetInPlace(t,e)}draw(t,e){if(!this.intersects(e))return;let i=this.rect;t.drawDebugRect(i),t.drawImage(this.image,i.anchorX-i.leftw,i.anchorY-i.toph,i.width,i.height)}},z=class extends G{constructor(t,e,i,s="black"){super(t),this.diatonicId=e,this.accidental=i,this.color=s,(0,a.Mu)(this,"mi"),this.mi=new ke(this)}getMusicInterface(){return this.mi}pick(t,e){return this.rect.contains(t,e)?[this]:[]}layout(t){let{unitSize:e}=t;switch(this.accidental){case-2:this.rect=n.vW.createSections(1.25*e,1.25*e,4*e,1.2*e);break;case-1:this.rect=n.vW.createSections(.75*e,.75*e,4*e,1.2*e);break;case 0:this.rect=n.vW.createSections(.75*e,.75*e,2.2*e,2.2*e);break;case 1:this.rect=n.vW.createSections(.75*e,.75*e,2*e,2*e);break;case 2:this.rect=n.vW.createSections(1*e,1*e,1*e,1*e);break;default:throw new D("Invalid accidental value: "+this.accidental)}}offset(t,e){this.rect.offsetInPlace(t,e)}draw(t,e){if(!this.intersects(e))return;t.drawDebugRect(this.rect);let{unitSize:i}=t,{accidental:s}=this,n=this.rect.anchorX,a=this.rect.anchorY;t.color(this.color);const o=(e,s)=>{t.lineWidth(1).beginPath().moveTo(e-.75*i,s-4*i).lineTo(e-.75*i,s+1.1*i).bezierCurveTo(e+.75*i,s-0*i,e+.75*i,s-2.2*i,e-.75*i,s-.5*i).stroke()};-2===s?(o(n-.5*i,a),o(n+.5*i,a)):-1===s&&o(n,a),0===s?t.beginPath().lineWidth(1).moveTo(n-.5*i,a-2.2*i).lineTo(n-.5*i,a+1*i).moveTo(n+.5*i,a+2.2*i).lineTo(n+.5*i,a-1*i).stroke().beginPath().lineWidth(2).moveTo(n-.5*i,a+1*i).lineTo(n+.5*i,a+.6*i).moveTo(n+.5*i,a-1*i).lineTo(n-.5*i,a-.6*i).stroke():1===s?t.lineWidth(1).beginPath().moveTo(n-.3*i,a-1.6*i).lineTo(n-.3*i,a+2*i).moveTo(n+.3*i,a-2*i).lineTo(n+.3*i,a+1.6*i).stroke().lineWidth(2).beginPath().moveTo(n-.75*i,a-.5*i).lineTo(n+.75*i,a-.9*i).moveTo(n-.75*i,a+.9*i).lineTo(n+.75*i,a+.5*i).stroke():2===s&&t.lineWidth(1).beginPath().moveTo(n-.75*i,a-.75*i).lineTo(n+.75*i,a+.75*i).moveTo(n-.75*i,a+.75*i).lineTo(n+.75*i,a-.75*i).stroke().fillRect(n-1*i,a-1*i,.7*i,.7*i).fillRect(n+.3*i,a-1*i,.7*i,.7*i).fillRect(n-1*i,a+.3*i,.7*i,.7*i).fillRect(n+.3*i,a+.3*i,.7*i,.7*i)}},V=class extends G{constructor(t,e,i,s){var o,r,h,c,u,l;super(t),this.anchorX=i,this.anchorY=s,(0,a.Mu)(this,"text"),(0,a.Mu)(this,"scale"),(0,a.Mu)(this,"color"),(0,a.Mu)(this,"bold"),(0,a.Mu)(this,"italic"),(0,a.Mu)(this,"boxed"),(0,a.Mu)(this,"padding"),(0,a.Mu)(this,"bgcolor"),(0,a.Mu)(this,"font",""),(0,a.Mu)(this,"textLines"),(0,a.Mu)(this,"lineWidths",[]),(0,a.Mu)(this,"lineHeight",0),(0,a.Mu)(this,"mi");let d="string"==typeof e?{text:e}:e;this.text=d.text,this.scale=null!=(o=d.scale)?o:1,this.color=null!=(r=d.color)?r:"black",this.bold=null!=(h=d.bold)&&h,this.italic=null!=(c=d.italic)&&c,this.boxed=null!=(u=d.boxed)&&u,this.padding=null!=(l=d.padding)?l:this.boxed?.5:0,this.bgcolor=d.bgcolor,(!isFinite(this.padding)||this.padding<0)&&(this.padding=0),this.textLines=this.text.split("\n"),0===this.textLines.length&&(this.textLines=[""]),this.rect=new n.vW,this.mi=new Wi(this)}getMusicInterface(){return this.mi}getText(){return this.text}pick(t,e){return this.rect.contains(t,e)?[this]:[]}layout(t){let{scale:e,anchorX:i,anchorY:s,bold:a,italic:o}=this,r=t.fontSizePx*e;this.font=(o?"italic ":"")+(a?"bold ":"")+r+"px Times New Roman",this.lineWidths=this.textLines.map(e=>t.getTextWidth(e,this.font)),this.lineHeight=r;let h=this.padding*t.unitSize,c=h+Math.max(...this.lineWidths)+h,u=h+this.lineHeight*this.textLines.length+h;"square"!==this.boxed&&"circle"!==this.boxed||(u=c=Math.max(u,c)),this.rect=n.vW.createSections(c*i,c*(1-i),u*s,u*(1-s))}offset(t,e){this.rect.offsetInPlace(t,e)}draw(t,e){var i;if(!this.intersects(e))return;t.drawDebugRect(this.rect),t.lineWidth(1).font(this.font);let{rect:s,padding:n,lineHeight:a,lineWidths:o,anchorX:r,anchorY:h,italic:c}=this;void 0!==this.bgcolor&&(t.save(),t.fillColor(null!=(i=this.bgcolor)?i:"black"),t.beginPath(),t.fillRect(s.left,s.top,s.width,s.height),t.fill(),t.restore());let u=this.textLines.length*a,l=-a*(c?.25:.2),d=n*t.unitSize,g=(s.left+d)*(1-r)+(s.right-d)*r,f=(s.top+d)*(1-h)+(s.bottom-d)*h;switch(t.color(this.color),this.textLines.forEach((e,i)=>{let s=g-o[i]*r,n=f-u*h+a*(i+1)+l;t.fillText(e,s,n)}),this.boxed){case"square":case"rectangle":t.strokeRect(s.left,s.top,s.width,s.height);break;case"circle":case"ellipse":t.beginPath(),t.ellipse(s.centerX,s.centerY,s.width/2,s.height/2,0,0,2*Math.PI),t.stroke()}}};function Z(t){return["black","#000","#0000","#000000","#00000000"].includes(t)?"":t}var q=class extends G{constructor(t,e){super(t),this.measure=t,this.staff=e,(0,a.Mu)(this,"clefImage"),(0,a.Mu)(this,"eightBelowClef"),(0,a.Mu)(this,"measureNumber"),(0,a.Mu)(this,"ksNeutralizeAccidentals",[]),(0,a.Mu)(this,"ksNewAccidentals",[]),(0,a.Mu)(this,"beatCountText"),(0,a.Mu)(this,"beatSizeText"),(0,a.Mu)(this,"tsImage"),(0,a.Mu)(this,"tempoText"),(0,a.Mu)(this,"mi"),this.mi=new Di(this)}get doc(){return this.measure.doc}getMusicInterface(){return this.mi}updateClefImage(t,e){if(e){const e=this.doc.getColorWithKey("staff.signature.clef");let i=t.getImageAsset(this.staff.clefImageAsset,Z(e));this.clefImage=i?new U(this,i,0,.5,.1):void 0,this.eightBelowClef=this.clefImage&&this.staff.isOctaveDown?new V(this,{text:"8",color:e},.5,0):void 0}else this.clefImage=void 0}updateMeasureNumber(t){if(t){const t=this.doc.getColorWithKey("staff.signature.measurenum"),e=this.measure.getMeasureNumber().toString();this.measureNumber=new V(this,{text:e,color:t},0,1)}else this.measureNumber=void 0}updateKeySignature(t){if(t){let{measure:t}=this;const e=this.doc.getColorWithKey("staff.signature.key");let i=t.getPrevMeasure(),s=i?i.getKeySignature():void 0,n=t.getKeySignature();this.ksNeutralizeAccidentals=[],this.ksNewAccidentals=[],s&&!o.KeySignature.equals(n,s)&&s.getOrderedAccidentalNotes().forEach(t=>{this.ksNeutralizeAccidentals.push(new z(this,this.getAccidentalDiatonicId(t),0,e))}),n.getOrderedAccidentalNotes().forEach(t=>{this.ksNewAccidentals.push(new z(this,this.getAccidentalDiatonicId(t),t.accidental,e))})}else this.ksNeutralizeAccidentals=[],this.ksNewAccidentals=[]}updateTimeSignature(t,e){if(e){let e=this.measure.getTimeSignature();const i=this.doc.getColorWithKey("staff.signature.time");switch(this.tsImage=this.beatCountText=this.beatSizeText=void 0,e.type){case"common":{let e=t.getImageAsset(2,Z(i));this.tsImage=e?new U(this,e,0,.5,.1):void 0;break}case"cut":{let e=t.getImageAsset(3,Z(i));this.tsImage=e?new U(this,e,0,.5,.1):void 0;break}default:{let t=e.beatCount.toString();this.beatCountText=new V(this,{text:t,color:i,scale:1.4},.5,.5);let s=e.beatSize.toString();this.beatSizeText=new V(this,{text:s,color:i,scale:1.4},.5,.5);break}}}else this.beatCountText=this.beatSizeText=void 0}updateTempo(t){if(t){const t=this.doc.getColorWithKey("staff.signature.tempo"),e=(0,o.getTempoString)(this.measure.getTempo());this.tempoText=new V(this,{text:e,color:t},.5,1)}else this.tempoText=void 0}getAccidentalDiatonicId(t){let e,{clef:i}=this.staff.staffConfig;if("G"===i?t.accidental>0?e=this.staff.bottomLineDiatonicId+3:t.accidental<0&&(e=this.staff.bottomLineDiatonicId+1):"F"===i&&(t.accidental>0?e=this.staff.bottomLineDiatonicId+1:t.accidental<0&&(e=this.staff.bottomLineDiatonicId-1)),void 0!==e)return o.Note.findNextDiatonicIdAbove(t.diatonicId,e,!1);throw new D("Cannot get accidental diatonicId because note has no accidental.")}pick(t,e){if(!this.rect.contains(t,e))return[];if(this.eightBelowClef){let i=this.eightBelowClef.pick(t,e);if(i.length>0)return[this,...i]}if(this.clefImage){let i=this.clefImage.pick(t,e);if(i.length>0)return[this,...i]}for(let i=0;i<this.ksNeutralizeAccidentals.length;i++){let s=this.ksNeutralizeAccidentals[i].pick(t,e);if(s.length>0)return[this,...s]}for(let i=0;i<this.ksNewAccidentals.length;i++){let s=this.ksNewAccidentals[i].pick(t,e);if(s.length>0)return[this,...s]}if(this.beatCountText){let i=this.beatCountText.pick(t,e);if(i.length>0)return[this,...i]}if(this.beatSizeText){let i=this.beatSizeText.pick(t,e);if(i.length>0)return[this,...i]}if(this.tsImage){let i=this.tsImage.pick(t,e);if(i.length>0)return[this,...i]}if(this.tempoText){let i=this.tempoText.pick(t,e);if(i.length>0)return[this,...i]}if(this.measureNumber){let i=this.measureNumber.pick(t,e);if(i.length>0)return[this,...i]}return[this]}layout(t){var e,i,s,a,o,r,h;let{unitSize:c}=t,{staff:u}=this,l=c,d=0;if(this.rect=new n.vW,this.clefImage&&(d+=l,this.clefImage.layout(t),this.clefImage.setAnchor(d,u.getDiatonicIdY(u.clefLineDiatonicId)),this.rect.unionInPlace(this.clefImage.getRect()),d=this.rect.right,this.eightBelowClef)){let e=this.clefImage.getRect();this.eightBelowClef.layout(t),this.eightBelowClef.setCenterX(e.centerX),this.eightBelowClef.setTop(Math.max(e.anchorY+.3*e.height,u.getBottomLineY())),this.rect.unionInPlace(this.eightBelowClef.getRect())}this.measureNumber&&(this.measureNumber.layout(t),this.measureNumber.setLeft(0),this.measureNumber.setBottom(Math.min(u.getTopLineY(),this.clefImage?this.clefImage.getRect().top:u.getTopLineY())),this.rect.unionInPlace(this.measureNumber.getRect()),d=Math.max(d,this.rect.right)),this.ksNeutralizeAccidentals.length>0&&(d+=l,this.ksNeutralizeAccidentals.forEach(e=>{e.layout(t),e.setLeft(d),e.setAnchorY(u.getDiatonicIdY(e.diatonicId)),this.rect.unionInPlace(e.getRect()),d=this.rect.right})),this.ksNewAccidentals&&(d+=l,this.ksNewAccidentals.forEach(e=>{e.layout(t),e.setLeft(d),e.setAnchorY(u.getDiatonicIdY(e.diatonicId)),this.rect.unionInPlace(e.getRect()),d=this.rect.right}));let g=d;if(this.tsImage){null==(e=this.tsImage)||e.layout(t);let i=this.tsImage.getRect().width;this.tsImage.setCenter(d+i/2+l,u.getDiatonicIdY(u.middleLineDiatonicId)),this.rect.unionInPlace(this.tsImage.getRect()),g=Math.max(g,this.rect.right),d=g}else{null==(i=this.beatCountText)||i.layout(t),null==(s=this.beatSizeText)||s.layout(t);let e=Math.max(null!=(o=null==(a=this.beatCountText)?void 0:a.getRect().width)?o:0,null!=(h=null==(r=this.beatSizeText)?void 0:r.getRect().width)?h:0);this.beatCountText&&(this.beatCountText.setCenter(d+e/2+l,u.getDiatonicIdY(u.middleLineDiatonicId+2)),this.rect.unionInPlace(this.beatCountText.getRect()),g=Math.max(g,this.rect.right)),this.beatSizeText&&(this.beatSizeText.setCenter(d+e/2+l,u.getDiatonicIdY(u.bottomLineDiatonicId+2)),this.rect.unionInPlace(this.beatSizeText.getRect()),g=Math.max(g,this.rect.right)),d=g}this.tempoText&&(this.tempoText.layout(t),this.tempoText.setCenterX(d),this.tempoText.setBottom(u.getTopLineY()),this.clefImage&&n.vW.overlap(this.clefImage.getRect(),this.tempoText.getRect())&&this.tempoText.setBottom(this.clefImage.getRect().top),[...this.ksNeutralizeAccidentals,...this.ksNewAccidentals].forEach(t=>{this.tempoText&&n.vW.overlap(t.getRect(),this.tempoText.getRect())&&this.tempoText.setBottom(t.getRect().top)}),this.rect.unionInPlace(this.tempoText.getRect())),this.rect.right+=l}offset(t,e){var i,s,n,a,o,r,h;null==(i=this.clefImage)||i.offset(t,e),null==(s=this.eightBelowClef)||s.offset(t,e),null==(n=this.measureNumber)||n.offset(t,e),this.ksNeutralizeAccidentals.forEach(i=>i.offset(t,e)),this.ksNewAccidentals.forEach(i=>i.offset(t,e)),null==(a=this.beatCountText)||a.offset(t,e),null==(o=this.beatSizeText)||o.offset(t,e),null==(r=this.tsImage)||r.offset(t,e),null==(h=this.tempoText)||h.offset(t,e),this.rect.offsetInPlace(t,e)}draw(t,e){var i,s,n,a,o,r,h;this.intersects(e)&&(null==(i=this.clefImage)||i.draw(t,e),null==(s=this.eightBelowClef)||s.draw(t,e),null==(n=this.measureNumber)||n.draw(t,e),this.ksNeutralizeAccidentals.forEach(i=>i.draw(t,e)),this.ksNewAccidentals.forEach(i=>i.draw(t,e)),null==(a=this.beatCountText)||a.draw(t,e),null==(o=this.beatSizeText)||o.draw(t,e),null==(r=this.tsImage)||r.draw(t,e),null==(h=this.tempoText)||h.draw(t,e))}},H=class extends G{constructor(t,e){super(t),this.measure=t,this.tab=e,(0,a.Mu)(this,"measureNumber"),(0,a.Mu)(this,"beatCountText"),(0,a.Mu)(this,"beatSizeText"),(0,a.Mu)(this,"tsImage"),(0,a.Mu)(this,"tempoText"),(0,a.Mu)(this,"mi"),this.mi=new Oi(this)}getMusicInterface(){return this.mi}get doc(){return this.measure.doc}updateMeasureNumber(t){if(t){const t=this.doc.getColorWithKey("tab.signature.measurenum"),e=this.measure.getMeasureNumber().toString();this.measureNumber=new V(this,{text:e,color:t},0,1)}else this.measureNumber=void 0}updateTimeSignature(t,e){if(e){const e=this.measure.getTimeSignature(),i=this.doc.getColorWithKey("tab.signature.time");switch(this.tsImage=this.beatCountText=this.beatSizeText=void 0,e.type){case"common":{let e=t.getImageAsset(2,Z(i));this.tsImage=e?new U(this,e,0,.5,.1):void 0;break}case"cut":{let e=t.getImageAsset(3,Z(i));this.tsImage=e?new U(this,e,0,.5,.1):void 0;break}default:{let t=e.beatCount.toString();this.beatCountText=new V(this,{text:t,color:i,scale:1.4},.5,.5);let s=e.beatSize.toString();this.beatSizeText=new V(this,{text:s,color:i,scale:1.4},.5,.5);break}}}else this.beatCountText=this.beatSizeText=void 0}updateTempo(t){if(t){const t=this.doc.getColorWithKey("tab.signature.tempo"),e=(0,o.getTempoString)(this.measure.getTempo());this.tempoText=new V(this,{text:e,color:t},0,1)}else this.tempoText=void 0}pick(t,e){if(!this.rect.contains(t,e))return[];if(this.beatCountText){let i=this.beatCountText.pick(t,e);if(i.length>0)return[this,...i]}if(this.beatSizeText){let i=this.beatSizeText.pick(t,e);if(i.length>0)return[this,...i]}if(this.tsImage){let i=this.tsImage.pick(t,e);if(i.length>0)return[this,...i]}if(this.tempoText){let i=this.tempoText.pick(t,e);if(i.length>0)return[this,...i]}if(this.measureNumber){let i=this.measureNumber.pick(t,e);if(i.length>0)return[this,...i]}return[this]}layout(t){var e,i,s,a,o,r,h;let{unitSize:c}=t,{tab:u}=this,l=c,d=0,g=u.getTopLineY();if(this.rect=new n.vW,this.measureNumber&&(this.measureNumber.layout(t),this.measureNumber.setLeft(0),this.measureNumber.setBottom(g),this.rect.unionInPlace(this.measureNumber.getRect()),d=Math.max(d,this.rect.right)),this.tsImage){null==(e=this.tsImage)||e.layout(t);let i=this.tsImage.getRect().width;this.tsImage.setCenter(d+i/2+l,(u.getBottomLineY()+u.getTopLineY())/2),this.rect.unionInPlace(this.tsImage.getRect()),d=this.rect.right}else{null==(i=this.beatCountText)||i.layout(t),null==(s=this.beatSizeText)||s.layout(t);let e=Math.max(null!=(o=null==(a=this.beatCountText)?void 0:a.getRect().width)?o:0,null!=(h=null==(r=this.beatSizeText)?void 0:r.getRect().width)?h:0);this.beatCountText&&(this.beatCountText.setCenter(0+e/2+l,u.getRect().anchorY-this.beatCountText.getRect().bottomh),this.rect.unionInPlace(this.beatCountText.getRect())),this.beatSizeText&&(this.beatSizeText.setCenter(0+e/2+l,u.getRect().anchorY+this.beatSizeText.getRect().toph),this.rect.unionInPlace(this.beatSizeText.getRect()))}this.tempoText&&(this.tempoText.layout(t),this.tempoText.setLeft(d+2*c),this.tempoText.setBottom(g),this.rect.unionInPlace(this.tempoText.getRect())),this.rect.right+=l}offset(t,e){var i,s,n,a,o;null==(i=this.measureNumber)||i.offset(t,e),null==(s=this.beatCountText)||s.offset(t,e),null==(n=this.beatSizeText)||n.offset(t,e),null==(a=this.tsImage)||a.offset(t,e),null==(o=this.tempoText)||o.offset(t,e),this.rect.offsetInPlace(t,e)}draw(t,e){var i,s,n,a,o;this.intersects(e)&&(null==(i=this.measureNumber)||i.draw(t,e),null==(s=this.beatCountText)||s.draw(t,e),null==(n=this.beatSizeText)||n.draw(t,e),null==(a=this.tsImage)||a.draw(t,e),null==(o=this.tempoText)||o.draw(t,e))}},K=class extends G{constructor(t,e,i){if(super(t),this.measure=t,this.color=e,this.passages=i,(0,a.Mu)(this,"endingText"),(0,a.Mu)(this,"shapeRects",[]),(0,a.Mu)(this,"mi"),this.mi=new Xe(this),!n.I8.isIntegerGte(i.length,1))throw new D("Passages is empty.");if(!this.passages.every(t=>n.I8.isIntegerGte(t,1)))throw new D("Invalid passages: "+this.passages);this.passages.sort((t,e)=>t-e);const s=this.passages.map(t=>t+".").join("");this.endingText=new V(this,{text:s,color:e},0,1)}getMusicInterface(){return this.mi}getShapeRects(){return this.shapeRects}isSingleMeasureEnding(){let{measure:t}=this,e=t.getNextMeasure();return!0===(null==e?void 0:e.hasNavigation("ending"))||t.hasNavigation("endRepeat")||t.isLastMeasure()}hasPassage(t){return this.passages.some(e=>e===t)}getHighestPassage(){return Math.max(0,...this.passages)}pick(t,e){return this.rect.contains(t,e)?[this]:[]}layout(t){this.rect=new n.vW,this.shapeRects=[this.rect.clone()]}layoutFitToMeasure(t){let{unitSize:e}=t,{measure:i}=this;this.endingText.layout(t);let s=this.endingText.getRect(),a=i.getColumnsContentRect(),o=s.height;this.rect=new n.vW(a.left+e,a.right-e,-o,0),this.endingText.setLeft(this.rect.left+e/2),this.endingText.setBottom(this.rect.bottom),this.shapeRects=[new n.vW(this.rect.left,this.rect.left+1,this.rect.top,this.rect.bottom),new n.vW(this.rect.left,this.rect.right,this.rect.top,this.rect.top+1),new n.vW(this.rect.right-1,this.rect.right,this.rect.top,this.rect.bottom),this.endingText.getRect().clone()]}offset(t,e){this.endingText.offset(t,e),this.shapeRects.forEach(i=>i.offsetInPlace(t,e)),this.rect.offsetInPlace(t,e)}draw(t,e){if(!this.intersects(e))return;let{rect:i}=this;t.drawDebugRect(this.rect),t.color(this.color).lineWidth(1),t.beginPath(),t.moveTo(i.left,i.bottom),t.lineTo(i.left,i.top),t.lineTo(i.right,i.top),this.isSingleMeasureEnding()&&t.lineTo(i.right,i.bottom),t.stroke(),this.endingText.draw(t,e)}},X=class extends G{constructor(t,e){super(t),this.staff=t,this.rest=e,(0,a.Mu)(this,"restRect",new n.vW),(0,a.Mu)(this,"symbols",[]),(0,a.Mu)(this,"mi"),t.addObject(this),this.mi=new bi(this)}getMusicInterface(){return this.mi}pick(t,e){if(!this.getRect().contains(t,e))return[];for(let i=0;i<this.symbols.length;i++){let s=this.symbols[i].pick(t,e);if(s.length>0)return[this,...s]}return[this]}offset(t,e){this.restRect.offsetInPlace(t,e),this.symbols.forEach(i=>i.offset(t,e)),this.requestRectUpdate(),this.rest.requestRectUpdate()}updateRect(){this.rect=this.restRect.clone(),this.symbols.forEach(t=>this.rect.unionInPlace(t.getRect()))}},J=class t extends G{constructor(e,i,s,n,r){var h,c,u,l;super(e),this.col=e,this.voiceId=i,this.options=n,(0,a.Mu)(this,"color"),(0,a.Mu)(this,"hide"),(0,a.Mu)(this,"oldStyleTriplet"),(0,a.Mu)(this,"rhythmProps"),(0,a.Mu)(this,"setDiatonicId"),(0,a.Mu)(this,"runningDiatonicId"),(0,a.Mu)(this,"runningStemDir"),(0,a.Mu)(this,"beamGroup"),(0,a.Mu)(this,"staffObjects",[]),(0,a.Mu)(this,"mi"),this.setDiatonicId=null!=(c=this.getDiatonicIdFromStaffPos(null==(h=this.options)?void 0:h.staffPos))?c:t.UndefinedDiatonicId,this.setDiatonicId=this.getDiatonicIdOnLine(this.setDiatonicId),this.runningDiatonicId=this.setDiatonicId,this.runningStemDir="up",this.color=null!=(u=null==n?void 0:n.color)?u:this.doc.getColorWithKey("staff.rest"),this.hide=null!=(l=null==n?void 0:n.hide)&&l,this.oldStyleTriplet=void 0===r&&o.NoteLengthProps.get(s).isTriplet,this.rhythmProps=o.RhythmProps.get(s,void 0,(null!=r?r:this.oldStyleTriplet)?o.Tuplet.Triplet:void 0),this.mi=new Ii(this)}getMusicInterface(){return this.mi}get doc(){return this.col.doc}get measure(){return this.col.measure}get row(){return this.col.row}get noteLength(){return this.rhythmProps.noteLength}getDiatonicIdFromStaffPos(t){return"number"==typeof t?o.Note.getChromaticNote(t).diatonicId:"string"==typeof t?o.Note.getNote(t).diatonicId:t instanceof o.Note?t.diatonicId:void 0}getDiatonicIdOnLine(e){let i=this.row.getStaves().filter(t=>t.containsVoiceId(this.voiceId));return e!==t.UndefinedDiatonicId&&i.length>0&&i[0].isSpace(e)?e+(e>=i[0].middleLineDiatonicId?1:-1):e}getDiatonicId(e){return this.runningDiatonicId===t.UndefinedDiatonicId?e?o.NoteLengthProps.equals(this.noteLength,"1n")?e.middleLineDiatonicId+2:e.middleLineDiatonicId:o.Note.getNote("G4").diatonicId:this.runningDiatonicId}get stemDir(){return this.runningStemDir}updateRunningArguments(t,e,i){this.runningDiatonicId=t,this.runningStemDir=e}getStaticObjects(t){let e=[];return this.staffObjects.forEach(i=>{i.staff===t&&e.push(i)}),e}pick(t,e){if(!this.getRect().contains(t,e))return[];for(let i=0;i<this.staffObjects.length;i++){let s=this.staffObjects[i].pick(t,e);if(s.length>0)return[this,...s]}return[]}getBeamGroup(){return this.beamGroup}setBeamGroup(t){this.beamGroup=t}resetBeamGroup(){this.beamGroup=void 0}getBeamCoords(){return this.staffObjects.map(t=>{let e=t.staff,i=t.getRect().anchorX,s="up"===this.stemDir?t.getRect().top:t.getRect().bottom;return{staff:e,x:i,y:s,stemHeight:Math.abs(t.getRect().anchorY-s)}})}hasTuplet(){return void 0!==this.rhythmProps.tupletRatio}isEmpty(){return 0===this.staffObjects.length}visibleInStaff(t){return t.containsVoiceId(this.voiceId)&&this.staffObjects.some(e=>e instanceof X&&e.staff===t)}getRestDotVerticalDisplacement(t){switch(t){case 1:return 1;case 2:case 4:case 8:case 16:return-1;case 32:case 64:return-3;default:throw new D(`Get rest dot vertical displacement: Invalid note size: ${t}`)}}updateAccidentalState(t){}layout(t,e){if(this.requestRectUpdate(),this.staffObjects.length=0,this.hide)return;let{unitSize:i}=t,{noteSize:s,dotCount:n}=this.rhythmProps;this.row.getStaves().forEach(e=>{let a=this.getDiatonicId(e);if(!e.containsDiatonicId(a)||!e.containsVoiceId(this.voiceId))return;let o=new X(e,this);o.restRect=t.getRestRect(s);for(let r=0;r<n;r++){const e=o.restRect.rightw+(R+A*i)+r*A*i*1.5,n=this.getRestDotVerticalDisplacement(s)*i,a=new F(this,1,!1,!1,this.color);a.layout(t),a.offset(e,n),o.symbols.push(a)}o.setAnchor(0,e.getDiatonicIdY(a)),this.staffObjects.push(o),this.measure.addStaticObject(e,o)})}updateRect(){if(0===this.staffObjects.length)this.rect=new n.vW;else if(this.rect=this.staffObjects[0].getRect().clone(),this.staffObjects.length>1)for(let t=1;t<this.staffObjects.length;t++)this.rect.unionInPlace(this.staffObjects[t].getRect())}offset(t,e){this.staffObjects.forEach(e=>e.offset(t,0)),this.requestRectUpdate()}draw(t,e){if(!this.intersects(e))return;if(0===this.staffObjects.length)return;t.drawDebugRect(this.getRect());let{noteSize:i}=this.rhythmProps;t.color(this.color).lineWidth(1),this.staffObjects.forEach(e=>{let{symbols:s,restRect:n}=e;t.drawRest(i,n.anchorX,n.anchorY),s.forEach(e=>e.draw(t))})}};(0,a.Mu)(J,"UndefinedDiatonicId",1/0);var Q=J,_=class t extends G{constructor(e,i,s="black"){switch(super(e),this.text=i,this.color=s,(0,a.Mu)(this,"components",[]),(0,a.Mu)(this,"mi"),this.text){case t.Coda:this.components=[new V(this,{text:"\ud834\udd0c",scale:1.7,color:s},.5,.3),new V(this,{text:" Coda",color:s},0,1)];break;case t.toCoda:this.components=[new V(this,{text:"toCoda ",color:s},1,1),new V(this,{text:"\ud834\udd0c",scale:1.7,color:s},.5,.3)];break;case t.Segno:this.components=[new V(this,{text:"\ud834\udd0b",scale:1.1,color:s},.5,1)];break;default:this.components=[]}this.mi=new Gi(this)}getMusicInterface(){return this.mi}getText(){return this.text}pick(t,e){return this.rect.contains(t,e)?[this]:[]}layout(e){switch(this.text){case t.Coda:{let t=this.components[0],i=this.components[1];t.layout(e),i.layout(e),t.setAnchorY(i.getRect().centerY),i.setLeft(t.getRect().right),this.rect=new n.vW(t.getRect().left,t.getRect().anchorX,i.getRect().right,i.getRect().top,i.getRect().anchorY,i.getRect().bottom);break}case t.toCoda:{let t=this.components[0],i=this.components[1];t.layout(e),i.layout(e),i.setAnchorY(t.getRect().centerY),t.setRight(i.getRect().left),this.rect=new n.vW(t.getRect().left,i.getRect().anchorX,i.getRect().right,t.getRect().top,t.getRect().anchorY,t.getRect().bottom);break}default:{let t=this.components[0];t.layout(e),this.rect=t.getRect().clone();break}}}offset(t,e){this.components.forEach(i=>i.offset(t,e)),this.rect.offsetInPlace(t,e)}draw(t,e){this.intersects(e)&&(t.drawDebugRect(this.rect),this.components.forEach(i=>i.draw(t,e)))}};(0,a.Mu)(_,"toCoda","\ud834\udd0c toCoda"),(0,a.Mu)(_,"Coda","Coda \ud834\udd0c"),(0,a.Mu)(_,"Segno","\ud834\udd0b");var $=_;function tt(t){switch(t){case"D.C. al Coda":return"D.C. al Coda";case"D.C. al Fine":return"D.C. al Fine";case"D.S. al Coda":return"D.S. al Coda";case"D.S. al Fine":return"D.S. al Fine";case"Fine":return"Fine";case"Segno":return $.Segno;case"Coda":return $.Coda;case"toCoda":return $.toCoda;default:return t[0].toUpperCase()+t.substring(1)}}function et(t,e,i){const s=e=>t instanceof ge?"tab"+e.substring(5):e;switch(e){case"navigation":return s("staff.annotation.navigation");case"dynamics":return s("staff.annotation.dynamics");case"tempo":return s("staff.annotation.tempo");case"articulation":return s("staff.annotation.articulation");case"expression":return s("staff.annotation.expression");case"technique":return s("staff.annotation.technique");case"temporal":return s("staff.annotation.temporal");case"label":return s("staff.annotation.label");case"ornament":return s("staff.annotation.ornament");default:return s("staff.annotation.misc")}}function it(t){if(/^(p+|f+|m|mp|mf)$/.test(t)){let e=.5-.1*n.OZ.Str.charCount(t,"p")+.1*n.OZ.Str.charCount(t,"f");return n.OZ.Math.clamp(e,0,1)}}var st=new n.b1([["D.C. al Fine","navigation"],["D.C. al Coda","navigation"],["D.S. al Fine","navigation"],["D.S. al Coda","navigation"],["Coda","navigation"],["toCoda","navigation"],["Segno","navigation"],["Fine","navigation"],["startRepeat","navigation"],["endRepeat","navigation"],["ending","navigation"],["ppp","dynamics"],["pp","dynamics"],["p","dynamics"],["mp","dynamics"],["m","dynamics"],["mf","dynamics"],["f","dynamics"],["ff","dynamics"],["fff","dynamics"],["cresc.","dynamics"],["decresc.","dynamics"],["dim.","dynamics"],["fp","dynamics"],["sf","dynamics"],["sfz","dynamics"],["sforzando","dynamics"],["accel.","tempo"],["rit.","tempo"],["rall.","tempo"],["a tempo","tempo"],["rubato","tempo"],["Largo","tempo"],["Adagio","tempo"],["Andante","tempo"],["Moderato","tempo"],["Allegro","tempo"],["Vivace","tempo"],["Presto","tempo"],["Prestissimo","tempo"],["staccato","articulation"],["staccatissimo","articulation"],["spiccato","articulation"],["tenuto","articulation"],["accent","articulation"],["marcato","articulation"],["legato","articulation"],["portato","articulation"],["dolce","expression"],["cantabile","expression"],["espressivo","expression"],["espr.","expression"],["leggiero","expression"],["pesante","expression"],["con brio","expression"],["con fuoco","expression"],["giocoso","expression"],["maestoso","expression"],["misterioso","expression"],["tranquillo","expression"],["pizz.","technique"],["arco","technique"],["col legno","technique"],["sul ponticello","technique"],["sul tasto","technique"],["vibrato","technique"],["senza vibrato","technique"],["legato pedal","technique"],["staccato pedal","technique"],["una corda","technique"],["tre corde","technique"],["trill","ornament"],["tr","ornament"],["mordent","ornament"],["grace note","ornament"],["turn","ornament"],["appoggiatura","ornament"],["acciaccatura","ornament"],["fermata","temporal"],["measureEndFermata","temporal"],["pitchLabel","label"],["chordLabel","label"],["8va","misc"],["8vb","misc"],["loco","misc"],["tacet","misc"],["sim.","misc"],["div.","misc"],["unis.","misc"],["cue notes","misc"]]);function nt(t){return st.get(t)}function at(t){return String(t).trim().toLowerCase().replace(/[.]/g,"").replace(/[-]/g," ")}var ot=new n.b1;for(const[Ts]of st)ot.set(at(Ts),Ts);var rt=["staccato","staccatissimo","spiccato","portato","tenuto","accent","marcato"];function ht(t){return rt.includes(t)}var ct=class extends G{constructor(t,e){super(t),this.staff=t,this.noteGroup=e,(0,a.Mu)(this,"noteHeadRects",[]),(0,a.Mu)(this,"symbols",[]),(0,a.Mu)(this,"accidentals",[]),(0,a.Mu)(this,"stemTip"),(0,a.Mu)(this,"stemBase"),(0,a.Mu)(this,"flagRects",[]),(0,a.Mu)(this,"prevTopNoteY",0),(0,a.Mu)(this,"prevBottomNoteY",0),(0,a.Mu)(this,"mi"),this.mi=new fi(this)}getMusicInterface(){return this.mi}pick(t,e){if(!this.getRect().contains(t,e))return[];for(let i=0;i<this.accidentals.length;i++){let s=this.accidentals[i].pick(t,e);if(s.length>0)return[this,...s]}for(let i=0;i<this.symbols.length;i++){let s=this.symbols[i].pick(t,e);if(s.length>0)return[this,...s]}return[this]}updateRect(){this.rect=this.noteHeadRects[0].clone(),this.noteHeadRects.forEach(t=>this.rect.unionInPlace(t)),this.stemTip&&this.rect.unionInPlace(this.stemTip),this.stemBase&&this.rect.unionInPlace(this.stemBase),this.symbols.forEach(t=>this.rect.unionInPlace(t.getRect())),this.flagRects.forEach(t=>this.rect.unionInPlace(t)),this.accidentals.forEach(t=>this.rect.unionInPlace(t.getRect()))}getRect(){let t=this.noteHeadRects[0],e=this.noteHeadRects[this.noteHeadRects.length-1];return this.prevTopNoteY===e.anchorY&&this.prevBottomNoteY===t.anchorY||(this.prevTopNoteY=e.anchorY,this.prevBottomNoteY=t.anchorY,this.requestRectUpdate()),super.getRect()}offset(t,e){var i,s;this.noteHeadRects.forEach(i=>i.offsetInPlace(t,e)),this.symbols.forEach(i=>i.offset(t,e)),this.accidentals.forEach(i=>i.offset(t,e)),null==(i=this.stemTip)||i.offsetInPlace(t,e),null==(s=this.stemBase)||s.offsetInPlace(t,e),this.flagRects.forEach(i=>i.offsetInPlace(t,e)),this.requestRectUpdate(),this.noteGroup.requestRectUpdate()}},ut=class extends G{constructor(t,e){super(t),this.tab=t,this.noteGroup=e,(0,a.Mu)(this,"fretNumbers",[]),(0,a.Mu)(this,"mi"),this.mi=new pi(this)}getMusicInterface(){return this.mi}pick(t,e){return this.getRect().contains(t,e)?[this]:[]}updateRect(){this.rect=this.fretNumbers[0].getRect().clone(),this.fretNumbers.forEach(t=>this.rect.unionInPlace(t.getRect()))}offset(t,e){this.fretNumbers.forEach(i=>i.offset(t,e)),this.requestRectUpdate(),this.noteGroup.requestRectUpdate()}},lt=class t extends G{constructor(t,e,i,s,r,h){var c,u;if(super(t),this.col=t,this.voiceId=e,this.notes=i,this.options=r,(0,a.Mu)(this,"setDiatonicId"),(0,a.Mu)(this,"setStringsNumbers"),(0,a.Mu)(this,"runningDiatonicId"),(0,a.Mu)(this,"runningStemDir"),(0,a.Mu)(this,"runningStringNumbers"),(0,a.Mu)(this,"color"),(0,a.Mu)(this,"diamond"),(0,a.Mu)(this,"arpeggio"),(0,a.Mu)(this,"oldStyleTriplet"),(0,a.Mu)(this,"rhythmProps"),(0,a.Mu)(this,"articulations",[]),(0,a.Mu)(this,"startConnnectives",[]),(0,a.Mu)(this,"runningConnectives",[]),(0,a.Mu)(this,"leftBeamCount",0),(0,a.Mu)(this,"rightBeamCount",0),(0,a.Mu)(this,"beamGroup"),(0,a.Mu)(this,"staffObjects",[]),(0,a.Mu)(this,"tabObjects",[]),(0,a.Mu)(this,"isNoteDisplaced"),(0,a.Mu)(this,"mi"),!n.I8.isIntegerGte(i.length,1))throw new D("Cannot create note group object because notes array is empty.");let{sortedNotes:l,sortedStrings:d}=function(t,e){let i=n.OZ.Arr.isArray(e)?e:void 0!==e?[e]:[],s=t.map((t,e)=>({note:t,string:i[e]}));return s=n.OZ.Arr.removeDuplicates(s,(t,e)=>o.Note.equals(t.note,e.note)).sort((t,e)=>o.Note.compareFunc(t.note,e.note)),{sortedNotes:s.map(t=>t.note),sortedStrings:s.every(t=>void 0===t.string)?void 0:s.map(t=>t.string)}}(i,null==r?void 0:r.string);var g;this.notes=l,this.setStringsNumbers=d,this.isNoteDisplaced=this.notes.map(()=>!1),this.setDiatonicId=Math.round((this.minDiatonicId+this.maxDiatonicId)/2),this.runningDiatonicId=this.setDiatonicId,this.runningStemDir="up",this.runningStringNumbers=[],this.color=null!=(c=null==r?void 0:r.color)?c:this.doc.getColorWithKey("staff.note"),this.diamond=null!=(u=null==r?void 0:r.diamond)&&u,this.arpeggio=(g=null==r?void 0:r.arpeggio,n.I8.isEnumValue(g,Ft)?g:!0===g?"up":void 0),this.oldStyleTriplet=void 0===h&&o.NoteLengthProps.get(s).isTriplet,(null==r?void 0:r.staccato)&&(this.articulations=[{kind:"staccato",color:null==r?void 0:r.color}]),this.rhythmProps=o.RhythmProps.get(s,void 0,(null!=h?h:this.oldStyleTriplet)?o.Tuplet.Triplet:void 0),this.mi=new di(this)}getMusicInterface(){return this.mi}get doc(){return this.col.doc}get measure(){return this.col.measure}get row(){return this.col.row}addNoteArticulation(t,e){ht(t)&&("staccatissimo"===t&&(t="spiccato"),void 0!==!this.articulations.find(e=>e.kind===t)&&(this.articulations.push({kind:t,color:e.color}),this.articulations=this.articulations.slice().sort((t,e)=>{let i=rt.indexOf(t.kind);i<0&&(i=1/0);let s=rt.indexOf(e.kind);return s<0&&(s=1/0),i-s})))}hasArticulation(t){return"staccatissimo"===t&&(t="spiccato"),void 0!==this.articulations.find(e=>e.kind===t)}get minDiatonicId(){return this.notes[0].diatonicId}get maxDiatonicId(){return this.notes[this.notes.length-1].diatonicId}getDiatonicId(t){return this.runningDiatonicId}get stemDir(){return this.runningStemDir}setNoteDisplacement(t,e){let i=this.notes.indexOf(t);i>=0&&(this.isNoteDisplaced[i]=e)}enableConnective(t){return t.containsVoiceId(this.voiceId)&&(t instanceof ge||t.containsDiatonicId(this.runningDiatonicId))}startConnective(t){if(!this.row.hasStaff&&"tie"===t.connective)throw new D("Ties not implemented for guitar tabs alone, staff is required!");if(!this.row.hasStaff&&"slur"===t.connective)throw new D("Slurs not implemented for guitar tabs alone, staff is required!");this.startConnnectives.push(t),this.doc.addConnectiveProps(t)}updateRunningArguments(t,e,i){this.runningDiatonicId=t===Q.UndefinedDiatonicId?this.setDiatonicId:t,this.runningStemDir=e,this.runningStringNumbers=i}pick(t,e){if(!this.getRect().contains(t,e))return[];for(let i=0;i<this.staffObjects.length;i++){let s=this.staffObjects[i].pick(t,e);if(s.length>0)return[this,...s]}for(let i=0;i<this.tabObjects.length;i++){let s=this.tabObjects[i].pick(t,e);if(s.length>0)return[this,...s]}return[]}getTopNote(){return this.notes[this.notes.length-1]}getBottomNote(){return this.notes[0]}getConnectiveAnchorPoint(t,e,i,s,n){var a;if(!(e instanceof de)){if(e instanceof ge){let s=null==(a=this.tabObjects.find(t=>t.tab===e))?void 0:a.fretNumbers[i];if(!s)return{x:0,y:0};let o,r=s.getRect(),h="right"===n?r.left:r.right,c=.9;if("slide"===t.connective){let i=t.noteGroups[0].getFretNumber(e,0),s=t.noteGroups[1].getFretNumber(e,0),a=void 0===i||void 0===s||i<=s;o="left"===n?(a?r.anchorY+r.bottomh:r.anchorY-r.toph)*c:(a?r.anchorY-r.toph:r.anchorY+r.bottomh)*c}else o=r.anchorY+r.bottomh*c;return{x:h,y:o}}return{x:0,y:0}}{if(i<0||i>=this.notes.length)throw new D("Invalid noteIndex: "+i);let t=this.staffObjects.find(t=>t.staff===e);if(!t||i<0||i>=t.noteHeadRects.length){let t=this.getRect();return{x:t.anchorX,y:t.bottom}}let a=t.noteHeadRects[i],o=t.stemTip,r=this.stemDir,h=void 0!==o,c=h?"up"===r?"right":"left":void 0,u=a.height/2,l=a.anchorX,d=a.anchorY,g=a.left-u,f=a.right+u,m=a.top-u,p=a.bottom+u;switch("auto"===s?s="below":"stemTip"!==s||h||(s="up"===r?"above":"below"),s){case"center":return"left"===n?{x:f,y:d}:{x:g,y:d};case"above":return h&&"down"!==r?{x:"left"===n&&"right"===c?f:"right"===n&&"left"===c?g:l,y:m}:{x:l,y:m};case"below":return h&&"up"!==r?{x:"left"===n&&"right"===c?f:"right"===n&&"left"===c?g:l,y:p}:{x:l,y:p};case"stemTip":return{x:l,y:o.anchorY+("up"===r?-u:u)};default:throw new D("Invalid noteAnchor: "+s)}}}getFretNumberString(t){return this.runningStringNumbers[t]}getFretNumber(t,e){let i=this.tabObjects.find(e=>e.tab===t),s=null==i?void 0:i.fretNumbers[e];return s?parseInt(s.getText()):void 0}getNextNoteGroup(){let e=this.measure.getVoiceSymbols(this.voiceId).filter(e=>e instanceof t),i=e.indexOf(this);if(i<0)return;if(i<e.length-1)return e[i+1];let s=this.measure.getNextMeasure();for(;s;){let e=s.getVoiceSymbols(this.voiceId).filter(e=>e instanceof t);if(e.length>0)return e[0];s=s.getNextMeasure()}}collectConnectiveProps(){this.startConnnectives.forEach(t=>{this.runningConnectives.push(t);let e=this.getNextNoteGroup();for(;e&&t.addNoteGroup(e);)e.runningConnectives.push(t),e=e.getNextNoteGroup()})}removeConnectiveProps(){this.runningConnectives=[]}getPlaySlur(){let t=this.runningConnectives.filter(t=>"slur"===t.connective).map(t=>t.startsWith(this)?"first":"slurred");return t.indexOf("first")>=0?"first":t.indexOf("slurred")>=0?"slurred":void 0}getBeamGroup(){return this.beamGroup}setBeamGroup(t){this.beamGroup=t}resetBeamGroup(){this.leftBeamCount=this.rightBeamCount=0,this.beamGroup=void 0}getBeamCoords(){return this.staffObjects.map(t=>{var e,i,s,n;let a=t.staff,o=null!=(i=null==(e=t.stemTip)?void 0:e.anchorX)?i:t.noteHeadRects[0].anchorX,r=null!=(n=null==(s=t.stemTip)?void 0:s.anchorY)?n:"up"===this.stemDir?t.getRect().top:t.getRect().bottom;return{staff:a,x:o,y:r,stemHeight:"up"===this.stemDir?Math.abs(t.noteHeadRects[0].anchorY-r):Math.abs(t.noteHeadRects[t.noteHeadRects.length-1].anchorY-r)}})}getStemHeight(t){let{unitSize:e}=t,{flagCount:i,hasStem:s}=this.rhythmProps;if(s){let t=this.hasBeamCount()?M:w;return(b+Math.max(0,i-1)*t)*e}return 0}hasBeamCount(){return this.leftBeamCount>0||this.rightBeamCount>0}getLeftBeamCount(){return this.leftBeamCount}getRightBeamCount(){return this.rightBeamCount}setLeftBeamCount(t){this.leftBeamCount=t}setRightBeamCount(t){this.rightBeamCount=t}hasTuplet(){return void 0!==this.rhythmProps.tupletRatio}isEmpty(){return 0===this.staffObjects.length&&0===this.tabObjects.length}visibleInStaff(t){return t.containsVoiceId(this.voiceId)&&this.staffObjects.some(e=>e instanceof ct&&e.staff===t)}getPlayTicks(t){let e=this.runningConnectives.filter(t=>"tie"===t.connective).map(e=>{let i=e.noteGroups,s=i.indexOf(this);if(s<0)return 0;if("stub"===e.span||"toMeasureEnd"===e.span)return Math.max(this.rhythmProps.ticks,this.measure.getMeasureTicks()-this.col.positionTicks);let a=i[s-1];return a&&a.notes.some(e=>o.Note.equals(e,t))?0:(i=i.slice(s),s=i.findIndex(e=>e.notes.every(e=>!o.Note.equals(e,t))),s>=0&&(i=i.slice(0,s)),n.OZ.Math.sum(i.map(t=>t.rhythmProps.ticks)))});return 0===e.length?this.rhythmProps.ticks:Math.max(...e)}updateAccidentalState(t){this.notes.forEach(e=>{t.needAccidental(e)&&t.setAccidental(e)})}layout(t,e){this.requestRectUpdate();let{unitSize:i}=t,{row:s,stemDir:a}=this,{dotCount:o,flagCount:r,hasStem:h}=this.rhythmProps,c=t.getSymbolRect(1),u=t.getSymbolRect(this.diamond?13:11);this.staffObjects.length=0,s.getStaves().forEach(s=>{if(!s.containsDiatonicId(this.runningDiatonicId)||!s.containsVoiceId(this.voiceId))return;let l=new ct(s,this),d=s,g=s;this.notes.forEach((n,r)=>{var h;let p=0===r,C=r===this.notes.length-1,I=null!=(h=s.getActualStaff(n.diatonicId))?h:s,A=this.isNoteDisplaced[r]?u.width*("down"===a?-1:1):0,b=I.getDiatonicIdY(n.diatonicId),y=I.isLine(n.diatonicId);if(p&&"up"===a&&(d=I),C&&"up"===a&&(g=I),p&&"down"===a&&(g=I),C&&"down"===a&&(d=I),I.addObject(l.noteHeadRects[r]=u.offsetCopy(A,b)),e.needAccidental(n)){let e=l.accidentals[r]=new z(this,n.diatonicId,n.accidental,this.color);e&&(e.layout(t),e.setAnchor(-u.leftw-i*m-e.getRect().rightw,b)),I.addObject(e)}for(let e=0;e<o;e++){const o=u.right+f*i+c.width/2+e*c.width*1.5,r=b+this.getDotVerticalDisplacement(s,n.diatonicId,a)*i,h=new F(this,1,!1,!1,this.color);h.layout(t),h.offset(o,r),l.symbols.push(h),I.addObject(h)}if("up"===a&&p||"down"===a&&C){let e="down"===a?-1:1,n=A,o=b+(y?3:2)*i*e;this.articulations.forEach(a=>{var r;const h=function(t){switch(t){case"staccato":return 3;case"staccatissimo":case"spiccato":return 4;case"accent":return 5;case"marcato":return 6;case"tenuto":return 7;case"portato":return 8;default:return 0}}(a.kind),c=null!=(r=a.color)?r:this.doc.getColorWithKey(et(s,"articulation",a.kind)),u=new F(this,h,!1,!1,c);u.layout(t),u.offset(n,o),l.symbols.push(u),d.addObject(u),o+=2*i*e})}});let p=l.noteHeadRects[0].anchorY,C=l.noteHeadRects[l.noteHeadRects.length-1].anchorY,I="up"===a?u.width/2:-u.width/2,A=this.getStemHeight(t),b="up"===a?C-A:p+A,M="up"===a?p:C;if(h&&(l.stemTip=new n.vW(I,I,b,b),l.stemBase=new n.vW(I,I,M,M),g.addObject(l.stemTip),d.addObject(l.stemBase)),!this.hasBeamCount()){let t=0===r?0:y*i,e=0===r?0:v*i;for(let s=0;s<r;s++){let o=s*i*w,r=l.flagRects[s]="up"===a?new n.vW(I,I+t,b+o,b+e+o):new n.vW(I,I+t,b-e-o,b-o);g.addObject(r)}}this.staffObjects.push(l),this.measure.addStaticObject(s,l)}),this.tabObjects.length=0,s.getTabs().forEach(e=>{if(!e.containsVoiceId(this.voiceId))return;let i=new ut(e,this);const s=this.doc.getBackground("background"),a=this.doc.getColorWithKey("tab.note");this.notes.forEach((o,r)=>{let h=this.runningStringNumbers[r];if(n.I8.isIntegerBetween(h,1,6)){let n=o.chromaticId-e.getTuningStrings()[h-1].chromaticId,r=new V(this,{text:String(n),color:a,bgcolor:s},.5,.5);r.layout(t),r.setAnchor(this.col.getRect().anchorX,e.getStringY(h-1)),i.fretNumbers.push(r)}}),i.fretNumbers.length>0&&(this.tabObjects.push(i),e.addObject(i),this.measure.addStaticObject(e,i))})}updateRect(){if(this.staffObjects.length>0)this.rect=this.staffObjects[0].noteHeadRects[0].clone();else{if(!(this.tabObjects.length>0&&this.tabObjects[0].fretNumbers.length>0))return void(this.rect=new n.vW);this.rect=this.tabObjects[0].fretNumbers[0].getRect().clone()}this.staffObjects.forEach(t=>this.rect.unionInPlace(t.getRect())),this.tabObjects.forEach(t=>this.rect.unionInPlace(t.getRect()))}setStemTipY(t,e){let i=this.staffObjects.find(e=>e.staff===t);this.hasBeamCount()&&(null==i?void 0:i.stemTip)&&e!==i.stemTip.anchorY&&(i.stemTip.top=i.stemTip.anchorY=i.stemTip.bottom=e,this.requestRectUpdate(),this.col.requestRectUpdate())}offset(t,e){this.staffObjects.forEach(e=>e.offset(t,0)),this.tabObjects.forEach(e=>e.offset(t,0)),this.requestRectUpdate()}draw(t,e){if(!this.intersects(e))return;t.drawDebugRect(this.getRect());let{stemDir:i}=this,{isSolidNoteHead:s}=this.rhythmProps;this.staffObjects.forEach(n=>{n.accidentals.forEach(i=>i.draw(t,e)),n.symbols.forEach(i=>i.draw(t,e)),t.color(this.color),t.lineWidth(1),n.noteHeadRects.forEach(e=>{this.diamond?s?t.drawSymbol(13,e):t.drawSymbol(12,e):s?t.drawSymbol(11,e):t.drawSymbol(10,e)}),n.stemTip&&n.stemBase&&(t.beginPath(),t.moveTo(n.stemBase.anchorX,n.stemBase.anchorY),t.lineTo(n.stemTip.anchorX,n.stemTip.anchorY),t.stroke()),n.flagRects.forEach(e=>t.drawSymbol(9,e,!1,"down"===i))}),this.tabObjects.forEach(e=>e.fretNumbers.forEach(e=>e.draw(t)))}getDotVerticalDisplacement(t,e,i){return t.isLine(e)?"up"===i?-1:1:0}static hasSameNotes(t,e){if(t.notes.length!==e.notes.length)return!1;for(let i=0;i<t.notes.length;i++){let s=t.notes[i],n=e.notes[i];if(s.diatonicId!==n.diatonicId||s.accidental!==n.accidental)return!1}return!0}},dt=class{constructor(t,e,i,s,n){this.staff=t,this.beamGroup=e,this.symbol=i,this.x=s,this.y=n,(0,a.Mu)(this,"topBeamsHeight",0),(0,a.Mu)(this,"bottomBeamsHeight",0),t.addObject(this)}offset(t,e){this.x+=t,this.y+=e,this.beamGroup.requestRectUpdate()}getRect(){return new n.vW(this.x,this.x,this.x,this.y-this.topBeamsHeight,this.y,this.y+this.bottomBeamsHeight)}},gt=class extends G{constructor(t,e){super(t),this.staff=t,this.beamGroup=e,(0,a.Mu)(this,"tupletNumber"),(0,a.Mu)(this,"tupletNumberOffsetY",0),(0,a.Mu)(this,"points",[]),(0,a.Mu)(this,"mi"),t.addObject(this),this.mi=new Ze(this)}getMusicInterface(){return this.mi}pick(t,e){return this.getRect().contains(t,e)?[this]:[]}offset(t,e){var i;this.points.forEach(e=>e.offset(t,0)),null==(i=this.tupletNumber)||i.offset(t,e),this.requestRectUpdate(),this.beamGroup.requestRectUpdate()}updateRect(){this.points.length>0?this.rect=this.points[0].getRect().clone():this.tupletNumber&&(this.rect=this.tupletNumber.getRect().clone()),this.points.forEach(t=>this.rect.unionInPlace(t.getRect())),this.tupletNumber&&this.rect.unionInPlace(this.tupletNumber.getRect())}},ft=class{constructor(t,e){this.beamGroup=t,this.message=e}},mt=class t extends G{constructor(t,e){super(t[0].measure),this.symbols=t,this.tupletRatio=e,(0,a.Mu)(this,"mi"),(0,a.Mu)(this,"type"),(0,a.Mu)(this,"staffObjects",[]),this.mi=new ze(this);let i=e?"Tuplet":"BeamGroup";if(!t.every(e=>e.measure===t[0].measure))throw new D(`All ${i} symbols are not in same measure.`);if(t.length<2)throw new D(`${i} needs minimum 2 symbols, but ${t.length} given.`);if(void 0!==e){let e=t.length<3||t.some(t=>!(t instanceof lt))||t.some(e=>e.rhythmProps.flagCount!==t[0].rhythmProps.flagCount);t.length>=3&&t[0]instanceof lt&&t[t.length-1]instanceof lt&&t[0].rhythmProps.flagCount===t[t.length-1].rhythmProps.flagCount&&(e=!1),t.some(t=>o.NoteLengthProps.cmp(t.rhythmProps.noteLength,o.NoteLength.Quarter)>=0)&&(e=!0),this.type=e?2:1,this.setTupletBeamCounts()}else this.type=0,this.setBeamCounts();if(!t.every(t=>void 0===t.getBeamGroup()))throw new D(`Cannot add ${i} because some symbol already has one.`);if(t.forEach(t=>t.setBeamGroup(this)),t[0].measure.addBeamGroup(this),0===this.type&&this.symbols.filter(t=>t instanceof lt).some((t,e)=>{let i=0===e,s=e===this.symbols.length-1;if(i&&0===t.getRightBeamCount()||s&&0===t.getLeftBeamCount()||!i&&!s&&(0===t.getLeftBeamCount()||0===t.getRightBeamCount()))throw new ft(this,"Beam has zero left or right beam count!")}),t.some(e=>e.voiceId!==t[0].voiceId))throw 0===this.type?new ft(this,"Beam symbols have different voiceId."):new D("Tuplet symbols have different voiceId.");t[0].row.getStaves().forEach(e=>{e.getActualStaff(t[0].getDiatonicId(e))&&e.containsVoiceId(t[0].voiceId)&&t.forEach(t=>{let i=e.getActualStaff(t.getDiatonicId(e));if(!i||!i.containsVoiceId(t.voiceId))throw new ft(this,"Some of beam or tuplet symbols are not visible!")})})}get stemDir(){return this.symbols[0].stemDir}get showTupletRatio(){var t;return!0===(null==(t=this.tupletRatio)?void 0:t.showRatio)}static createBeam(e){if(e.length>1&&e.every(t=>!t.hasTuplet()))try{return new t(e,void 0),!0}catch(i){if(!(i instanceof ft))throw i;i.beamGroup.detach()}return!1}static createOldStyleTriplet(e){try{let i=e.slice(0,2),s=i.map(t=>t.rhythmProps.noteSize);if(2===i.length&&i.every(t=>t.oldStyleTriplet&&void 0===t.getBeamGroup())&&(2*s[0]===s[1]||2*s[1]===s[0]))return new t(i,o.Tuplet.Triplet),2;let n=e.slice(0,3),a=n.map(t=>t.rhythmProps.noteSize);if(3===n.length&&n.every(t=>t.oldStyleTriplet&&void 0===t.getBeamGroup())&&a.every(t=>t===a[0]))return new t(n,o.Tuplet.Triplet),3}catch(i){if(!(i instanceof ft))throw i;console.error(i.message),i.beamGroup.detach()}return 0}static createTuplet(e,i){try{new t(e,i)}catch(s){if(!(s instanceof ft))throw s;console.error(s.message),s.beamGroup.detach()}}getMusicInterface(){return this.mi}detach(){this.getSymbols().forEach(t=>t.resetBeamGroup())}isEmpty(){return 0===this.staffObjects.length}pick(t,e){if(!this.getRect().contains(t,e))return[];for(let i=0;i<this.staffObjects.length;i++){let s=this.staffObjects[i].pick(t,e);if(s.length>0)return[this,...s]}return[this]}getType(){return this.type}isTuplet(){return 1===this.type||2===this.type}getTupletRatioText(){var t,e,i;return this.showTupletRatio?String(null==(t=this.tupletRatio)?void 0:t.parts)+":"+String(null==(e=this.tupletRatio)?void 0:e.inTimeOf):String(null==(i=this.tupletRatio)?void 0:i.parts)}getSymbols(){return this.symbols}getFirstSymbol(){return this.symbols[0]}getLastSymbol(){return this.symbols[this.symbols.length-1]}get color(){return this.symbols[0].color}layout(t){this.requestRectUpdate(),this.staffObjects.length=0;let e=this.getSymbols();if(0===e.length)return;let{unitSize:i}=t,{stemDir:s,type:a}=this,o=e.map(t=>t.getBeamCoords());o[0].map(t=>null==t?void 0:t.staff).forEach((r,h)=>{var c,u;if(!r)return;let l=o.map(t=>{var e;return null==(e=t[h])?void 0:e.x}),d=o.map(t=>{var e;return null==(e=t[h])?void 0:e.y}),g=o.map(t=>{var e;return null==(e=t[h])?void 0:e.staff}),f=o.map(t=>{var e;return null==(e=t[h])?void 0:e.stemHeight}),m=e[0],p=l[0],C=d[0],I=g[0],A=e[e.length-1],b=l[l.length-1],y=d[d.length-1],v=g[d.length-1];if(void 0===p||void 0===C||void 0===I||void 0===b||void 0===y||void 0===v)return;let w=null!=(c=f[0])?c:0,R=null!=(u=f[f.length-1])?u:0;if(2!==a){let t=w<R?Math.sqrt(R-w):0,e=R<w?Math.sqrt(w-R):0;"up"===s&&(t*=-1,e*=-1),0!==t&&(C+=t,d[0]+=t),0!==e&&(y+=e,d[d.length-1]+=e)}let L=2*i*("up"===s?-1:1),x=(y+C)/2,T=((t,e)=>{let i=N;if(Number.isFinite(i)&&0!==i){let s=t/e/i;return s=Math.sign(s)*Math.sqrt(Math.abs(s)),t/s*i}return e})(b-p,y-C)/2;C=x-T,y=x+T;let P=0;d.forEach((t,e)=>{let i=l[e];if(void 0!==i&&void 0!==t){let e=t-n.OZ.Math.interpolateY(p,C,b,y,i);"up"===s&&e<0?P=Math.min(P,e):"down"===s&&e>0&&(P=Math.max(P,e))}}),C+=P,y+=P,d=d.map(t=>void 0===t?void 0:t+P);let D=new gt(r,this);if(2===a){let t=i/(b-p),e=n.OZ.Math.interpolateCoord(p,C+L,b,y+L,-t),s=n.OZ.Math.interpolateCoord(p,C+L,b,y+L,1+t);D.points.push(new dt(I,this,m,e.x,e.y)),D.points.push(new dt(v,this,A,s.x,s.y)),D.tupletNumberOffsetY=0}else if(0===a||1===a){P*=.5;let n=t.lineWidthPx*S;const a=t=>{let n=e[t];if(n instanceof lt){let t=n instanceof lt?Math.max(n.getLeftBeamCount(),n.getRightBeamCount()):0;return M*i*("up"===s?t-1:0)}return 0};e.forEach((t,e)=>{let i=g[e],o=l[e],r=d[e];if(i&&void 0!==o&&void 0!==r){let h=new dt(i,this,t,o,r);switch(s){case"up":h.topBeamsHeight=n/2,h.bottomBeamsHeight=n/2+a(e);break;case"down":h.topBeamsHeight=n/2+a(e),h.bottomBeamsHeight=n/2}D.points.push(h)}}),D.tupletNumberOffsetY=L}this.isTuplet()&&(D.tupletNumber=new V(this,this.getTupletRatioText(),.5,.5),D.tupletNumber.layout(t),D.tupletNumber.offset((p+b)/2,(C+y)/2+D.tupletNumberOffsetY)),D.points.length>=2&&this.staffObjects.push(D)})}updateRect(){if(0===this.staffObjects.length)this.rect=new n.vW;else{this.staffObjects.forEach(t=>t.updateRect()),this.rect=this.staffObjects[0].getRect().clone();for(let t=1;t<this.staffObjects.length;t++)this.rect.unionInPlace(this.staffObjects[t].getRect())}}updateNoteStemTips(){this.staffObjects.forEach(t=>{let e=t.points[0],i=t.points[t.points.length-1];2!==this.type&&t.points.forEach(t=>{t.symbol instanceof lt&&(t!==e&&t!==i&&(t.y=n.OZ.Math.interpolateY(e.x,e.y,i.x,i.y,t.x)),t.symbol.setStemTipY(t.staff,t.y))}),t.tupletNumber&&t.tupletNumber.setAnchorY((e.y+i.y)/2+t.tupletNumberOffsetY)})}offset(t,e){this.staffObjects.forEach(e=>e.offset(t,0)),this.requestRectUpdate()}draw(t,e){if(!this.intersects(e))return;let{unitSize:i}=t,{stemDir:s,color:a,type:o}=this;if(2===o){t.color(a).lineWidth(1);let e=("up"===s?1:-1)*i;this.staffObjects.forEach(i=>{let{x:s,y:a}=i.points[0],{x:o,y:r}=i.points[i.points.length-1];if(i.tupletNumber){let e=i.tupletNumber.getRect().width/(o-s)*1.2,h=n.OZ.Math.interpolateCoord(s,a,o,r,.5-e/2),c=n.OZ.Math.interpolateCoord(s,a,o,r,.5+e/2);t.strokeLine(s,a,h.x,h.y),t.strokeLine(c.x,c.y,o,r)}else t.strokeLine(s,a,o,r);t.strokeLine(s,a,s,a+e),t.strokeLine(o,r,o,r+e)})}else 0!==o&&1!==o||(t.color(a).lineWidth(S),this.staffObjects.forEach(e=>{let n=e.points.filter(t=>t.symbol instanceof lt),{x:a,y:o}=n[0],{x:r,y:h}=n[n.length-1],c=M*i*("up"===s?1:-1)*(1+.5*Math.abs(Math.atan2(h-o,r-a)));for(let i=0;i<n.length-1;i++){let{x:e,y:s,symbol:a}=n[i],{x:o,y:r,symbol:h}=n[i+1],u=a.getRightBeamCount(),l=h.getLeftBeamCount();for(let i=0;i<Math.max(u,l);i++)i<u&&i<l?t.strokeLine(e,s,o,r):u>l?t.strokePartialLine(e,s,o,r,0,.25):l>u&&t.strokePartialLine(e,s,o,r,.75,1),s+=c,r+=c}}));this.staffObjects.forEach(e=>{var i;return null==(i=e.tupletNumber)?void 0:i.draw(t)})}setBeamCounts(){const t=(t,e)=>{let{flagCount:i,noteSize:s,dotCount:n}=t.rhythmProps,{flagCount:a,noteSize:o,dotCount:r}=e.rhythmProps;return i>0&&a>0&&n>0&&0===r&&s*Math.pow(2,n)===o};let e,i=this.symbols.filter(t=>t instanceof lt);for(let s=0;s<i.length;s++){let e=i[s],n=i[s-1],a=i[s+1];e&&(e.setLeftBeamCount(0),e.setRightBeamCount(0),n&&(n.rhythmProps.flagCount===e.rhythmProps.flagCount||t(n,e)||t(e,n)?e.setLeftBeamCount(e.rhythmProps.flagCount):e.setLeftBeamCount(Math.min(n.rhythmProps.flagCount,e.rhythmProps.flagCount))),a&&(a.rhythmProps.flagCount===e.rhythmProps.flagCount||t(a,e)||t(e,a)?e.setRightBeamCount(e.rhythmProps.flagCount):e.setRightBeamCount(Math.min(a.rhythmProps.flagCount,e.rhythmProps.flagCount))))}do{e=!1;for(let t=0;t<i.length;t++){let s=i[t],n=i[t-1],a=i[t+1];s&&s.getLeftBeamCount()!==s.rhythmProps.flagCount&&s.getRightBeamCount()!==s.rhythmProps.flagCount&&(s.setLeftBeamCount(0),s.setRightBeamCount(0),n&&n.getRightBeamCount()>0&&(n.setRightBeamCount(0),e=!0),a&&a.getLeftBeamCount()>0&&(a.setLeftBeamCount(0),e=!0))}}while(e)}setTupletBeamCounts(){let t=this.getType(),e=this.getSymbols();1===t?e.forEach((t,i)=>{t instanceof lt&&(t.setLeftBeamCount(0===i?0:t.rhythmProps.flagCount),t.setRightBeamCount(i===e.length-1?0:t.rhythmProps.flagCount))}):2===t&&e.forEach(t=>{t instanceof lt&&(t.setLeftBeamCount(0),t.setRightBeamCount(0))})}};function pt(t){return t instanceof V||t instanceof $?t.getText():t instanceof ae?"[measure]":""}var Ct=class{constructor(t){this.startColumn=t,(0,a.Mu)(this,"columnRange"),(0,a.Mu)(this,"stopObject"),this.columnRange=[t]}get endColumn(){return this.columnRange[this.columnRange.length-1]}addColumn(t){this.endColumn!==t&&this.columnRange.push(t)}setStopObject(t){this.stopObject=t}},It=class t extends k{constructor(t,e,i,s,n,o){super(t.musicObj),this.headObj=t,(0,a.Mu)(this,"length"),(0,a.Mu)(this,"visible"),(0,a.Mu)(this,"lineStyle"),(0,a.Mu)(this,"linePos"),(0,a.Mu)(this,"startColumn"),this.length=i+1,this.visible=s,this.lineStyle=n,this.linePos=o,this.startColumn=e}isVisible(){return this.visible}getLineStyle(){return this.lineStyle}getLinePos(){return this.linePos}whatStopped(e){const i=e.measure,s=i.getColumns(),n=e.getAnchoredLayoutObjects().filter(t=>t!==this.headObj&&t.layoutGroupId===this.headObj.layoutGroupId).map(t=>t.musicObj).filter(t=>t instanceof V||t instanceof $)[0];return n||(e===s[s.length-1]&&i.hasEndSection()||i.hasEndSong()||t.StopNavigations.some(t=>i.hasNavigation(t))?i.getBarLineRight():void 0)}getRange(){let{startColumn:t,length:e}=this,i=t,s=new Ct(i),n=e;for(;;){if(!i||n<=0)return s;const t=this.whatStopped(i);if(void 0!==t)return s.setStopObject(t),s;s.addColumn(i),n-=i.getTicksToNextColumn(),i=i.getNextColumn()}}};(0,a.Mu)(It,"StopNavigations",["endRepeat","ending"]);var At=It;var bt=class extends G{constructor(t){var e;super(t[0].row),this.lines=t,(0,a.Mu)(this,"space",0),(0,a.Mu)(this,"instrument"),(0,a.Mu)(this,"hasBrace"),(0,a.Mu)(this,"instrText"),(0,a.Mu)(this,"braceRect",new n.vW),(0,a.Mu)(this,"mi");const i=this.row.doc.getColorWithKey("rowgroup.instrument"),s=function(t){return{instrName:(t.startsWith("!{")?t.substring(2):t.startsWith("!")?t.substring(1):t).trim(),hideInstr:t.startsWith("!"),hideBrace:t.startsWith("!{")}}(null!=(e=t[0].getConfig().instrument)?e:"");this.instrument=s.instrName,this.hasBrace=!s.hideBrace&&(this.hasInstrument&&t.length>=2);const o=s.hideInstr?"":this.instrument;this.instrText=new V(this,{text:o,color:i,scale:1},1,.5),this.mi=new Si(this)}getMusicInterface(){return this.mi}get row(){return this.lines[0].row}get hasInstrument(){return this.instrument.length>0}hasNotationLine(t){return this.lines.includes(t)}pick(t,e){if(!this.getRect().contains(t,e))return[];let i=this.instrText.pick(t,e);return i.length>0?[this,...i]:[this]}updateRect(){this.instrText.setRight(this.braceRect.left-this.space),this.instrText.setCenterY(this.braceRect.anchorY),this.rect=this.instrText.getRect().clone().unionInPlace(this.braceRect)}layout(t){this.space=t.unitSize,this.instrText.layout(t),this.braceRect=new n.vW(-(this.hasBrace?5*t.unitSize:0),0,0,0),this.forceRectUpdate()}layoutToNotationLines(){this.braceRect.top=this.lines[0].getTopLineY(),this.braceRect.bottom=this.lines[this.lines.length-1].getBottomLineY(),this.braceRect.anchorY=this.braceRect.centerY,this.forceRectUpdate()}offset(t,e){this.instrText.offset(t,e),this.braceRect.offsetInPlace(t,e),this.rect.offsetInPlace(t,e)}draw(t,e){if(this.intersects(e)&&(this.instrText.draw(t,e),this.hasBrace)){const e=this.braceRect,i=this.row.doc.getColorWithKey("rowgroup.frame");t.color(i).lineWidth(1).drawBracket(e,"{")}}},yt=class{constructor(){(0,a.Mu)(this,"instrWidth",0),(0,a.Mu)(this,"staffWidth",0)}resetWidths(){this.instrWidth=this.staffWidth=0}addRowInstrWidth(t){this.instrWidth=Math.max(this.instrWidth,t)}addRowstaffWidth(t){this.staffWidth=Math.max(this.staffWidth,t)}get instrLeft(){return 0}get instrRight(){return this.instrWidth}get staffLeft(){return this.instrRight}get staffRight(){return this.staffLeft+this.staffWidth}get left(){return this.instrLeft}get right(){return this.staffRight}get width(){return this.instrWidth+this.staffWidth}},vt=class extends G{constructor(t,e,i){super(t),this.doc=t,this.prevRow=e,this.scoreConfig=i,(0,a.Mu)(this,"nextRow"),(0,a.Mu)(this,"notationLines"),(0,a.Mu)(this,"rowGroups"),(0,a.Mu)(this,"staves"),(0,a.Mu)(this,"tabs"),(0,a.Mu)(this,"measures",[]),(0,a.Mu)(this,"rowGroupByLine"),(0,a.Mu)(this,"needLayout",!0),(0,a.Mu)(this,"mi"),this.notationLines=this.createNotationLines(),this.staves=this.notationLines.filter(t=>t instanceof de),this.tabs=this.notationLines.filter(t=>t instanceof ge);let s=[];for(let n=0;n<this.notationLines.length;n++){let t=this.notationLines[n],e=s[s.length-1];void 0===e||void 0===e[0].getConfig().instrument||e[0].getConfig().instrument!==t.getConfig().instrument?s.push([t]):e.push(t)}this.rowGroups=s.filter(t=>t.length>0).map(t=>new bt(t)),this.rowGroupByLine=this.notationLines.map(t=>this.rowGroups.find(e=>e.lines.includes(t))),this.prevRow&&(this.prevRow.nextRow=this),this.mi=new Mi(this)}getMusicInterface(){return this.mi}createNotationLines(){let t=this.scoreConfig.map((t,e)=>"staff"===t.type?new de(this,t,e):new ge(this,t,e));for(let e=0;e<t.length-1;e++){let i=t[e],s=t[e+1];i instanceof de&&s instanceof de&&void 0!==i.staffConfig.grandId&&i.staffConfig.grandId===s.staffConfig.grandId&&(i.joinGrandStaff(s),s.joinGrandStaff(i))}return t}getNotationLines(){return this.notationLines}getRowGroups(){return this.rowGroups}getRowGroupByLineId(t){return this.rowGroupByLine[t]}findMatchingLine(t){return t.row===this?t:this.notationLines.find(e=>n.OZ.Obj.deepEqual(t.row.scoreConfig,e.row.scoreConfig)&&t.id===e.id||n.I8.isNonEmptyString(t.getConfig().name)&&t.getConfig().name===e.getConfig().name&&t.getConfig().type===e.getConfig().type)}get regions(){return this.doc.regions}getStaves(){return this.staves}getTabs(){return this.tabs}get hasStaff(){return this.staves.length>0}get hasTab(){return this.tabs.length>0}getTopStaff(){let t=this.staves[0];if(t)return t;throw new D("Top staff is required!")}getBottomStaff(){let t=this.staves[this.staves.length-1];if(t)return t;throw new D("Bottom staff is required!")}getStaff(t){o.Note.validateDiatonicId(t);for(let e=0;e<this.notationLines.length;e++){let i=this.notationLines[e];if(i instanceof de&&i.containsDiatonicId(t))return i}}resetLayoutGroups(t){this.notationLines.forEach(e=>e.resetLayoutGroups(t))}layoutLayoutGroups(t){this.notationLines.forEach(e=>e.layoutAllLayoutGroups(t))}pick(t,e){if(!this.getRect().contains(t,e))return[];for(let i=0;i<this.measures.length;i++){let s=this.measures[i].pick(t,e);if(s.length>0)return[this,...s]}for(let i=0;i<this.rowGroups.length;i++){let s=this.rowGroups[i].pick(t,e);if(s.length>0)return[this,...s]}for(let i=0;i<this.notationLines.length;i++){let s=this.notationLines[i].pick(t,e);if(s.length>0)return[this,...s]}return[this]}getConnectivesContentRect(){let t=this.getRect(),e=this.getFirstMeasure(),i=e?e.getColumnsContentRect().left:t.left;return new n.vW(i,(i+t.right)/2,t.right,t.top,t.anchorY,t.bottom)}getDiatonicIdAt(t){for(let e=0;e<this.notationLines.length;e++){let i=this.notationLines[e],s=i instanceof de?i.getDiatonicIdAt(t):void 0;if(void 0!==s)return s}}addMeasure(t){this.measures.push(t)}getMeasures(){return this.measures}isFirstRow(){return this===this.doc.getFirstRow()}isLastRow(){return this===this.doc.getLastRow()}getPrevRow(){return this.prevRow}getNextRow(){return this.nextRow}getFirstMeasure(){return this.measures.length>0?this.measures[0]:void 0}getLastMeasure(){return this.measures.length>0?this.measures[this.measures.length-1]:void 0}getFirstColumn(){var t;return null==(t=this.getFirstMeasure())?void 0:t.getFirstColumn()}getLastColumn(){var t;return null==(t=this.getLastMeasure())?void 0:t.getLastColumn()}solveAutoStemDir(t){if(0===t.length)return"up";{let e=t[0].voiceId,i=t.filter(t=>t instanceof lt).map(t=>t.setDiatonicId),s=t.filter(t=>t instanceof Q&&t.setDiatonicId!==Q.UndefinedDiatonicId).map(t=>t.setDiatonicId);if(0===i.length&&0===s.length)return"up";let a=i.length>0?i:s,o=Math.floor(n.OZ.Math.avg(...a)),r=this.getStaves().filter(t=>t.containsVoiceId(e)&&t.containsDiatonicId(o));return r.length>0&&o>=r[0].middleLineDiatonicId?"down":"up"}}requestLayout(){this.needLayout||(this.needLayout=!0,this.doc.requestLayout())}layout(t){if(!this.needLayout)return;this.requestRectUpdate(),this.notationLines.forEach(e=>{e.removeObjects(),e.layoutHeight(t)}),this.rowGroups.forEach(e=>{e.layout(t),this.regions.addRowInstrWidth(e.getRect().width)}),this.measures.forEach(e=>e.layout(t));let e=this.measures.map(t=>t.getMinWidth()+t.getPostMeasureBreakWidth()).reduce((t,e)=>t+e);this.regions.addRowstaffWidth(e)}layoutStretch(t){if(!this.needLayout)return;this.rect=new n.vW(this.regions.left,this.regions.right,0,0),this.notationLines.forEach(e=>e.layoutWidth(t)),this.rowGroups.forEach(t=>t.setRight(this.regions.instrRight));let e=this.regions.staffWidth,i=0;this.measures.forEach(t=>{e-=t.getTotalStaticWidth()+t.getPostMeasureBreakWidth(),i+=t.getMinColumnsWidth()});let s=e/i,a=this.regions.staffLeft;this.measures.forEach(e=>{let i=e.getTotalStaticWidth()+e.getMinColumnsWidth()*s;e.layoutWidth(t,i);let n=e.getRect();e.setLeft(a),e.setAnchorY(0),a+=n.width,a+=e.getPostMeasureBreakWidth()}),this.measures.forEach(e=>{e.layoutConnectives(t),e.layoutBeams(t)})}updateRect(){var t;let e=this.regions.left,i=this.regions.right,s=0,a=0;const o=null==(t=this.getLastMeasure())?void 0:t.getBarLineRight().getAnchoredLayoutObjects().map(t=>t.musicObj).find(t=>t instanceof W);o&&(i=Math.max(i,o.getRect().right)),this.measures.length>0&&(s=Math.min(...this.measures.map(t=>t.getRect().top)),a=Math.max(...this.measures.map(t=>t.getRect().bottom))),this.rect=new n.vW(e,i,s,a)}alignStemsToBeams(){this.measures.forEach(t=>t.alignStemsToBeams())}layoutSetNotationLines(t){let{unitSize:e}=t;for(let i=1;i<this.notationLines.length;i++){let t=this.notationLines[i-1],s=this.notationLines[i];if(t instanceof de&&s instanceof de&&void 0!==t.staffConfig.grandId&&t.staffConfig.grandId===s.staffConfig.grandId){let i=t.getBottomLineY()-s.getTopLineY()+6*e;s.offsetY(i)}else{let i=t.calcBottom()-s.calcTop()+3*e;s.offsetY(i)}}this.measures.forEach(t=>{t.requestRectUpdate(),t.getBarLineLeft().requestRectUpdate(),t.getBarLineRight().requestRectUpdate(),t.getColumns().forEach(t=>{t.requestRectUpdate(),[0,1,2,3].forEach(e=>{var i;return null==(i=t.getVoiceSymbol(e))?void 0:i.requestRectUpdate()})})}),this.rowGroups.forEach(t=>t.layoutToNotationLines()),this.alignStemsToBeams(),this.requestRectUpdate()}layoutDone(){this.measures.forEach(t=>t.layoutDone()),this.needLayout=!1}offset(t,e){this.measures.forEach(i=>i.offset(t,e)),this.rect.offsetInPlace(t,e),this.notationLines.forEach(i=>i.offset(t,e)),this.rowGroups.forEach(i=>i.offset(t,e))}getStaffLineLeft(){var t;return null==(t=this.getFirstMeasure())?void 0:t.getStaffLineLeft()}draw(t,e){if(!this.intersects(e))return;t.drawDebugRect(this.getRect()),this.measures.forEach(i=>i.draw(t,e)),this.notationLines.forEach(i=>i.draw(t,e));const i=this.getStaffLineLeft();void 0!==i&&this.notationLines.length>1&&this.notationLines.forEach(e=>e.drawVerticalLine(t,i,t.lineWidthPx,!0)),this.rowGroups.forEach(i=>i.draw(t,e))}};function wt(t){let e=t;for(;e;){if(e.row instanceof vt)return e.row;if(e.measure instanceof ae)return e.measure.row;e=e.getParent()}}function Mt(t){return t instanceof Me||t instanceof V||t instanceof $}var Nt=class extends G{constructor(t,e,i,s){super(t),this.measure=t,this.line=e,this.extension=i,this.cols=s,(0,a.Mu)(this,"mi"),i.addTail(this),this.mi=new Ki(this)}get row(){return this.measure.row}getMusicInterface(){return this.mi}getLeftObj(){return this.cols[0]}getLineLeft(t){let e=this.getLeftObj();if(function(t){return t instanceof V||t instanceof $}(e))return e.getRect().right+t.unitSize;if(e instanceof we)return e.getRect().anchorX;if(e instanceof me){const t=e.measure.getColumns();if(e===t[0])return e.measure.getRect().left}return e.getRect().right}getRightObj(){const t=this.cols[this.cols.length-1];if(Mt(t)){const e=wt(t),i=this.cols[this.cols.length-2],s=wt(i);return e&&s&&e!==s?i:t}return t}getLineRight(t){let e=this.getRightObj();if(Mt(e))return e.getRect().left-t.unitSize;if(e instanceof me){const t=e.measure.getColumns();if(e===t[t.length-1])return e.measure.getRect().right;let i=e.getNextColumn();if(i&&i.measure===e.measure)return(e.getRect().right+i.getRect().left)/2}return e.getRect().anchorX}layoutFitToMeasure(t){let e=t.unitSize,i=this.getLineLeft(t),s=this.getLineRight(t);[i,s]=[Math.min(i,s),Math.max(i,s)],this.rect=new n.vW(i,s,-e/2,e/2)}pick(t,e){return this.rect.contains(t,e)?[this]:[]}layout(t){this.rect=new n.vW}offset(t,e){this.rect.offsetInPlace(t,e)}draw(t,e){if(!this.intersects(e))return;let{rect:i}=this;const s=this.extension.headObj.musicObj,n=String(s.userData["extension-color"]);"dashed"===this.extension.getLineStyle()&&t.setLineDash([7,3]),t.color(n).lineWidth(1),t.strokeLine(i.left,i.anchorY,i.right,i.anchorY),t.setLineDash([]);let a=this.extension.getTails();if(this===a[a.length-1]&&!Mt(this.getRightObj())){let e=i.anchorY>this.line.getRect().anchorY?-t.unitSize:t.unitSize;t.strokeLine(i.right,i.anchorY,i.right,i.anchorY+e)}}},St=class extends G{constructor(t,e,i,s,o,...r){var h;super(i),this.connectiveProps=t,this.measure=i,(0,a.Mu)(this,"lx",0),(0,a.Mu)(this,"ly",0),(0,a.Mu)(this,"rx",0),(0,a.Mu)(this,"ry",0),(0,a.Mu)(this,"cp1x",0),(0,a.Mu)(this,"cp1y",0),(0,a.Mu)(this,"cp2x",0),(0,a.Mu)(this,"cp2y",0),(0,a.Mu)(this,"arcHeight",0),(0,a.Mu)(this,"line"),(0,a.Mu)(this,"leftNoteGroup"),(0,a.Mu)(this,"leftNoteId"),(0,a.Mu)(this,"rightNoteGroup"),(0,a.Mu)(this,"rightNoteId"),(0,a.Mu)(this,"tieType"),(0,a.Mu)(this,"mi"),this.line=null!=(h=this.measure.row.findMatchingLine(e))?h:e,this.leftNoteGroup=s,this.leftNoteId=o,r[0]instanceof lt&&"number"==typeof r[1]?(this.rightNoteGroup=r[0],this.rightNoteId=r[1],this.tieType=void 0):n.I8.isEnumValue(r[0],Wt)&&(this.rightNoteGroup=void 0,this.rightNoteId=void 0,this.tieType=r[0]),this.measure.addConnectiveObject(this),this.mi=new Fe(this)}getMusicInterface(){return this.mi}get color(){return this.measure.doc.getColorWithKey(this.line instanceof ge?"tab.connective":"staff.connective")}isInsideMeasure(){return void 0===this.rightNoteGroup||this.leftNoteGroup.measure===this.rightNoteGroup.measure}pick(t,e){return this.rect.contains(t,e)?[this]:[]}layout(t){let e,i,s,a,o,r,{unitSize:h}=t,{measure:c,line:u,leftNoteGroup:l,leftNoteId:d,rightNoteGroup:g,rightNoteId:f,connectiveProps:m}=this,{noteAnchor:p,arcDir:C}=m,{row:I}=c,A=I.getPrevRow(),b=I.getNextRow(),y=I.getConnectivesContentRect();if(e=l.getConnectiveAnchorPoint(m,u,d,p,"left"),i=void 0!==g&&void 0!==f?g.getConnectiveAnchorPoint(m,u,f,p,"right"):"toMeasureEnd"===this.tieType?{x:c.getColumnsContentRect().right,y:e.y}:{x:e.x+h*x,y:e.y},void 0===g)s=e.x,a=e.y,o=i.x,r=i.y;else if(l.row===I&&g.row===I)s=e.x,a=e.y,o=i.x,r=i.y;else if(l.row===A&&g.row===I){let t=A.getConnectivesContentRect().right-e.x,n=i.x-y.left;s=y.left,a=e.y+(i.y-e.y)*t/(t+n),o=i.x,r=i.y}else{if(l.row!==I||g.row!==b)throw new D("Cannot layout connective object because no valid left and right note groups.");{let t=b.getConnectivesContentRect(),n=y.right-e.x,h=i.x-t.left;s=e.x,a=e.y,o=y.right,r=e.y+(i.y-e.y)*n/(n+h)}}let v=("up"===C?-1:1)*h*Math.log2(o-s)/3;this.lx=s,this.ly=a,this.rx=o,this.ry=r,this.arcHeight="slide"===this.connectiveProps.connective?0:v;let{nx:w,ny:M}=n.OZ.Math.calcNormal(s,a,o,r);this.cp1x=.7*s+.3*o+w*this.arcHeight,this.cp1y=.7*a+.3*r+M*this.arcHeight,this.cp2x=.3*s+.7*o+w*this.arcHeight,this.cp2y=.3*a+.7*r+M*this.arcHeight,this.rect=new n.vW(Math.min(this.lx,this.cp1x,this.cp2x,this.rx),Math.max(this.lx,this.cp1x,this.cp2x,this.rx),Math.min(this.ly,this.cp1y,this.cp2y,this.ry),Math.max(this.ly,this.cp1y,this.cp2y,this.ry)),this.line.addObject(this)}offset(t,e){this.lx+=t,this.ly+=e,this.rx+=t,this.ry+=e,this.cp1x+=t,this.cp1y+=e,this.cp2x+=t,this.cp2y+=e,this.rect.offsetInPlace(t,e)}draw(t,e){if(!this.intersects(e))return;if(void 0===this.rightNoteGroup);else if(this.leftNoteGroup.measure===this.rightNoteGroup.measure);else if(this.leftNoteGroup.row.getNextRow()===this.rightNoteGroup.row);else if(this.measure!==this.rightNoteGroup.measure)return;let{rect:i}=this,{lineWidthPx:s}=t;t.drawDebugRect(i);let n=1.5*s,a=.25*s;t.color(this.color),t.lineWidth(1),0===this.arcHeight?(t.beginPath(),t.moveTo(this.lx,this.ly),t.lineTo(this.rx,this.ry),t.stroke()):(t.beginPath(),t.moveTo(this.lx,this.ly-a),t.bezierCurveTo(this.cp1x,this.cp1y-n,this.cp2x,this.cp2y-n,this.rx,this.ry-a),t.lineTo(this.rx,this.ry+a),t.bezierCurveTo(this.cp2x,this.cp2y+n,this.cp1x,this.cp1y+n,this.lx,this.ly+a),t.fill())}},Rt=(t=>(t.Treble="treble",t.Bass="bass",t.Grand="grand",t.GuitarTreble="guitarTreble",t.GuitarTab="guitarTab",t.GuitarCombined="guitarCombined",t))(Rt||{}),Lt=(t=>(t.G="G",t.F="F",t))(Lt||{});function xt(){return[0,1,2,3]}function Tt(t){return n.I8.isIncluded(Number(t),[0,1,2,3])}function Pt(t){if(Tt(t))return t;throw new D(`Invalid voice id: ${t}`)}function Dt(){return[1,2,3,4,5,6]}function Bt(t){return n.I8.isIncluded(Number(t),[1,2,3,4,5,6])}function Ot(t){if(Bt(t))return t;throw new D(`Invalid string number: ${t}`)}function Et(){return[1,2,3]}function jt(t){return n.I8.isIncluded(Number(t),[1,2,3])}function kt(t){if(jt(t))return t;throw new D(`Invalid verse number: ${t}`)}var Gt=(t=>(t.Auto="auto",t.Up="up",t.Down="down",t))(Gt||{}),Ft=(t=>(t.Up="up",t.Down="down",t))(Ft||{}),Wt=(t=>(t.Stub="stub",t.ToMeasureEnd="toMeasureEnd",t))(Wt||{}),Yt=(t=>(t.Auto="auto",t.Above="above",t.Center="center",t.Below="below",t.StemTip="stemTip",t))(Yt||{}),Ut=(t=>(t.Tie="tie",t.Slur="slur",t.Slide="slide",t))(Ut||{}),zt=(t=>(t.Auto="auto",t.Above="above",t.Below="below",t.Both="both",t))(zt||{}),Vt=(t=>(t.Left="left",t.Center="center",t.Right="right",t))(Vt||{}),Zt=(t=>(t.Hyphen="-",t.Extender="---",t))(Zt||{}),qt=(t=>(t.AtNote="atNote",t.AtMeasureEnd="atMeasureEnd",t))(qt||{}),Ht=(t=>(t.Note="note",t.Chord="chord",t))(Ht||{}),Kt=(t=>(t.Navigation="navigation",t.Dynamics="dynamics",t.Tempo="tempo",t.Articulation="articulation",t.Expression="expression",t.Technique="technique",t.Temporal="temporal",t.Label="label",t.Ornament="ornament",t.Misc="misc",t))(Kt||{}),Xt=(t=>(t.DC_al_Fine="D.C. al Fine",t.DC_al_Coda="D.C. al Coda",t.DS_al_Fine="D.S. al Fine",t.DS_al_Coda="D.S. al Coda",t.Coda="Coda",t.toCoda="toCoda",t.Segno="Segno",t.Fine="Fine",t.StartRepeat="startRepeat",t.EndRepeat="endRepeat",t.Ending="ending",t.ppp="ppp",t.pp="pp",t.p="p",t.mp="mp",t.m="m",t.mf="mf",t.f="f",t.ff="ff",t.fff="fff",t.cresc="cresc.",t.decresc="decresc.",t.dim="dim.",t.fp="fp",t.sf="sf",t.sfz="sfz",t.sforzando="sforzando",t.accel="accel.",t.rit="rit.",t.rall="rall.",t.a_tempo="a tempo",t.rubato="rubato",t.Largo="Largo",t.Adagio="Adagio",t.Andante="Andante",t.Moderato="Moderato",t.Allegro="Allegro",t.Vivace="Vivace",t.Presto="Presto",t.Prestissimo="Prestissimo",t.staccato="staccato",t.staccatissimo="staccatissimo",t.spiccato="spiccato",t.tenuto="tenuto",t.accent="accent",t.marcato="marcato",t.legato="legato",t.portato="portato",t.dolce="dolce",t.cantabile="cantabile",t.espressivo="espressivo",t.espr="espr.",t.leggiero="leggiero",t.pesante="pesante",t.con_brio="con brio",t.con_fuoco="con fuoco",t.giocoso="giocoso",t.maestoso="maestoso",t.misterioso="misterioso",t.tranquillo="tranquillo",t.pizz="pizz.",t.arco="arco",t.col_legno="col legno",t.sul_ponticello="sul ponticello",t.sul_tasto="sul tasto",t.vibrato="vibrato",t.senza_vibrato="senza vibrato",t.legato_pedal="legato pedal",t.staccato_pedal="staccato pedal",t.una_corda="una corda",t.tre_corde="tre corde",t.trill="trill",t.tr="tr",t.mordent="mordent",t.grace_note="grace note",t.turn="turn",t.appoggiatura="appoggiatura",t.acciaccatura="acciaccatura",t.fermata="fermata",t.measureEndFermata="measureEndFermata",t.PitchLabel="pitchLabel",t.ChordLabel="chordLabel",t._8va="8va",t._8vb="8vb",t.loco="loco",t.tacet="tacet",t.sim="sim.",t.div="div.",t.unis="unis.",t.cue_notes="cue notes",t))(Xt||{}),Jt=(t=>(t.TimePosition="timePosition",t.LeftBarLine="leftBarLine",t.RightBarLine="rightBarLine",t))(Jt||{}),Qt=(t=>(t.DC_al_Fine="D.C. al Fine",t.DC_al_Coda="D.C. al Coda",t.DS_al_Fine="D.S. al Fine",t.DS_al_Coda="D.S. al Coda",t.Coda="Coda",t.toCoda="toCoda",t.Segno="Segno",t.Fine="Fine",t.StartRepeat="startRepeat",t.EndRepeat="endRepeat",t.Ending="ending",t))(Qt||{}),_t=(t=>(t.ppp="ppp",t.pp="pp",t.p="p",t.mp="mp",t.m="m",t.mf="mf",t.f="f",t.ff="ff",t.fff="fff",t.cresc="cresc.",t.decresc="decresc.",t.dim="dim.",t))(_t||{}),$t=(t=>(t.accel="accel.",t.rit="rit.",t.rall="rall.",t.a_tempo="a tempo",t))($t||{}),te=(t=>(t.fermata="fermata",t.measureEndFermata="measureEndFermata",t))(te||{}),ee=(t=>(t[t.Playing=0]="Playing",t[t.Paused=1]="Paused",t[t.Stopped=2]="Stopped",t))(ee||{}),ie=class{constructor(t,e,i,s){this.connective=t,this.span=e,this.noteAnchor=i,(0,a.Mu)(this,"noteGroups"),(0,a.Mu)(this,"arcDir","down"),this.noteGroups=[s]}getStartNoteGroup(){return this.noteGroups[0]}startsWith(t){return this.noteGroups[0]===t}addNoteGroup(t){return"stub"!==this.span&&"toMeasureEnd"!==this.span&&(this.span>this.noteGroups.length&&(this.noteGroups.push(t),!0))}computeParams(t){let{stemDir:e}=this.noteGroups[0],{hasStem:i}=this.noteGroups[0].rhythmProps;if("stemTip"===this.noteAnchor)this.arcDir="up"===e?"up":"down";else if("auto"===this.noteAnchor)this.arcDir="up"!==e&&i?"up":"down",this.noteGroups[0].notes.length>1||"slide"===this.connective?this.noteAnchor="center":"up"===this.arcDir?this.noteAnchor="above":this.noteAnchor="below";else if("center"===this.noteAnchor){let e=t instanceof de?t:void 0,i=this.noteGroups[0].getDiatonicId(e);this.arcDir=!e||i<e.middleLineDiatonicId?"down":"up"}else"above"===this.noteAnchor?this.arcDir="up":"below"===this.noteAnchor&&(this.arcDir="down")}removeConnectives(){this.noteGroups.forEach(t=>{t.measure.removeConnectiveObjects(),t.removeConnectiveProps()}),this.noteGroups.length=1}createConnectives(){if(0===this.noteGroups.length)return;this.getStartNoteGroup().collectConnectiveProps();let{connective:t,span:e}=this;this.noteGroups[0].row.getNotationLines().forEach(i=>{if(this.computeParams(i),"tie"===t){if(n.I8.isEnumValue(e,Wt)){let t=this.noteGroups[0];for(let s=0;s<t.notes.length;s++)this.createObjConnectiveWithTieType(i,t,s,e)}else if(this.noteGroups.length>=2)for(let t=0;t<this.noteGroups.length-1;t++){let e=this.noteGroups[t],s=this.noteGroups[t+1];e.notes.forEach((t,n)=>{let a=s.notes.findIndex(e=>o.Note.equals(e,t));a>=0&&this.createObjConnective(i,e,n,s,a)})}}else if("slur"===t){if("number"==typeof e&&e>=2&&this.noteGroups.length===e){let t=this.noteGroups[0],e=this.noteGroups[this.noteGroups.length-1];this.createObjConnective(i,t,0,e,0)}}else if("slide"===t&&this.noteGroups.length>=2)for(let t=0;t<this.noteGroups.length-1;t++){let e=this.noteGroups[t],s=this.noteGroups[t+1];this.createObjConnective(i,e,0,s,0)}})}createObjConnectiveWithTieType(t,e,i,s){if(e.enableConnective(t))if(t instanceof de)new St(this,t,e.measure,e,i,s);else if(t instanceof ge){void 0!==e.getFretNumberString(i)&&new St(this,t,e.measure,e,i,s)}}createObjConnective(t,e,i,s,n){const a=(e,i,s,n,a)=>{if(i.enableConnective(t)&&n.enableConnective(t))if(t instanceof de)new St(this,t,e,i,s,n,a);else if(t instanceof ge){let o=i.getFretNumberString(s),r=n.getFretNumberString(a);void 0===o||void 0===r||o!==r&&"slur"!==this.connective||new St(this,t,e,i,s,n,a)}};if(e.measure===s.measure)a(e.measure,e,i,s,n);else{if(e.measure.getNextMeasure()!==s.measure)throw new D("Cannot create connective because it is jumping measures.");a(e.measure,e,i,s,n),a(s.measure,e,i,s,n)}}},se=class extends G{constructor(t,e,i,s,r,h,c){super(t),this.col=t,this.verse=e,this.line=i,this.vpos=s,(0,a.Mu)(this,"nextLyricsObject"),(0,a.Mu)(this,"rhythmProps"),(0,a.Mu)(this,"color","black"),(0,a.Mu)(this,"hyphen"),(0,a.Mu)(this,"text"),(0,a.Mu)(this,"mi"),this.rhythmProps=o.RhythmProps.get(r);let u="left"===(null==c?void 0:c.align)?0:"right"===(null==c?void 0:c.align)?1:.5;this.hyphen=n.I8.isEnumValue(null==c?void 0:c.hyphen,Zt)?null==c?void 0:c.hyphen:void 0,this.text=new V(this,{text:h,color:this.color,scale:.8},u,0),this.rect=this.text.getRect().clone(),this.mi=new Ui(this)}getMusicInterface(){return this.mi}get measure(){return this.col.measure}getText(){return this.text.getText()}setNextLyricsObject(t){this.nextLyricsObject=t}pick(t,e){return this.getRect().contains(t,e)?[this]:[]}layout(t){this.text.layout(t),this.rect=this.text.getRect().clone()}offset(t,e){this.text.offset(t,e),this.rect.offsetInPlace(t,e)}draw(t,e){var i;if(this.intersects(e)&&(this.text.draw(t,e),void 0!==this.hyphen)){t.color(this.color).lineWidth(1);let e=this.getRect(),s=null==(i=this.nextLyricsObject)?void 0:i.getRect(),n=1.5*t.unitSize,a=s?.85*(s.left-e.right):n,o="-"===this.hyphen?Math.min(n,a):a;if(o>0){let i=s?(e.right+s.left)/2:e.right+o/.85,n=e.centerY;t.moveTo(i-o/2,n),t.lineTo(i+o/2,n),t.stroke()}}}},ne=class extends G{constructor(t,e){super(t),this.measure=t,this.tab=e,(0,a.Mu)(this,"voiceId"),(0,a.Mu)(this,"mi"),(0,a.Mu)(this,"tupletPartsTextObjMap",new n.b1),this.voiceId=[0,1,2,3].filter(t=>e.containsVoiceId(t)),this.rect=new n.vW,this.mi=new ji(this)}getMusicInterface(){return this.mi}get doc(){return this.measure.doc}pick(t,e){return this.rect.contains(t,e)?[this]:[]}layout(t){let e=this.measure.getColumns(),i=[0,1,2,3].map(t=>n.OZ.Math.sum(e.map(e=>e.getVoiceSymbol(t)?1:0)));this.voiceId.sort((t,e)=>n.OZ.Math.cmp(i[t],i[e])),this.rect=new n.vW}hasTuplets(){return this.measure.getBeamGroups().some(t=>t.isTuplet())}layoutFitToMeasure(t){let{unitSize:e,fontSizePx:i}=t,{measure:s}=this,n=s.getColumnsContentRect(),a=5*e;this.rect.left=n.left,this.rect.anchorX=n.centerX,this.rect.right=n.right,this.rect.top=this.hasTuplets()?-i:0,this.rect.anchorY=0,this.rect.bottom=a}offset(t,e){this.rect.offsetInPlace(t,e)}draw(t,e){if(!this.intersects(e))return;t.drawDebugRect(this.rect),t.lineWidth(1);let{unitSize:i,fontSizePx:s}=t,a=i,o=i,r=.25*i,{bottom:h,anchorY:c}=this.getRect(),u=c,l=h,d=this.measure.getColumns();for(let g=0;g<d.length;g++){let i=d[g],h=this.voiceId.map(t=>i.getVoiceSymbol(t)).find(t=>void 0!==t);if(!h)continue;let c=h.getBeamGroup(),f=c?c.getSymbols():[h];for(let m=0;m<f.length;m++){let i=f[m],h=f[m+1],p=i.col.getRect().anchorX;if(i instanceof lt){if(t.lineWidth(1),t.color(this.doc.getColorWithKey("tab.note")),i.rhythmProps.noteSize>=2&&(t.lineWidth(4===i.rhythmProps.noteSize?2:1),t.strokeLine(p,l,p,u)),1===f.length)for(let e=0;e<i.rhythmProps.flagCount;e++)t.drawSymbol(9,new n.vW(p,p+a,u+e*a,u+(e+2)*a),!1,!1);for(let e=0;e<i.rhythmProps.dotCount;e++)t.fillCircle(p+o*(e+1),l-r,r)}else if(i instanceof Q){t.lineWidth(1),t.color(this.doc.getColorWithKey("tab.rest"));let e=p,s=(u+l)/2,n=.65;t.save(),t.scale(n,n),t.drawRest(i.rhythmProps.noteSize,e/n,s/n),t.restore();for(let a=0;a<i.rhythmProps.dotCount;a++)e+=1.5*o,t.fillCircle(e,s+o,r)}if(h){let e=i,s=h,n=e.col.getRect().anchorX,c=s.col.getRect().anchorX,d=e.hasTuplet()?1:e instanceof lt?e.getRightBeamCount():1,g=s.hasTuplet()?1:s instanceof lt?s.getLeftBeamCount():1,f=Math.max(d,g);t.color(this.doc.getColorWithKey("tab.note")),t.lineWidth(2);for(let i=0;i<f;i++){let e=g>d&&i>=d?.75:0,s=d>g&&i>=g?.25:1;t.strokePartialLine(n,u+i*a,c,u+i*a,e,s)}t.lineWidth(1);for(let i=0;i<e.rhythmProps.dotCount;i++)t.fillCircle(n+o*(i+1),l-r,r);for(let i=0;i<s.rhythmProps.dotCount;i++)t.fillCircle(c+o*(i+1),l-r,r)}if(c&&c.isTuplet()){t.color(this.doc.getColorWithKey("tab.note"));let i=(f[0].col.getRect().anchorX+f[f.length-1].col.getRect().anchorX)/2,n=c.getTupletRatioText(),a=this.tupletPartsTextObjMap.get(n);a||(this.tupletPartsTextObjMap.set(n,a=new V(this,{text:n,scale:.75},.5,.5)),a.layout(t)),a.setCenter(i,u-s/2),a.draw(t,e)}f.length>1&&(g=d.indexOf(f[f.length-1].col),g<0&&(g=d.length))}}}};var ae=class extends G{constructor(t,e){super(t),this.row=t,this.options=e,(0,a.Mu)(this,"prevMeasure"),(0,a.Mu)(this,"nextMeasure"),(0,a.Mu)(this,"keySignature",o.getDefaultKeySignature()),(0,a.Mu)(this,"timeSignature",(0,o.getDefaultTimeSignature)()),(0,a.Mu)(this,"tempo",(0,o.getDefaultTempo)()),(0,a.Mu)(this,"alterKeySignature"),(0,a.Mu)(this,"alterTimeSignature"),(0,a.Mu)(this,"alterTempo"),(0,a.Mu)(this,"signatures",[]),(0,a.Mu)(this,"tabStringNotes",[]),(0,a.Mu)(this,"barLineLeft"),(0,a.Mu)(this,"columns",[]),(0,a.Mu)(this,"barLineRight"),(0,a.Mu)(this,"connectives",[]),(0,a.Mu)(this,"beamGroups",[]),(0,a.Mu)(this,"measureId"),(0,a.Mu)(this,"region_0_tabTuning",0),(0,a.Mu)(this,"region_1_signature",0),(0,a.Mu)(this,"region_2_leftBarLine",0),(0,a.Mu)(this,"region_3_padding",0),(0,a.Mu)(this,"region_4_columnsMin",0),(0,a.Mu)(this,"region_5_padding",0),(0,a.Mu)(this,"region_6_rightBarLine",0),(0,a.Mu)(this,"needLayout",!0),(0,a.Mu)(this,"voiceSymbols",(0,n.Sl)(new n.qG)),(0,a.Mu)(this,"lastAddedRhythmColumn"),(0,a.Mu)(this,"lastAddedRhythmSymbol"),(0,a.Mu)(this,"addExtensionTo",[]),(0,a.Mu)(this,"layoutObjects",[]),(0,a.Mu)(this,"postMeasureBreakWidth",0),(0,a.Mu)(this,"passCount",0),(0,a.Mu)(this,"needBeamsUpdate",!0),(0,a.Mu)(this,"navigationSet",new n.wu),(0,a.Mu)(this,"isEndSong",!1),(0,a.Mu)(this,"isEndSection",!1),(0,a.Mu)(this,"endRepeatPlayCount",2),(0,a.Mu)(this,"endRepeatPlayCountText"),(0,a.Mu)(this,"staticObjectsCache",new n.b1),(0,a.Mu)(this,"lyricsObjectsCache",new n.Yz),(0,a.Mu)(this,"mi"),this.mi=new ni(this),this.prevMeasure=t.doc.getLastMeasure(),this.prevMeasure&&(this.prevMeasure.nextMeasure=this),this.barLineLeft=new we(this),this.barLineRight=new Me(this),this.measureId=this.prevMeasure?this.prevMeasure.measureId+1:0,this.updateKeySignature(),this.updateTimeSignature(),this.updateTempo(),this.row.getTabs().forEach(t=>{this.addLayoutObject(new ne(this,t),t,0,0)})}getMusicInterface(){return this.mi}get doc(){return this.row.doc}isPartialMeasure(){return this.getConsumedTicks()<this.getMeasureTicks()}isUpBeat(){return this===this.doc.getFirstMeasure()}resetPassCount(){this.passCount=0}incPassCount(){this.passCount++}getPassCount(){return this.passCount}updateRunningArguments(t){var e;null!=t||(t=[]);let i=n.OZ.Math.sum([0,1,2,3].map(t=>this.getVoiceSymbols(t).length>0?1:0));[0,1,2,3].forEach(e=>{var s;let n=null!=(s=t[e])?s:t[e]={diatonicId:(()=>{let t=this.row.getStaves().filter(t=>t.containsVoiceId(e)),i=this.row.getTabs().filter(t=>t.containsVoiceId(e));return t.length>0?t[0].middleLineDiatonicId:i.length>0?i[0].getTuningStrings()[3].diatonicId:o.Note.getNote("G4").diatonicId})(),stemDir:"auto",stringNumbers:[]};this.getVoiceSymbols(e).forEach((t,e,s)=>{var a,o;if(t.setDiatonicId===Q.UndefinedDiatonicId?i<2&&(n.diatonicId=Q.UndefinedDiatonicId):n.diatonicId=t.setDiatonicId,t instanceof lt)switch(t.setStringsNumbers&&(n.stringNumbers=t.setStringsNumbers),null==(a=t.options)?void 0:a.stem){case"up":case"up":n.stemDir="up";break;case"down":case"down":n.stemDir="down";break;case"auto":case"auto":n.stemDir="auto"}let r,h=null==(o=t.getBeamGroup())?void 0:o.getSymbols();r=void 0===h?"auto"===n.stemDir?this.row.solveAutoStemDir([t]):n.stemDir:t===h[0]?"auto"===n.stemDir?this.row.solveAutoStemDir(h):n.stemDir:h[0].stemDir,t.updateRunningArguments(n.diatonicId,r,n.stringNumbers)})}),null==(e=this.getNextMeasure())||e.updateRunningArguments(t)}pick(t,e){if(!this.getRect().contains(t,e))return[];for(let i=0;i<this.signatures.length;i++){let s=this.signatures[i].pick(t,e);if(s.length>0)return[this,...s]}for(let i=0;i<this.tabStringNotes.length;i++){let s=this.tabStringNotes[i].pick(t,e);if(s.length>0)return[this,...s]}for(let i=0;i<this.columns.length;i++){let s=this.columns[i].pick(t,e);if(s.length>0)return[this,...s]}if(this.barLineLeft){let i=this.barLineLeft.pick(t,e);if(i.length>0)return[this,...i]}if(this.barLineRight){let i=this.barLineRight.pick(t,e);if(i.length>0)return[this,...i]}if(this.endRepeatPlayCountText){let i=this.endRepeatPlayCountText.pick(t,e);if(i.length>0)return[this,...i]}for(let i=0;i<this.connectives.length;i++){let s=this.connectives[i].pick(t,e);if(s.length>0)return[this,...s]}for(let i=0;i<this.beamGroups.length;i++){let s=this.beamGroups[i].pick(t,e);if(s.length>0)return[this,...s]}for(let i=0;i<this.layoutObjects.length;i++){let s=this.layoutObjects[i].musicObj.pick(t,e);if(s.length>0)return[this,...s]}return[this]}getMeasureNumber(){let t=this.doc.getFirstMeasure();return t&&t.isPartialMeasure()?this.measureId:this.measureId+1}getColumns(){return this.columns}getColumnCount(){return this.columns.length}getColumn(t){return this.getColumns()[t]}isFirstMeasure(){return void 0===this.prevMeasure}isLastMeasure(){return void 0===this.nextMeasure}isFirstMeasureInRow(){return this===this.row.getFirstMeasure()}isLastMeasureInRow(){return this===this.row.getLastMeasure()}getNextMeasure(){return this.nextMeasure}getPrevMeasure(){return this.prevMeasure}getKeySignature(){return this.keySignature}getFirstColumn(){return 0===this.columns.length?void 0:this.columns[0]}getLastColumn(){return 0===this.columns.length?void 0:this.columns[this.columns.length-1]}setKeySignature(...t){var e;if(null==(e=this.getPrevMeasure())||e.endSection(),t[0]instanceof o.KeySignature)this.alterKeySignature=t[0];else if(t[0]instanceof o.Scale)this.alterKeySignature=t[0];else if(n.I8.isNonEmptyString(t[0]))if(1===t.length)this.alterKeySignature=o.getScale(t[0]);else if(2===t.length){let e=o.resolveTonic(t[0]),i=o.resolveScaleType(t[1]);this.alterKeySignature=o.getScale(e,i)}this.updateKeySignature()}updateKeySignature(){this.keySignature=this.prevMeasure?this.prevMeasure.keySignature:o.getDefaultKeySignature(),this.alterKeySignature&&(this.keySignature=this.alterKeySignature),this.nextMeasure&&this.nextMeasure.updateKeySignature(),this.requestLayout()}getTimeSignature(){return this.timeSignature}setTimeSignature(t){var e;null==(e=this.getPrevMeasure())||e.endSection(),this.alterTimeSignature=t,this.updateTimeSignature()}updateTimeSignature(){this.timeSignature=this.prevMeasure?this.prevMeasure.timeSignature:(0,o.getDefaultTimeSignature)(),this.alterTimeSignature&&(this.timeSignature=this.alterTimeSignature),this.nextMeasure&&this.nextMeasure.updateTimeSignature(),this.requestLayout()}getTempo(){return this.tempo}setTempo(t,e){var i;if(null==(i=this.getPrevMeasure())||i.endSection(),void 0===e)this.alterTempo={beatsPerMinute:t};else{let i=o.NoteLengthProps.get(e).dotCount,s={beatLength:o.validateNoteLength(e),dotCount:i>0?i:void 0};this.alterTempo={beatsPerMinute:t,options:s}}this.updateTempo()}updateTempo(){var t;if(this.tempo=this.prevMeasure?this.prevMeasure.tempo:(0,o.getDefaultTempo)(),this.alterTempo){let e,i,s=this.alterTempo.beatsPerMinute;this.alterTempo.options?(e=this.alterTempo.options.beatLength,i=null!=(t=this.alterTempo.options.dotCount)?t:0):this.alterTimeSignature?(e=this.alterTimeSignature.beatLength,i=0):(e=this.tempo.options.beatLength,i=this.tempo.options.dotCount),this.tempo={beatsPerMinute:s,options:{beatLength:e,dotCount:i}}}this.nextMeasure&&this.nextMeasure.updateTempo(),this.requestLayout()}hasPostMeasureBreak(){return this.isEndSong&&this!==this.row.getLastMeasure()}getPostMeasureBreakWidth(){return this.postMeasureBreakWidth}addLayoutObject(t,e,i,s){const n=new ce(t,e,i,s);return this.layoutObjects.push(n),this.requestLayout(),this.requestRectUpdate(),n}forEachStaffTarget(t,e,i){const s=this.row.getNotationLines(),a=(t,o,r=[])=>{if("number"==typeof t)s[t]&&i(s[t],o);else if("string"==typeof t&&t.length>0){let h=s.filter(e=>e.name===t);if(h.forEach(t=>i(t,o)),0===h.length){let i=this.doc.getStaffGroup(t);if(i&&!r.includes(t)){let s=[...r,t];(n.I8.isArray(i.staffsTabsAndGroups)?i.staffsTabsAndGroups:[i.staffsTabsAndGroups]).forEach(t=>{switch(i.verticalPosition){case"above":a(t,0,s);break;case"below":a(t,1,s);break;case"both":a(t,0,s),a(t,1,s);break;case"auto":a(t,e,s)}})}}}};void 0===t?s.length>=2&&s[0]instanceof de&&s[1]instanceof de&&void 0!==s[0].staffConfig.grandId&&s[0].staffConfig.grandId===s[1].staffConfig.grandId?a(1===e?1:0,e):a(0,e):n.I8.isArray(t)?t.forEach(t=>a(t,e)):a(t,e)}hasNavigation(t){return this.navigationSet.has(t)}hasFermata(t){return this.layoutObjects.some(e=>e.musicObj instanceof W&&e.anchor===t)}addAnnotation(t,e,i,s){var a;if(!n.I8.isNonEmptyString(i))throw new D("Annotation error: invalid annotation kind.");if("label"===e&&!n.I8.isNonEmptyString(s.labelText))throw new D("Annotation error: label text is empty.");if("ending"===i&&n.I8.isUndefined(s.endingPassages))throw new D("Annotation error: ending passages is undefined.");if(ht(i)){if(this.lastAddedRhythmSymbol instanceof lt)return void this.lastAddedRhythmSymbol.addNoteArticulation(i,s);throw new D(`Annotation error: no note for "${i}".`)}const o=function(t){switch(t){case"bottom":return.8;case"middle":return.5}}("bottom");let r;const h=t=>{var i;return null!=(i=s.color)?i:this.doc.getColorWithKey(et(t,e))},c=this.lastAddedRhythmColumn,u="rightBarLine"===s.anchor||"measureEndFermata"===i?this.barLineRight:this.lastAddedRhythmColumn;switch(i){case"ending":if(this.navigationSet.has(i))throw new D("Cannot add ending becaure measure already has one.");r=t=>{let e=s.endingPassages;const i=h(t);return new K(this,i,n.I8.isArray(e)?e:[e])};break;case"D.C. al Coda":case"D.C. al Fine":case"D.S. al Coda":case"D.S. al Fine":r=t=>{const e=this.barLineRight,s=tt(i),n=h(t);return new V(e,{text:s,color:n},1,1)},this.addAnnotation(t,"navigation","endRepeat",{}),this.endSong();break;case"Fine":r=t=>{const e=this.barLineRight,s=tt(i),n=h(t);return new V(e,{text:s,color:n},1,1)};break;case"Segno":case"Coda":r=t=>{const e=this.barLineLeft,s=tt(i),n=h(t);return new $(e,s,n)};break;case"toCoda":r=t=>{const e=this.barLineRight,s=tt(i),n=h(t);return new $(e,s,n)};break;case"endRepeat":if(this.endRepeatPlayCount=null!=(a=s.repeatCount)?a:2,2!==this.endRepeatPlayCount){const t=`${this.endRepeatPlayCount}x`,e=this.doc.getColorWithKey("staff.frame");this.endRepeatPlayCountText=new V(this,{text:t,color:e,scale:.8},.5,1)}break;case"startRepeat":break;case"fermata":case"measureEndFermata":u&&(r=(t,e)=>new W(u,1===e,h(t)));break;case"chordLabel":c&&(r=(t,e)=>{const i=h(t),n=String(s.labelText);return new V(c,{text:n,color:i},.5,o)});break;case"pitchLabel":c&&(r=(t,e)=>{const i=h(t),n=String(s.labelText);return new V(c,{text:n,color:i},.5,o)});break;default:c&&(r=(t,e)=>{const s=h(t),n=function(t){return"trill"===t?"tr":t}(i);return new V(c,{text:n,color:s,italic:!0},.5,o)})}if(this.disableExtensionLine(),r){const s=function(t,e){switch(e){case"fermata":case"measureEndFermata":return 5;case"ending":return 11;case"chordLabel":return 13;case"pitchLabel":return 1}switch(t){case"navigation":return 10;case"dynamics":return 6;case"tempo":return 8;case"articulation":return 2;case"expression":return 7;case"technique":return 3;case"temporal":return 9;case"label":return 12;case"ornament":return 4;default:return 14}}(e,i),n=function(t,e){return"pitchLabel"===e||"dynamics"===t?1:0}(e,i);this.forEachStaffTarget(t,n,(t,e)=>{const i=this.addLayoutObject(r(t,e),t,s,e);this.enableExtensionLine(i,h(t))})}n.I8.isEnumValue(i,Qt)&&this.navigationSet.add(i)}addConnective(t,...e){let i=this.lastAddedRhythmSymbol;if(!(i instanceof lt))throw new D("Connective can be added to note group only.");if("tie"===t){let t=n.I8.isInteger(e[0])||n.I8.isEnumValue(e[0],Wt)?e[0]:2,s=n.I8.isEnumValue(e[1],Yt)?e[1]:"auto";i.startConnective(new ie("tie",t,s,i))}else if("slur"===t){let t=n.I8.isInteger(e[0])?e[0]:2,s=n.I8.isEnumValue(e[1],Yt)?e[1]:"auto";i.startConnective(new ie("slur",t,s,i))}else if("slide"===t){let t=n.I8.isEnumValue(e[0],Yt)?e[0]:"auto";i.startConnective(new ie("slide",2,t,i))}}addExtension(t,e){if(this.addExtensionTo.forEach(i=>{const{layoutObj:s,color:a}=i,{musicObj:r}=s;r.userData["extension-color"]=a;const h=r.getParent();if(!(r instanceof V&&h instanceof me))throw new D("Cannot add extension becaue no compatible music object to attach it to.");{let i="dashed",a="bottom",c=new At(s,h,function(t){if("string"==typeof t&&(t=[t]),n.I8.isArray(t)){let e=0;for(let i=0;i<t.length;){let s=t[i],n=t[i+1];if("string"==typeof s){i++;let t=o.RhythmProps.get(s).ticks;"number"==typeof n&&(i++,t*=n),e+=t}else i++}return e}return t}(t),e,i,a);r.setLink(c)}}),0===this.addExtensionTo.length)throw new D("Cannot add extension because music object to attach it to is undefined.");this.disableExtensionLine(),this.requestLayout()}enableExtensionLine(t,e){this.addExtensionTo.push({layoutObj:t,color:e})}disableExtensionLine(){this.addExtensionTo=[]}getEnding(){return this.layoutObjects.map(t=>t.musicObj).find(t=>t instanceof K)}getEndRepeatPlayCount(){return this.endRepeatPlayCount}endSong(){this.isEndSong=!0,this.requestLayout(),this.disableExtensionLine()}hasEndSong(){return this.isEndSong}endSection(){this.isEndSection=!0,this.requestLayout(),this.disableExtensionLine()}hasEndSection(){return this.isEndSection}endRow(){this.doc.requestNewRow(),this.disableExtensionLine()}addRhythmSymbol(t){let{col:e,voiceId:i}=t;e.setVoiceSymbol(i,t),this.voiceSymbols.add(i,t),t.oldStyleTriplet&&this.createOldStyleTriplets(i),this.requestBeamsUpdate(),this.lastAddedRhythmColumn=e,this.lastAddedRhythmSymbol=t}addNoteGroup(t,e,i,s,n){let a=e.map(t=>"string"==typeof t?o.Note.getNote(t):t),r=this.getRhythmColumn(t),h=new lt(r,t,a,i,s,n);return this.addRhythmSymbol(h),h}addRest(t,e,i,s){let n=this.getRhythmColumn(t),a=new Q(n,t,e,i,s);return this.addRhythmSymbol(a),a}addLyrics(t,e,i,s,a){this.forEachStaffTarget(t,1,(t,r)=>{var h;let c=this.getRhythmColumn({verse:e,line:t,vpos:r}),u=new se(c,e,t,r,o.validateNoteLength(s),i,a);c.addLyricsObject(u);let l=this.lyricsObjectsCache.getOrCreate(t,r,e,[]);l.push(u),l.sort((t,e)=>n.OZ.Math.cmp(t.col.positionTicks,e.col.positionTicks)),null==(h=u.measure.getPrevLyricsObject(u))||h.setNextLyricsObject(u),this.addLayoutObject(u,t,function(t){switch(t){case 1:return 15;case 2:return 16;case 3:return 17;default:throw new D("VerseNumber is not 1, 2 or 3.")}}(e),r),this.lastAddedRhythmColumn=c})}getRhythmColumn(t){let e=0;for(let i=this.columns.length-1;i>=0&&0===e;i--){let s=this.columns[i],n="number"==typeof t?s.getVoiceSymbol(t):s.getLyricsObject(t.verse,t.line,t.vpos);n&&(e=s.positionTicks+n.rhythmProps.ticks)}for(let i=0;i<=this.columns.length;i++){let t=this.columns[i];if(t&&t.positionTicks===e)return t;if(!t||t.positionTicks>e){let t=new me(this,e);return this.columns.splice(i,0,t),t}}throw new D("Error in rhythm column. Should never get here.")}getMeasureTicks(){return this.getTimeSignature().measureTicks}getConsumedTicks(t){let e=0;return this.columns.forEach(i=>{[0,1,2,3].forEach(s=>{let n=i.getVoiceSymbol(s);!n||void 0!==t&&t!==s||(e=Math.max(e,i.positionTicks+n.rhythmProps.ticks))})}),e}getColumnsContentRect(){return new n.vW(this.barLineLeft.getRect().anchorX,this.barLineRight.getRect().anchorX,this.getRect().top,this.getRect().bottom)}getLeftStaticWidth(){return this.region_0_tabTuning+this.region_1_signature+this.region_2_leftBarLine+this.region_3_padding}getMinColumnsWidth(){return this.region_4_columnsMin}getRightStaticWidth(){return this.region_5_padding+this.region_6_rightBarLine}getTotalStaticWidth(){return this.getLeftStaticWidth()+this.getRightStaticWidth()}getMinWidth(){return this.getLeftStaticWidth()+this.getMinColumnsWidth()+this.getRightStaticWidth()}getStaffLineLeft(){let t=this.getPrevMeasure();return t&&t.row===this.row&&!t.hasPostMeasureBreak()?t.getStaffLineRight():this.getRect().left+this.region_0_tabTuning}getStaffLineRight(){return this.barLineRight.getRect().anchorX}getPrevLyricsObject(t){var e;let{line:i,verse:s,vpos:n}=t,a=this.lyricsObjectsCache.getOrDefault(i,n,s,[]),o=a.indexOf(t);if(o>0)return a[o-1];if(0===o){let a=null==(e=t.measure.getPrevMeasure())?void 0:e.lyricsObjectsCache.get(i,n,s);if(a&&a.length>0)return a[a.length-1]}}getStaticObjects(t){return this.staticObjectsCache.getOrDefault(t,[])}addStaticObject(t,e){this.staticObjectsCache.getOrCreate(t,[]).push(e)}removeLayoutObjects(t){this.layoutObjects=this.layoutObjects.filter(e=>{if(e.musicObj===t){let t=e.musicObj.getLink();return t&&t.detachTail(e.musicObj),e.layoutGroup.remove(e),!1}return!0})}addConnectiveObject(t){this.connectives.push(t),this.requestLayout()}removeConnectiveObjects(){this.connectives.length>0&&(this.connectives=[],this.requestLayout())}createExtensions(){this.layoutObjects.forEach(t=>{let{musicObj:e,measure:i,layoutGroupId:s,verticalPos:n,line:a}=t;if(e.getLink()instanceof At){let t=e.getLink();if(t.getHead()!==e)return;if(t.getTails().forEach(t=>i.removeLayoutObjects(t)),!t.isVisible())return;const o=t.getRange(),r=o.columnRange.slice();for(let i=!0;r.length>1;i=!1){const{measure:h}=r[0],c=r.findIndex(t=>t.measure!==h),u=r.splice(0,c>0?c:r.length);if(u.length<2)continue;const l=h.row.findMatchingLine(a);if(!l)continue;const d=0===r.length,g=[...i?[e]:[],...u,...d&&o.stopObject?[o.stopObject]:[]];h.addLayoutObject(new Nt(h,l,t,g),l,s,n)}}})}addBeamGroup(t){this.beamGroups.push(t)}requestBeamsUpdate(){this.needBeamsUpdate=!0}createOldStyleTriplets(t){let e=this.getVoiceSymbols(t);for(let i=0;i<e.length;)if(e[i].oldStyleTriplet){let t=mt.createOldStyleTriplet(e.slice(i,i+3));i+=0===t?1:t}else i++;this.requestLayout()}getBeamGroups(){return this.beamGroups}createBeams(){if(!this.needBeamsUpdate)return;this.beamGroups=this.beamGroups.filter(t=>!!t.isTuplet()||(t.detach(),!1));let t=this.getTimeSignature();this.needBeamsUpdate&&0!==t.beamGroupSizes.length&&([0,1,2,3].forEach(e=>{let i=this.getVoiceSymbols(e).slice();if(i.length<2)return;let s=this.isUpBeat()?Math.max(0,this.getMeasureTicks()-this.getConsumedTicks()):0,a=0;for(let r=0;r<t.beamGroupSizes.length;r++){let e=t.beamGroupSizes[r],h=[e];e.length>1&&h.unshift([n.OZ.Math.sum(e)]);let c=!1,u=a;for(;h.length>0&&!c;){let t=h.shift();a=u,t.forEach(t=>{let e=t*o.NoteLengthProps.get("8n").ticks,r=a+e,u=i.filter(t=>{let e=s+t.col.positionTicks,i=e+t.rhythmProps.ticks;return e>=a&&i<=r});n.OZ.Math.sum(u.map(t=>t.rhythmProps.ticks))===e&&u.every(t=>t instanceof lt)&&(u.every(t=>1===t.rhythmProps.flagCount)||0===h.length)&&mt.createBeam(u)&&(c=!0),a+=e})}}}),this.needBeamsUpdate=!1,this.requestLayout())}getBarLineLeft(){return this.barLineLeft}getBarLineRight(){return this.barLineRight}getVoiceSymbols(t){return this.voiceSymbols.getAll(t)}fillWithRests(...t){if(0!==t.length)if(t.length>1)t.forEach(t=>this.fillWithRests(t));else{const e=t[0];Pt(e);let i=this.getMeasureTicks()-this.getConsumedTicks(e),s=[];for(;i>0;)for(let t=o.NoteLengthProps.LongestNoteSize;t<=o.NoteLengthProps.ShortestNoteSize;t*=2){let e=o.NoteLengthProps.create(t).noteLength;for(let t=o.NoteLengthProps.get(e).maxDotCount;t>=0;t--){let n=o.RhythmProps.get(e,t);for(;n.ticks<=i;)s.push(n),i-=n.ticks}}s.reverse().forEach(t=>this.addRest(e,o.NoteLengthProps.create(t.noteLength,t.dotCount).noteLength))}else 0===this.getConsumedTicks()?this.fillWithRests(0):this.fillWithRests(...[0,1,2,3].filter(t=>this.getConsumedTicks(t)>0))}requestLayout(){this.needLayout||(this.needLayout=!0,this.row.requestLayout())}layout(t){var e;if(!this.needLayout)return;this.staticObjectsCache.clear(),this.requestRectUpdate();let{unitSize:i}=t;this.postMeasureBreakWidth=this.hasPostMeasureBreak()?g*i:0;let s=this.isFirstMeasureInRow(),n=!0===(null==(e=this.getPrevMeasure())?void 0:e.hasPostMeasureBreak());this.region_0_tabTuning=s&&this.row.hasTab?4*i:0;let a=s||n,r=s&&!this.row.isFirstRow();!0===this.doc.options.showMeasureNumbers&&(r=!0),!1===this.doc.options.showMeasureNumbers&&(r=!1),!0===this.options.showNumber&&(r=!0),!1===this.options.showNumber&&(r=!1);let h=s||n||!!this.alterKeySignature,c=!!this.alterTimeSignature,u=!!this.alterTempo;this.signatures=[],this.row.getNotationLines().forEach((e,i)=>{if(e instanceof de&&(a||r||h||c||u)){let s=this.signatures.filter(t=>t instanceof q).find(t=>t.staff===e),n=null!=s?s:new q(this,e);n.staff.addObject(n),n.updateClefImage(t,a),n.updateMeasureNumber(r&&0===i),n.updateKeySignature(h),n.updateTimeSignature(t,c),n.updateTempo(u&&0===i),n.layout(t),this.signatures.push(n)}else if(e instanceof ge&&(r||c||u)){let s=this.signatures.filter(t=>t instanceof H).find(t=>t.tab===e),n=null!=s?s:new H(this,e);n.tab.addObject(n),n.updateMeasureNumber(r&&0===i),n.updateTimeSignature(t,c),n.updateTempo(u&&0===i),n.layout(t),this.signatures.push(n)}}),[0,1,2,3].forEach(t=>{const e=this.row.getStaves()[0];e&&e.containsVoiceId(t)&&this.beamGroups.forEach(t=>{const i=t.getSymbols();i.forEach((s,n)=>{if(!(s instanceof Q&&s.setDiatonicId===Q.UndefinedDiatonicId))return;let a,o=n,r=n;for(;i[o]instanceof Q;)o--;for(;i[r]instanceof Q;)r++;o<0&&r<=i.length-1?a=i[r].getDiatonicId(e):o>=0&&r>i.length-1?a=i[o].getDiatonicId(e):o>=0&&r<=i.length-1&&(a=Math.round((i[o].getDiatonicId(e)+i[r].getDiatonicId(e))/2)),void 0!==a&&s.updateRunningArguments(a,t.stemDir,[])})})}),this.tabStringNotes.length=0,this.isFirstMeasureInRow()&&this.row.getTabs().forEach(e=>{for(let i=0;i<6;i++){const s=e.getTuningStrings()[i].format(o.PitchNotation.Helmholtz,o.SymbolSet.Unicode),n=this.doc.getColorWithKey("tab.tuning"),a=new V(this,{text:s,scale:.8,color:n},1,.5);a.layout(t),a.setRight(.8*this.region_0_tabTuning),a.setCenterY(e.getStringY(i)),this.tabStringNotes.push(a),e.addObject(a)}}),this.barLineLeft.layout(t);const d=new Y(this);this.columns.forEach(e=>e.layout(t,d)),this.barLineRight.layout(t),this.endRepeatPlayCountText&&this.endRepeatPlayCountText.layout(t),this.layoutObjects.forEach(e=>e.layout(t));let f=t.unitSize;this.region_1_signature=Math.max(0,...this.signatures.map(t=>t.getRect().width)),this.region_2_leftBarLine=this.barLineLeft.getRect().width,this.region_3_padding=f,this.region_4_columnsMin=Math.max(l*i,this.columns.map(t=>t.getRectWithObjects().width).reduce((t,e)=>t+e,0)),this.region_5_padding=f,this.region_6_rightBarLine=this.barLineRight.getRect().width}layoutWidth(t,e){var i;if(!this.needLayout)return;e=Math.max(e,this.getMinWidth()),this.rect=new n.vW,this.rect.anchorX=this.rect.left+e/2,this.rect.right=this.rect.left+e,this.signatures.forEach(t=>{t.setLeft(this.rect.left+this.region_0_tabTuning),t.setAnchorY(this.rect.anchorY)});let s=Math.max(0,...this.signatures.map(t=>t.getRect().width));this.barLineLeft.setLeft(this.rect.left+this.region_0_tabTuning+s),this.barLineLeft.setAnchorY(this.rect.anchorY),this.barLineRight.setRight(this.rect.right),this.barLineRight.setAnchorY(this.rect.anchorY),this.endRepeatPlayCountText&&(this.endRepeatPlayCountText.setCenterX(this.barLineRight.getRect().left),this.endRepeatPlayCountText.setBottom(this.barLineRight.getRect().top));const a=this.rect.left+this.getLeftStaticWidth(),o=this.rect.right-this.getRightStaticWidth()-a,r=this.columns.map(t=>t.getRect()),h=this.columns.map(t=>t.getRectWithObjects().clone()),c=n.OZ.Math.sum(h.map(t=>t.width));let u=Math.max(o-c,0);const l=u/100;let d=10*this.columns.length;for(;u>l&&--d>=0&&this.columns.length>0;){const t=this.columns.map((t,e)=>+(Math.max(0,h[e].leftw-r[e].leftw)+Math.max(0,h[e].rightw-r[e].rightw)).toFixed(3)),e=n.OZ.Arr.removeDuplicates(t).sort(),s=u/t.reduce((t,i)=>i===e[0]?t+1:t,0),a=Math.min(s,(null!=(i=e[1])?i:1/0)-e[0]);if(!n.I8.isFinite(a))break;h.forEach((i,s)=>{t[s]===e[0]&&(i.left-=a/2,i.right+=a/2,u-=a)})}let g=a;h.forEach((t,e)=>{t.offsetInPlace(g-t.left,0),this.columns[e].setAnchorX(t.anchorX),g=t.right}),[0,1,2,3].forEach(t=>{const e=this.getVoiceSymbols(t),i=1===e.length&&e[0]instanceof Q?e[0]:void 0;if(!i)return;0===[0,1,2,3].map(t=>i.col.getVoiceSymbol(t)).filter(t=>void 0!==t&&t!==i).length||i.setAnchorX(this.getColumnsContentRect().centerX)})}layoutConnectives(t){this.needLayout&&this.connectives.forEach(e=>{e.layout(t),this.rect.top=Math.min(this.rect.top,e.getRect().top),this.rect.bottom=Math.max(this.rect.bottom,e.getRect().bottom)})}layoutBeams(t){this.needLayout&&this.beamGroups.forEach(e=>{e.layout(t),this.rect.top=Math.min(this.rect.top,e.getRect().top),this.rect.bottom=Math.max(this.rect.bottom,e.getRect().bottom)})}alignStemsToBeams(){this.beamGroups.forEach(t=>t.updateNoteStemTips())}layoutDone(){this.columns.forEach(t=>t.layoutDone()),this.needLayout=!1}updateRect(){this.rect.top=Math.min(...this.signatures.map(t=>t.getRect().top),...this.tabStringNotes.map(t=>t.getRect().top),this.barLineLeft.getRect().top,...this.columns.filter(t=>!t.isEmpty()).map(t=>t.getRect().top),this.barLineRight.getRect().top,...this.connectives.map(t=>t.getRect().top),...this.beamGroups.filter(t=>!t.isEmpty()).map(t=>t.getRect().top),...this.layoutObjects.map(t=>t.musicObj.getRect().top)),this.rect.bottom=Math.max(...this.signatures.map(t=>t.getRect().bottom),...this.tabStringNotes.map(t=>t.getRect().bottom),this.barLineLeft.getRect().bottom,...this.columns.filter(t=>!t.isEmpty()).map(t=>t.getRect().bottom),this.barLineRight.getRect().bottom,...this.connectives.map(t=>t.getRect().bottom),...this.beamGroups.filter(t=>!t.isEmpty()).map(t=>t.getRect().bottom),...this.layoutObjects.map(t=>t.musicObj.getRect().bottom)),this.isLastMeasureInRow()&&(this.rect.right=Math.max(this.rect.right,...this.layoutObjects.filter(t=>t.musicObj instanceof W).map(t=>t.musicObj.getRect().right))),this.row.getNotationLines().forEach(t=>{this.rect.top=Math.min(this.rect.top,t.calcTop()),this.rect.bottom=Math.max(this.rect.bottom,t.calcBottom())}),this.row.requestRectUpdate()}offset(t,e){this.signatures.forEach(e=>e.offset(t,0)),this.tabStringNotes.forEach(e=>e.offset(t,0)),this.barLineLeft.offset(t,e),this.columns.forEach(i=>i.offset(t,e)),this.barLineRight.offset(t,e),this.endRepeatPlayCountText&&this.endRepeatPlayCountText.offset(t,e),this.connectives.forEach(e=>e.offset(t,0)),this.beamGroups.forEach(i=>i.offset(t,e)),this.layoutObjects.forEach(e=>e.offset(t,0)),this.rect.offsetInPlace(t,e),this.requestRectUpdate()}draw(t,e){if(!this.intersects(e))return;t.drawDebugRect(this.getRect()),t.lineWidth(1);let i=this.getStaffLineLeft(),s=this.getStaffLineRight();const n=(e,n)=>t.color(n).strokeLine(i,e,s,e);this.row.getNotationLines().forEach(t=>{if(t instanceof de)for(let e=t.bottomLineDiatonicId;e<=t.topLineDiatonicId;e+=2)n(t.getDiatonicIdY(e),this.doc.getColorWithKey("staff.frame"));else if(t instanceof ge)for(let e=0;e<6;e++)n(t.getStringY(e),this.doc.getColorWithKey("tab.frame"))}),this.isFirstMeasureInRow()&&1===this.row.getNotationLines().length&&this.row.getTabs().forEach(e=>{if(e.getRowGroup().hasBrace)return;const i=this.getStaffLineLeft(),s=e.getTopLineY(),n=e.getBottomLineY(),a=this.doc.getColorWithKey("tab.frame");t.color(a).lineWidth(1).strokeLine(i,s,i,n)}),this.signatures.forEach(i=>i.draw(t,e)),this.tabStringNotes.forEach(i=>i.draw(t,e)),this.barLineLeft.draw(t,e),this.columns.forEach(i=>i.draw(t,e)),this.barLineRight.draw(t,e),this.endRepeatPlayCountText&&this.endRepeatPlayCountText.draw(t,e),this.connectives.forEach(i=>i.draw(t,e)),this.layoutObjects.forEach(i=>i.musicObj.draw(t,e)),this.beamGroups.forEach(i=>i.draw(t,e))}},oe=(t=>(t[t.TabRhythm=0]="TabRhythm",t[t.Annotation_Label_PitchLabel=1]="Annotation_Label_PitchLabel",t[t.Annotation_Articulation=2]="Annotation_Articulation",t[t.Annotation_Technique=3]="Annotation_Technique",t[t.Annotation_Ornament=4]="Annotation_Ornament",t[t.Annotation_Temporal_Fermata=5]="Annotation_Temporal_Fermata",t[t.Annotation_Dynamics=6]="Annotation_Dynamics",t[t.Annotation_Expression=7]="Annotation_Expression",t[t.Annotation_Tempo=8]="Annotation_Tempo",t[t.Annotation_Temporal=9]="Annotation_Temporal",t[t.Annotation_Navigation=10]="Annotation_Navigation",t[t.Annotation_Navigation_Ending=11]="Annotation_Navigation_Ending",t[t.Annotation_Label=12]="Annotation_Label",t[t.Annotation_Label_ChordLabel=13]="Annotation_Label_ChordLabel",t[t.Annotation_Misc=14]="Annotation_Misc",t[t.LyricsVerse1=15]="LyricsVerse1",t[t.LyricsVerse2=16]="LyricsVerse2",t[t.LyricsVerse3=17]="LyricsVerse3",t))(oe||{}),re=new n.b1([[0,{isLane:!0,padding:0}],[1,{isLane:!1,padding:0}],[2,{isLane:!1,padding:0}],[3,{isLane:!1,padding:0}],[4,{isLane:!1,padding:0}],[5,{isLane:!1,padding:0}],[6,{isLane:!0,padding:0}],[7,{isLane:!0,padding:0}],[8,{isLane:!0,padding:0}],[9,{isLane:!0,padding:0}],[10,{isLane:!0,padding:0}],[11,{isLane:!0,padding:0}],[12,{isLane:!0,padding:0}],[13,{isLane:!0,padding:0}],[14,{isLane:!0,padding:0}],[15,{isLane:!0,padding:0}],[16,{isLane:!0,padding:0}],[17,{isLane:!0,padding:0}]]);var he=class{constructor(t,e,i){this.groupName=t,this.staffsTabsAndGroups=e,this.verticalPosition=i}},ce=class{constructor(t,e,i,s){this.musicObj=t,this.line=e,this.layoutGroupId=i,(0,a.Mu)(this,"anchor"),(0,a.Mu)(this,"measure"),(0,a.Mu)(this,"row"),(0,a.Mu)(this,"layoutGroup"),this.measure=function(t){for(;t;){if(t instanceof ae)return t;t=t.getParent()}throw new D("Parent measure is required but not found!")}(this.musicObj),this.row=this.measure.row;let n=this.musicObj.getParent();if(!n)throw new D("Parent music object is required as an anchor.");this.anchor=n,this.anchor.addAnchoredLayoutObject(this),this.layoutGroup=this.line.getLayoutGroup(i,s),this.layoutGroup.add(this)}get verticalPos(){return this.layoutGroup.verticalPos}layout(t){this.line.addObject(this)}offset(t,e){this.musicObj.offset(t,e)}setAnchorY(t){this.musicObj.setAnchorY(t)}getRect(){return this.musicObj.getRect()}},ue=class{constructor(t,e){var i,s,n;this.layoutGroupId=t,this.verticalPos=e,(0,a.Mu)(this,"layoutObjects",[]),(0,a.Mu)(this,"isLane"),(0,a.Mu)(this,"padding"),this.isLane=!0===(null==(i=re.get(t))?void 0:i.isLane),this.padding=null!=(n=null==(s=re.get(t))?void 0:s.padding)?n:0}getLayoutObjects(){return this.layoutObjects}add(t){this.layoutObjects.push(t)}remove(t){const e=this.layoutObjects.indexOf(t);e>=0&&this.layoutObjects.splice(e,1)}layout(t){for(const e of this.layoutObjects)e.musicObj.layout(t)}getPadding(t){return Math.max(.5,this.padding)*t.unitSize}},le=class extends G{constructor(t){super(t),this.row=t,(0,a.Mu)(this,"objects",[]),(0,a.Mu)(this,"layoutGroups",[]),(0,a.Mu)(this,"resolvedObjects",[]),(0,a.Mu)(this,"resolvedBaseY",0)}getRowGroup(){return this.row.getRowGroupByLineId(this.id)}addObject(t){this.objects.push(t)}removeObjects(){this.objects.length=0}getLayoutGroup(t,e){return void 0===this.layoutGroups[e]&&(this.layoutGroups[e]=new n.b1),this.layoutGroups[e].getOrCreate(t,()=>new ue(t,e))}resetLayoutGroups(t){for(const e of[0,1])this.layoutGroups[e]&&this.layoutGroups[e].forEach(e=>e.layout(t))}layoutAllLayoutGroups(t){const e=[];for(const s of this.row.getMeasures())e.splice(e.length,0,...s.getStaticObjects(this));const i=t.unitSize;for(const s of[0,1])if(this.layoutGroups[s]){this.resolvedBaseY=0===s?this.getTopLineY()-i:this.getBottomLineY()+i,this.resolvedObjects=e.slice();for(const e of n.OZ.Enum.getEnumValues(oe)){const i=this.layoutGroups[s].get(e);i&&this.layoutSingleLayoutGroup(t,i)}}}setObjectAnchorY(t,e){void 0!==e&&(t.setAnchorY(e-t.getRect().anchorY),this.resolvedObjects.push(t.musicObj))}resolveNearestY(t,e){const{musicObj:i,verticalPos:s,layoutGroup:a}=e,o=a.getPadding(t);let r=0===s?this.resolvedBaseY-i.getRect().bottomh:this.resolvedBaseY+i.getRect().toph;const h=i.getShapeRects().map(t=>t.inflateCopy(o));return this.resolvedObjects.forEach(t=>{t.getRect();const e=t.getShapeRects();h.forEach(t=>{e.forEach(e=>{n.vW.overlapX(t,e)&&(r=0===s?Math.min(r,e.top-t.bottomh-t.anchorY-o):Math.max(r,e.bottom+t.toph+t.anchorY+o))})})}),r}resolveIndividualObject(t,e,i){const{verticalPos:s}=e;let n=[i],a=i.musicObj.getLink();if(a)if(a.getHead()===i.musicObj){let t=[a.getHead(),...a.getTails()];n=e.getLayoutObjects().filter(e=>t.some(t=>t===e.musicObj))}else n=[];if(0===n.length)return;let o=n.map(e=>this.resolveNearestY(t,e));const r=1===s?Math.max(...o):Math.min(...o);n.forEach(t=>this.setObjectAnchorY(t,r))}resolveBaseY(t,e,i){const s=e.getPadding(t);for(const n of this.resolvedObjects)this.resolvedBaseY=0===i?Math.min(this.resolvedBaseY,n.getRect().top-s):Math.max(this.resolvedBaseY,n.getRect().bottom+s)}resolveLaneObjects(t,e){const{verticalPos:i}=e,s=e.getLayoutObjects();if(0===s.length)return;this.resolveBaseY(t,e,i);const n=0===i?this.resolvedBaseY-Math.max(...s.map(t=>t.getRect().bottomh)):this.resolvedBaseY+Math.max(...s.map(t=>t.getRect().toph));s.forEach(t=>this.setObjectAnchorY(t,n)),this.resolveBaseY(t,e,i)}layoutSingleLayoutGroup(t,e){let i=e.getLayoutObjects();if(i.forEach(e=>{let{musicObj:i,anchor:s}=e;i instanceof K||i instanceof Nt||i instanceof ne?i.layoutFitToMeasure(t):i.setAnchorX(s.getRect().anchorX)}),e.isLane)this.resolveLaneObjects(t,e);else for(const s of i)this.resolveIndividualObject(t,e,s)}drawVerticalLine(t,e,i,s=!1){const n=this.row.doc.getColorWithKey("tab"===this.getConfig().type?"tab.frame":"staff.frame");t.color(n);const a=this.row.getNotationLines().indexOf(this),o=a>=0?this.row.getNotationLines()[a+1]:void 0,r=this.getRowGroup().lines.length>1,h=this instanceof de&&this.isGrandTreble(),c=this.getTopLineY(),u=o&&(s||r||h)?o.getTopLineY():this.getBottomLineY();t.fillRect(e,c,i,u-c)}},de=class extends le{constructor(t,e,i){super(t),this.staffConfig=e,this.id=i,(0,a.Mu)(this,"clefImageAsset"),(0,a.Mu)(this,"clefLineDiatonicId"),(0,a.Mu)(this,"topLineDiatonicId"),(0,a.Mu)(this,"middleLineDiatonicId"),(0,a.Mu)(this,"bottomLineDiatonicId"),(0,a.Mu)(this,"minDiatonicId"),(0,a.Mu)(this,"maxDiatonicId"),(0,a.Mu)(this,"joinedGrandStaff"),(0,a.Mu)(this,"topLineY",0),(0,a.Mu)(this,"bottomLineY",0),(0,a.Mu)(this,"mi");const s=(t,e)=>o.Note.getNote(t).diatonicId-(e?7:0);if("G"===e.clef)this.clefImageAsset=0,this.clefLineDiatonicId=s("G4",!0===e.isOctaveDown),this.middleLineDiatonicId=this.clefLineDiatonicId+2;else{if("F"!==e.clef)throw new D(`Invalid staffConfig.clef ${e.clef}.`);this.clefImageAsset=1,this.clefLineDiatonicId=s("F3",!0===e.isOctaveDown),this.middleLineDiatonicId=this.clefLineDiatonicId-2}this.topLineDiatonicId=this.middleLineDiatonicId+4,this.bottomLineDiatonicId=this.middleLineDiatonicId-4,this.minDiatonicId=void 0!==e.minNote?Math.min(s(e.minNote,!1),this.bottomLineDiatonicId):void 0,this.maxDiatonicId=void 0!==e.maxNote?Math.max(s(e.maxNote,!1),this.topLineDiatonicId):void 0,this.mi=new Li(this)}getMusicInterface(){return this.mi}get isOctaveDown(){return!0===this.staffConfig.isOctaveDown}get name(){var t;return null!=(t=this.staffConfig.name)?t:""}getConfig(){return this.staffConfig}getTopLineY(){return this.topLineY}getMiddleLineY(){return(this.topLineY+this.bottomLineY)/2}getBottomLineY(){return this.bottomLineY}joinGrandStaff(t){t!==this&&(this.joinedGrandStaff=t)}isGrandTreble(){return void 0!==this.joinedGrandStaff&&"G"===this.staffConfig.clef}isGrandBass(){return void 0!==this.joinedGrandStaff&&"F"===this.staffConfig.clef}getLineSpacing(){return(this.bottomLineY-this.topLineY)/4}getDiatonicSpacing(){return this.getLineSpacing()/2}containsDiatonicId(t){return o.Note.validateDiatonicId(t),(void 0===this.minDiatonicId||t>=this.minDiatonicId)&&(void 0===this.maxDiatonicId||t<=this.maxDiatonicId)}getDiatonicIdY(t){if(this.containsDiatonicId(t))return this.bottomLineY+(this.bottomLineDiatonicId-t)*this.getDiatonicSpacing();if(this.joinedGrandStaff&&this.joinedGrandStaff.containsDiatonicId(t))return this.joinedGrandStaff.getDiatonicIdY(t);throw new D("Staff does not contain diatonicId "+t)}getActualStaff(t){if(this.containsDiatonicId(t))return this;if(this.joinedGrandStaff&&this.joinedGrandStaff.containsDiatonicId(t))return this.joinedGrandStaff;throw new D("Staff does not contain diatonicId "+t)}getDiatonicIdAt(t){let e=Math.round(this.bottomLineDiatonicId-(t-this.bottomLineY)/this.getDiatonicSpacing());return this.containsDiatonicId(e)?e:void 0}isLine(t){return t%2==this.middleLineDiatonicId%2}isSpace(t){return t%2!=this.middleLineDiatonicId%2}containsVoiceId(t){return n.I8.isUndefined(this.staffConfig.voiceId)||n.OZ.Arr.toArray(this.staffConfig.voiceId).includes(t)}calcTop(){let t=this.topLineY;if(this.objects.forEach(e=>t=Math.min(t,e.getRect().top)),void 0!==this.maxDiatonicId){let e=this.getDiatonicIdY(this.maxDiatonicId),i=this.getDiatonicIdY(this.maxDiatonicId-1);t=Math.min(t,e-Math.abs(i-e)+1)}return t}calcBottom(){let t=this.bottomLineY;if(this.objects.forEach(e=>t=Math.max(t,e.getRect().bottom)),void 0!==this.minDiatonicId){let e=this.getDiatonicIdY(this.minDiatonicId),i=this.getDiatonicIdY(this.minDiatonicId+1);t=Math.max(t,e+Math.abs(i-e)-1)}return t}calcUsedDiatonicIdRange(){var t,e;let i=null!=(t=this.minDiatonicId)?t:this.bottomLineDiatonicId,s=null!=(e=this.maxDiatonicId)?e:this.topLineDiatonicId;return[0,1,2,3].filter(t=>this.containsVoiceId(t)).forEach(t=>{this.row.getMeasures().forEach(e=>{e.getVoiceSymbols(t).forEach(t=>{i=Math.min(i,t.getDiatonicId()),s=Math.max(s,t.getDiatonicId())})})}),{minDiatonicId:i,maxDiatonicId:s}}pick(t,e){return this.getRect().contains(t,e)?[this]:[]}layoutHeight(t){let{unitSize:e}=t,i=e*T;this.topLineY=-i/2,this.bottomLineY=i/2,this.rect=new n.vW(0,0,this.topLineY,this.bottomLineY)}layoutWidth(t){this.rect.left=this.row.getRect().left,this.rect.right=this.row.getRect().right}offset(t,e){this.topLineY+=e,this.bottomLineY+=e,this.objects.forEach(t=>{t.offsetInPlace?t.offsetInPlace(0,e):t.offset&&t.offset(0,e)}),this.rect.offsetInPlace(t,e)}draw(t,e){this.intersects(e)}},ge=class extends le{constructor(t,e,i){super(t),this.tabConfig=e,this.id=i,(0,a.Mu)(this,"top",0),(0,a.Mu)(this,"bottom",0),(0,a.Mu)(this,"tuningName"),(0,a.Mu)(this,"tuningStrings"),(0,a.Mu)(this,"mi"),n.I8.isArray(e.tuning)?(this.tuningName=void 0,this.tuningStrings=e.tuning.map(t=>o.Note.getNote(t)).reverse()):"string"==typeof e.tuning?(this.tuningName=(0,o.resolveTuningName)(e.tuning),this.tuningStrings=(0,o.getTuningStrings)(this.tuningName)):(this.tuningName="Standard",this.tuningStrings=(0,o.getTuningStrings)(this.tuningName)),this.mi=new Ti(this)}getMusicInterface(){return this.mi}get name(){var t;return null!=(t=this.tabConfig.name)?t:""}getConfig(){return this.tabConfig}getTuningName(){return this.tuningName}getTuningStrings(){return this.tuningStrings}getStringY(t){return this.top+(this.bottom-this.top)/6*(t+.5)}getTopStringY(){return this.getStringY(0)}getBottomStringY(){return this.getStringY(5)}getTopLineY(){return this.getTopStringY()}getBottomLineY(){return this.getBottomStringY()}getTop(){return this.top}getBottom(){return this.bottom}containsVoiceId(t){return n.I8.isUndefined(this.tabConfig.voiceId)||n.OZ.Arr.toArray(this.tabConfig.voiceId).includes(t)}containsDiatonicId(t){return!0}calcTop(){let{top:t}=this;return this.objects.forEach(e=>t=Math.min(t,e.getRect().top)),t}calcBottom(){let{bottom:t}=this;return this.objects.forEach(e=>t=Math.max(t,e.getRect().bottom)),t}pick(t,e){return this.getRect().contains(t,e)?[this]:[]}layoutHeight(t){let{unitSize:e}=t,i=e*P;this.top=-i/2,this.bottom=i/2,this.rect=new n.vW(0,0,this.top,this.bottom)}layoutWidth(t){this.rect.left=this.row.getRect().left,this.rect.right=this.row.getRect().right}offset(t,e){this.top+=e,this.bottom+=e,this.objects.forEach(t=>{t.offsetInPlace?t.offsetInPlace(0,e):t.offset&&t.offset(0,e)}),this.rect.offsetInPlace(t,e)}draw(t,e){this.intersects(e)}},fe=class extends G{constructor(t,e,i){super(t),this.col=t,this.line=e,this.arpeggioDir=i,(0,a.Mu)(this,"topArrowHeight",0),(0,a.Mu)(this,"bottomArrowHeight",0),(0,a.Mu)(this,"cycleHeight",0),(0,a.Mu)(this,"numCycles",0),(0,a.Mu)(this,"mi"),this.mi=new Ye(this)}getMusicInterface(){return this.mi}get color(){return this.col.doc.getColorWithKey(this.line instanceof ge?"tab.arpeggio":"staff.arpeggio")}pick(t,e){return this.rect.contains(t,e)?[this]:[]}layout(t){let{unitSize:e}=t;this.topArrowHeight="up"===this.arpeggioDir?e:0,this.bottomArrowHeight="down"===this.arpeggioDir?e:0;let i=this.line.getTopLineY(),s=this.line.getBottomLineY();this.cycleHeight=2*e,this.numCycles=Math.ceil((s-i)/this.cycleHeight)+2;let a=2*e,o=this.numCycles*this.cycleHeight;this.rect=new n.vW(-a/2,a/2,-o/2-this.topArrowHeight,o/2+this.bottomArrowHeight)}offset(t,e){this.rect.offsetInPlace(t,e)}draw(t,e){if(!this.intersects(e))return;let{rect:i,topArrowHeight:s,bottomArrowHeight:n}=this;t.drawDebugRect(this.rect),t.color(this.color),t.lineWidth(2),t.beginPath();for(let a=0,o=i.top+s;a<this.numCycles;a++,o+=this.cycleHeight)t.moveTo(i.anchorX,o),t.quadraticCurveTo(i.left,o+this.cycleHeight/4,i.anchorX,o+this.cycleHeight/2),t.quadraticCurveTo(i.right,o+3*this.cycleHeight/4,i.anchorX,o+this.cycleHeight);t.stroke(),s>0&&(t.beginPath(),t.moveTo(i.anchorX,i.top),t.lineTo(i.right,i.top+s),t.lineTo(i.left,i.top+s),t.fill()),n>0&&(t.beginPath(),t.moveTo(i.anchorX,i.bottom),t.lineTo(i.left,i.bottom-n),t.lineTo(i.right,i.bottom-n),t.fill())}},me=class extends G{constructor(t,e){super(t),this.measure=t,this.positionTicks=e,(0,a.Mu)(this,"voiceSymbol",new n.qG),(0,a.Mu)(this,"lyricsObject",new n.Yz),(0,a.Mu)(this,"minDiatonicId"),(0,a.Mu)(this,"maxDiatonicId"),(0,a.Mu)(this,"staffMinDiatonicId",new n.b1),(0,a.Mu)(this,"staffMaxDiatonicId",new n.b1),(0,a.Mu)(this,"arpeggioDir"),(0,a.Mu)(this,"arpeggios",[]),(0,a.Mu)(this,"_staccato",!1),(0,a.Mu)(this,"playerProps"),(0,a.Mu)(this,"needLayout",!0),(0,a.Mu)(this,"shapeRects",[]),(0,a.Mu)(this,"rectWithObjects",new n.vW),(0,a.Mu)(this,"mi"),this.playerProps=new Ae(this),this.mi=new vi(this)}getMusicInterface(){return this.mi}getPlayerProps(){return this.playerProps}getNextColumnInMeasure(){let t=this.measure.getColumns().indexOf(this);return n.z8.isIntegerGte(t,0),this.measure.getColumn(t+1)}getPrevColumnInMeasure(){let t=this.measure.getColumns().indexOf(this);return n.z8.isIntegerGte(t,0),this.measure.getColumn(t-1)}getNextColumn(){var t,e;return null!=(e=this.getNextColumnInMeasure())?e:null==(t=this.measure.getNextMeasure())?void 0:t.getFirstColumn()}getPrevColumn(){var t,e;return null!=(e=this.getPrevColumnInMeasure())?e:null==(t=this.measure.getPrevMeasure())?void 0:t.getLastColumn()}getTicksToNextColumn(){let t=this.getNextColumnInMeasure(),e=this.positionTicks,i=t?t.positionTicks:this.measure.getConsumedTicks();return Math.max(0,i-e)}getShapeRects(){return this.forceRectUpdate(),this.shapeRects}get doc(){return this.measure.doc}get row(){return this.measure.row}pick(t,e){const i=this.getRect().contains(t,e);for(let s=0;s<this.voiceSymbol.length;s++){let n=this.voiceSymbol.get(s);if(n instanceof Q){let s=n.pick(t,e);if(s.length>0)return i?[this,...s]:s}}if(!i)return[];for(let s=0;s<this.voiceSymbol.length;s++){let i=this.voiceSymbol.get(s);if(i instanceof lt){let s=i.pick(t,e);if(s.length>0)return[this,...s]}}for(let s=0;s<this.arpeggios.length;s++){let i=this.arpeggios[s].pick(t,e);if(i.length>0)return[this,...i]}return[]}get staccato(){return this._staccato}hasArpeggio(){return void 0!==this.arpeggioDir}getArpeggioDir(){var t;return null!=(t=this.arpeggioDir)?t:"up"}setVoiceSymbol(t,e){Pt(t),this.voiceSymbol.set(t,e),e instanceof Q&&!e.hide?this.row.getStaves().forEach(t=>{let i=e.getDiatonicId(t);this.minDiatonicId=void 0===this.minDiatonicId?i:Math.min(this.minDiatonicId,i),this.maxDiatonicId=void 0===this.maxDiatonicId?i:Math.max(this.maxDiatonicId,i)}):e instanceof lt&&(this.minDiatonicId=void 0===this.minDiatonicId?e.notes[0].diatonicId:Math.min(this.minDiatonicId,e.notes[0].diatonicId),this.maxDiatonicId=void 0===this.maxDiatonicId?e.notes[e.notes.length-1].diatonicId:Math.max(this.maxDiatonicId,e.notes[e.notes.length-1].diatonicId),void 0!==e.arpeggio&&(this.arpeggioDir=e.arpeggio),this.updateNoteDisplacements()),this.requestLayout(),this.requestRectUpdate()}getVoiceSymbol(t){return this.voiceSymbol.get(t)}getLyricsObject(t,e,i){return this.lyricsObject.get(t,e,i)}addLyricsObject(t){this.lyricsObject.set(t.verse,t.line,t.vpos,t)}updateNoteDisplacements(){let t=[];this.voiceSymbol.forEach(e=>{e instanceof lt&&e.notes.forEach(i=>{e.setNoteDisplacement(i,!1),t.push({noteGroup:e,note:i})})});if(t.sort((t,e)=>{let i=o.Note.compareFunc(t.note,e.note);return 0===i?t.noteGroup.stemDir===e.noteGroup.stemDir?0:"up"===t.noteGroup.stemDir?1:-1:i}),!(t.length<2)){for(let e=0;e<t.length;e++){let i=t[e],s=t[e+1];s&&i.note.diatonicId===s.note.diatonicId&&(i.isDisplaced=s.isDisplaced=!1)}for(let e=0;e<t.length;e++){let i=t[e-1],s=t[e],n=t[e+1];void 0===s.isDisplaced&&(i&&s.note.diatonicId-i.note.diatonicId<=1?s.isDisplaced=!i.isDisplaced:n&&n.note.diatonicId-s.note.diatonicId<=1&&(s.isDisplaced=!n.isDisplaced))}t.forEach(t=>{var e;return t.noteGroup.setNoteDisplacement(t.note,null!=(e=t.isDisplaced)&&e)})}}isEmpty(){return 0===this.voiceSymbol.size||this.voiceSymbol.every(t=>t.isEmpty())}getPlayerNotes(){let t=[];return[0,1,2,3].forEach(e=>{const i=this.getVoiceSymbol(e);if(i instanceof lt){let e=i.getPlaySlur();i.notes.forEach(s=>{!function(e,i,s,n){if(i<=0)return;t.some(t=>e.diatonicId===t.note.diatonicId&&e.accidental===t.note.accidental&&(t.ticks=Math.max(t.ticks,i),!0))||t.push({note:e,ticks:i,staccato:s,slur:n})}(s,i.getPlayTicks(s),i.hasArticulation("staccato")?"staccato":i.hasArticulation("staccatissimo")?"staccatissimo":"none",e)})}}),t.sort((t,e)=>o.Note.compareFunc(t.note,e.note)),this.hasArpeggio()&&"down"===this.getArpeggioDir()&&t.reverse(),t}getIdealMinWidth(t){const e=this.voiceSymbol.mapToArray(t=>t.rhythmProps.noteSize),i=Math.min(8,Math.max(1,...e));return Math.ceil(8/i)*p*d*t.unitSize}getRectWithObjects(){return this.rectWithObjects}requestLayout(){this.needLayout||(this.needLayout=!0,this.measure.requestLayout())}layout(t,e){if(!this.needLayout)return;let{row:i}=this;this.rect=new n.vW,this.requestRectUpdate();let s=this.getIdealMinWidth(t)/2,a=s,o=0,r=0;if(this.voiceSymbol.forEach(i=>{i.layout(t,e);let n=i.getRect();s=Math.max(s,n.leftw),a=Math.max(a,n.rightw),o=r=-n.leftw-1.25*t.unitSize}),void 0!==this.arpeggioDir){this.arpeggios=i.getNotationLines().map(t=>new fe(this,t,this.getArpeggioDir())),this.arpeggios.forEach(e=>e.layout(t));const e=this.arpeggios.map(t=>t.getRect().width).reduce((t,e)=>Math.max(t,e),0);this.arpeggios.forEach(t=>{t.setAnchor(r-e/2,t.line.getRect().anchorY),o=Math.min(o,t.getRect().left),t.line.addObject(t),this.measure.addStaticObject(t.line,t)}),s=-o}else this.arpeggios=[];this.rect.left=-s,this.rect.anchorX=0,this.rect.right=a,this.requestRectUpdate(),this.rectWithObjects=this.getRect().clone();const h=t.unitSize/2;this.getAnchoredLayoutObjects().forEach(t=>{const e=this.getPrevColumn();this===this.row.getFirstColumn()?(this.rectWithObjects.left=Math.min(this.rectWithObjects.left,t.getRect().left-h),this.requestRectUpdate()):e&&e.row===this.row&&e.getAnchoredLayoutObjects().forEach(e=>{e.getRect().intersects(t.getRect())&&(this.rectWithObjects.left=Math.min(this.rectWithObjects.left,t.getRect().left-h),this.requestRectUpdate())});const i=this.getNextColumn();this===this.row.getLastColumn()?(this.rectWithObjects.right=Math.max(this.rectWithObjects.right,t.getRect().right+h),this.requestRectUpdate()):i&&i.row===this.row&&i.getAnchoredLayoutObjects().forEach(e=>{e.getRect().intersects(t.getRect())&&(this.rectWithObjects.right=Math.max(this.rectWithObjects.right,t.getRect().right+h),this.requestRectUpdate())})}),this.voiceSymbol.forEach(t=>t.updateAccidentalState(e)),this.row.getStaves().forEach(t=>{let e,i;this.voiceSymbol.forEach(s=>{if(s.visibleInStaff(t))if(s instanceof lt)e=void 0===e?s.minDiatonicId:Math.min(e,s.minDiatonicId),i=void 0===i?s.maxDiatonicId:Math.max(i,s.maxDiatonicId);else if(s instanceof Q){let n=s.getDiatonicId(t);e=void 0===e?n:Math.min(e,n),i=void 0===i?n:Math.max(i,n)}}),void 0!==e?this.staffMinDiatonicId.set(t,e):this.staffMinDiatonicId.delete(t),void 0!==i?this.staffMaxDiatonicId.set(t,i):this.staffMaxDiatonicId.delete(t)})}layoutDone(){this.needLayout=!1}updateRect(){this.shapeRects=[...this.voiceSymbol.filter(t=>void 0!==t).mapToArray(t=>t.getRect().clone()),...this.arpeggios.map(t=>t.getRect().clone())],this.rect.top=Math.min(...this.shapeRects.map(t=>t.top)),this.rect.bottom=Math.max(...this.shapeRects.map(t=>t.bottom)),this.rect.anchorY=(this.rect.top+this.rect.bottom)/2}offset(t,e){this.voiceSymbol.forEach(e=>e.offset(t,0)),this.arpeggios.forEach(e=>e.offset(t,0)),this.shapeRects.forEach(i=>i.offsetInPlace(t,e)),this.rect.offsetInPlace(t,e)}draw(t,e){if(!this.intersects(e))return;const i=this.doc.getColorWithKey("staff.frame");t.color(i),this.row.getStaves().forEach(e=>{let i=this.staffMinDiatonicId.get(e),s=this.staffMaxDiatonicId.get(e);void 0!==i&&t.drawLedgerLines(e,i,this.getRect().anchorX),void 0!==s&&t.drawLedgerLines(e,s,this.getRect().anchorX)}),this.voiceSymbol.forEach(i=>i.draw(t,e)),this.arpeggios.forEach(i=>i.draw(t,e))}};function pe(t,e){return"undefined"==typeof window?void 0:window.setTimeout(t,e)}function Ce(t){"undefined"!=typeof window&&window.clearTimeout(t)}function Ie(){return it("m")}var Ae=class{constructor(t){this.col=t,(0,a.Mu)(this,"speed"),(0,a.Mu)(this,"volume"),(0,a.Mu)(this,"octaveShift"),this.speed=1,this.volume=Ie(),this.octaveShift=0}get measure(){return this.col.measure}reset(){this.speed=1,this.volume=Ie(),this.octaveShift=0}setSpeed(t){this.speed=t}getSpeed(){return this.speed}getTempo(){let t=n.OZ.Math.clamp(this.getSpeed(),.1,10);return(0,o.alterTempoSpeed)(this.measure.getTempo(),t)}setVolume(t){this.volume=t}getVolume(){return this.volume}setOctaveShift(t){this.octaveShift=t}getOctaveShift(){return this.octaveShift}hasFermata(){return this.measure.hasFermata(this.col)}getFermataHoldTicks(){if(!this.hasFermata())return 0;const{col:t}=this;if(t instanceof Me)return this.measure.getMeasureTicks()/2;{let e=[0,1,2,3].map(e=>t.getVoiceSymbol(e)).filter(t=>!!t).map(t=>t.rhythmProps.ticks);return 0===e.length?0:n.OZ.Math.sum(e)/e.length}}},be=class t{constructor(){(0,a.Mu)(this,"playTimer"),(0,a.Mu)(this,"playPos"),(0,a.Mu)(this,"playState",2),(0,a.Mu)(this,"doc"),(0,a.Mu)(this,"cursorPositionChangeListener"),(0,a.Mu)(this,"playStateChnageListeners",new n.wu),(0,a.Mu)(this,"playerColumnSequence",[])}setDocument(t){this.doc=t}setCursorPositionChangeListener(t){this.cursorPositionChangeListener=t}setPlayStateChangeListener(t){this.playStateChnageListeners.add(t)}removePlayStateChangeListener(t){this.playStateChnageListeners.delete(t)}getPlayStateChangeListeners(){return this.playStateChnageListeners.toArray()}notifyCursorPositionChanged(){this.cursorPositionChangeListener&&this.cursorPositionChangeListener(this.getCursorRect())}notifyPlayStateChanged(){let t=void 0!==this.playPos&&void 0!==this.playTimer?0:void 0!==this.playPos&&void 0===this.playTimer?1:2;this.playState!==t&&(this.playStateChnageListeners.forEach(e=>e(t)),this.playState=t)}collectPlayerMeasureSequence(){var e;if(!this.doc)return[];let i,s=[],n=this.doc.getFirstMeasure(),a=n,o=!1,r=!1,h=!1,c=[],u=!1,l=10*this.doc.getMeasures().length;for(;n&&--l>=0;){n.incPassCount();let l=n.getPassCount(),d=n.getEnding();if(d){const i=0===c.length?1:c[c.length-1].pass+1,s=null==(e=c.slice().reverse().find(t=>1===t.pass))?void 0:e.ending;if(d.hasPassage(i))c.push({pass:i,ending:d});else if(d.hasPassage(1)&&s!==d)c.push({pass:1,ending:d});else if(d=t.resolveNextEnding(d,i),n=null==d?void 0:d.measure,!n)break;u=!0}if(s.push(n),n.hasNavigation("startRepeat")&&(a=n,u=!1),n.hasNavigation("Segno")&&(i=n),r&&n.hasNavigation("toCoda"))for(;n&&!n.hasNavigation("Coda");)n=n.getNextMeasure();else if(o&&n.hasNavigation("Fine"))n=void 0;else if(n.hasNavigation("D.C. al Coda"))r=!0,n=this.doc.getFirstMeasure(),h=!0;else if(n.hasNavigation("D.C. al Fine"))o=!0,n=this.doc.getFirstMeasure(),h=!0;else if(n.hasNavigation("D.S. al Coda"))r=!0,n=i,h=!0;else if(n.hasNavigation("D.S. al Fine"))o=!0,n=i,h=!0;else if(!n.hasNavigation("endRepeat")||h&&!u)n=n.hasEndSong()?void 0:n.getNextMeasure();else{const t=n.getEndRepeatPlayCount();n=l<t||u?a:!1?void 0:n.getNextMeasure()}}return s}collectPlayerColumnSequence(){let t=this.collectPlayerMeasureSequence(),e=[];for(let i=0;i<t.length;i++){let s=t[i];e=e.concat(s.getColumns()),s.hasFermata(s.getBarLineRight())&&e.push(s.getBarLineRight())}return e}updatePlayerProps(){if(this.playerColumnSequence.forEach(t=>t.getPlayerProps().reset()),!this.doc)return;let t=1,e=Ie(),i=0,s=new n.b1,a=new n.b1,o=new n.b1;const r=(t,e)=>s.getOrCreate(t,[]).push(e),h=(t,e)=>a.getOrCreate(t,[]).push(e),c=(t,e)=>o.getOrCreate(t,[]).push(e);this.playerColumnSequence.forEach((u,l)=>{if(!(u instanceof me))return;u.getAnchoredLayoutObjects().forEach(s=>{const a=pt(s.musicObj);let o;if("a tempo"===a)t=1;else if(void 0!==(o=it(a)))e=o;else if("loco"===a)i=0;else if("tempo"===nt(a)||function(t){return"dynamics"===nt(t)}(a)||"8va"===a||"8vb"===a){const i=(s.musicObj.getLink()instanceof At?s.musicObj.getLink():new At(s,u,1/0,!1,"solid","bottom")).getRange(),l=i.stopObject?pt(i.stopObject):"";let d=n.OZ.Math.sum(i.columnRange.map(t=>t.getTicksToNextColumn()));switch(a){case"accel.":{let e=t,s=2*e,n=0;i.columnRange.forEach(t=>{n+=t.getTicksToNextColumn(),r(t,e+(s-e)*n/d)});break}case"rit.":case"rall.":{let e=t,s=e/2,n=0;i.columnRange.forEach(t=>{n+=t.getTicksToNextColumn(),r(t,e+(s-e)*n/d)});break}case"cresc.":{let t=e,s=t+.5;i.stopObject&&void 0!==(o=it(l))&&o>t&&(s=o);let n=0;i.columnRange.forEach(e=>{n+=e.getTicksToNextColumn(),h(e,t+(s-t)*n/d)});break}case"decresc.":case"dim.":{let t=e,s=t-.5;i.stopObject&&void 0!==(o=it(l))&&o<t&&(s=o);let n=0;i.columnRange.forEach(e=>{n+=e.getTicksToNextColumn(),h(e,t+(s-t)*n/d)});break}case"8va":i.columnRange.forEach(t=>c(t,1));break;case"8vb":i.columnRange.forEach(t=>c(t,-1))}}});let d=s.getOrDefault(u,[]),g=a.getOrDefault(u,[]),f=o.getOrDefault(u,[]);d.length>0&&(t=n.OZ.Math.avg(...d)),g.length>0&&(e=n.OZ.Math.avg(...g)),i=f.length>0?f[f.length-1]:0,u.getPlayerProps().setSpeed(t),u.getPlayerProps().setVolume(e),u.getPlayerProps().setOctaveShift(i)})}static resolveNextEnding(t,e){let i=t.measure.getNextMeasure();for(;i;){const t=i.getEnding();if(t&&t.hasPassage(e))return t;let s=i.getNextMeasure();if(!s||i.hasEndSong()||i.hasEndSection()||s.hasNavigation("startRepeat")&&!s.hasNavigation("ending"))return;i=i.getNextMeasure()}}initializeForPlayback(){var t;null==(t=this.doc)||t.resetMeasures(),this.playerColumnSequence=this.collectPlayerColumnSequence(),this.updatePlayerProps()}playStep(){if(this.notifyCursorPositionChanged(),this.notifyPlayStateChanged(),void 0===this.playPos)return void this.stop();const t=this.playerColumnSequence[this.playPos];if(!t)return void this.stop();const e=(t,e)=>{let i=function(t,e){let i=o.RhythmProps.get(e.options.beatLength,e.options.dotCount).ticks;return 60*t/(e.beatsPerMinute*i)}(t,e);return Math.max(0,i)};let i,s=t.getPlayerProps().getTempo(),n=t.getPlayerProps().getFermataHoldTicks();if(t instanceof Me)i=e(n,s);else{t.getPlayerNotes().forEach((i,a)=>{let r=t.hasArpeggio()?o.RhythmProps.get(o.NoteLength.ThirtySecond).ticks*a:0,c=e(i.ticks+n-r,s);if(c>0){"staccato"===i.staccato?c=Math.min(e(o.RhythmProps.get(o.NoteLength.Eighth).ticks,s)/2,c/2):"staccatissimo"===i.staccato&&(c=Math.min(e(o.RhythmProps.get(o.NoteLength.Eighth).ticks,s)/4,c/4));let n=1.25*t.getPlayerProps().getVolume();"slurred"===i.slur&&(n*=.5);let a=i.note,u=t.getPlayerProps().getOctaveShift();if(0!==u&&(a=new o.Note(a.diatonicId+7*u,a.accidental)),r>0){pe(()=>h.playNote(a,c,n),1e3*e(r,s))}else h.playNote(a,c,n)}}),i=e(t.getTicksToNextColumn()+n,s)}this.playTimer=pe(()=>{this.playPos=this.getNextPlayPos(),this.notifyPlayStateChanged(),this.playStep()},1e3*i)}play(){if(this.initializeForPlayback(),0===this.playState)this.stop();else if(1===this.playState)return this.playStep(),void this.notifyPlayStateChanged();let{doc:t}=this;t&&(t.getFirstMeasure()?(this.playPos=0,this.playStep()):this.playPos=void 0,this.notifyPlayStateChanged())}pause(){this.playTimer&&(Ce(this.playTimer),this.playTimer=void 0),this.notifyCursorPositionChanged(),this.notifyPlayStateChanged(),this.playPos=this.getNextPlayPos()}stop(){this.playTimer&&(Ce(this.playTimer),this.playTimer=void 0),this.playPos=void 0,this.notifyCursorPositionChanged(),this.notifyPlayStateChanged()}getNextPlayPos(){if(void 0===this.playPos)return;const t=this.playPos+1;return t>=this.playerColumnSequence.length?void 0:t}getPlayState(){return this.playState}getCursorRect(){if(void 0===this.playPos)return;let t=this.playerColumnSequence[this.playPos];if(!t)return;let e=t.measure,i=t.getRect().anchorX,{top:s,height:a}=e.row.getRect();return new n.rw(i,s,0,a)}},ye=class extends G{constructor(t,e,i){super(e),this.barLine=t,this.line=e,this.rowGroup=i,(0,a.Mu)(this,"vlines",[]),(0,a.Mu)(this,"dots",[]),(0,a.Mu)(this,"mi"),e.addObject(this),this.mi=new ui(this)}getMusicInterface(){return this.mi}pick(t,e){return this.getRect().contains(t,e)?[this]:[]}updateRect(){this.rect=new n.vW(0,0,this.line.getTopLineY(),this.line.getBottomLineY()),this.vlines.forEach(t=>this.rect.unionInPlace(new n.vW(t.left,t.left+t.width,this.rect.top,this.rect.bottom))),this.dots.forEach(t=>this.rect.unionInPlace(new n.vW(t.x-t.r,t.x+t.r,t.y-t.r,t.y+t.r)))}offset(t,e){this.vlines.forEach(e=>e.left+=t),this.dots.forEach(i=>{i.x+=t,i.y+=e}),this.rect.offsetInPlace(t,e)}},ve=class extends G{constructor(t){super(t),this.measure=t,(0,a.Mu)(this,"notationLineObjects",[]),(0,a.Mu)(this,"notationLineObjectsByGrp",new n.b1),(0,a.Mu)(this,"barLineType",0)}get doc(){return this.measure.doc}get row(){return this.measure.row}pick(t,e){if(!this.getRect().contains(t,e))return[];for(let i=0;i<this.notationLineObjects.length;i++){let s=this.notationLineObjects[i].pick(t,e);if(s.length>0)return[this,...s]}return[this]}layout(t){this.requestRectUpdate(),this.barLineType=this.solveBarLineType();let{unitSize:e,lineWidthPx:i}=t,{measure:s,barLineType:n}=this,{row:a}=s,o=i,r=.7*e,h=.7*e,c=A*e/2;this.notationLineObjects=[],this.notationLineObjectsByGrp.clear(),a.getRowGroups().forEach(t=>{t.lines.forEach(e=>{let i,s,a=new ye(this,e,t);this.notationLineObjects.push(a),this.notationLineObjectsByGrp.getOrCreate(t,[]).push(a);const u=(t,e)=>{a.vlines.push({left:t,width:e})},l=t=>{for(let e=-1;e<=1;e+=2){let n=i+e*s;a.dots.push({x:t,y:n,r:c})}};switch(e instanceof de?(i=e.getMiddleLineY(),s=e.getDiatonicSpacing()):(i=(e.getBottomLineY()+e.getTopLineY())/2,s=(e.getBottomLineY()-e.getTopLineY())/6),n){case 0:break;case 1:u(-o,o);break;case 2:u(-o-h-o,o),u(-o,o);break;case 3:u(-o-h-r,o),u(-r,r);break;case 4:u(0,r),u(r+h,o),l(r+h+o+h+c);break;case 5:u(-o-h-r,o),u(-r,r),l(-o-h-r-h-c);break;case 6:u(-r/2,r),u(-r/2-h-o,o),u(r/2+h,o),l(-r/2-h-o-h-c),l(r/2+h+o+h+c)}a.forceRectUpdate()})})}updateRect(){if(this.notationLineObjects.length>0){this.rect=this.notationLineObjects[0].getRect().clone();for(let t=1;t<this.notationLineObjects.length;t++)this.rect.unionInPlace(this.notationLineObjects[t].getRect())}else this.rect=new n.vW}offset(t,e){this.notationLineObjects.forEach(e=>e.offset(t,0)),this.requestRectUpdate()}draw(t,e){this.intersects(e)&&0!==this.barLineType&&(t.drawDebugRect(this.getRect()),this.notationLineObjects.forEach(e=>{e.vlines.forEach(i=>e.line.drawVerticalLine(t,i.left,i.width)),e.dots.forEach(e=>t.fillCircle(e.x,e.y,e.r))}))}},we=class extends ve{constructor(t){super(t),(0,a.Mu)(this,"mi"),this.mi=new hi(this)}getMusicInterface(){return this.mi}solveBarLineType(){let t=this.measure,e=t.getPrevMeasure();return t.hasNavigation("startRepeat")?e&&e.row===t.row&&e.hasNavigation("endRepeat")?0:4:0}},Me=class extends ve{constructor(t){super(t),(0,a.Mu)(this,"playerProps"),(0,a.Mu)(this,"mi"),this.playerProps=new Ae(this),this.mi=new oi(this)}getMusicInterface(){return this.mi}getPlayerProps(){return this.playerProps}solveBarLineType(){let t=this.measure,e=t.getNextMeasure();return t.hasNavigation("endRepeat")?e&&e.row===t.row&&e.hasNavigation("startRepeat")?6:5:t.doc.hasSingleMeasure()||!t.hasEndSong()&&t.getNextMeasure()?t.hasEndSection()||t===t.row.getLastMeasure()&&e&&e.row===t.row.getNextRow()&&e.hasNavigation("startRepeat")?2:e&&e.hasNavigation("startRepeat")?0:1:3}};function Ne(t,e){n.OZ.Dom.addClass(t,...e.split(" ").map(t=>t.trim()).filter(Boolean))}var Se="wms-button",Re="wms-button-group",Le="undefined"!=typeof HTMLElement?HTMLElement:class{},xe=class extends Le{constructor(){super(),(0,a.Mu)(this,"playLabel"),(0,a.Mu)(this,"pauseLabel"),(0,a.Mu)(this,"stopLabel"),(0,a.Mu)(this,"btnPlay"),(0,a.Mu)(this,"btnPause"),(0,a.Mu)(this,"btnStop"),(0,a.Mu)(this,"buttonClass",Se),(0,a.Mu)(this,"buttonGroupClass",Re),(0,a.Mu)(this,"_layout","play-pause-stop"),(0,a.Mu)(this,"_controls"),(0,a.Mu)(this,"_doc"),(0,a.Mu)(this,"_player"),(0,a.Mu)(this,"_root"),(0,a.Mu)(this,"_connected",!1),this._controls=new os,"undefined"!=typeof document&&(this._root=document.createElement("div"),Ne(this._root,this.buttonGroupClass))}static get observedAttributes(){return["single-play","single-play-stop","play-stop","play-pause-stop","play-label","pause-label","stop-label","button-class","button-group-class"]}attributeChangedCallback(t,e,i){"play-label"===t&&(this.playLabel=null!=i?i:void 0),"pause-label"===t&&(this.pauseLabel=null!=i?i:void 0),"stop-label"===t&&(this.stopLabel=null!=i?i:void 0),"single-play"===t&&i&&(this._layout="single-play"),"single-play-stop"===t&&i&&(this._layout="single-play-stop"),"play-stop"===t&&i&&(this._layout="play-stop"),"play-pause-stop"===t&&i&&(this._layout="play-pause-stop"),"single-play"!==t&&"single-play-stop"!==t&&"play-stop"!==t&&"play-pause-stop"!==t||null!==i||(this._layout="play-pause-stop"),"button-class"===t&&(this.buttonClass=null!=i?i:Se),"button-group-class"===t&&(this.buttonGroupClass=null!=i?i:Re,this._root&&(this._root.className="",Ne(this._root,this.buttonGroupClass))),this.update()}connectedCallback(){"undefined"!=typeof document&&(this.hasAttribute("play-label")&&(this.playLabel=this.getAttribute("play-label")),this.hasAttribute("pause-label")&&(this.pauseLabel=this.getAttribute("pause-label")),this.hasAttribute("stop-label")&&(this.stopLabel=this.getAttribute("stop-label")),this._layout="play-pause-stop",this.hasAttribute("single-play")&&(this._layout="single-play"),this.hasAttribute("single-play-stop")&&(this._layout="single-play-stop"),this.hasAttribute("play-stop")&&(this._layout="play-stop"),this.hasAttribute("play-pause-stop")&&(this._layout="play-pause-stop"),this.hasAttribute("button-class")&&(this.buttonClass=this.getAttribute("button-class")),this.hasAttribute("button-group-class")&&(this.buttonGroupClass=this.getAttribute("button-group-class")),this.append(this._root),this._connected=!0,this.update())}disconnectedCallback(){this._connected=!1}adoptedCallback(){}get wmsControls(){return this._controls}set doc(t){this._doc=t,this._player=null==t?void 0:t.getDefaultPlayer(),this.update()}get doc(){return this._doc}set player(t){this._doc=void 0,this._player=t,this.update()}get player(){return this._player}ensureButton(t){return t||((t=document.createElement("button")).type="button"),t.className="",Ne(t,this.buttonClass),t}update(){if("undefined"!=typeof document&&this._root&&this._connected)switch(this._controls.setPlayer(this._player),this._layout){case"single-play":this.btnPause=this.btnStop=void 0,this.btnPlay=this.ensureButton(this.btnPlay),this._root.replaceChildren(this.btnPlay),this._controls.setSinglePlay(this.btnPlay,this.playLabel);break;case"single-play-stop":this.btnPlay=this.ensureButton(this.btnPlay),this.btnPause=void 0,this.btnStop=void 0,this._root.replaceChildren(this.btnPlay),this._controls.setSinglePlayStop(this.btnPlay,this.playLabel,this.stopLabel);break;case"play-stop":this.btnPlay=this.ensureButton(this.btnPlay),this.btnPause=void 0,this.btnStop=this.ensureButton(this.btnStop),this._root.replaceChildren(this.btnPlay,this.btnStop),this._controls.setPlayStop(this.btnPlay,this.btnStop,this.playLabel,this.stopLabel);break;default:this.btnPlay=this.ensureButton(this.btnPlay),this.btnPause=this.ensureButton(this.btnPause),this.btnStop=this.ensureButton(this.btnStop),this._root.replaceChildren(this.btnPlay,this.btnPause,this.btnStop),this._controls.setPlayPauseStop(this.btnPlay,this.btnPause,this.btnStop,this.playLabel,this.pauseLabel,this.stopLabel)}}};function Te(){if("undefined"!=typeof document&&"undefined"!=typeof customElements)try{customElements.get("wms-controls")||customElements.define("wms-controls",xe)}catch(t){}}function Pe(t){return"undefined"!=typeof document&&"undefined"!=typeof customElements&&(n.OZ.Obj.isObject(t)&&n.OZ.Obj.hasProperties(t,["tagName"])&&"WMS-CONTROLS"===t.tagName)}var De=class t{constructor(t,e){(0,a.Mu)(this,"player"),s.RB.assertVar(t instanceof He,"doc",t),s.RB.assertVar(n.I8.isFunctionOrUndefined(e),"playStateChangeListener",e),this.player=new be,this.player.setDocument(t.getMusicObject()),this.player.setCursorPositionChangeListener(e=>{t.getMusicObject().updateCursorRect(this,e)}),e&&this.player.setPlayStateChangeListener(e)}setPlayStateChangeListener(t){this.player.setPlayStateChangeListener(t)}removePlayStateChangeListener(t){this.player.removePlayStateChangeListener(t)}getPlayStateChangeListeners(){return this.player.getPlayStateChangeListeners()}getPlayState(){return this.player.getPlayState()}static stopAll(){this.currentlyPlaying.forEach(t=>t.stop()),h.stop()}play(){return t.currentlyPlaying.add(this),this.player.play(),this}pause(){return this.player.pause(),this}stop(){return this.player.stop(),t.currentlyPlaying.delete(this),this}bindElement(t){if(s.RB.assertVar(n.I8.isNonEmptyString(t)||n.I8.isObject(t),"elem",t),"undefined"==typeof document)return!1;const e="string"==typeof t?document.getElementById(t):t;return!!Pe(e)&&(e.player=this,!0)}unbindElement(t){if(s.RB.assertVar(n.I8.isNonEmptyString(t)||n.I8.isObject(t),"elem",t),"undefined"==typeof document)return!1;const e="string"==typeof t?document.getElementById(t):t;return!!Pe(e)&&(e.player=void 0,!0)}};(0,a.Mu)(De,"currentlyPlaying",new n.wu);var Be=De;function Oe(t){if(t instanceof de||t instanceof ge)return t.getMusicInterface();throw new D("Object is not staff or tab.")}var Ee=class{constructor(t){this.name=t}getParent(){var t;return null==(t=this.getMusicObject().getParent())?void 0:t.getMusicInterface()}},je=class t extends Ee{constructor(e){super(t.Name),this.obj=e}getMusicObject(){return this.obj}getAccidental(){return this.obj.accidental}};(0,a.Mu)(je,"Name","Accidental");var ke=je,Ge=class t extends Ee{constructor(e){super(t.Name),this.obj=e}getMusicObject(){return this.obj}};(0,a.Mu)(Ge,"Name","Connective");var Fe=Ge,We=class t extends Ee{constructor(e){super(t.Name),this.obj=e}getMusicObject(){return this.obj}getRhythmColumn(){return this.obj.col.getMusicInterface()}getNotationLine(){return Oe(this.obj.line)}};(0,a.Mu)(We,"Name","Arpeggio");var Ye=We,Ue=class t extends Ee{constructor(e){super(t.Name),this.obj=e}getMusicObject(){return this.obj}};(0,a.Mu)(Ue,"Name","BeamGroup");var ze=Ue,Ve=class t extends Ee{constructor(e){super(t.Name),this.obj=e}getMusicObject(){return this.obj}getStaff(){return this.obj.staff.getMusicInterface()}};(0,a.Mu)(Ve,"Name","StaffBeamGroup");var Ze=Ve,qe=class t extends Ee{constructor(e){super(t.Name),this.obj=e,(0,a.Mu)(this,"defaultPlayer")}getMusicObject(){return this.obj}getTitle(){return this.obj.getTitle()}getComposer(){return this.obj.getComposer()}getArranger(){return this.obj.getArranger()}getRows(){return this.obj.getRows().map(t=>t.getMusicInterface())}getMeasures(){return this.obj.getMeasures().map(t=>t.getMusicInterface())}play(t){s.RB.assertVar(n.I8.isFunctionOrUndefined(t),"playStateChangeListener",t);const e=this.getDefaultPlayer();return t&&e.setPlayStateChangeListener(t),e.play(),e}getDefaultPlayer(){return this.defaultPlayer||(this.defaultPlayer=new Be(this)),this.defaultPlayer}bindElement(t){if(s.RB.assertVar(n.I8.isNonEmptyString(t)||n.I8.isObject(t),"elem",t),"undefined"==typeof document)return!1;const e="string"==typeof t?document.getElementById(t):t;return!(!xs(e)&&!Pe(e)||e.doc===this)&&(e.doc=this,this.getMusicObject().requestFullLayout(),!0)}unbindElement(t){if(s.RB.assertVar(n.I8.isNonEmptyString(t)||n.I8.isObject(t),"elem",t),"undefined"==typeof document)return!1;const e="string"==typeof t?document.getElementById(t):t;return!(!xs(e)&&!Pe(e)||e.doc!==this)&&(e.doc=void 0,this.getMusicObject().requestFullLayout(),!0)}};(0,a.Mu)(qe,"Name","Document");var He=qe,Ke=class t extends Ee{constructor(e){super(t.Name),this.obj=e}getMusicObject(){return this.obj}getPassages(){return this.obj.passages}hasPassage(t){return s.RB.assertVar(n.I8.isIntegerGte(t,1),"passage",t),this.obj.hasPassage(t)}};(0,a.Mu)(Ke,"Name","Ending");var Xe=Ke,Je=class t extends Ee{constructor(e){super(e instanceof W?_e.Name:t.Name),this.obj=e}getMusicObject(){return this.obj}};(0,a.Mu)(Je,"Name","Symbol");var Qe=Je,_e=class extends Qe{constructor(t){super(t)}getMusicObject(){return this.obj}};(0,a.Mu)(_e,"Name","Fermata");var $e=class t extends Ee{constructor(e){super(t.Name),this.obj=e}getMusicObject(){return this.obj}getTitle(){return this.obj.title}getComposer(){return this.obj.composer}getArranger(){return this.obj.arranger}};(0,a.Mu)($e,"Name","Header");var ti=$e,ei=class t extends Ee{constructor(e){super(t.Name),this.obj=e}getMusicObject(){return this.obj}};(0,a.Mu)(ei,"Name","Image");var ii=ei,si=class t extends Ee{constructor(e){super(t.Name),this.obj=e}getMusicObject(){return this.obj}getMeasureNumber(){return this.obj.getMeasureNumber()}getRhythmColumns(){return this.obj.getColumns().map(t=>t.getMusicInterface())}getRow(){return this.obj.row.getMusicInterface()}};(0,a.Mu)(si,"Name","Measure");var ni=si,ai=class t extends Ee{constructor(e){super(t.Name),this.obj=e}getMusicObject(){return this.obj}};(0,a.Mu)(ai,"Name","BarLineRight");var oi=ai,ri=class t extends Ee{constructor(e){super(t.Name),this.obj=e}getMusicObject(){return this.obj}};(0,a.Mu)(ri,"Name","BarLineLeft");var hi=ri,ci=class t extends Ee{constructor(e){super(t.Name),this.obj=e}getMusicObject(){return this.obj}getBarLine(){let t=this.obj.barLine;if(t instanceof we||t instanceof Me)return t.getMusicInterface();throw new D("Bar line not left nor right.")}getNotationLine(){return Oe(this.obj.line)}};(0,a.Mu)(ci,"Name","StaffBarLine");var ui=ci,li=class t extends Ee{constructor(e){super(t.Name),this.obj=e}getMusicObject(){return this.obj}getNotes(){return this.obj.notes}getRhythmProps(){return this.obj.rhythmProps}getRhythmColumn(){return this.obj.col.getMusicInterface()}getMeasure(){return this.obj.measure.getMusicInterface()}};(0,a.Mu)(li,"Name","NoteGroup");var di=li,gi=class t extends Ee{constructor(e){super(t.Name),this.obj=e}getMusicObject(){return this.obj}getNoteGroup(){return this.obj.noteGroup.getMusicInterface()}getRhythmColumn(){return this.getNoteGroup().getRhythmColumn()}getMeasure(){return this.getNoteGroup().getMeasure()}getStaff(){return this.obj.staff.getMusicInterface()}};(0,a.Mu)(gi,"Name","StaffNoteGroup");var fi=gi,mi=class t extends Ee{constructor(e){super(t.Name),this.obj=e}getMusicObject(){return this.obj}getNoteGroup(){return this.obj.noteGroup.getMusicInterface()}getRhythmColumn(){return this.getNoteGroup().getRhythmColumn()}getMeasure(){return this.getNoteGroup().getMeasure()}getTab(){return this.obj.tab.getMusicInterface()}};(0,a.Mu)(mi,"Name","TabNoteGroup");var pi=mi,Ci=class t extends Ee{constructor(e){super(t.Name),this.obj=e}getMusicObject(){return this.obj}getRhythmProps(){return this.obj.rhythmProps}getRhythmColumn(){return this.obj.col.getMusicInterface()}getMeasure(){return this.obj.measure.getMusicInterface()}};(0,a.Mu)(Ci,"Name","Rest");var Ii=Ci,Ai=class t extends Ee{constructor(e){super(t.Name),this.obj=e}getMusicObject(){return this.obj}getRest(){return this.obj.rest.getMusicInterface()}getRhythmColumn(){return this.getRest().getRhythmColumn()}getMeasure(){return this.getRest().getMeasure()}getStaff(){return this.obj.staff.getMusicInterface()}};(0,a.Mu)(Ai,"Name","StaffRest");var bi=Ai,yi=class t extends Ee{constructor(e){super(t.Name),this.obj=e}getMusicObject(){return this.obj}getRhythmSymbol(t){var e;return s.RB.assertVar(Tt(t),"voiceId",t),null==(e=this.obj.getVoiceSymbol(t))?void 0:e.getMusicInterface()}getMeasure(){return this.obj.measure.getMusicInterface()}};(0,a.Mu)(yi,"Name","RhythmColumn");var vi=yi,wi=class t extends Ee{constructor(e){super(t.Name),this.obj=e}getMusicObject(){return this.obj}getDocument(){return this.obj.doc.getMusicInterface()}getMeasures(){return this.obj.getMeasures().map(t=>t.getMusicInterface())}getNotationLines(){return this.obj.getNotationLines().map(t=>Oe(t))}};(0,a.Mu)(wi,"Name","ScoreRow");var Mi=wi,Ni=class t extends Ee{constructor(e){super(t.Name),this.obj=e}getMusicObject(){return this.obj}getInstrument(){return this.obj.instrument}};(0,a.Mu)(Ni,"Name","ScoreRowGroup");var Si=Ni,Ri=class t extends Ee{constructor(e){super(t.Name),this.obj=e}getMusicObject(){return this.obj}getId(){return this.obj.id}getName(){return this.obj.name.length>0?this.obj.name:void 0}getRow(){return this.obj.row.getMusicInterface()}};(0,a.Mu)(Ri,"Name","Staff");var Li=Ri,xi=class t extends Ee{constructor(e){super(t.Name),this.obj=e}getMusicObject(){return this.obj}getId(){return this.obj.id}getName(){return this.obj.name.length>0?this.obj.name:void 0}getRow(){return this.obj.row.getMusicInterface()}};(0,a.Mu)(xi,"Name","Tab");var Ti=xi,Pi=class t extends Ee{constructor(e){super(t.Name),this.obj=e}getMusicObject(){return this.obj}getStaff(){return this.obj.staff.getMusicInterface()}};(0,a.Mu)(Pi,"Name","StaffSignature");var Di=Pi,Bi=class t extends Ee{constructor(e){super(t.Name),this.obj=e}getMusicObject(){return this.obj}getTab(){return this.obj.tab.getMusicInterface()}};(0,a.Mu)(Bi,"Name","TabSignature");var Oi=Bi,Ei=class t extends Ee{constructor(e){super(t.Name),this.obj=e}getMusicObject(){return this.obj}getMeasure(){return this.obj.measure.getMusicInterface()}getTab(){return this.obj.tab.getMusicInterface()}};(0,a.Mu)(Ei,"Name","TabRhythm");var ji=Ei,ki=class t extends Ee{constructor(e){super(t.Name),this.obj=e}getMusicObject(){return this.obj}getText(){return this.obj.getText()}};(0,a.Mu)(ki,"Name","SpecialText");var Gi=ki,Fi=class t extends Ee{constructor(e){super(t.Name),this.obj=e}getMusicObject(){return this.obj}getText(){return this.obj.getText()}};(0,a.Mu)(Fi,"Name","Text");var Wi=Fi,Yi=class t extends Ee{constructor(e){super(t.Name),this.obj=e}getMusicObject(){return this.obj}getText(){return this.obj.getText()}};(0,a.Mu)(Yi,"Name","Lyrics");var Ui=Yi,zi=class t extends Ee{constructor(e){super(t.Name),this.obj=e}getMusicObject(){return this.obj}};(0,a.Mu)(zi,"Name","ExtensionLine");var Vi,Zi,qi,Hi,Ki=zi;(Zi=Vi=Vi||(Vi={})).AliceBlue="aliceblue",Zi.AntiqueWhite="antiquewhite",Zi.Aqua="aqua",Zi.Aquamarine="aquamarine",Zi.Azure="azure",Zi.Beige="beige",Zi.Bisque="bisque",Zi.Black="black",Zi.BlanchedAlmond="blanchedalmond",Zi.Blue="blue",Zi.BlueViolet="blueviolet",Zi.Brown="brown",Zi.BurlyWood="burlywood",Zi.CadetBlue="cadetblue",Zi.Chartreuse="chartreuse",Zi.Chocolate="chocolate",Zi.Coral="coral",Zi.CornflowerBlue="cornflowerblue",Zi.CornSilk="cornsilk",Zi.Crimson="crimson",Zi.Cyan="cyan",Zi.DarkBlue="darkblue",Zi.DarkCyan="darkcyan",Zi.DarkGoldenRod="darkgoldenrod",Zi.DarkGray="darkgray",Zi.DarkGreen="darkgreen",Zi.DarkGrey="darkgrey",Zi.DarkKhaki="darkkhaki",Zi.DarkMagenta="darkmagenta",Zi.DarkOliveGreen="darkolivegreen",Zi.DarkOrange="darkorange",Zi.DarkOrchid="darkorchid",Zi.DarkRed="darkred",Zi.DarkSalmon="darksalmon",Zi.DarkSeaGreen="darkseagreen",Zi.DarkSlateBlue="darkslateblue",Zi.DarkSlateGray="darkslategray",Zi.DarkSlateGrey="darkslategrey",Zi.DarkTurquoise="darkturquoise",Zi.DarkViolet="darkviolet",Zi.DeepPink="deeppink",Zi.DeepSkyBlue="deepskyblue",Zi.DimGray="dimgray",Zi.DimGrey="dimgrey",Zi.DodgerBlue="dodgerblue",Zi.FireBrick="firebrick",Zi.FloralWhite="floralwhite",Zi.ForestGreen="forestgreen",Zi.Fuchsia="fuchsia",Zi.Gainsboro="gainsboro",Zi.GhostWhite="ghostwhite",Zi.Gold="gold",Zi.GoldenRod="goldenrod",Zi.Gray="gray",Zi.Green="green",Zi.GreenYellow="greenyellow",Zi.Grey="grey",Zi.Honeydew="honeydew",Zi.HotPink="hotpink",Zi.IndianRed="indianred",Zi.Indigo="indigo",Zi.Ivory="ivory",Zi.Khaki="khaki",Zi.Lavender="lavender",Zi.LavenderBlush="lavenderblush",Zi.LawnGreen="lawngreen",Zi.LemonChiffon="lemonchiffon",Zi.LightBlue="lightblue",Zi.LightCoral="lightcoral",Zi.LightCyan="lightcyan",Zi.LightGoldenRodYellow="lightgoldenrodyellow",Zi.LightGray="lightgray",Zi.LightGreen="lightgreen",Zi.LightGrey="lightgrey",Zi.LightPink="lightpink",Zi.LightSalmon="lightsalmon",Zi.LightSeaGreen="lightseagreen",Zi.LightSkyBlue="lightskyblue",Zi.LightSlateGray="lightslategray",Zi.LightSlateGrey="lightslategrey",Zi.LightSteelBlue="lightsteelblue",Zi.LightYellow="lightyellow",Zi.Lime="lime",Zi.LimeGreen="limegreen",Zi.Linen="linen",Zi.Magenta="magenta",Zi.Maroon="maroon",Zi.MediumAquamarine="mediumaquamarine",Zi.MediumBlue="mediumblue",Zi.MediumOrchid="mediumorchid",Zi.MediumPurple="mediumpurple",Zi.MediumSeaGreen="mediumseagreen",Zi.MediumSlateBlue="mediumslateblue",Zi.MediumSpringGreen="mediumspringgreen",Zi.MediumTurquoise="mediumturquoise",Zi.MediumVioletRed="mediumvioletred",Zi.MidnightBlue="midnightblue",Zi.MintCream="mintcream",Zi.MistyRose="mistyrose",Zi.Moccasin="moccasin",Zi.NavajoWhite="navajowhite",Zi.Navy="navy",Zi.OldLace="oldlace",Zi.Olive="olive",Zi.OliveDrab="olivedrab",Zi.Orange="orange",Zi.OrangeRed="orangered",Zi.Orchid="orchid",Zi.PaleGoldenRod="palegoldenrod",Zi.PaleGreen="palegreen",Zi.PaleTurquoise="paleturquoise",Zi.PaleVioletRed="palevioletred",Zi.PapayaWhip="papayawhip",Zi.PeachPuff="peachpuff",Zi.Peru="peru",Zi.Pink="pink",Zi.Plum="plum",Zi.PowderBlue="powderblue",Zi.Purple="purple",Zi.RebeccaPurple="rebeccapurple",Zi.Red="red",Zi.RosyBrown="rosybrown",Zi.RoyalBlue="royalblue",Zi.SaddleBrown="saddlebrown",Zi.Salmon="salmon",Zi.SandyBrown="sandybrown",Zi.SeaGreen="seagreen",Zi.SeaShell="seashell",Zi.Sienna="sienna",Zi.Silver="silver",Zi.SkyBlue="skyblue",Zi.SlateBlue="slateblue",Zi.SlateGray="slategray",Zi.SlateGrey="slategrey",Zi.Snow="snow",Zi.SpringGreen="springgreen",Zi.SteelBlue="steelblue",Zi.Tan="tan",Zi.Teal="teal",Zi.Thistle="thistle",Zi.Tomato="tomato",Zi.Turquoise="turquoise",Zi.Violet="violet",Zi.Wheat="wheat",Zi.White="white",Zi.WhiteSmoke="whitesmoke",Zi.Yellow="yellow",Zi.YellowGreen="yellowgreen",(Hi=qi=qi||(qi={})).Hex="hex",Hi.RGB="rgb",Hi.Array="array";var Xi={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};for(const Ts in Xi)Object.freeze(Xi[Ts]);var Ji=Object.freeze(Xi),Qi={hash:!0,lowercase:!1,short:!1};var _i=(0,a.ko)((0,a.IA)({},Qi),{fallback:!0,alpha:1,format:qi.Hex});function $i(t,e={}){const i=(0,a.IA)((0,a.IA)({},_i),e),{fallback:s,format:n,hash:o,lowercase:r,short:h,alpha:c}=i,u=(t=`${t}`).toLowerCase().replaceAll(/[^a-z]/g,"");let l=Ji[u];if(!l){if(!s)throw new Error(`no matching color found for '${t}'`);const e=t.toLowerCase().replaceAll(/[^\da-f]/g,"");l=(e.length<=3?[e.slice(0,1).repeat(2),e.slice(1,2).repeat(2),e.slice(2,3).repeat(2)]:[e.slice(0,2),e.slice(2,4),e.slice(4,6)]).map(t=>Number.parseInt(t.length<2?`${"0".repeat(2-t.length)}${t}`:t,16))}switch(n){case qi.Array:return[...l];case qi.RGB:return function(t,e=1){return(e=Math.min(1,Math.max(0,e)))<1?`rgba(${t[0]}, ${t[1]}, ${t[2]}, ${e})`:`rgb(${t[0]}, ${t[1]}, ${t[2]})`}(l,c);default:return function(t,e){const i=(0,a.IA)((0,a.IA)({},Qi),e),{hash:s,lowercase:n,short:o}=i;let r=t.map(t=>{let e=t.toString(16);return e=1===e.length?`0${e}`:e,e}).join("");if(o){const t=[...r];t[0]===t[1]&&t[2]===t[3]&&t[4]===t[5]&&(r=`${t[0]}${t[2]}${t[4]}`)}return r=n?r.toLowerCase():r.toUpperCase(),s&&(r=`#${r}`),r}(l,{hash:o,lowercase:r,short:h})}}var ts=t=>t.toLowerCase();function es(t){return t}var is=class t{constructor(){(0,a.Mu)(this,"colors",{"hilight.staffpos":"#55cc55","hilight.object":"#55cc55","play.cursor":"#44aa44",background:"white","header.title":"black","header.composer":"black","header.arranger":"black","rowgroup.instrument":"black","rowgroup.frame":"black","staff.frame":"black","staff.note":"black","staff.rest":"black","staff.lyrics":"black","staff.connective":"black","staff.arpeggio":"black","staff.signature.clef":"black","staff.signature.key":"black","staff.signature.time":"black","staff.signature.tempo":"black","staff.signature.measurenum":"black","staff.element.fermata":"black","staff.element.annotation":"black","staff.element.navigation":"black","staff.element.label":"black","staff.annotation.navigation":"black","staff.annotation.dynamics":"black","staff.annotation.tempo":"black","staff.annotation.articulation":"black","staff.annotation.expression":"black","staff.annotation.technique":"black","staff.annotation.temporal":"black","staff.annotation.label":"black","staff.annotation.ornament":"black","staff.annotation.misc":"black","tab.frame":"black","tab.note":"black","tab.rest":"black","tab.lyrics":"black","tab.connective":"black","tab.arpeggio":"black","tab.tuning":"black","tab.signature.clef":"black","tab.signature.key":"black","tab.signature.time":"black","tab.signature.tempo":"black","tab.signature.measurenum":"black","tab.element.fermata":"black","tab.element.annotation":"black","tab.element.navigation":"black","tab.element.label":"black","tab.annotation.navigation":"black","tab.annotation.dynamics":"black","tab.annotation.tempo":"black","tab.annotation.articulation":"black","tab.annotation.expression":"black","tab.annotation.technique":"black","tab.annotation.temporal":"black","tab.annotation.label":"black","tab.annotation.ornament":"black","tab.annotation.misc":"black"})}setColor(t,e){if("all"===t){for(const t of Object.keys(this.colors))"background"!==t&&"hilight.object"!==t&&"hilight.staffpos"!==t&&"play.cursor"!==t&&(this.colors[t]=e||"black");return this}const i="string"==typeof(t=function(t){let e=t;const i=n.I8.isArray(t)?t:[t],a=t=>t.every(t=>i.includes(t))&&i.every(e=>t.includes(e));if(a(["element"])||a(["element","annotation"]))e="annotation";else if(a(["element","fermata"]))e=["annotation","temporal"];else if(a(["element","navigation"]))e=["annotation","navigation"];else if(a(["element","label"]))e=["annotation","label"];else switch(t){case"staff.element.fermata":e="staff.annotation.temporal";break;case"staff.element.annotation":e=["staff","annotation"];break;case"staff.element.navigation":e="staff.annotation.navigation";break;case"staff.element.label":e="staff.annotation.label";break;case"tab.element.fermata":e="tab.annotation.temporal";break;case"tab.element.annotation":e=["tab","annotation"];break;case"tab.element.navigation":e="tab.annotation.navigation";break;case"tab.element.label":e="tab.annotation.label"}return n.OZ.Obj.deepEqual(t,e)||(0,s.S2)(`Deprecated ColorKey: ${n.OZ.Str.stringify(t)}`),e}(t))&&"background"===ts(t)||n.I8.isArray(t)&&1===t.length&&"background"===ts(t[0]),a=e||(i?"white":"black");if(i)return this.colors.background=a,this;if("string"==typeof t&&t in this.colors)return this.colors[t]=a,this;const o=n.I8.isArray(t)?t:t.split(".");if(o.includes("fermata")&&(0,s.S2)('Color key "fermata" is deprecated. Will be removed in future release. Use "annotation" instead.'),0===o.length)return this;const r=o.map(ts);let h=!1;for(const s of Object.keys(this.colors)){const t=s.split(".").map(ts);r.every(e=>t.includes(e))&&(this.colors[s]=a,h=!0)}return h||console.error(`Color attrs ${n.OZ.Str.stringify(o)} did not match any color.`),this}getColor(t){var e;return null!=(e=this.colors[t])?e:t}getColorCode(e){return t.colorNameToCode(this.getColor(e))}getColorRGBA(e){return t.colorNameToRGBA(this.getColor(e))}static colorNameToCode(t){return $i(t)}static colorNameToRGBA(t,e=1){const i=$i(t).replace("#","");return[parseInt(i.slice(0,2),16),parseInt(i.slice(2,4),16),parseInt(i.slice(4,6),16),Math.round(255*e)]}bindElement(t){if(s.RB.assertVar(n.I8.isNonEmptyString(t)||n.I8.isObject(t),"elem",t),"undefined"==typeof document)return!1;const e="string"==typeof t?document.getElementById(t):t;return!!xs(e)&&(e.paint=this,!0)}unbindElement(t){if(s.RB.assertVar(n.I8.isNonEmptyString(t)||n.I8.isObject(t),"elem",t),"undefined"==typeof document)return!1;const e="string"==typeof t?document.getElementById(t):t;return!!xs(e)&&(e.paint=void 0,!0)}};(0,a.Mu)(is,"default",new is);var ss=is,ns=class{constructor(){(0,a.Mu)(this,"_view"),this._view=new j(this)}static getByElementId(t){if("undefined"==typeof document)return;const e="string"==typeof t?document.getElementById(t):t;return e&&xs(e)?e.wmsView:void 0}setPaint(t){return s.RB.assertVar(n.I8.isUndefined(t)||t instanceof ss,"paint",t),this._view.setPaint(t),this}setDocument(t){return s.RB.assertVar(n.I8.isUndefined(t)||t instanceof He,"doc",t),this._view.setDocument(null==t?void 0:t.getMusicObject()),this}setCanvas(t){return this._view.setCanvas(s.RB.requireVar("canvas",n.OZ.Dom.getCanvas(t))),this}setZoom(t=1){return s.RB.assertVar(n.I8.isNumberGt(t,0)&&n.I8.isFinite(t),"zoom",t),this._view.setZoom(t),this}setStaffSize(t="default"){return s.RB.assertVar(n.I8.isNonEmptyString(t)||n.I8.isNumberGt(t,0)&&n.I8.isFinite(t),"staffSize",t),this._view.setStaffSize(t),this}setScoreEventListener(t){s.RB.assertVar(n.I8.isFunctionOrUndefined(t),"scoreEventListener",t),this._view.setScoreEventListener(t)}hilightObject(t){this._view.hilightObject(null==t?void 0:t.getMusicObject())}hilightStaffPos(t){let e=!1;if((null==t?void 0:t.staff)instanceof Li&&t.measure&&(this._view.hilightStaffPos({staff:t.staff.getMusicObject(),measure:t.measure.getMusicObject(),diatonicId:t.diatonicId}),e=!0),(null==t?void 0:t.scoreRow)instanceof Mi){const i=t.scoreRow.getNotationLines().find(t=>t instanceof Li);i&&(this._view.hilightStaffPos({staff:i.getMusicObject(),measure:void 0,diatonicId:t.diatonicId}),e=!0)}e||this._view.hilightStaffPos(void 0)}draw(){try{this._view.draw()}catch(t){console.log("Draw failed in music render context!",t)}}},as=class t{constructor(){(0,a.Mu)(this,"playButton"),(0,a.Mu)(this,"stopButton"),(0,a.Mu)(this,"playStopButton"),(0,a.Mu)(this,"pauseButton"),(0,a.Mu)(this,"onPlay"),(0,a.Mu)(this,"onStop"),(0,a.Mu)(this,"onPlayStop"),(0,a.Mu)(this,"onPause"),(0,a.Mu)(this,"playLabel",t.DefaultPlayLabel),(0,a.Mu)(this,"stopLabel",t.DefaultStopLabel),(0,a.Mu)(this,"pauseLabel",t.DefaultPauseLabel),(0,a.Mu)(this,"playState",2),(0,a.Mu)(this,"player"),this.onPlay=()=>{var t;return null==(t=this.player)?void 0:t.play()},this.onStop=()=>{var t;return null==(t=this.player)?void 0:t.stop()},this.onPlayStop=()=>{var t,e;0===this.playState?null==(t=this.player)||t.stop():null==(e=this.player)||e.play()},this.onPause=()=>{var t;return null==(t=this.player)?void 0:t.pause()},this.updateButtons()}static getByElementId(t){if("undefined"==typeof document)return;const e="string"==typeof t?document.getElementById(t):t;return e&&Pe(e)?e.wmsControls:void 0}setPlayer(t){return s.RB.assertVar(n.I8.isUndefined(t)||t instanceof Be,"player",t),this.player===t||(this.onStop(),this.player=t,this.player?(this.player.setPlayStateChangeListener(t=>{this.playState=t,this.updateButtons()}),this.playState=this.player.getPlayState()):this.playState=2,this.updateButtons()),this}setDocument(t){return s.RB.assertVar(n.I8.isUndefined(t)||t instanceof He,"doc",t),this.setPlayer(null==t?void 0:t.getDefaultPlayer())}detachDocument(){this.setDocument(void 0)}updateButtons(){this.playButton&&(this.playButton.disabled=!this.player||0===this.playState,this.playButton.innerText=this.playLabel),this.stopButton&&(this.stopButton.disabled=!this.player||2===this.playState,this.stopButton.innerText=this.stopLabel),this.playStopButton&&(this.playStopButton.disabled=!this.player,this.playStopButton.innerText=0===this.playState?this.stopLabel:this.playLabel),this.pauseButton&&(this.pauseButton.disabled=!this.player||0!==this.playState,this.pauseButton.innerText=this.pauseLabel)}_setPlayButton(e,i){return s.RB.assertVar(n.I8.isStringOrUndefined(i),"playLabel",i),t.removeOnClickListeners(this.playButton,this.onPlay),this.playButton=s.RB.requireVar("playBtn",n.OZ.Dom.getButton(e)),this.playLabel=null!=i?i:t.DefaultPlayLabel,t.removeOnClickListeners(this.playButton,"all"),t.addOnClickListener(this.playButton,this.onPlay),this.updateButtons(),this}setPlayButton(t,e){return(0,s.S2)("setPlayButton() is deprecated. Will be removed in future release. Use `setSinglePlay()`, `setSinglePlayStop()`, `setPlayStop()` or `setPlayPauseStop()` instead."),this._setPlayButton(t,e)}_setStopButton(e,i){return s.RB.assertVar(n.I8.isStringOrUndefined(i),"stopLabel",i),t.removeOnClickListeners(this.stopButton,this.onStop),this.stopButton=s.RB.requireVar("stopBtn",n.OZ.Dom.getButton(e)),this.stopLabel=null!=i?i:t.DefaultStopLabel,t.removeOnClickListeners(this.stopButton,"all"),t.addOnClickListener(this.stopButton,this.onStop),this.updateButtons(),this}setStopButton(t,e){return(0,s.S2)("setStopButton() is deprecated. Will be removed in future release. Use `setSinglePlay()`, `setSinglePlayStop()`, `setPlayStop()` or `setPlayPauseStop()` instead."),this._setStopButton(t,e)}_setPlayStopButton(e,i,a){return s.RB.assertVar(n.I8.isStringOrUndefined(i),"playLabel",i),s.RB.assertVar(n.I8.isStringOrUndefined(a),"stopLabel",a),t.removeOnClickListeners(this.playStopButton,this.onPlayStop),this.playStopButton=s.RB.requireVar("playStopBtn",n.OZ.Dom.getButton(e)),this.playLabel=null!=i?i:t.DefaultPlayLabel,this.stopLabel=null!=a?a:t.DefaultStopLabel,t.removeOnClickListeners(this.playStopButton,"all"),t.addOnClickListener(this.playStopButton,this.onPlayStop),this.updateButtons(),this}setPlayStopButton(t,e,i){return(0,s.S2)("setPlayStopButton() is deprecated. Will be removed in future release. Use `setSinglePlay()`, `setSinglePlayStop()`, `setPlayStop()` or `setPlayPauseStop()` instead."),this._setPlayStopButton(t,e,i)}_setPauseButton(e,i){return s.RB.assertVar(n.I8.isStringOrUndefined(i),"pauseLabel",i),t.removeOnClickListeners(this.pauseButton,this.onPause),this.pauseButton=s.RB.requireVar("pauseBtn",n.OZ.Dom.getButton(e)),this.pauseLabel=null!=i?i:t.DefaultPauseLabel,t.removeOnClickListeners(this.pauseButton,"all"),t.addOnClickListener(this.pauseButton,this.onPause),this.updateButtons(),this}setPauseButton(t,e){return(0,s.S2)("setPauseButton() is deprecated. Will be removed in future release. Use `setSinglePlay()`, `setSinglePlayStop()`, `setPlayStop()` or `setPlayPauseStop()` instead."),this._setPauseButton(t,e)}static removeOnClickListeners(t,e){if(!t)return;let i=this.savedOnClickListeners.getOrDefault(t,[]);i=i.filter(i=>e!==i&&"all"!==e||(t.removeEventListener("click",i),!1)),this.savedOnClickListeners.set(t,i)}static addOnClickListener(t,e){s.RB.assertVar(n.I8.isFunction(e),"onClickListener",e),t.addEventListener("click",e),this.savedOnClickListeners.getOrCreate(t,[]).push(e)}setSinglePlay(t,e){return this._setPlayButton(t,e),this}setSinglePlayStop(t,e,i){return this._setPlayStopButton(t,e),this}setPlayStop(t,e,i,s){return this._setPlayButton(t,i),this._setStopButton(e,s),this}setPlayPauseStop(t,e,i,s,n,a){return this._setPlayButton(t,s),this._setPauseButton(e,n),this._setStopButton(i,a),this}};(0,a.Mu)(as,"DefaultPlayLabel","Play"),(0,a.Mu)(as,"DefaultPauseLabel","Pause"),(0,a.Mu)(as,"DefaultStopLabel","Stop"),(0,a.Mu)(as,"savedOnClickListeners",new n.b1);var os=as,rs=class extends ns{constructor(){super(),(0,s.S2)("MRenderContext is deprecated. Will be removed in future release. Use WmsView instead.")}},hs=class extends os{constructor(){super(),(0,s.S2)("MPlayerButtons is deprecated. Will be removed in future release. Use WmsControls instead.")}},cs=class extends Be{constructor(t,e){super(t,e),(0,s.S2)("MPlayer is deprecated. Will be removed in future release. Use Player instead.")}},us=class extends G{constructor(t,e,i,s){super(t),this.doc=t,this.title=e,this.composer=i,this.arranger=s,(0,a.Mu)(this,"titleText"),(0,a.Mu)(this,"composerText"),(0,a.Mu)(this,"arrangerText"),(0,a.Mu)(this,"mi"),this.mi=new ti(this),this.titleText=this.title?new V(this,{text:this.title,color:t.getColorWithKey("header.title"),scale:2},.5,0):void 0,this.composerText=this.composer?new V(this,{text:this.composer,color:t.getColorWithKey("header.composer")},1,0):void 0,this.arrangerText=this.arranger?new V(this,{text:"Arr.: "+this.arranger,color:t.getColorWithKey("header.arranger")},1,0):void 0}getMusicInterface(){return this.mi}pick(t,e){if(!this.rect.contains(t,e))return[];if(this.titleText){let i=this.titleText.pick(t,e);if(i.length>0)return[this,...i]}if(this.composerText){let i=this.composerText.pick(t,e);if(i.length>0)return[this,...i]}if(this.arrangerText){let i=this.arrangerText.pick(t,e);if(i.length>0)return[this,...i]}return[this]}layout(t){const e=t.unitSize;let i=e;const s=this.doc.regions.staffLeft+e,a=this.doc.regions.staffRight-e,o=new n.vW(s,a,i,i);this.titleText&&(this.titleText.layout(t),this.titleText.setCenterX((s+a)/2),this.titleText.setTop(i),i+=this.titleText.getRect().height,o.unionInPlace(this.titleText.getRect())),this.composerText&&(this.composerText.layout(t),this.composerText.setRight(a),this.composerText.setTop(i),i+=this.composerText.getRect().height,o.unionInPlace(this.composerText.getRect())),this.arrangerText&&(this.arrangerText.layout(t),this.arrangerText.setRight(a),this.arrangerText.setTop(i),i+=this.arrangerText.getRect().height,o.unionInPlace(this.arrangerText.getRect())),this.rect=o.inflateCopy(e)}offset(t,e){this.titleText&&this.titleText.offset(t,e),this.composerText&&this.composerText.offset(t,e),this.arrangerText&&this.arrangerText.offset(t,e),this.rect.offsetInPlace(t,e)}draw(t,e){this.intersects(e)&&(this.titleText&&this.titleText.draw(t,e),this.composerText&&this.composerText.draw(t,e),this.arrangerText&&this.arrangerText.draw(t,e))}},ls=class extends G{constructor(t){super(void 0),this.options=t,(0,a.Mu)(this,"needLayout",!0),(0,a.Mu)(this,"attachedViews",new n.wu),(0,a.Mu)(this,"regions",new yt),(0,a.Mu)(this,"rows",[]),(0,a.Mu)(this,"measures",[]),(0,a.Mu)(this,"measuresPerRow",1/0),(0,a.Mu)(this,"curScoreConfig",[{type:"staff",clef:"G"}]),(0,a.Mu)(this,"header"),(0,a.Mu)(this,"newRowRequested",!1),(0,a.Mu)(this,"allConnectiveProps",[]),(0,a.Mu)(this,"staffGroups",new n.b1),(0,a.Mu)(this,"mi"),this.mi=new He(this)}getMusicInterface(){return this.mi}getBackground(t){var e,i;return null!=(i=null!=(e=this.options.background)?e:t)?i:"white"}getColorWithKey(t){var e,i;return null!=(i=null!=(e=this.options.color)?e:t)?i:"black"}setScoreConfiguration(t){if(n.I8.isEnumValue(t,Rt))switch(t){default:case"treble":this.curScoreConfig=[{type:"staff",clef:"G"}];break;case"bass":this.curScoreConfig=[{type:"staff",clef:"F"}];break;case"grand":this.curScoreConfig=[{type:"staff",clef:"G",grandId:"grand1"},{type:"staff",clef:"F",grandId:"grand1"}];break;case"guitarTreble":this.curScoreConfig=[{type:"staff",clef:"G",isOctaveDown:!0}];break;case"guitarTab":this.curScoreConfig=[{type:"tab",tuning:"Standard"}];break;case"guitarCombined":this.curScoreConfig=[{type:"staff",clef:"G",isOctaveDown:!0},{type:"tab",tuning:"Standard"}]}else n.I8.isArray(t)?this.curScoreConfig=t:this.curScoreConfig=[t];for(let e=0,i=[];e<this.curScoreConfig.length;){let t=this.curScoreConfig[e],s=this.curScoreConfig[e+1];if(t&&s&&"staff"===t.type&&"staff"===s.type&&void 0!==t.grandId&&t.grandId===s.grandId){if(i.includes(t.grandId))throw new D(`Grand staff error: grandId "${t.grandId}" already used!`);if("G"!==t.clef)throw new D(`Grand staff error: Invalid treble clef "${t.clef}"!`);if("F"!==s.clef)throw new D(`Grand staff error: Invalid treble clef "${t.clef}"!`);if(t.isOctaveDown||s.isOctaveDown)throw new D("Grand staff error: cannot use isOctaveDown option!");i.push(t.grandId),t.minNote="C4",s.maxNote="B3",e+=2}else{if(t&&"staff"===t.type&&void 0!==t.grandId)throw new D(`Grand staff error: invalid use of grandId "${t.grandId}"!`);e++}}this.requestNewRow()}setMeasuresPerRow(t){this.measuresPerRow=t}addConnectiveProps(t){this.allConnectiveProps.push(t)}addView(t){t&&(this.attachedViews.add(t),t.setDocument(this),this.requestFullLayout())}removeView(t){t&&(t.setDocument(void 0),this.attachedViews.delete(t))}setHeader(t,e,i){this.header=new us(this,t,e,i),this.requestLayout()}getTitle(){var t;return null==(t=this.header)?void 0:t.title}getComposer(){var t;return null==(t=this.header)?void 0:t.composer}getArranger(){var t;return null==(t=this.header)?void 0:t.arranger}hasSingleMeasure(){return 1===this.measures.length}getFirstMeasure(){return this.measures.length>0?this.measures[0]:void 0}getLastMeasure(){return this.measures.length>0?this.measures[this.measures.length-1]:void 0}addNewRow(t){let e=new vt(this,t,this.curScoreConfig);return this.rows.push(e),e}getFirstRow(){return 0===this.rows.length?this.addNewRow(void 0):this.rows[0]}getLastRow(){return 0===this.rows.length?this.addNewRow(void 0):this.rows[this.rows.length-1]}getRows(){return this.rows}getMeasures(){return this.measures}requestNewRow(){this.newRowRequested=!0}addMeasure(t){let e=this.rows[this.rows.length-1];(!e||this.newRowRequested&&e.getMeasures().length>0||e.getMeasures().length>=this.measuresPerRow)&&(e=this.addNewRow(e),this.newRowRequested=!1);let i=new ae(e,t);return this.measures.push(i),e.addMeasure(i),this.requestLayout(),i}addStaffGroup(t,e,i){this.staffGroups.set(t,new he(t,e,i))}getStaffGroup(t){return this.staffGroups.get(t)}getVoiceSymbols(t){let e=[];return this.forEachMeasure(i=>e=e.concat(i.getVoiceSymbols(t))),e}removeLayoutObjects(t){this.forEachMeasure(e=>e.removeLayoutObjects(t))}forEachMeasure(t){let e=this.getFirstMeasure();for(;e;)t(e),e=e.getNextMeasure()}resetMeasures(){this.measures.forEach(t=>t.resetPassCount())}updateCursorRect(t,e){for(const i of this.attachedViews)i.updateCursorOverlay(t,e)}requestLayout(){this.needLayout=!0}requestFullLayout(){this.rows.forEach(t=>t.requestLayout()),this.forEachMeasure(t=>{t.getColumns().forEach(t=>t.requestLayout()),t.requestLayout()}),this.requestLayout()}layout(t){var e;if(!this.needLayout)return;let{unitSize:i}=t;this.forEachMeasure(t=>t.createBeams()),null==(e=this.getFirstMeasure())||e.updateRunningArguments(),this.forEachMeasure(t=>t.createExtensions()),this.allConnectiveProps.forEach(t=>t.removeConnectives()),this.allConnectiveProps.forEach(t=>t.createConnectives()),this.rows.forEach(e=>e.resetLayoutGroups(t)),this.regions.resetWidths(),this.regions.addRowstaffWidth(u*i),this.rows.forEach(e=>e.layout(t)),this.rows.forEach(e=>e.layoutStretch(t)),this.rows.forEach(e=>e.layoutLayoutGroups(t)),this.rows.forEach(e=>e.layoutSetNotationLines(t)),this.rect=new n.vW,this.header&&(this.header.layout(t),this.rect.unionInPlace(this.header.getRect())),this.rows.forEach(t=>{t.setLeft(0),t.setTop(this.rect.bottom+2*i),this.rect.unionInPlace(t.getRect())}),this.rows.forEach(t=>t.layoutDone()),t.isAllDirty=!0,this.needLayout=!1}offset(t,e){}draw(t,e){var i;this.intersects(e)&&(null==(i=this.header)||i.draw(t,e),this.rows.forEach(i=>i.draw(t,e)))}pickStaffPosAt(t,e){if(this.rect.contains(t,e))for(let i=0;i<this.rows.length;i++){const s=this.rows[i];for(let i=0;i<s.getStaves().length;i++){const n=s.getStaves()[i],a=s.getMeasures().find(i=>i.getRect().contains(t,e));if(!a)continue;let o=n.getDiatonicIdAt(e),{minDiatonicId:r,maxDiatonicId:h}=n.calcUsedDiatonicIdRange();if(void 0!==o&&o>=r&&o<=h)return{staff:n,diatonicId:o,measure:a,accidental:a.getKeySignature().getAccidental(o)}}}}pick(t,e){if(!this.rect.contains(t,e))return[];if(this.header){let i=this.header.pick(t,e);if(i.length>0)return[this,...i]}for(let i=0;i<this.rows.length;i++){let s=this.rows[i].pick(t,e);if(s.length>0)return[this,...s]}return[this]}};function ds(t,e,i){s.RB.assertMsg(!n.I8.isTypedObject(t,[e]),i)}function gs(t){s.RB.assert(n.I8.isObject(t),n.I8.isStringOrUndefined(t.name),n.I8.isUndefined(t.voiceId)||Tt(t.voiceId)||n.I8.isArray(t.voiceId)&&t.voiceId.every(t=>Tt(t))),ds(t,"voiceIds","Baseconfig.voiceIds was removed. Use BaseConfig.voiceId instead."),n.I8.isArray(t.voiceId)&&(t.voiceId=n.OZ.Arr.removeDuplicates(t.voiceId)),s.RB.assert(n.I8.isStringOrUndefined(t.instrument))}function fs(t){gs(t),s.RB.assert(n.I8.isObject(t),n.I8.isStrictEqual(t.type,"staff"),n.I8.isEnumValue(t.clef,Lt),n.I8.isBooleanOrUndefined(t.isOctaveDown),n.I8.isUndefined(t.minNote)||o.Note.isNote(t.minNote),n.I8.isUndefined(t.maxNote)||o.Note.isNote(t.maxNote),n.I8.isStringOrUndefined(t.grandId)),ds(t,"isGrand","StaffConfig.isGrand was removed. Use StaffConfig.grandId instead.")}function ms(t){gs(t),s.RB.assert(n.I8.isObject(t),n.I8.isStrictEqual(t.type,"tab"),n.I8.isUndefined(t.tuning)||n.I8.isString(t.tuning)&&n.I8.isIncluded(t.tuning,o.TuningNameList)||n.I8.isArray(t.tuning)&&n.I8.isStrictEqual(t.tuning.length,6)&&t.tuning.every(t=>o.Note.isNote(t)))}function ps(t){s.RB.assert(n.I8.isObject(t),n.I8.isEnumValueOrUndefined(t.stem,Gt),n.I8.isStringOrUndefined(t.color),n.I8.isBooleanOrUndefined(t.arpeggio)||n.I8.isEnumValue(t.arpeggio,Ft),n.I8.isBooleanOrUndefined(t.staccato),n.I8.isBooleanOrUndefined(t.diamond),n.I8.isUndefined(t.string)||Bt(t.string)||n.I8.isEmptyArray(t.string)||n.I8.isNonEmptyArray(t.string)&&t.string.every(t=>Bt(t))),ds(t,"dotted","NoteOptions.dotted was removed."),ds(t,"triplet","NoteOptions.triplet was removed."),ds(t,"tieSpan",'NoteOptions.tieSpan was removed. Use addConnective("tie", tieSpan)'),ds(t,"slurSpan",'NoteOptions.slurSpan was removed. Use addConnective("slur", slurSpan)')}function Cs(t){s.RB.assert(n.I8.isObject(t),n.I8.isStringOrUndefined(t.staffPos)||n.I8.isInteger(t.staffPos)||t.staffPos instanceof o.Note,n.I8.isStringOrUndefined(t.color),n.I8.isBooleanOrUndefined(t.hide)),ds(t,"dotted","RestOptions.dotted was removed."),ds(t,"triplet","RestOptions.triplet was removed.")}function Is(t){s.RB.assert(n.I8.isStringOrUndefined(t)||n.I8.isIntegerGte(t,0)||n.I8.isNonEmptyArray(t)&&t.every(t=>n.I8.isString(t)||n.I8.isIntegerGte(t,0)))}var As=class t{constructor(t){(0,a.Mu)(this,"doc"),(0,a.Mu)(this,"errorHandler",t=>{throw t}),(0,a.Mu)(this,"currentLyricsAlign","center"),s.RB.setClassConstructor("DocumentBuilder",t),null!=t||(t={}),function(t){s.RB.assert(n.I8.isObject(t),n.I8.isBooleanOrUndefined(t.showMeasureNumbers),n.I8.isStringOrUndefined(t.background),n.I8.isStringOrUndefined(t.color))}(t),this.doc=new ls(t)}setErrorHandler(t){return this.errorHandler=t,this}safe(t){try{t()}catch(e){this.errorHandler(e)}return this}setScoreConfiguration(t){return this.safe(()=>{s.RB.setClassFunc("DocumentBuilder","setScoreConfiguration",t),n.I8.isEnumValue(t,Rt)?this.doc.setScoreConfiguration(t):n.I8.isObject(t)&&"staff"===t.type?(fs(t),this.doc.setScoreConfiguration(t)):n.I8.isObject(t)&&"tab"===t.type?(ms(t),this.doc.setScoreConfiguration(t)):n.I8.isNonEmptyArray(t)?(t.forEach(t=>{n.I8.isObject(t)&&"staff"===t.type?fs(t):n.I8.isObject(t)&&"tab"===t.type?ms(t):s.RB.assert(!1)}),this.doc.setScoreConfiguration(t)):s.RB.assert(!1)})}getMeasure(){var e;return null!=(e=this.doc.getLastMeasure())?e:this.doc.addMeasure(t.DefaultMeasureOptions)}getDocument(){return this.getMeasure(),this.doc.getMusicInterface()}setHeader(t,e,i){return this.safe(()=>{s.RB.setClassFunc("DocumentBuilder","setHeader",t,e,i),s.RB.assert(n.I8.isStringOrUndefined(t),n.I8.isStringOrUndefined(e),n.I8.isStringOrUndefined(i)),this.doc.setHeader(t,e,i)})}setMeasuresPerRow(t){return this.safe(()=>{s.RB.setClassFunc("DocumentBuilder","setMeasuresPerRow",t),s.RB.assert(n.I8.isIntegerGte(t,1)||n.I8.isPosInfinity(t)),this.doc.setMeasuresPerRow(t)})}addMeasure(t){return this.safe(()=>{s.RB.setClassFunc("DocumentBuilder","addMeasure",t),null!=t||(t={}),function(t){s.RB.assert(n.I8.isObject(t),n.I8.isBooleanOrUndefined(t.showNumber))}(t),this.doc.addMeasure(t)})}setKeySignature(...t){return this.safe(()=>{s.RB.setClassFunc("DocumentBuilder","setKeySignature",...t),s.RB.assert(t[0]instanceof o.Scale||t[0]instanceof o.KeySignature||n.I8.isNonEmptyString(t[0])&&n.I8.isNonEmptyStringOrUndefined(t[1])),this.getMeasure().setKeySignature(...t)})}setTimeSignature(...t){return this.safe(()=>{s.RB.setClassFunc("DocumentBuilder","setTimeSignature",...t),"C"===t[0]||"C|"===t[0]?this.getMeasure().setTimeSignature(new o.TimeSignature(t[0])):t[0]instanceof o.TimeSignature?this.getMeasure().setTimeSignature(t[0]):n.I8.isEnumValue(t[0],o.TimeSignatures)&&n.I8.isEnumValueOrUndefined(t[1],o.BeamGrouping)?this.getMeasure().setTimeSignature(new o.TimeSignature(t[0],t[1])):n.I8.isIntegerGte(t[0],1)&&n.I8.isIntegerGte(t[1],1)&&n.I8.isEnumValueOrUndefined(t[2],o.BeamGrouping)?this.getMeasure().setTimeSignature(new o.TimeSignature(t[0],t[1],t[2])):s.RB.assert(!1)})}setTempo(t,e){return this.safe(()=>{s.RB.setClassFunc("DocumentBuilder","setTempo",t,e),s.RB.assert(n.I8.isIntegerGte(t,1),n.I8.isUndefined(e)||o.isNoteLength(e)),this.getMeasure().setTempo(t,e)})}addNote(t,e,i,a){return this.safe(()=>{s.RB.setClassFunc("DocumentBuilder","addNote",t,e,i,a),s.RB.assert(Tt(t),e instanceof o.Note||n.I8.isNonEmptyString(e)||n.I8.isArray(e)&&e.every(t=>t instanceof o.Note||n.I8.isNonEmptyString(t)),o.isNoteLength(i));const r=null!=a?a:{};if(ps(r),n.I8.isArray(e)){let s=r.string;e.forEach((e,o)=>{r.string=n.I8.isArray(s)?s[o]:s,this.getMeasure().addNoteGroup(t,[e],i,a)})}else this.getMeasure().addNoteGroup(t,[e],i,a)})}addChord(t,e,i,a){return this.safe(()=>{s.RB.setClassFunc("DocumentBuilder","addChord",t,e,i,a),s.RB.assert(Tt(t),n.I8.isNonEmptyArray(e)&&e.every(t=>t instanceof o.Note||n.I8.isNonEmptyString(t)),o.isNoteLength(i)),null!=a||(a={}),ps(a),this.getMeasure().addNoteGroup(t,e,i,a)})}addRest(t,e,i){return this.safe(()=>{s.RB.setClassFunc("DocumentBuilder","addRest",t,e,i),s.RB.assert(Tt(t),o.isNoteLength(e)),null!=i||(i={}),Cs(i),this.getMeasure().addRest(t,e,i)})}addTuplet(t,e,i){return this.safe(()=>{s.RB.setClassFunc("DocumentBuilder","addTuplet",t,e),s.RB.assert(Tt(t),n.I8.isFunction(i),o.isTupletRatio(e)&&n.I8.isBooleanOrUndefined(e.showRatio));let a=[];const r={addNote:(i,h,c)=>{if(s.RB.setClassFunc("DocumentBuilder","addTuplet => addNote",i,h,c),s.RB.assert(i instanceof o.Note||n.I8.isNonEmptyString(i)||n.I8.isArray(i)&&i.every(t=>t instanceof o.Note||n.I8.isNonEmptyString(t)),o.isNoteLength(h)),null!=c||(c={}),ps(c),n.I8.isArray(i)){let s=c.string;i.forEach((i,o)=>{c.string=n.I8.isArray(s)?s[o]:s;let r=this.getMeasure().addNoteGroup(t,[i],h,c,e);a.push(r)})}else{let s=this.getMeasure().addNoteGroup(t,[i],h,c,e);a.push(s)}return r},addChord:(i,h,c)=>{s.RB.setClassFunc("DocumentBuilder","addTuplet => addChord",i,h,c),s.RB.assert(n.I8.isNonEmptyArray(i)&&i.every(t=>t instanceof o.Note||n.I8.isNonEmptyString(t)),o.isNoteLength(h)),null!=c||(c={}),ps(c);let u=this.getMeasure().addNoteGroup(t,i,h,c,e);return a.push(u),r},addRest:(i,n)=>{s.RB.setClassFunc("DocumentBuilder","addTuplet => addRest",i,n),s.RB.assert(o.isNoteLength(i)),null!=n||(n={}),Cs(n);let h=this.getMeasure().addRest(t,i,n,e);return a.push(h),r}};i(r),mt.createTuplet(a,e)})}addLyricsInternal(t,e,i,a,r){Is(t),s.RB.assert(jt(e),n.I8.isEnumValue(a,o.NoteLength),n.I8.isString(i)||n.I8.isArray(i)&&i.every(t=>n.I8.isString(t))),null!=r||(r={}),function(t){s.RB.assert(n.I8.isObject(t),n.I8.isEnumValueOrUndefined(t.align,Vt),n.I8.isEnumValueOrUndefined(t.hyphen,Zt))}(r),void 0!==r.align?this.currentLyricsAlign=r.align:null!=r.align||(r.align=this.currentLyricsAlign),n.I8.isArray(i)?i.forEach(i=>this.getMeasure().addLyrics(t,e,i,a,r)):this.getMeasure().addLyrics(t,e,i,a,r)}addLyrics(t,e,i,n){return this.safe(()=>{s.RB.setClassFunc("DocumentBuilder","addLyrics",t,i,e,n),this.addLyricsInternal(void 0,t,e,i,n)})}addLyricsTo(t,e,i,n,a){return this.safe(()=>{s.RB.setClassFunc("DocumentBuilder","addLyricsTo",e,n,i,a),this.addLyricsInternal(t,e,i,n,a)})}addFermata(t="atNote"){return this.safe(()=>{(0,s.S2)("addFermata() is deprecated. Will be removed in future release. Use addAnnotation() instead."),s.RB.setClassFunc("DocumentBuilder","addFermata",t),s.RB.assert(n.I8.isEnumValue(t,qt)),"atNote"===t?this.addAnnotation("fermata",{}):"atMeasureEnd"===t&&this.addAnnotation("fermata",{anchor:"rightBarLine"})})}addFermataTo(t,e="atNote"){return this.safe(()=>{(0,s.S2)("addFermataTo() is deprecated. Will be removed in future release. Use addAnnotationTo() instead."),s.RB.setClassFunc("DocumentBuilder","addFermataTo",t,e),Is(t),s.RB.assert(n.I8.isEnumValue(e,qt)),"atNote"===e?this.addAnnotationTo(t,"fermata",{}):"atMeasureEnd"===e&&this.addAnnotationTo(t,"fermata",{anchor:"rightBarLine"})})}addNavigation(t,...e){return this.safe(()=>{s.RB.setClassFunc("DocumentBuilder","addNavigation",t,...e),this.addAnnotationInternal(void 0,"navigation",t,...e)})}addNavigationTo(t,e,...i){return this.safe(()=>{s.RB.setClassFunc("DocumentBuilder","addNavigationTo",t,e,...i),this.addAnnotationInternal(t,"navigation",e,...i)})}addAnnotationInternal(t,...e){Is(t);let i=n.I8.isObject(e[e.length-1])?e.pop():{};var a;a=i,s.RB.assert(n.I8.isObject(a),n.I8.isEnumValueOrUndefined(a.group,Kt),n.I8.isEnumValueOrUndefined(a.anchor,Jt),n.I8.isUndefined(a.repeatCount)||n.I8.isIntegerGte(a.repeatCount,1),n.I8.isUndefined(a.endingPassages)||n.I8.isIntegerGte(a.endingPassages,1)||n.I8.isArray(a.endingPassages)&&a.endingPassages.every(t=>n.I8.isIntegerGte(t,1)),n.I8.isNonEmptyStringOrUndefined(a.labelText),n.I8.isStringOrUndefined(a.color));let o=i.group;if(!o){let t=(0,s.bm)(String(e[0]),Kt);t&&(e.shift(),o=t)}let r=String(e.shift());if(!o){let t=(h=r,ot.get(at(h)));void 0!==t&&(o=nt(t),r=t)}var h;s.RB.assert(n.I8.isEnumValue(o,Kt),n.I8.isNonEmptyString(r)),"label"===o&&n.I8.isNullish(i.labelText)&&n.I8.isNonEmptyString(e[0])&&(i.labelText=n.I8.isNullish(e[0])?void 0:String(e.shift())),"endRepeat"===r&&n.I8.isNullish(i.repeatCount)&&n.I8.isIntegerGte(e[0],2)&&(i.repeatCount=n.I8.isNullish(e[0])?void 0:Number(e.shift())),"ending"===r&&n.I8.isNullish(i.endingPassages)&&e.every(t=>n.I8.isIntegerGte(t,1))&&(i.endingPassages=e.length>0?[...e.map(t=>Number(t))]:1),this.getMeasure().addAnnotation(t,o,r,i)}addAnnotation(...t){return this.safe(()=>{s.RB.setClassFunc("DocumentBuilder","addAnnotation",...t),this.addAnnotationInternal(void 0,...t)})}addAnnotationTo(t,...e){return this.safe(()=>{s.RB.setClassFunc("DocumentBuilder","addAnnotationTo",t,...e),this.addAnnotationInternal(t,...e)})}addLabel(t,e){return this.safe(()=>{s.RB.setClassFunc("DocumentBuilder","addLabel",t,e),s.RB.assert(n.I8.isEnumValue(t,Ht),n.I8.isNonEmptyString(e)),"chord"===t?this.addAnnotation("chordLabel",e):"note"===t&&this.addAnnotation("pitchLabel",e)})}addLabelTo(t,e,i){return this.safe(()=>{s.RB.setClassFunc("DocumentBuilder","addLabelTo",t,e,i),Is(t),s.RB.assert(n.I8.isEnumValue(e,Ht),n.I8.isNonEmptyString(i)),"chord"===e?this.addAnnotationTo(t,"chordLabel",i):"note"===e&&this.addAnnotationTo(t,"pitchLabel",i)})}addConnective(t,...e){return this.safe(()=>{if(s.RB.setClassFunc("DocumentBuilder","addConnective",t,...e),s.RB.assert(n.I8.isEnumValue(t,Ut)),"tie"===t){s.RB.assert(n.I8.isIntegerOrUndefined(e[0])||n.I8.isEnumValue(e[0],Wt)),s.RB.assert(n.I8.isEnumValueOrUndefined(e[1],Yt));let i=e[0],a=e[1];this.getMeasure().addConnective(t,i,a)}else if("slur"===t){s.RB.assert(n.I8.isIntegerOrUndefined(e[0])),s.RB.assert(n.I8.isEnumValueOrUndefined(e[1],Yt));let i=e[0],a=e[1];this.getMeasure().addConnective(t,i,a)}else if("slide"===t){s.RB.assert(n.I8.isEnumValueOrUndefined(e[0],Yt));let i=e[0];this.getMeasure().addConnective(t,i)}})}addExtension(t){return this.safe(()=>{s.RB.setClassFunc("DocumentBuilder","addExtension"),s.RB.assertMsg(n.I8.isFunctionOrUndefined(t),"addExtension() has new usage, e.g. addExtension(ext => ext.measures(2)).");let e=0,i=!0;const a={notes:(t,i)=>(s.RB.setClassFunc("DocumentBuilder","addExtension.notes",t,i),s.RB.assert(o.isNoteLength(t)),s.RB.assert(n.I8.isUndefined(i)||n.I8.isNumber(i)&&i>=0),e+=o.RhythmProps.get(t).ticks*(null!=i?i:1),a),measures:t=>(s.RB.setClassFunc("DocumentBuilder","addExtension.measures",t),s.RB.assert(n.I8.isNumber(t)&&t>=1),e+=this.getMeasure().getMeasureTicks()*t,a),infinity:()=>(s.RB.setClassFunc("DocumentBuilder","addExtension.infinity"),e=1/0,a),hide:()=>(s.RB.setClassFunc("DocumentBuilder","addExtension.hide"),i=!1,a)};t?t(a):e=1/0,this.getMeasure().addExtension(e,i)})}addStaffGroup(t,e,i="auto"){return this.safe(()=>{s.RB.setClassFunc("DocumentBuilder","addStaffGroup",t,e,i),s.RB.assert(n.I8.isNonEmptyString(t),n.I8.isNonEmptyString(e)||n.I8.isIntegerGte(e,0)||n.I8.isNonEmptyArray(e)&&e.every(t=>n.I8.isNonEmptyString(t)||n.I8.isIntegerGte(t,0)),n.I8.isEnumValue(i,zt)),this.doc.addStaffGroup(t,e,i)})}endSong(){return this.safe(()=>{s.RB.setClassFunc("DocumentBuilder","endSong"),this.getMeasure().endSong()})}endSection(){return this.safe(()=>{s.RB.setClassFunc("DocumentBuilder","endSection"),this.getMeasure().endSection()})}endRow(){return this.safe(()=>{var t;s.RB.setClassFunc("DocumentBuilder","endRow"),null==(t=this.doc.getLastMeasure())||t.endRow()})}fillWithRests(...t){return this.safe(()=>{s.RB.setClassFunc("DocumentBuilder","fillWithRests",...t),s.RB.assert(n.I8.isArray(t)&&t.every(t=>Tt(t))),this.getMeasure().fillWithRests(...t)})}addScaleArpeggio(t,e,i){return this.safe(()=>{s.RB.setClassFunc("DocumentBuilder","addScaleArpeggio",t,e,i),s.RB.assert(n.I8.isNonEmptyString(e),n.I8.isIntegerGte(i,1));let a=this.getMeasure().getTimeSignature(),r=t.getScaleNotes(e,i);for(let t=0;t<r.length;t++){t%a.beatCount===0&&t>0&&this.addMeasure();let e=r[t];this.addNote(0,e,a.beatLength),this.addAnnotation("pitchLabel",e.formatOmitOctave(o.SymbolSet.Unicode))}})}repeat(t,e){return this.safe(()=>{s.RB.setClassFunc("DocumentBuilder","repeat",e),s.RB.assert(n.I8.isIntegerGte(t,0),n.I8.isFunction(e));for(let i=0;i<t;i++)e(this)})}};(0,a.Mu)(As,"DefaultMeasureOptions",{});var bs=As,ys=class t{constructor(t){this.type=t,(0,a.Mu)(this,"kind","ScoreEvent")}static is(e){return e instanceof t||n.OZ.Obj.isObject(e)&&n.OZ.Obj.hasProperties(e,["kind","type"])&&"ScoreEvent"===e.kind}},vs=class t extends ys{constructor(t,e,i,s,n,r){super(t),this.view=e,this.staff=i,this.measure=s,this.diatonicId=n,this.accidental=r,(0,a.Mu)(this,"kind","ScoreStaffEvent"),(0,a.Mu)(this,"_note"),this._note=new o.Note(n,r)}static is(e){return e instanceof t||n.OZ.Obj.isObject(e)&&n.OZ.Obj.hasProperties(e,["kind","type","view","staff","measure","diatonicId","accidental"])&&"ScoreStaffEvent"===e.kind}get noteName(){return this._note.format(o.PitchNotation.Scientific,o.SymbolSet.Ascii)}get diatonicClass(){return this._note.diatonicClass}get chromaticId(){return this._note.chromaticId}get chromaticClass(){return this._note.chromaticClass}get midiNumber(){return this._note.midiNumber}},ws=class t extends ys{constructor(t,e,i){super(t),this.view=e,this.tab=i,(0,a.Mu)(this,"kind","ScoreTabEvent")}static is(e){return e instanceof t||n.OZ.Obj.isObject(e)&&n.OZ.Obj.hasProperties(e,["kind","type","view","tab"])&&"ScoreTabEvent"===e.kind}},Ms=class extends ys{constructor(t,e,i,s){super(t),this.view=e,this.scoreRow=i,this.diatonicId=s}get renderContext(){return(0,s.S2)("renderContext is deprecated. Will be removed in future release. Use view instead."),this.view}},Ns=class t extends ys{constructor(t,e,i){if(super(t),this.view=e,this.objects=i,(0,a.Mu)(this,"kind","ScoreObjectEvent"),0===arguments.length)throw new D("Empty objects array in ScoreObjectEvent!")}static is(e){return e instanceof t||n.OZ.Obj.isObject(e)&&n.OZ.Obj.hasProperties(e,["kind","type","view","objects"])&&"ScoreObjectEvent"===e.kind}get renderContext(){return(0,s.S2)("renderContext is deprecated. Will be removed in future release. Use view instead."),this.view}get topObject(){return this.objects[this.objects.length-1]}findObject(t,e=!1){if(e){for(let i=this.objects.length-1;i>=0;i--)if(t(this.objects[i]))return this.objects[i]}else for(let i=0;i<this.objects.length;i++)if(t(this.objects[i]))return this.objects[i]}},Ss="undefined"!=typeof HTMLElement?HTMLElement:class{},Rs=class extends Ss{constructor(){super(),(0,a.Mu)(this,"_canvas"),(0,a.Mu)(this,"_view"),(0,a.Mu)(this,"_doc"),(0,a.Mu)(this,"_paint"),(0,a.Mu)(this,"_connected",!1),this._view=new ns,"undefined"!=typeof document&&(this._canvas=document.createElement("canvas"),n.OZ.Dom.addClass(this._canvas,"wms-canvas"),this._view.setCanvas(this._canvas))}static get observedAttributes(){return["src","zoom","staff-size"]}attributeChangedCallback(t,e,i){var s,n;"src"===t&&i&&this.loadFromUrl(i),"zoom"===t&&i&&(null==(s=this._view)||s.setZoom(+i)),"staff-size"===t&&i&&(null==(n=this._view)||n.setStaffSize(i))}connectedCallback(){this._connected||(this._connected=!0,this._canvas&&this.append(this._canvas),this.update())}disconnectedCallback(){this._connected=!1}adoptedCallback(){}get wmsView(){return this._view}set doc(t){this._doc=t,this.update()}get doc(){return this._doc}set paint(t){this._paint=t,this.update()}get paint(){return this._paint}update(){var t;this._connected&&this._view&&(this._doc&&this._view.setDocument(this._doc),this._paint&&this._view.setPaint(this._paint),null==(t=this._view)||t.draw())}loadFromUrl(t){}};function Ls(){if("undefined"!=typeof document&&"undefined"!=typeof customElements)try{customElements.get("wms-view")||customElements.define("wms-view",Rs)}catch(t){}}function xs(t){return"undefined"!=typeof document&&"undefined"!=typeof customElements&&(n.OZ.Obj.isObject(t)&&n.OZ.Obj.hasProperties(t,["tagName"])&&"WMS-VIEW"===t.tagName)}},3774(t,e,i){i.r(e),i.d(e,{createAll:()=>h,createAndanteByDiabelli:()=>n,createCanonInD:()=>a,createFrereJacques:()=>o,createGreensleeves:()=>r});i(6362);var s=i(9041);function n(){return(new s.DocumentBuilder).setScoreConfiguration("guitarTreble").setHeader("Andante","A. Diabelli").addMeasure().setKeySignature("D","Major").setTimeSignature("3/4").setTempo(80).addRest(0,"8n",{staffPos:"G4"}).addAnnotation("dynamics","p").addNote(0,"F#4","8n",{stem:"up"}).addNote(0,"G4","8n").addConnective("slur",2,"below").addNote(0,"F#4","8n").addNote(0,"E4","8n").addNote(0,"D4","8n").addNote(1,"D3","2.",{stem:"down"}).addMeasure().addNote(0,"C#4","8n").addConnective("slur",2,"below").addNote(0,"D4","8n").addNote(0,"E4","8n").addNote(0,"F#4","8n").addNote(0,"G4","4n").addNote(1,"A2","2.").addMeasure().addRest(0,"8n",{staffPos:"B3"}).addAnnotation("dynamics","f").addNote(0,"A3","8n").addNote(0,"G#3","8n").addConnective("slur",2,"below").addNote(0,"A3","8n").addNote(0,"B3","8n").addNote(0,"C#4","8n").addNote(1,"A2","2.").endRow().addMeasure().addNote(0,"D4","8n",{string:3}).addNote(0,"E4","8n").addNote(0,"F#4","8n").addNote(0,"G4","8n").addNote(0,"A4","4n").addNote(1,"D3","2.").addMeasure().addRest(0,"8n",{staffPos:"G4"}).addAnnotation("dynamics","p").addNote(0,"F#4","8n").addNote(0,"G4","8n").addConnective("slur",2,"below").addNote(0,"F#4","8n").addNote(0,"E4","8n").addNote(0,"D4","8n").addNote(1,"D3","2.").addMeasure().addNote(0,"C#4","8n").addConnective("slur",2,"below").addNote(0,"D4","8n").addNote(0,"E4","8n").addNote(0,"F#4","8n").addNote(0,"G4","4n").addNote(1,"A2","2.").endRow().addMeasure().addRest(0,"8n",{staffPos:"B3"}).addAnnotation("dynamics","f").addNote(0,"A3","8n").addNote(0,"G#3","8n").addConnective("slur",2,"below").addNote(0,"A3","8n").addNote(0,"B3","8n").addNote(0,"C#4","8n").addNote(1,"A2","2.").addMeasure().addNote(0,"D4","4n").addRest(1,"4n",{staffPos:"D3"}).addNote(0,"D3","4n").addNote(1,"D3","4n").addRest(1,"4n",{staffPos:"B3"}).addNavigation("endRepeat").addMeasure().addRest(0,"8n",{staffPos:"D4"}).addAnnotation("dynamics","f").addNote(0,"D4","8n").addNote(0,"E4","8n").addConnective("slur",2,"below").addNote(0,"D4","8n").addNote(0,"C#4","8n").addNote(0,"B3","8n").addNote(1,"E2","2.").endRow().addMeasure().addNote(0,"C#4","8n").addConnective("slur",2,"below").addNote(0,"D4","8n").addNote(0,"E4","8n").addNote(0,"F#4","8n").addNote(0,"E4","4n").addNote(1,"A2","2.").addMeasure().addRest(0,"8n",{staffPos:"B3"}).addAnnotation("dynamics","p").addNote(0,"E3","8n").addNote(0,"D#3","8n").addConnective("slur",2,"below").addNote(0,"E3","8n").addNote(0,"F#3","8n").addNote(0,"G#3","8n").addNote(1,"E2","2.").addMeasure().addNote(0,"A3","8n").addConnective("slur",2,"below").addNote(0,"G#3","8n").addNote(0,"A3","8n").addNote(0,"B3","8n").addNote(0,"C#4","4n").addNote(1,"A2","2.").endRow().addMeasure().addRest(0,"8n",{staffPos:"G4"}).addAnnotation("dynamics","f").addNote(0,"G4","8n").addNote(0,"A4","8n").addConnective("slur",2,"below").addNote(0,"G4","8n").addNote(0,"F#4","8n").addNote(0,"E4","8n").addNote(1,"A2","2.").addMeasure().addNote(0,"D4","8n").addNote(0,"C#4","8n").addNote(0,"D4","8n").addNote(0,"E4","8n").addNote(0,"F#4","4n").addNote(1,"D3","2.").addMeasure().addRest(0,"8n",{staffPos:"B3"}).addAnnotation("dynamics","ff").addNote(0,"A3","8n").addNote(0,"G#3","8n").addConnective("slur",2,"below").addNote(0,"A3","8n").addNote(0,"B3","8n").addNote(0,"C#4","8n").addNote(1,"A2","2.").addMeasure().addNote(0,"D4","4n").addRest(1,"4n",{staffPos:"D3"}).addNote(0,"D3","4n").addNote(1,"D3","4n").addRest(1,"4n",{staffPos:"B3"}).endSong().getDocument()}function a(){return(new s.DocumentBuilder).setHeader("Canon in D","Pachelbel").setScoreConfiguration([{type:"staff",clef:"G",voiceId:0,instrument:"Piano"},{type:"staff",clef:"F",voiceId:1,instrument:"Piano"}]).addMeasure().setKeySignature("D Major").setTimeSignature("4/4").setTempo(50,"2n").fillWithRests(0).addNote(1,["D3","F#3","A3","D4"],"8n").addNote(1,["A2","C#3","E3","A3"],"8n").addMeasure({showNumber:!0}).fillWithRests(0).addNote(1,["B2","D3","F#3","B3"],"8n").addNote(1,["F#2","A2","C#3","F#3"],"8n").addMeasure().fillWithRests(0).addNote(1,["G2","B2","D3","G3"],"8n").addNote(1,["D2","F#2","A2","D3"],"8n").addMeasure({showNumber:!0}).fillWithRests(0).addNote(1,["G2","B2","D3","G3"],"8n").addNote(1,["A2","C#3","E3","A3"],"8n").addMeasure().addNote(0,["F#5","E5"],"2n").addNote(1,["D3","F#3","A3","D4"],"8n").addNote(1,["A2","C#3","E3","A3"],"8n").endRow().addMeasure({showNumber:!0}).addNote(0,["D5","C#5"],"2n").addNote(1,["B2","D3","F#3","B3"],"8n").addNote(1,["F#2","A2","C#3","F#3"],"8n").addMeasure().addNote(0,["B4","A4"],"2n").addNote(1,["G2","B2","D3","G3"],"8n").addNote(1,["D2","F#2","A2","D3"],"8n").addMeasure({showNumber:!0}).addNote(0,["B4","C#5"],"2n").addNote(1,["G2","B2","D3","G3"],"8n").addNote(1,["A2","C#3","E3","A3"],"8n").addMeasure().addChord(0,["F#5","D5"],"2n").addChord(0,["E5","C#5"],"2n").addNote(1,["D3","F#3","A3","D4"],"8n").addNote(1,["A2","C#3","E3","A3"],"8n").addMeasure({showNumber:!0}).addChord(0,["D5","B4"],"2n").addChord(0,["C#5","A4"],"2n").addNote(1,["B2","D3","F#3","B3"],"8n").addNote(1,["F#2","A2","C#3","F#3"],"8n").endRow().addMeasure({showNumber:!1}).addChord(0,["B4","G4"],"2n").addChord(0,["A4","F#4"],"2n").addNote(1,["G2","B2","D3","G3"],"8n").addNote(1,["D2","F#2","A2","D3"],"8n").addMeasure({showNumber:!0}).addChord(0,["B4","G4"],"2n").addChord(0,["C#5","A4"],"2n").addNote(1,["G2","B2","D3","G3"],"8n").addNote(1,["A2","C#3","E3","A3"],"8n").addMeasure().addNote(0,["D4","F#4","A4","G4"],"4n").addNote(1,["D3","A2"],"2n").addMeasure({showNumber:!0}).addNote(0,["F#4","D4","F#4","E4"],"4n").addNote(1,["B2","F#2"],"2n").addMeasure().addNote(0,["D4","B3","D4","A4"],"4n").addNote(1,["G2","D2"],"2n").addMeasure({showNumber:!0}).addNote(0,["G4","B4","A4","G4"],"4n").addNote(1,["G2","A2"],"2n").addMeasure().addNote(0,["F#4","D4","E4","C#5"],"4n").addNote(1,["D3","A2"],"2n").endRow().addMeasure({showNumber:!0}).addNote(0,["D5","F#5","A5","A4"],"4n").addNote(1,["B2","F#2"],"2n").addMeasure().addNote(0,["B4","G4","A4","F#4"],"4n").addNote(1,["G2","D2"],"2n").addMeasure({showNumber:!0}).addNote(0,["D4","D5","C#5"],"4n").addRest(0,"4n").addNote(1,["G2","A2"],"2n").addMeasure().addNote(0,["D5","C#5","D5","D4"],"8n").addNote(0,["C#4","A4","E4","F#4"],"8n").addNote(1,["D3","A2"],"2n").addMeasure({showNumber:!0}).addNote(0,["D4","D5","C#5","B4"],"8n").addNote(0,["C#5","F#5","A5","B5"],"8n").addNote(1,["B2","F#2"],"2n").addMeasure().addNote(0,["G5","F#5","E5","G5"],"8n").addNote(0,["F#5","E5","D5","C#5"],"8n").addNote(1,["G2","D2"],"2n").endRow().addMeasure({showNumber:!0}).addNote(0,["B4","A4","G4","F#4"],"8n").addNote(0,["E4","G4","F#4","E4"],"8n").addNote(1,["G2","A2"],"2n").addMeasure().addNote(0,["D4","E4","F#4","G4"],"8n").addNote(0,["A4","E4","A4","G4"],"8n").addNote(1,["D3","A2"],"2n").addMeasure({showNumber:!0}).addNote(0,["F#4","B4","A4","G4"],"8n").addNote(0,["A4","G4","F#4","E4"],"8n").addNote(1,["B2","F#2"],"2n").addMeasure().addNote(0,["D4","B3","B4","C#5"],"8n").addNote(0,["D5","C#5","B4","A4"],"8n").addNote(1,["G2","D2"],"2n").addMeasure({showNumber:!0}).addNote(0,["G4","F#4","E4","B4"],"8n").addNote(0,["A4","B4","A4","G4"],"8n").addNote(1,["G2","A2"],"2n").endRow().addMeasure({showNumber:!1}).addNote(0,"F#4","4n").addNote(0,"F#5","4n").addNote(0,"E5","2n").addNote(1,["D3","A2"],"2n").addMeasure({showNumber:!0}).addRest(0,"4n",{staffPos:"B4"}).addNote(0,"D5","4n").addNote(0,"F#5","2n").addNote(1,["B2","F#2"],"2n").addMeasure().addNote(0,["B5","A5"],"2n").addNote(1,["G2","D2"],"2n").addMeasure({showNumber:!0}).addNote(0,["B5","C#6"],"2n").addNote(1,["G2","A2"],"2n").addMeasure().addNote(0,["D6","D5"],"4n").addNote(0,"C#5","2n").addNote(1,["D3","A2"],"2n").addMeasure({showNumber:!0}).addRest(0,"4n",{staffPos:"B4"}).addNote(0,"B4","4n").addNote(0,"D5","2n").addNote(1,["B2","F#2"],"2n").addMeasure().addNote(0,"D5","2n").addRest(0,"4n",{staffPos:"B4"}).addNote(0,"D5","4n").addNote(1,["G2","D2"],"2n").addMeasure({showNumber:!0}).addNote(0,["D5","F#5","E5","A5"],"4n").addNote(1,["G2","A2"],"2n").endRow().addMeasure({showNumber:!1}).addNote(0,"A5","8n").addNote(0,["F#5","G5"],"16n").addNote(0,"A5","8n").addNote(0,["F#5","G5"],"16n").addNote(0,["A5","A4","B4","C#5"],"16n").addNote(0,["D5","E5","F#5","G5"],"16n").addNote(1,["D3","A2"],"2n").addMeasure({showNumber:!0}).addNote(0,"F#5","8n").addNote(0,["D5","E5"],"16n").addNote(0,"F#5","8n").addNote(0,["F#4","G4"],"16n").addNote(0,["A4","B4","A4","G4"],"16n").addNote(0,["A4","F#4","G4","A4"],"16n").addNote(1,["B2","F#2"],"2n").addMeasure().addNote(0,"G4","8n").addNote(0,["B4","A4"],"16n").addNote(0,"G4","8n").addNote(0,["F#4","E4"],"16n").addNote(0,["F#4","E4","D4","E4"],"16n").addNote(0,["F#4","G4","A4","B4"],"16n").addNote(1,["G2","D2"],"2n").endRow().addMeasure({showNumber:!0}).addNote(0,"G4","8n").addNote(0,["B4","A4"],"16n").addNote(0,"B4","8n").addNote(0,["C#5","D5"],"16n").addNote(0,["A4","B4","C#5","D5"],"16n").addNote(0,["E5","F#5","G5","A5"],"16n").addNote(1,["G2","A2"],"2n").addMeasure().addNote(0,"F#5","8n").addNote(0,["D5","E5"],"16n").addNote(0,"F#5","8n").addNote(0,["E5","D5"],"16n").addNote(0,["E5","C#5","D5","E5"],"16n").addNote(0,["F#5","E5","D5","C#5"],"16n").addNote(1,["D3","A2"],"2n").addMeasure({showNumber:!0}).addNote(0,"D5","8n").addNote(0,["B4","C#5"],"16n").addNote(0,"D5","8n").addNote(0,["D4","E4"],"16n").addNote(0,["F#4","G4","F#4","E4"],"16n").addNote(0,["F#4","D5","C#5","D5"],"16n").addNote(1,["B2","F#2"],"2n").endRow().addMeasure({showNumber:!1}).addNote(0,"B4","8n").addNote(0,["D5","C#5"],"16n").addNote(0,"B4","8n").addNote(0,["A4","G4"],"16n").addNote(0,["A4","G4","F#4","G4"],"16n").addNote(0,["A4","B4","C#5","D5"],"16n").addNote(1,["G2","D2"],"2n").addMeasure({showNumber:!0}).addNote(0,"B4","8n").addNote(0,["D5","C#5"],"16n").addNote(0,"D5","8n").addNote(0,["C#5","B4"],"16n").addNote(0,["C#5","D5","E5","D5"],"16n").addNote(0,["C#5","D5","B4","C#5"],"16n").addNote(1,["G2","A2"],"2n").addMeasure().addNavigation("startRepeat").addNote(0,"D5","4.").addNote(0,"A5","8n").addNote(0,["A5","B5","A5","G5"],"8n").addNote(1,["D3","A2"],"2n").addMeasure({showNumber:!0}).addNote(0,"F#5","4.").addNote(0,"F#5","8n").addNote(0,["F#5","G5","F#5","E5"],"8n").addNote(1,["B2","F#2"],"2n").endRow().addMeasure({showNumber:!1}).addNote(0,"D5","4.").addNote(0,"D5","8n").addNote(0,["D5","A5"],"4n").addNote(1,["G2","D2"],"2n").addMeasure({showNumber:!0}).addNote(0,["D5","C5","B5","C5"],"8n").addNote(0,"C#5","2n").addNote(1,["G2","A2"],"2n").addNavigation("endRepeat").addMeasure().addNote(0,"D5","1n").addNote(1,"D3","1n").getDocument()}function o(){return(new s.DocumentBuilder).setHeader("Fr\xe8re Jacques","Traditional").setScoreConfiguration([{type:"staff",clef:"G",voiceId:0,instrument:"!{Piano"},{type:"staff",clef:"F",voiceId:1,instrument:"!{Piano"}]).setMeasuresPerRow(2).addMeasure().setKeySignature("D Major").setTimeSignature("4/4").addNote(0,"D4","4n",{stem:"up"}).addLyrics(1,"Are","4n").addNote(0,"E4","4n").addLyrics(1,"you","4n").addNote(0,"F#4","4n").addLyrics(1,"sleep","4n",{hyphen:"-"}).addNote(0,"D4","4n").addLyrics(1,"ing?","4n").addRest(1,"1n",{staffPos:"F3"}).addMeasure().addNote(0,"D4","4n").addLyrics(1,"Are","4n").addNote(0,"E4","4n").addLyrics(1,"you","4n").addNote(0,"F#4","4n").addLyrics(1,"sleep","4n",{hyphen:"-"}).addNote(0,"D4","4n").addLyrics(1,"ing?","4n").addRest(1,"1n",{staffPos:"F3"}).addMeasure().addNavigation("startRepeat").addNote(0,"F#4","4n").addLyrics(1,"Bro","4n",{hyphen:"-"}).addNote(0,"G4","4n").addLyrics(1,"ther","4n").addNote(0,"A4","2n").addLyrics(1,"John?","4n").addNote(1,"D3","4n",{stem:"down"}).addLyricsTo(1,1,"Are","4n").addNote(1,"E3","4n").addLyricsTo(1,1,"you","4n").addNote(1,"F#3","4n").addLyricsTo(1,1,"sleep","4n",{hyphen:"-"}).addNote(1,"D3","4n").addLyricsTo(1,1,"ing?","4n").addMeasure().addNote(0,"F#4","4n").addLyrics(1,"Bro","4n",{hyphen:"-"}).addNote(0,"G4","4n").addLyrics(1,"ther","4n").addNote(0,"A4","2n").addLyrics(1,"John?","4n").addNote(1,"D3","4n").addLyricsTo(1,1,"Are","4n").addNote(1,"E3","4n").addLyricsTo(1,1,"you","4n").addNote(1,"F#3","4n").addLyricsTo(1,1,"sleep","4n",{hyphen:"-"}).addNote(1,"D3","4n").addLyricsTo(1,1,"ing?","4n").addMeasure().addNote(0,"A4","8n").addLyrics(1,"Morn","8n",{hyphen:"-"}).addNote(0,"B4","8n").addLyrics(1,"ing","8n").addNote(0,"A4","8n").addLyrics(1,"bells","8n").addNote(0,"G4","8n").addLyrics(1,"are","8n").addNote(0,"F#4","4n").addLyrics(1,"ring","4n",{hyphen:"-"}).addNote(0,"D4","4n").addLyrics(1,"ing!","4n").addNote(1,"F#3","4n").addLyricsTo(1,1,"Bro","4n",{hyphen:"-"}).addNote(1,"G3","4n").addLyricsTo(1,1,"ther","4n").addNote(1,"A3","2n").addLyricsTo(1,1,"John?","2n").addMeasure().addNote(0,"A4","8n").addLyrics(1,"Morn","8n",{hyphen:"-"}).addNote(0,"B4","8n").addLyrics(1,"ing","8n").addNote(0,"A4","8n").addLyrics(1,"bells","8n").addNote(0,"G4","8n").addLyrics(1,"are","8n").addNote(0,"F#4","4n").addLyrics(1,"ring","4n",{hyphen:"-"}).addNote(0,"D4","4n").addLyrics(1,"ing!","4n").addNote(1,"F#3","4n").addLyricsTo(1,1,"Bro","4n",{hyphen:"-"}).addNote(1,"G3","4n").addLyricsTo(1,1,"ther","4n").addNote(1,"A3","2n").addLyricsTo(1,1,"John?","2n").addMeasure().addNote(0,"D4","4n").addLyrics(1,"Ding","4n").addChord(0,["C#4","A4"],"4n").addLyrics(1,"ding","4n").addNote(0,"D4","4n").addLyrics(1,"dong!","4n").addRest(0,"4n").addNote(1,"A3","8n").addLyricsTo(1,1,"Morn","8n",{hyphen:"-"}).addNote(1,"B3","8n").addLyricsTo(1,1,"ing","8n").addNote(1,"A3","8n").addLyricsTo(1,1,"bells","8n").addNote(1,"G3","8n").addLyricsTo(1,1,"are","8n").addNote(1,"F#3","4n").addLyricsTo(1,1,"ring","4n",{hyphen:"-"}).addNote(1,"D3","4n").addLyricsTo(1,1,"ing!","4n").addMeasure().addNote(0,"D4","4n").addLyrics(1,"Ding","4n").addChord(0,["C#4","A4"],"4n").addLyrics(1,"ding","4n").addNote(0,"D4","4n").addLyrics(1,"dong!","4n").addRest(0,"4n").addNote(1,"A3","8n").addLyricsTo(1,1,"Morn","8n",{hyphen:"-"}).addNote(1,"B3","8n").addLyricsTo(1,1,"ing","8n").addNote(1,"A3","8n").addLyricsTo(1,1,"bells","8n").addNote(1,"G3","8n").addLyricsTo(1,1,"are","8n").addNote(1,"F#3","4n").addLyricsTo(1,1,"ring","4n",{hyphen:"-"}).addNote(1,"D3","4n").addLyricsTo(1,1,"ing!","4n").addMeasure().setMeasuresPerRow(4).addNote(0,"D4","4n").addLyrics(1,"Are","4n").addNote(0,"E4","4n").addLyrics(1,"you","4n").addNote(0,"F#4","4n").addLyrics(1,"sleep","4n",{hyphen:"-"}).addNote(0,"D4","4n").addLyrics(1,"ing?","4n").addNote(1,"D3","4n").addLyricsTo(1,1,"Ding","4n").addChord(1,["C#3","A3"],"4n").addLyricsTo(1,1,"ding","4n").addNote(1,"D3","4n").addLyricsTo(1,1,"dong!","4n").addRest(1,"4n").addMeasure().addNavigation("endRepeat").addNote(0,"D4","4n").addLyrics(1,"Are","4n").addNote(0,"E4","4n").addLyrics(1,"you","4n").addNote(0,"F#4","4n").addLyrics(1,"sleep","4n",{hyphen:"-"}).addNote(0,"D4","4n").addLyrics(1,"ing?","4n").addNote(1,"D3","4n").addLyricsTo(1,1,"Ding","4n").addChord(1,["C#3","A3"],"4n").addLyricsTo(1,1,"ding","4n").addNote(1,"D3","4n").addLyricsTo(1,1,"dong!","4n").addRest(1,"4n").addMeasure().addNote(0,"F#4","4n").addLyrics(1,"YES","4n").addNote(0,"D4","4n").addLyrics(1,"I'm","4n").addNote(0,"F#4","4n").addLyrics(1,"SLEEP","4n",{hyphen:"-"}).addNote(0,"D4","4n").addLyrics(1,"ING","4n").addNote(1,"A3","4n").addNote(1,"F#3","4n").addNote(1,"A3","4n").addNote(1,"F#3","4n").addMeasure().addNote(0,"A3","4n").addLyrics(1,"Please","4n").addNote(0,"C#4","8n").addLyrics(1,"GO","8n").addNote(0,"C#4","8n").addLyrics(1,"A","8n",{hyphen:"-"}).addNote(0,"D4","2n").addLyrics(1,"WAY!","4n").addNote(1,"D3","4n").addNote(1,"E3","4n").addNote(1,"F#3","2n").getDocument()}function r(){return(new s.DocumentBuilder).setScoreConfiguration("guitarTreble").setHeader("Greensleeves").addMeasure().setKeySignature("C","Major").setTimeSignature("6/8").setTempo(140).addNote(0,"A3","8n").addMeasure().addNavigation(s.Navigation.StartRepeat).addNote(0,"C4","4n",{stem:"up"}).addLabel("chord","Am").addNote(0,"D4","8n").addNote(0,"E4","8.").addNote(0,"F4","16n").addNote(0,"E4","8n").addNote(1,"A2","8n",{stem:"down"}).addNote(1,"E3","4n").addNote(1,"A2","8n").addNote(1,"E3","4n").addMeasure().addNote(0,"D4","4n",{stem:"up"}).addLabel("chord","G").addNote(0,"B3","8n").addNote(0,"G3","8.").addLabel("chord","Em").addNote(0,"A3","16n").addNote(0,"B3","8n").addNote(1,"G2","8n",{stem:"down"}).addNote(1,"D3","4n").addNote(1,"E2","8n").addNote(1,"B2","4n").addMeasure().addNote(0,"C4","4n",{stem:"up"}).addLabel("chord","Am").addNote(0,"A3","8n").addNote(0,"A3","8.").addLabel("chord","F").addNote(0,"G#3","16n").addNote(0,"A3","8n").addNote(1,"A2","8n",{stem:"down"}).addNote(1,"E3","4n").addNote(1,"F2","8n").addNote(1,"A2","4n").addMeasure().addNote(0,"B3","4n",{stem:"up"}).addLabel("chord","E").addNote(0,"G#3","8n").addNote(0,"E3","4n").addNote(0,"A3","8n").addNote(1,"E2","8n",{stem:"down"}).addNote(1,"B2","4n").addNote(1,"E2","8n").addNote(1,"B2","4n").endRow().addMeasure().addNote(0,"C4","4n",{stem:"up"}).addLabel("chord","Am").addNote(0,"D4","8n").addNote(0,"E4","8.").addNote(0,"F4","16n").addNote(0,"E4","8n").addNote(1,"A2","8n",{stem:"down"}).addNote(1,"E3","4n").addNote(1,"A2","8n").addNote(1,"E3","4n").addMeasure().addNote(0,"D4","4n",{stem:"up"}).addLabel("chord","G").addNote(0,"B3","8n").addNote(0,"G3","8.").addLabel("chord","Em").addNote(0,"A3","16n").addNote(0,"B3","8n").addNote(1,"G2","8n",{stem:"down"}).addNote(1,"D3","4n").addNote(1,"E2","8n").addNote(1,"B2","4n").addMeasure().addNote(0,"C4","8.",{stem:"up"}).addLabel("chord","Am").addNote(0,"B3","16n").addNote(0,"A3","8n").addNote(0,"G#3","8.").addLabel("chord","E").addNote(0,"F#3","16n").addNote(0,"G#3","8n").addNote(1,"A2","8n",{stem:"down"}).addNote(1,"E3","4n").addNote(1,"E2","8n").addNote(1,"B2","4n").addMeasure().addNote(0,"A3","4.",{stem:"up"}).addLabel("chord","Am").addNote(0,"A3","4.").addNote(1,"A2","8n",{stem:"down"}).addNote(1,"E3","8n").addNote(1,"C4","8n").addNote(1,"A2","4.").endRow().addMeasure().addChord(0,["C3","E3","G3","C4","G4"],"4.",{arpeggio:"up",stem:"up"}).addLabel("chord","C").addNote(0,"G4","8.").addNote(0,"F#4","16n").addNote(0,"E4","8n").addRest(1,"4.",{hide:!0}).addNote(1,"C3","8n",{stem:"down"}).addNote(1,"G3","4n").addMeasure().addNote(0,"D4","4n",{stem:"up"}).addLabel("chord","G").addNote(0,"B3","8n").addNote(0,"G3","8.").addLabel("chord","Em").addNote(0,"A3","16n").addNote(0,"B3","8n").addNote(1,"G2","8n",{stem:"down"}).addNote(1,"D3","4n").addNote(1,"E2","8n").addNote(1,"B2","4n").addMeasure().addNote(0,"C4","4n",{stem:"up"}).addLabel("chord","Am").addNote(0,"A3","8n").addNote(0,"A3","8.").addLabel("chord","F").addNote(0,"G#3","16n").addNote(0,"A3","8n").addNote(1,"A2","8n",{stem:"down"}).addNote(1,"E3","4n").addNote(1,"F2","8n").addNote(1,"A2","4n").addMeasure().addNote(0,"B3","4n",{stem:"up"}).addLabel("chord","E").addNote(0,"G#3","8n").addNote(0,"E3","4.").addNote(1,"E2","8n",{stem:"down"}).addNote(1,"B2","4n").addNote(1,"E2","8n").addNote(1,"B2","8n").addNote(1,"E3","8n").endRow().addMeasure().addNote(0,"G4","4.",{stem:"up"}).addLabel("chord","C").addNote(0,"G4","8.").addNote(0,"F#4","16n").addNote(0,"E4","8n").addNote(1,"C3","8n",{stem:"down"}).addNote(1,"G3","8n").addNote(1,"C4","8n").addNote(1,"C3","8n").addNote(1,"G3","4n").addMeasure().addNote(0,"D4","4n",{stem:"up"}).addLabel("chord","G").addNote(0,"B3","8n").addNote(0,"G3","8.").addLabel("chord","Em").addNote(0,"A3","16n").addNote(0,"B3","8n").addNote(1,"G2","8n",{stem:"down"}).addNote(1,"D3","4n").addNote(1,"E2","8n").addNote(1,"B2","4n").addMeasure().addNote(0,"C4","8.",{stem:"up"}).addLabel("chord","Am").addNote(0,"B3","16n").addNote(0,"A3","8n").addNote(0,"G#3","8.").addLabel("chord","E").addNote(0,"F#3","16n").addNote(0,"G#3","8n").addNote(1,"A2","8n",{stem:"down"}).addNote(1,"E3","4n").addNote(1,"E2","8n").addNote(1,"B2","4n").addMeasure().addNavigation("ending",1).addNavigation("endRepeat").addNote(0,"A3","4.",{stem:"up"}).addLabel("chord","Am").addNote(0,"A3","4n").addNote(0,"A3","8n").addNote(1,"A2","8n",{stem:"down"}).addNote(1,"E3","8n").addNote(1,"C4","8n").addNote(1,"A2","4.").addMeasure().addNavigation("ending",2).addNote(0,"A3","4.",{stem:"up"}).addLabel("chord","Am").addNote(0,"A3","4.").addAnnotation("fermata").addNote(1,"A2","8n",{stem:"down"}).addNote(1,"E3","8n").addNote(1,"C4","8n").addNote(1,"A2","4.").getDocument()}function h(){return[n(),a(),o(),r()]}},2175(t,e,i){i.r(e),i.d(e,{MusicScoreView:()=>l,PlaybackButtons:()=>d,WmsControls:()=>u,WmsView:()=>c});var s=i(7414),n=(i(3894),i(6362)),a=i(6540),o=i(9041),r=i(4848),h=i(5690),c=class extends a.Component{constructor(t){super(t),(0,n.Mu)(this,"view"),this.view=new o.WmsView,void 0!==t.paint&&this.view.setPaint(t.paint),void 0!==t.zoom&&this.view.setZoom(+t.zoom),void 0!==t.staffSize&&this.view.setStaffSize(t.staffSize),this.view.setDocument(t.doc),t.onScoreEvent&&this.view.setScoreEventListener(t.onScoreEvent)}componentDidUpdate(t,e){t.doc!==this.props.doc&&(this.view.setDocument(this.props.doc),this.view.draw()),void 0!==this.props.zoom&&t.zoom!==this.props.zoom&&(this.view.setZoom(+this.props.zoom),this.view.draw()),void 0!==this.props.staffSize&&t.staffSize!==this.props.staffSize&&(this.view.setStaffSize(this.props.staffSize),this.view.draw())}render(){return(0,r.jsx)("canvas",{style:{position:"relative"},ref:t=>{t&&(this.view.setCanvas(t),this.view.draw())},children:"Your browser does not support the HTML canvas tag."})}};var u=class extends a.Component{constructor(t){super(t),(0,n.Mu)(this,"state"),(0,n.Mu)(this,"buttonClass"),(0,n.Mu)(this,"buttonGroupClass"),(0,n.Mu)(this,"btnPlay"),(0,n.Mu)(this,"btnPause"),(0,n.Mu)(this,"btnStop");const e=new o.WmsControls;switch(t.player?e.setPlayer(t.player):t.doc&&e.setDocument(t.doc),this.state={controls:e},function(){if("undefined"==typeof window)return"unknown";const t=document.createElement("button");t.className="btn btn-primary",document.body.appendChild(t);const e=getComputedStyle(t).padding;return document.body.removeChild(t),e.includes("6px")&&e.includes("12px")?"bootstrap":""!==getComputedStyle(document.documentElement).getPropertyValue("--ifm-color-primary").trim()?"infima":"unknown"}()){case"bootstrap":this.buttonClass="btn btn-primary",this.buttonGroupClass="btn-group";break;case"infima":this.buttonClass="button button--primary",this.buttonGroupClass="ifm-button-group";break;default:this.buttonClass="wms-button",this.buttonGroupClass="wms-button-group"}}componentDidUpdate(t){this.props.doc!==t.doc&&this.state.controls.setDocument(this.props.doc)}render(){let{singlePlay:t,singlePlayStop:e,playStop:i,playLabel:s,pauseLabel:n,stopLabel:a}=this.props,{controls:h}=this.state;const{buttonClass:c,buttonGroupClass:u}=this;return null!=s||(s=o.WmsControls.DefaultPlayLabel),null!=n||(n=o.WmsControls.DefaultPauseLabel),null!=a||(a=o.WmsControls.DefaultStopLabel),this.btnPlay=this.btnPause=this.btnStop=void 0,t?(0,r.jsx)("div",{className:u,children:(0,r.jsx)("button",{className:c,ref:t=>{t&&(this.btnPlay=t,h.setSinglePlay(this.btnPlay,s))}})}):e?(0,r.jsx)("div",{className:u,children:(0,r.jsx)("button",{className:c,ref:t=>{t&&(this.btnPlay=t,h.setSinglePlayStop(t,s,a))}})}):i?(0,r.jsxs)("div",{className:u,children:[(0,r.jsx)("button",{className:c,ref:t=>{t&&(this.btnPlay=t,this.btnPlay&&this.btnStop&&h.setPlayStop(this.btnPlay,this.btnStop,s,a))}}),(0,r.jsx)("button",{className:c,ref:t=>{t&&(this.btnStop=t,this.btnPlay&&this.btnStop&&h.setPlayStop(this.btnPlay,this.btnStop,s,a))}})]}):(0,r.jsxs)("div",{className:u,children:[(0,r.jsx)("button",{className:c,ref:t=>{t&&(this.btnPlay=t,this.btnPlay&&this.btnPause&&this.btnStop&&h.setPlayPauseStop(this.btnPlay,this.btnPause,this.btnStop,s,n,a))}}),(0,r.jsx)("button",{className:c,ref:t=>{t&&(this.btnPause=t,this.btnPlay&&this.btnPause&&this.btnStop&&h.setPlayPauseStop(this.btnPlay,this.btnPause,this.btnStop,s,n,a))}}),(0,r.jsx)("button",{className:c,ref:t=>{t&&(this.btnStop=t,this.btnPlay&&this.btnPause&&this.btnStop&&h.setPlayPauseStop(this.btnPlay,this.btnPause,this.btnStop,s,n,a))}})]})}},l=class extends c{constructor(t){super(t),(0,s.S2)("MusicScoreView is deprecated. Will be removed in future release. Use WmsView instead.")}},d=class extends u{constructor(t){super(t),(0,s.S2)("PlaybackButtons is deprecated. Will be removed in future release. Use WmsControls instead.")}};(0,h.init)()},9041(t,e,i){i.r(e),i.d(e,{Annotation:()=>s.JT,AnnotationAnchor:()=>s.r$,AnnotationGroup:()=>s.JT,AnnotationKind:()=>s.an,Arpeggio:()=>s.T8,ArticulationAnnotation:()=>s.vr,Clef:()=>s.fL,Connective:()=>s.HD,DocumentBuilder:()=>s.t5,DynamicsAnnotation:()=>s.Mo,Fermata:()=>s.L2,Label:()=>s.JU,LyricsAlign:()=>s.oA,LyricsHyphen:()=>s.fn,MAccidental:()=>s.iQ,MArpeggio:()=>s.k_,MBarLineLeft:()=>s.e9,MBarLineRight:()=>s.lP,MBeamGroup:()=>s.M_,MConnective:()=>s.YF,MDocument:()=>s.RS,MEnding:()=>s.Lw,MExtensionLine:()=>s.tJ,MFermata:()=>s.aE,MHeader:()=>s.LB,MImage:()=>s.Zk,MLyrics:()=>s.E3,MMeasure:()=>s.Kg,MNoteGroup:()=>s.bE,MPlaybackButtons:()=>s.w0,MPlayer:()=>s.nh,MRenderContext:()=>s.Bj,MRest:()=>s.ad,MRhythmColumn:()=>s.y9,MScoreRow:()=>s.UM,MScoreRowGroup:()=>s.B,MSpecialText:()=>s.C,MStaff:()=>s.yx,MStaffBarLine:()=>s.fJ,MStaffBeamGroup:()=>s.MN,MStaffNoteGroup:()=>s.VW,MStaffRest:()=>s.wb,MStaffSignature:()=>s.CS,MSymbol:()=>s.EX,MTab:()=>s.u1,MTabNoteGroup:()=>s.WN,MTabRhythm:()=>s.r6,MTabSignature:()=>s.hV,MText:()=>s.Xs,MusicInterface:()=>s.rM,Navigation:()=>s.Vx,NoteAnchor:()=>s.ys,Paint:()=>s.Pi,PlayState:()=>s.K8,Player:()=>s.ai,ScoreEvent:()=>s.Pg,ScoreObjectEvent:()=>s.uf,ScoreStaffEvent:()=>s.PC,ScoreStaffPosEvent:()=>s.$e,ScoreTabEvent:()=>s.m,StaffPreset:()=>s.IM,Stem:()=>s.wt,TempoAnnotation:()=>s.Ve,TieType:()=>s.zJ,VerticalPosition:()=>s.G0,WmsControls:()=>s.KU,WmsView:()=>s.zk,colorKey:()=>s.dB,getStringNumbers:()=>s.oT,getVerseNumbers:()=>s._t,getVoiceIds:()=>s.ZN,isStringNumber:()=>s.Hp,isVerseNumber:()=>s.LS,isVoiceId:()=>s.QF,validateStringNumber:()=>s.Vt,validateVerseNumber:()=>s.fP,validateVoiceId:()=>s.Kd});var s=i(9904);i(7414),i(3894),i(6362);(0,i(5690).init)(),function(){if("undefined"!=typeof window&&"undefined"!=typeof customElements)try{i.e(3466).then(i.bind(i,1085)).then(t=>t.registerWmsViewHTMLElement()),i.e(4531).then(i.bind(i,4531)).then(t=>t.registerWmsControlsHTMLElement())}catch(t){}}()}}]);