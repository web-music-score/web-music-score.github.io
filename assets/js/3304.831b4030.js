"use strict";(globalThis.webpackChunkweb_music_score_org=globalThis.webpackChunkweb_music_score_org||[]).push([[3304],{2652(t,e,i){i.r(e),i.d(e,{MusicScoreView:()=>h,PlaybackButtons:()=>c});var s=i(3342),r=i(6540),n=i(7976),o=i(4848),a=i(5221),h=class extends r.Component{constructor(t){super(t),(0,s.Mu)(this,"ctx"),this.ctx=new n.MRenderContext,t.paint&&this.ctx.setPaint(t.paint),this.ctx.setDocument(t.doc),t.onScoreEvent&&this.ctx.setScoreEventListener(t.onScoreEvent)}componentDidUpdate(t,e){t.doc!==this.props.doc&&(this.ctx.setDocument(this.props.doc),this.ctx.draw())}render(){return(0,o.jsx)("canvas",{style:{position:"relative"},ref:t=>{t&&(this.ctx.setCanvas(t),this.ctx.draw())},children:"Your browser does not support the HTML canvas tag."})}};var c=class extends r.Component{constructor(t){switch(super(t),(0,s.Mu)(this,"state"),(0,s.Mu)(this,"buttonClass"),(0,s.Mu)(this,"buttonGroupClass"),this.state={controller:(new n.MPlaybackButtons).setDocument(t.doc)},function(){if("undefined"==typeof window)return"unknown";const t=document.createElement("button");t.className="btn btn-primary",document.body.appendChild(t);const e=getComputedStyle(t).padding;return document.body.removeChild(t),e.includes("6px")&&e.includes("12px")?"bootstrap":""!==getComputedStyle(document.documentElement).getPropertyValue("--ifm-color-primary").trim()?"infima":"unknown"}()){case"bootstrap":this.buttonClass="btn btn-primary",this.buttonGroupClass="btn-group";break;case"infima":this.buttonClass="button button--primary",this.buttonGroupClass="ifm-button-group";break;default:this.buttonClass="wms-button",this.buttonGroupClass="wms-button-group"}}componentDidUpdate(t){this.props.doc!==t.doc&&this.state.controller.setDocument(this.props.doc)}render(){let{singlePlayStop:t,playStop:e,playLabel:i,pauseLabel:s,stopLabel:r}=this.props,{controller:n}=this.state;const{buttonClass:a,buttonGroupClass:h}=this;return null!=i||(i="Play"),null!=s||(s="Pause"),null!=r||(r="Stop"),t?(0,o.jsx)("button",{className:a,ref:t=>{t&&n.setPlayStopButton(t,i,r)}}):e?(0,o.jsxs)("div",{className:h,children:[(0,o.jsx)("button",{className:a,ref:t=>{t&&n.setPlayButton(t,i)}}),(0,o.jsx)("button",{className:a,ref:t=>{t&&n.setStopButton(t,r)}})]}):(0,o.jsxs)("div",{className:h,children:[(0,o.jsx)("button",{className:a,ref:t=>{t&&n.setPlayButton(t,i)}}),(0,o.jsx)("button",{className:a,ref:t=>{t&&n.setPauseButton(t,s)}}),(0,o.jsx)("button",{className:a,ref:t=>{t&&n.setStopButton(t,r)}})]})}};(0,a.init)()},7976(t,e,i){i.r(e),i.d(e,{Annotation:()=>j,Arpeggio:()=>M,Clef:()=>g,Connective:()=>S,DocumentBuilder:()=>Le,DynamicsAnnotation:()=>E,Fermata:()=>L,Label:()=>P,LyricsAlign:()=>x,LyricsHyphen:()=>T,MAccidental:()=>Ge,MArpeggio:()=>Ue,MBarLineLeft:()=>ai,MBarLineRight:()=>ni,MBeamGroup:()=>Ze,MConnective:()=>Ye,MDocument:()=>qe,MEnding:()=>Je,MExtensionLine:()=>qi,MFermata:()=>Qe,MHeader:()=>$e,MImage:()=>ei,MLyrics:()=>Ui,MMeasure:()=>si,MNoteGroup:()=>gi,MPlaybackButtons:()=>cs,MPlayer:()=>os,MRenderContext:()=>as,MRest:()=>Ci,MRhythmColumn:()=>yi,MScoreRow:()=>vi,MScoreRowGroup:()=>Si,MSpecialText:()=>Gi,MStaff:()=>xi,MStaffBarLine:()=>ci,MStaffBeamGroup:()=>Ve,MStaffNoteGroup:()=>di,MStaffRest:()=>Ai,MStaffSignature:()=>ji,MTab:()=>Li,MTabNoteGroup:()=>Ii,MTabRhythm:()=>ki,MTabSignature:()=>Oi,MText:()=>Yi,MusicInterface:()=>ke,Navigation:()=>N,NoteAnchor:()=>w,Paint:()=>is,PlayState:()=>k,ScoreEvent:()=>Ne,ScoreObjectEvent:()=>Ee,ScoreStaffPosEvent:()=>je,StaffPreset:()=>u,Stem:()=>y,TempoAnnotation:()=>O,TieType:()=>v,VerticalPosition:()=>R,colorKey:()=>ts,getStringNumbers:()=>I,getVerseNumbers:()=>p,getVoiceIds:()=>l,isStringNumber:()=>m,isVerseNumber:()=>A,isVoiceId:()=>d,validateStringNumber:()=>C,validateVerseNumber:()=>b,validateVoiceId:()=>f});var s=i(2604),r=i(5329),n=i(1204),o=i(3342),a=i(3543),h=i(5221),c=i(1236),u=(t=>(t.Treble="treble",t.Bass="bass",t.Grand="grand",t.GuitarTreble="guitarTreble",t.GuitarTab="guitarTab",t.GuitarCombined="guitarCombined",t))(u||{}),g=(t=>(t.G="G",t.F="F",t))(g||{});function l(){return[0,1,2,3]}function d(t){return n.I8.isIncluded(t,[0,1,2,3])}function f(t){if(d(t))return t;throw new s.O(6,`Voice id ${t} is invalid!`)}function I(){return[1,2,3,4,5,6]}function m(t){return n.I8.isIncluded(t,[1,2,3,4,5,6])}function C(t){if(m(t))return t;throw new s.O(6,`String number ${t} is invalid!`)}function p(){return[1,2,3]}function A(t){return n.I8.isIncluded(t,[1,2,3])}function b(t){if(A(t))return t;throw new s.O(6,`Verse number ${t} is invalid!`)}var y=(t=>(t.Auto="auto",t.Up="up",t.Down="down",t))(y||{}),M=(t=>(t.Up="up",t.Down="down",t))(M||{}),v=(t=>(t.Stub="stub",t.ToMeasureEnd="toMeasureEnd",t))(v||{}),w=(t=>(t.Auto="auto",t.Above="above",t.Center="center",t.Below="below",t.StemTip="stemTip",t))(w||{}),S=(t=>(t.Tie="tie",t.Slur="slur",t.Slide="slide",t))(S||{}),R=(t=>(t.Auto="auto",t.Above="above",t.Below="below",t.Both="both",t))(R||{}),x=(t=>(t.Left="left",t.Center="center",t.Right="right",t))(x||{}),T=(t=>(t.Hyphen="-",t.Extender="---",t))(T||{}),L=(t=>(t.AtNote="atNote",t.AtMeasureEnd="atMeasureEnd",t))(L||{}),N=(t=>(t.DC_al_Fine="D.C. al Fine",t.DC_al_Coda="D.C. al Coda",t.DS_al_Fine="D.S. al Fine",t.DS_al_Coda="D.S. al Coda",t.Coda="Coda",t.toCoda="toCoda",t.Segno="Segno",t.Fine="Fine",t.StartRepeat="startRepeat",t.EndRepeat="endRepeat",t.Ending="ending",t))(N||{}),j=(t=>(t.Dynamics="dynamics",t.Tempo="tempo",t))(j||{}),E=(t=>(t.cresc="cresc.",t.decresc="decresc.",t.dim="dim.",t.ppp="ppp",t.pp="pp",t.p="p",t.mp="mp",t.m="m",t.mf="mf",t.f="f",t.ff="ff",t.fff="fff",t))(E||{}),O=(t=>(t.accel="accel.",t.rit="rit.",t.a_tempo="a tempo",t))(O||{}),P=(t=>(t.Note="note",t.Chord="chord",t))(P||{}),k=(t=>(t[t.Playing=0]="Playing",t[t.Paused=1]="Paused",t[t.Stopped=2]="Stopped",t))(k||{}),D=class{constructor(t){(0,o.Mu)(this,"head"),(0,o.Mu)(this,"tail"),this.head=t,this.tail=[]}getHead(){return this.head}getTails(){return this.tail}addTail(t){this.tail.push(t)}detachTail(t){let e=this.tail.indexOf(t);e>=0&&this.tail.splice(e,1)}},G=class{constructor(t){this.parent=t,(0,o.Mu)(this,"anchoredLayoutObjects",[]),(0,o.Mu)(this,"link"),(0,o.Mu)(this,"userData",{}),(0,o.Mu)(this,"rect",new n.vW),(0,o.Mu)(this,"needRectUpdate",!0)}getParent(){return this.parent}requestRectUpdate(){this.needRectUpdate=!0}updateRect(){}forceRectUpdate(){this.needRectUpdate=!0,this.updateRect(),this.needRectUpdate=!1}getRect(){return this.needRectUpdate&&this.forceRectUpdate(),this.rect}offsetX(t){this.offset(t,0)}offsetY(t){this.offset(0,t)}setLeft(t){this.offset(t-this.getRect().left,0)}setRight(t){this.offset(t-this.getRect().right,0)}setTop(t){this.offset(0,t-this.getRect().top)}setBottom(t){this.offset(0,t-this.getRect().bottom)}setAnchor(t,e){this.offset(t-this.getRect().anchorX,e-this.getRect().anchorY)}setAnchorX(t){this.offset(t-this.getRect().anchorX,0)}setAnchorY(t){this.offset(0,t-this.getRect().anchorY)}setCenter(t,e){this.offset(t-this.getRect().centerX,e-this.getRect().centerY)}setCenterX(t){this.offset(t-this.getRect().centerX,0)}setCenterY(t){this.offset(0,t-this.getRect().centerY)}getShapeRects(){return[this.rect]}addAnchoredLayoutObject(t){this.anchoredLayoutObjects.push(t)}getAnchoredLayoutObjects(){return this.anchoredLayoutObjects}setLink(t){this.link=t}getLink(){return this.link}isLinked(){return null!==this.link}},B=!1,Y=1,W=75,U=10,z=1.7,Z=10,F=.5,V=.5,H=2,q=1.3,X=1.8,J=.8,K=7,Q=1.5,_=4,$=2,tt=1.25,et=.5,it=4,st=.5,rt=3.6,nt=5,ot=8,at=20,ht=new n.b1([[0,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAACWCAYAAACCe+v6AAADHXpUWHRSYXcgcHJvZmlsZSB0eXBlIGV4aWYAAHja7ZZRcu0mDIbfWUWXgCSExHIwmJnu4C6/Pxg7J2kyTdv7GJhjsJCF0CfZJ5y//hzhDzRK5iGpeS45R7RUUuGKicerHetKMa3ratL2Gr2Xh5L3AkMkU/O6LbzlJ+SY074vexO69W9D94QqZvq2UOuWH+/lxzbI/tHQ9kDo2jn2/cA2JLw9Std92x7l4vbuaH2fGYqXyN9+SYyzZrKEa+JolgvmzjEZ4tmno6NxWYb0CugjuO9vVYZPfApJxFUkXV7K/IlUjBlXrAYokhhuFMK5UFbgI1DCBXha9kY1PsF8jc1bjL5o3zlWxCbjnMov1J7xQ97k/HnePLOdBg81z3tB3mON+Rk/lZPehu4Fefbh1529PTu/k4vE9BqK8Ip7jO5jHRqnqCkjFnkf6j7KmkHvmFFcT2V0izkgax2T2Qu6xxobcqrHhko7MC/EoDsoUadKg841NmpwMfHJhpG5BZYldEAq3GQmQ5qdBpsU6eLImHblkPDjC61ty9qukcceYieoMsEY4ZH/3MN3FceYtUQU/YoT0gJ+8axOeBEJ+OcANTCgsYOqK8B3/9gm18lMV5gdB6zxCJeJQ+ktuWSBFigqxgsyWd8GECJsrXCGBARiJlHK8MiYjQiBdACqcJ0l8QECpModTnISyYCD6sDeeMZoqbLyJcZbVVJAsWYUrYNQBayUFPljyZFDVUWTqmY1dS1as+RZeTlbnq/namLJ1LIZ3tlWrLp4cvXs5u7Fa+EieH1rQZ0WL6XUik0rLFc8XaFQ68GHHOnQIx92+FHCURvSp6WmLTdr3kqrnbt0FHjP3br30utJJ1LpTKee+bTTz3LWgVQbMtLQkYeF4aOM+lCjXbYf+7+gRpsaL1JT0R5qkJrdJmi+TnQyAzFOBOAGaiCGxJ7MolNKPMlNZvgeoSqU4aROOJ0mMRBMJ7EOethtcoHr7+EWzBc3/r/kwkT3TXJ/5/YZtT6/Em0Ru8pwBjUKqg/rp1f2Oj+vX47hnxS+O/4Y+jH0Y+jrcYwROv51hb8AKbCqdGIdCl0AAAGFaUNDUElDQyBwcm9maWxlAAB4nH2RPUjDQBzFX1O1UqoOdhBxyFCd7OAH0rFUsQgWSluhVQeTS7+gSUOS4uIouBYc/FisOrg46+rgKgiCHyCuLk6KLlLi/5JCi1gPjvvx7t7j7h0gNCpMNXuigKpZRioeE7O5VdH3ij74MYgpRCRm6on0YgZdx9c9PHy9C/Os7uf+HANK3mSARySOMt2wiDeI5zYtnfM+cZCVJIX4nHjSoAsSP3JddvmNc9FhgWcGjUxqnjhILBY7WO5gVjJU4lnikKJqlC9kXVY4b3FWKzXWuid/YSCvraS5TnMMcSwhgSREyKihjAoshGnVSDGRov1YF/+o40+SSyZXGYwcC6hCheT4wf/gd7dmYWbaTQrEgN4X2/4YB3y7QLNu29/Htt08AbzPwJXW9lcbQOST9HpbCx0BQ9vAxXVbk/eAyx1g5EmXDMmRvDSFQgF4P6NvygHDt4B/ze2ttY/TByBDXS3fAAeHwESRste7vLu/s7d/z7T6+wEMNXLkxtwRywAADzRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+Cjx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDQuNC4wLUV4aXYyIj4KIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIgogICAgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIKICAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgIHhtbG5zOkdJTVA9Imh0dHA6Ly93d3cuZ2ltcC5vcmcveG1wLyIKICAgIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIgogICAgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIgogICB4bXBNTTpEb2N1bWVudElEPSJnaW1wOmRvY2lkOmdpbXA6NDA3ODVjMzYtNDAxZC00YTZlLTkxODctMDQ1NTI4MmM0ZGY2IgogICB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjhiZTJkYzc1LTVlYjQtNDk0Yy1iNWRlLWQ2MzZkNzZhNjI2YiIKICAgeG1wTU06T3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOmU3YWE0MWNhLTNiYjMtNGU5Yi05NDQxLTllNTNmZTJiZjM5ZiIKICAgZGM6Rm9ybWF0PSJpbWFnZS9wbmciCiAgIEdJTVA6QVBJPSIyLjAiCiAgIEdJTVA6UGxhdGZvcm09IldpbmRvd3MiCiAgIEdJTVA6VGltZVN0YW1wPSIxNjg2NDA4NjA5MzE2NDM4IgogICBHSU1QOlZlcnNpb249IjIuMTAuMzQiCiAgIHRpZmY6T3JpZW50YXRpb249IjEiCiAgIHhtcDpDcmVhdG9yVG9vbD0iR0lNUCAyLjEwIgogICB4bXA6TWV0YWRhdGFEYXRlPSIyMDIzOjA2OjEwVDE3OjUwOjA5KzAzOjAwIgogICB4bXA6TW9kaWZ5RGF0ZT0iMjAyMzowNjoxMFQxNzo1MDowOSswMzowMCI+CiAgIDx4bXBNTTpIaXN0b3J5PgogICAgPHJkZjpTZXE+CiAgICAgPHJkZjpsaQogICAgICBzdEV2dDphY3Rpb249InNhdmVkIgogICAgICBzdEV2dDpjaGFuZ2VkPSIvIgogICAgICBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjI3MzY2YmY0LWVkZDMtNDE5OC05NjJhLWU5ZTM5MTBlNThiZSIKICAgICAgc3RFdnQ6c29mdHdhcmVBZ2VudD0iR2ltcCAyLjEwIChXaW5kb3dzKSIKICAgICAgc3RFdnQ6d2hlbj0iMjAyMi0wOC0yMlQwMjo1NTozNiIvPgogICAgIDxyZGY6bGkKICAgICAgc3RFdnQ6YWN0aW9uPSJzYXZlZCIKICAgICAgc3RFdnQ6Y2hhbmdlZD0iLyIKICAgICAgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDo5NjVlMTM3OS0wZDlmLTQ5ODItYWQ3MC05MzhjOWMzOWE0ZjMiCiAgICAgIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkdpbXAgMi4xMCAoV2luZG93cykiCiAgICAgIHN0RXZ0OndoZW49IjIwMjItMDktMTFUMTY6MzU6MDAiLz4KICAgICA8cmRmOmxpCiAgICAgIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiCiAgICAgIHN0RXZ0OmNoYW5nZWQ9Ii8iCiAgICAgIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6MTBmYmEwYTMtOTI5Yi00NTRlLThjNGMtOGVkOGM4YWJhZGRjIgogICAgICBzdEV2dDpzb2Z0d2FyZUFnZW50PSJHaW1wIDIuMTAgKFdpbmRvd3MpIgogICAgICBzdEV2dDp3aGVuPSIyMDIzLTA2LTEwVDE3OjUwOjA5Ii8+CiAgICA8L3JkZjpTZXE+CiAgIDwveG1wTU06SGlzdG9yeT4KICA8L3JkZjpEZXNjcmlwdGlvbj4KIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAKPD94cGFja2V0IGVuZD0idyI/Ppn4NIQAAAAGYktHRAD/AP8A/6C9p5MAAAAJcEhZcwAALiMAAC4jAXilP3YAAAAHdElNRQfnBgoOMgm5WlWBAAAAGXRFWHRDb21tZW50AENyZWF0ZWQgd2l0aCBHSU1QV4EOFwAACHtJREFUeNrtnXuQVmMcxz+77cauTWUpbGSVu2w3BpnUEBq3chkmBjGayG1GBuNWLtUgw5SJkBkjl4QKg1wyQyarK0lRSlstU20bWam9+OM8O3P6vc8553nOe97tnO18Z84f57zP7XvOc/ndnueFfQx5e6neUmAI0B3oDPwD/AJ8Dvzcml5we+Al4D+gyeOaB1S0BrLHAut9iLqvf4ERSSZbBmwwJOu+RieV8JwQZJuARjXWE4WBIck2X38AByaJ8MwsCTcBTyWFbCFQFwHhv4DiKBqUn2PCPYEin9+bgI3AUuBPn3TtgMuT8IWv8vlq7wLdRPrTgPke6d9JAuFbPBo/3UfKK1TCh8yzIQmEb/cYjx0C8pUDuzV5D477GN6mefY+UBuQby0wV/O8U9wJr9E8W2iY92vNs45xJ6zTfKoN827UPNsdd8K1SlJyo8Awb7XhEIkVYYAVmjXVBPtr1uyqJBBeLu5LDPMdppkPdiaRcHvDfKeJ+++SIFoCLBP3R1toWW58lhQFogiodwkPlYZf1y1w/AcclCQVcYWQtILwqiA8M2lGgDcFgSN90nbXiJUXRdWQ/BYiLMdxH5+0k8VavRb4JGmEl4j7vh7pRgDni2fj1RyQKBwiuqjui/Un015dBbQloXCbaTdrZuUajTp4IwnGbEHmKPX8QmCHhuwC9p4rKBI8IghdB0zCsT1Lsg0+4zwxuEiQqqcVmGWDlAETk+zSJE9Ublyjuqof2TrgxKQT7anMNSZfd1iSiZYCUwy+avP1dJLJXglsxdyV8hHQJolEDwBewc5v9J3Klzj0xYnTsCG7W4mdicMdwC7CeQaPTBLRAjUxZeMKvSwpZPcDPghBUGpE45JAthjH92NLdiUwSDz7NO5k24YkuwTHGZYvtKMtcSabD7wVguy37OkilU7v8rgSfjoE2c816+wkkebKOJK9NgTZ2Wpykxgu0k2IG9lTcMIBbchOx9tTWKHpBbFBoZpwbMi+iL9FtEC8wG1xIvyQJdlJhuVWinzd4kD2cJxYZlOyky3KfkHkvSoOhF+2IPu8Zdk3x82O1QV96JDumhJSu5KB4XsVEwzJziCcy2Z/8UK3K5G1PZnhDi2iBW02IDvPY501xY8BuvJ6JcY+AQzAPCDGGucZkF2GefiCxFk4AWoN2K0AG4HHiSBATWJqQMXr1Qxui3Jlv8o2nHiHIl4UFeF1+G/ACOMGuZVoYqfd12qgX7ZkuwZUMjyEoWBaxETd1y5gVDaEr/YpfGqIyW9ODsm6r7FhCY/z6T625tTpLUS2+bo3DOHZHoVdYFnOqBYmG3rbz1JNQbZ2p2MsZfAor604G8OMsUVTyEBLwjMsv4r7vkapl28AH+PEWNqu1++ZNjRPk3mFJdnjDBu4HBipVoUGsewVaGb6fjgRPSsMSQ8wNb/KjA9bEp5osIzcLUitEml6BNQxxGPoWVtROmoynmFJ+CefRvytxFaJt0W6GwwtqE8GkA56cZSSGVxiI74FhTUM9ch3f0irCerleNU3wbZL2xrJzwhp+hks0s6PaBitMsnsXk7WWlY8xKPi7fjvOZI94x/sHOQFPobGw+U4kHBvrrDVRrw2RE4L6C3V7Ln3sBg43qLeeuAxj996BxHeJCYxm2i4Gh8RMwjL/BpqgA/VpKgTgnwJuzdXtbWUWpZpntUCiwwlPDf6WBLeBSzWPO8URFjuHOthUWm1ptJFaizZErb9wvJjNaMkiLDck2CrYD8n7k13hUrCvUIYB3Vdui6I8FI1qzbjUstKXwe+EV3aBKtE40pwjsKwwQEeuoEv4d3ALNf9ycCpFpU24ngRVrvkYNN8y7Ps1rqlb3MQYXCc3m7YytOb1FCYa2lhzHbiqjAoU4s2GoG+D+Fg85VGijq/ssh7qEboqLGZB6QDvBLHdZpLnK6R0EzlgNs0hGfZVJ6v1lV3ARNzTLhYo0sfY5h3sYWy4ole7Blh16ismrnEStFok/ou05BdR8iA1QfJDN2/PoeEZZTQkwZL0RoN4bvCNiCPzONlGpVJNBe7Tu4TdX1h2bbmmLCCbMfWAvTew6iDQy/QzLReZJ/RtKk+pFiagXZqmdCdyzGG8J5Eic6aOuSe4yK8A+RGRfn2/SqqwdmbVBZBPX/gHbh2MfAbEbtbTAQEr7itehyX6DDCn6zyCZlhUHcoTc7Ltj2WHKNcLexBRvaFaqxdr0Q/k2OixmNudN9uo+BEMcsOAB4AzrXIU6vUxlrVU3YqJaMEOELZoUzW0PeBezz04JyjN07o0mZy7zD7EjiTmKAQOAfHJlyJ/xmWtsHlo1UPCI28FnoBJym9urtaYspwdrOUKkmprerC/6pl7lel/HdxlTORBB/7aIJnLSQuK40orlisUWRaNXpoxnHX1ky4DZlhTkNbc5duwAlNjLRb58f8Ky/e1wgv2dcmrr6aiSur3agFOWxsL6XM91a6crUSCWfi+H9NoDtEsIKY7YI52sNQ4D5uZpBFeTKMamScyJqeFL4L8yOjfhB5x8Rp0ppoaPEoBF4j86A/HerEfUlcCB8GXGGRvqPSZYPQIeAF7DXC/bE3fJsY2eWsvCEuhMtC9oouAROgPPxveVwIN4TM53f08tnifgfmh/nmnPC6kPk2+fx2k7ifpWb4WKAT9mG+foFvMqqvkRj+pYntFp0HPMrZj8wg1VieEd8Tc6NdFXr3TCFOgLc77TZifE7AaAOyv+MY9iS64pxBK7vyJXHWcLy8eu4T0dybo9vhBMBMJvMwwEbgzqSodnfhvxOtDieQzOv3ncRkE7UNytV4tJ295+LsnUgsugKPAt/jvQm7DmcX2+Bcj7eWRjFwAo4rtYOa1avUMrSTFClSpEiRIkWKFClSpEiRIkWKFClSpEiRIkWKFClSpEiRIgL8D6ed2EKeJMaTAAAAAElFTkSuQmCC"],[1,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAABGCAYAAACQRffVAAADInpUWHRSYXcgcHJvZmlsZSB0eXBlIGV4aWYAAHja7VdbktwgDPznFDkCkgCJ4/AwVblBjp8GY+/OZFPZPD7yMVADWIiWUEt2jTu+fR3uCxplTi5EtZRT8mghh8wFC/Nnq2skH9a4mrS9R49yF9LeYIhkap6Pmbf8gBxr2s95G6FL/wK6FlSwim8bpWx5fZTXDcj2DLQ3hE7Lvu8DG0h4exTO57Y9Stn04Wp93xmKp8jefkGUU0ykAWNgr5oy1sY+KOLZp6PcznP31S7B9XypMnziQ0g8RpFweinzJ1IwJ4wk4qA4hUXiGlmWGTiUEG4Fbj6BR/F3MN/H5i1GP2mfuZaHkXFM5XdXu+envOn147y5VzsN3JU3lvaGPNLq0z1/KKd4AV0bctvh95at3ZYf5ENWdt3Nvad7jG5jXRq3KCEhFmlf6rrKWkGvziiuUwldfXLANSxmz+jmi2/Iqe4bKq1inYnB/aBAnQoNOtbcqMHFwAcrZubmWJbQQFLmhlQgCbPTYJUsXQwp0c4cEr59oWU2L3ONzHfnO0GVCWCEI3/c3WcVx5i1ROTtjBM8g188qxNeeAL9c4IaGKGxgxpXgK/+3CavAgbjCrPhgsVXd0LUSG/JJYvoSW/EfFY9ad8ACBFMRzhDAgZ8IomU4JEyKxECaSCowHWWwBUMUIzc4SQHkQRyUB2wjTNKS5Ujn2K8VSU4FGsSBTdZCsgKISJ/NBhyqESJIcaYokaLOZYkaVZeSprm67moaNCoSVXNadZiYsGiJVMzy1YyZ8HrO2bUabaccykwWoBccLpAoZTKVWqosaaq1Wp2tTSkTwstttS0WcutdO7SUeA9de3Wcy8HHUilIxzxSIceduSjDKTakBFGHGmoGzbyKDdrtMv2uf8Ga7RZ48XUVNSbNUhVLwiar5M4OQNjHAiEK1gDY0jsyZk3CoEnc5MzfI9QFZHhZJzkdJqMgcFwEMdBN3ebOcfl3/Dm1BZv/LfMuUndJ5n7kbePWOvzK9EWY2cZzqB6QfVh/7DCVubn9aez+5XCZ+cX0AvoBfQCegG9gP57oIEPJ/4Bue+bLIaQwqExNwAAAYVpQ0NQSUNDIHByb2ZpbGUAAHicfZE9SMNAHMVfU7UiFQeLijhkqE4WREUcSxWLYKG0FVp1MLn0Q2jSkKS4OAquBQc/FqsOLs66OrgKguAHiKuLk6KLlPi/pNAixoPjfry797h7Bwj1MlPNjiigapaRisfEbG5FDLyiC0EMYgIDEjP1RHohA8/xdQ8fX+8iPMv73J+jV8mbDPCJxFGmGxbxOvHMpqVz3icOsZKkEJ8Tjxt0QeJHrssuv3EuOizwzJCRSc0Rh4jFYhvLbcxKhko8TRxWVI3yhazLCuctzmq5ypr35C8M5rXlNNdpjiCORSSQhAgZVWygDAsRWjVSTKRoP+bhH3b8SXLJ5NoAI8c8KlAhOX7wP/jdrVmYmnSTgjGg88W2P0aBwC7QqNn297FtN04A/zNwpbX8lTow+0l6raWFj4C+beDiuqXJe8DlDjD0pEuG5Eh+mkKhALyf0TflgP5boGfV7a25j9MHIENdLd0AB4fAWJGy1zze3d3e279nmv39ANCccsygwwDVAAAQE2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNC40LjAtRXhpdjIiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iCiAgICB4bWxuczpzdEV2dD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlRXZlbnQjIgogICAgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIgogICAgeG1sbnM6R0lNUD0iaHR0cDovL3d3dy5naW1wLm9yZy94bXAvIgogICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iCiAgICB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iCiAgIHhtcE1NOkRvY3VtZW50SUQ9ImdpbXA6ZG9jaWQ6Z2ltcDo0MDc4NWMzNi00MDFkLTRhNmUtOTE4Ny0wNDU1MjgyYzRkZjYiCiAgIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6Nzg3YjYxN2YtMjg1MS00YzhlLTg2MTYtZWM3NGMwYzYwMWVlIgogICB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6ZTdhYTQxY2EtM2JiMy00ZTliLTk0NDEtOWU1M2ZlMmJmMzlmIgogICBkYzpGb3JtYXQ9ImltYWdlL3BuZyIKICAgR0lNUDpBUEk9IjIuMCIKICAgR0lNUDpQbGF0Zm9ybT0iV2luZG93cyIKICAgR0lNUDpUaW1lU3RhbXA9IjE2ODY2MTM5NDcxOTU2ODAiCiAgIEdJTVA6VmVyc2lvbj0iMi4xMC4zNCIKICAgdGlmZjpPcmllbnRhdGlvbj0iMSIKICAgeG1wOkNyZWF0b3JUb29sPSJHSU1QIDIuMTAiCiAgIHhtcDpNZXRhZGF0YURhdGU9IjIwMjM6MDY6MTNUMDI6NTI6MjUrMDM6MDAiCiAgIHhtcDpNb2RpZnlEYXRlPSIyMDIzOjA2OjEzVDAyOjUyOjI1KzAzOjAwIj4KICAgPHhtcE1NOkhpc3Rvcnk+CiAgICA8cmRmOlNlcT4KICAgICA8cmRmOmxpCiAgICAgIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiCiAgICAgIHN0RXZ0OmNoYW5nZWQ9Ii8iCiAgICAgIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6MjczNjZiZjQtZWRkMy00MTk4LTk2MmEtZTllMzkxMGU1OGJlIgogICAgICBzdEV2dDpzb2Z0d2FyZUFnZW50PSJHaW1wIDIuMTAgKFdpbmRvd3MpIgogICAgICBzdEV2dDp3aGVuPSIyMDIyLTA4LTIyVDAyOjU1OjM2Ii8+CiAgICAgPHJkZjpsaQogICAgICBzdEV2dDphY3Rpb249InNhdmVkIgogICAgICBzdEV2dDpjaGFuZ2VkPSIvIgogICAgICBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjk2NWUxMzc5LTBkOWYtNDk4Mi1hZDcwLTkzOGM5YzM5YTRmMyIKICAgICAgc3RFdnQ6c29mdHdhcmVBZ2VudD0iR2ltcCAyLjEwIChXaW5kb3dzKSIKICAgICAgc3RFdnQ6d2hlbj0iMjAyMi0wOS0xMVQxNjozNTowMCIvPgogICAgIDxyZGY6bGkKICAgICAgc3RFdnQ6YWN0aW9uPSJzYXZlZCIKICAgICAgc3RFdnQ6Y2hhbmdlZD0iLyIKICAgICAgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDoxMGZiYTBhMy05MjliLTQ1NGUtOGM0Yy04ZWQ4YzhhYmFkZGMiCiAgICAgIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkdpbXAgMi4xMCAoV2luZG93cykiCiAgICAgIHN0RXZ0OndoZW49IjIwMjMtMDYtMTBUMTc6NTA6MDkiLz4KICAgICA8cmRmOmxpCiAgICAgIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiCiAgICAgIHN0RXZ0OmNoYW5nZWQ9Ii8iCiAgICAgIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6MDBmYjM4YTMtZjZiMi00NjQ1LTliMTYtMjlhNWE0ODZlMjhhIgogICAgICBzdEV2dDpzb2Z0d2FyZUFnZW50PSJHaW1wIDIuMTAgKFdpbmRvd3MpIgogICAgICBzdEV2dDp3aGVuPSIyMDIzLTA2LTEzVDAyOjUyOjI3Ii8+CiAgICA8L3JkZjpTZXE+CiAgIDwveG1wTU06SGlzdG9yeT4KICA8L3JkZjpEZXNjcmlwdGlvbj4KIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAKPD94cGFja2V0IGVuZD0idyI/PsIRrtIAAAAGYktHRAD/AP8A/6C9p5MAAAAJcEhZcwAALiMAAC4jAXilP3YAAAAHdElNRQfnBgwXNBsqJURsAAAAGXRFWHRDb21tZW50AENyZWF0ZWQgd2l0aCBHSU1QV4EOFwAABF9JREFUeNrtmluIF1Ucxz9/E8P1VnnJ9dJWC4Frmq2JJmqolGEILoQvK2gZeXlRCSm1Fx9UEsJQERWsXhRftECs0Gq70EK9ZHlbFyHbds3VVXFX91+7664P81tYhpnfmft//st84TzMzDm/8/vOnPO7nYEMGTJkyJAhQ4YMGSJBLkJZw4FyYAIwDHgU+A9oAxqBv4C7xfyySoBlwKfAFaAb6DG0euAzoAoYXCxEnwH2A60eCGrtFrALGJNWokNEwY6QRO2tFXgPGJAmss8DlyImam/fASPTQHaeGJueBFod8FQhrfSLwM+ynDX8L1/oV+BP4LZY58eBUUAlMB94ycPSvQTMERmJ4jGgwYPh2Qg84VFmGbAP6DTI/aoQS/lzg1JfA2MDyn4ZuGaQvyZJspUGv3oKGBhyjmeBJmWOmxLMJIITiiIXIgwaZgFdylxbDeNHANXAZmAVUBpEiScNe2xRxC/3Y2WuRmUlLRHD1rd/HljvV4F3FAVqYlhNo4B7Pl/wdPEMbmOq/ShwRBH0Vkxb6LAy536fW64HuOpn8vOKoLKYCC9Q5rzs0L/JQxDjyYPkgHYXAW0xGslByrLuFuPUFw0eCI92mmiAQ4LgZoEbYyTcAZxVPsJk271ag7x6cWueCLvhfsyu8LzybKLtersUF9ywxe2BnXBnAZOUJuXZeNv1OSki3LLdzwPrgONuguw+7g7wAHjEoW+vEagAXgeelr1yUSZoCUn4hvJsqMO9byRaWyLGtFkiwOtBJnYzBKcVg/ZuSMIrlHl3RrWMnFK1OqX/q8oXOAisDqFLVxL7xonw9yHk7Q5RoxpuyLdjI3wmhLzBwMqAY0ck4SGcCNeKIQqKOTF84RtxEu4BPgohc2QM467HSRjgqBL5mBDUPU1Rnl1JwqBNUuJqrW0M+OLdYuk8Cdas38Rf4b3FR0HP/nLdZNYaioKbxSVuA6ZGQfoNvNWlO6VvEKxW5O5yGbNc4ml7ZrUtCtLjgGMSdjop9Q+wMIT8GoXwKw79ZxrKUG9r+a8flMoyr5AA4ybwo1QgggYHpZJ6Ou3Ta5IpddvufwEsVWQ2xFisCI1Nypf6RMmsIql4JI0S8bFuSs9UvmCgikeh8b6i8C/KuKOYD+VShzGSwLsprRnByYYYoSqNhE8qCv/kYfxrYjT7jmuPIC+PBWsVsl1YRzBeE45qqWGtwjo1SR0WoZ8a7KAfYa5h7/2OVaPuF1gqtS83srclpi565IAP0c+b7wOz+wPZckOc3Jt0LC52oiXABx7y6VasGnfRYgiwwRAu9raGqPLXQmAGcADvvyN+m9bgXnP4i4E9wN8+KiJ5WQG5QilumnioJP9lwHPANKw/fF7A+fxJw2ms/y9SFdiPBf4Vn9hJNL8T/iFxbyoxgej+m6zBOtnLpXlvhiXcDOyVJV8UCEL4KnBI/OnAtBP0q+ADMTq/SfshrdUFr4TzwJdY9d57WIdYzRIk1GMdeXSQIUOGDBmSwUMtd8u2ArdcUAAAAABJRU5ErkJggg=="]]),ct=t=>ht.getOrDefault(t,""),ut=new n.kM;var gt=class{constructor(t){this.mi=t,(0,o.Mu)(this,"devicePixelRatio"),(0,o.Mu)(this,"fontSize"),(0,o.Mu)(this,"unitSize"),(0,o.Mu)(this,"_lineWidth"),(0,o.Mu)(this,"scoreEventListener"),(0,o.Mu)(this,"canvas"),(0,o.Mu)(this,"ctx"),(0,o.Mu)(this,"mdoc"),(0,o.Mu)(this,"paint",is.default),(0,o.Mu)(this,"cursorRect"),(0,o.Mu)(this,"mousePos"),(0,o.Mu)(this,"curStaffPos"),(0,o.Mu)(this,"curObjects"),(0,o.Mu)(this,"hilightedStaffPos"),(0,o.Mu)(this,"hilightedObj"),(0,o.Mu)(this,"usingTouch",!1),(0,o.Mu)(this,"onClickFn"),(0,o.Mu)(this,"onMouseMoveFn"),(0,o.Mu)(this,"onMouseLeaveFn"),(0,o.Mu)(this,"onTouchEndFn"),this.devicePixelRatio="undefined"!=typeof window?window.devicePixelRatio:1,this.fontSize=n.L_.FontSize*Y*this.devicePixelRatio,this.unitSize=.3*this.fontSize,this._lineWidth=.2*this.unitSize,this.onClickFn=this.onClick.bind(this),this.onMouseMoveFn=this.onMouseMove.bind(this),this.onMouseLeaveFn=this.onMouseLeave.bind(this),this.onTouchEndFn=this.onTouchEnd.bind(this)}getMusicInterface(){return this.mi}get doc(){var t;return null==(t=this.mdoc)?void 0:t.getMusicObject()}getImageAsset(t,e){var i;return null!=e||(e=""),null==(i=ut.getOrCreate(t,e,()=>{const i={src:ct(t),color:e,loaded:!1,colorized:!1},s=new Image;return s.src=i.src,s.onload=()=>{i.img=s,this.onImageLoaded(i)},s.onerror=()=>{console.error("Failed to load image: "+i.src)},i}))?void 0:i.img}forceDraw(){var t;null==(t=this.doc)||t.requestFullLayout(),this.draw()}onImageLoaded(t){if(t.loaded||!t.img)return;const e=this.paint.getColor(t.color);if(t.colorized||""===e||"black"===e||"#000"===e||"#0000"===e||"#000000"===e||"#00000000"===e)return this.forceDraw(),void(t.loaded=!0);const[i,s,r,n]=is.colorNameToRGBA(e);if("undefined"==typeof document)return void console.error("Failed to colorize image: document is undefined.");const o=document.createElement("canvas");o.width=t.img.width,o.height=t.img.height;const a=o.getContext("2d");if(null==a)return void console.error("Failed to colorize image: ctx = null.");a.drawImage(t.img,0,0);const h=a.getImageData(0,0,o.width,o.height),c=h.data;for(let u=0;u<c.length;u+=4){const t=c[u],e=c[u+1],n=c[u+2];0!==c[u+3]&&(t<40&&e<40&&n<40&&(c[u+0]=i,c[u+1]=s,c[u+2]=r))}a.putImageData(h,0,0),t.img.src=o.toDataURL("image/png"),t.img.onload=()=>{t.colorized=!0,this.onImageLoaded(t)},t.img.onerror=()=>{console.error("Failed to colorize image.")}}setDocument(t){if(this.mdoc===t)return;this.updateCursorRect(void 0);let e=this.mdoc;this.mdoc=t,e&&e.getMusicObject().setRenderContext(void 0),t&&t.getMusicObject().setRenderContext(this)}setPaint(t){this.paint=null!=t?t:is.default}getPaint(){return this.paint}setCanvas(t){var e,i;this.canvas!==t&&(this.canvas&&(this.canvas.removeEventListener("click",this.onClickFn),this.canvas.removeEventListener("mousemove",this.onMouseMoveFn),this.canvas.removeEventListener("mouseleave",this.onMouseLeaveFn),this.canvas.removeEventListener("touchend",this.onTouchEndFn)),this.canvas=t,this.canvas.addEventListener("click",this.onClickFn),this.canvas.addEventListener("mousemove",this.onMouseMoveFn),this.canvas.addEventListener("mouseleave",this.onMouseLeaveFn),this.canvas.addEventListener("touchend",this.onTouchEndFn),this.canvas.style.position="relative"),this.ctx=null!=(i=null==(e=this.canvas)?void 0:e.getContext("2d"))?i:void 0}setScoreEventListener(t){this.scoreEventListener=t}needMouseInput(){return void 0!==this.scoreEventListener}getMousePos(t){return new n.l2(t.offsetX,t.offsetY)}updateCurStaffPos(t,e){let i=(s=t,r=this.curStaffPos,!(!s&&!r||s&&r&&s.scoreRow===r.scoreRow&&s.diatonicId===r.diatonicId));var s,r;if(i&&this.curStaffPos&&this.scoreEventListener){let{scoreRow:t,diatonicId:e}=this.curStaffPos;this.scoreEventListener(new je("leave",this.getMusicInterface(),t.getMusicInterface(),e))}if(i&&t&&this.scoreEventListener){let{scoreRow:e,diatonicId:i}=t;this.scoreEventListener(new je("enter",this.getMusicInterface(),e.getMusicInterface(),i))}if(e&&t&&this.scoreEventListener){let{scoreRow:e,diatonicId:i}=t;this.scoreEventListener(new je("click",this.getMusicInterface(),e.getMusicInterface(),i))}return this.curStaffPos=t,i}updateCurObjects(t,e){let i=(s=t,r=this.curObjects,!(!s&&!r||s&&r&&s.length===r.length&&s.every((t,e)=>t===r[e])));var s,r;return i&&this.curObjects&&this.curObjects.length>0&&this.scoreEventListener&&this.scoreEventListener(new Ee("leave",this.getMusicInterface(),this.curObjects.map(t=>t.getMusicInterface()))),i&&t&&t.length>0&&this.scoreEventListener&&this.scoreEventListener(new Ee("enter",this.getMusicInterface(),t.map(t=>t.getMusicInterface()))),e&&t&&t.length>0&&this.scoreEventListener&&this.scoreEventListener(new Ee("click",this.getMusicInterface(),t.map(t=>t.getMusicInterface()))),this.curObjects=t,i}onClick(t){let{doc:e}=this;if(this.needMouseInput()&&e&&(this.mousePos=this.txFromScreenCoord(this.getMousePos(t)),this.scoreEventListener)){let t=e.pick(this.mousePos.x,this.mousePos.y),i=e.pickStaffPosAt(this.mousePos.x,this.mousePos.y),s=this.updateCurStaffPos(i,!0),r=this.updateCurObjects(t,!0);(s||r)&&this.draw()}}onMouseMove(t){let{doc:e}=this;if(this.needMouseInput()&&e&&(this.mousePos=this.txFromScreenCoord(this.getMousePos(t)),!this.usingTouch)){let t=e.pick(this.mousePos.x,this.mousePos.y),i=e.pickStaffPosAt(this.mousePos.x,this.mousePos.y),s=this.updateCurStaffPos(i,!1),r=this.updateCurObjects(t,!1);(s||r)&&this.draw()}}onMouseLeave(t){if(!this.needMouseInput())return;this.mousePos=void 0;let e=this.updateCurStaffPos(void 0,!1),i=this.updateCurObjects(void 0,!1);(e||i)&&this.draw()}onTouchEnd(t){this.usingTouch=!0}hilightObject(t){this.hilightedObj=t}hilightStaffPos(t){this.hilightedStaffPos=t}updateCursorRect(t){this.cursorRect=t,this.draw()}updateCanvasSize(){let{canvas:t,doc:e}=this;if(t&&e){let i=e.getRect(),s=i.width+1,r=i.height+1;t.width=s,t.height=r,t.style.width=s/this.devicePixelRatio+"px",t.style.height=r/this.devicePixelRatio+"px"}}draw(){try{let{doc:t}=this;t&&(t.layout(),this.updateCanvasSize(),this.clearCanvas(),this.drawHilightStaffPosRect(),this.drawHilightObjectRect(),this.drawPlayCursor(),t.drawContent())}catch(t){console.error("Render failed!",t)}}drawHilightStaffPosRect(){let{mousePos:t,hilightedStaffPos:e,unitSize:i}=this;if(!e)return;let{scoreRow:s,diatonicId:r}=e,n=s.getStaff(r);n&&(this.fillColor(this.paint.colors["hilight.staffpos"]),this.fillRect(n.row.getRect().left,n.getDiatonicIdY(r)-i,n.row.getRect().width,2*i),void 0!==t&&this.drawLedgerLines(n,r,t.x))}drawHilightObjectRect(){let{hilightedObj:t}=this;if(!t)return;let e=t.getRect();this.lineColor(this.paint.colors["hilight.object"]),this.strokeRect(e.left,e.top,e.width,e.height)}drawPlayCursor(){let{cursorRect:t}=this;t&&this.color(this.paint.colors["play.cursor"]).lineWidth(2).strokeLine(t.centerX,t.top,t.centerX,t.bottom)}txFromScreenCoord(t){return t.mul(this.devicePixelRatio)}txToScreenCoord(t){return t.div(this.devicePixelRatio)}clearCanvas(){this.ctx&&(this.ctx.canvas.style.background=this.getPaint().colors.background,this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height))}drawDebugRect(t){B&&this.color("red").lineWidth(1).strokeRect(t.left,t.top,t.width,t.height)}drawLedgerLines(t,e,i){let{unitSize:s}=this,r=s*rt;if(e>=t.topLineDiatonicId+2){for(let n=t.topLineDiatonicId+2;n<=e;n+=2)if(t.containsDiatonicId(n)){let e=t.getDiatonicIdY(n);this.strokeLine(i-r/2,e,i+r/2,e)}}else if(e<=t.bottomLineDiatonicId-2)for(let n=t.bottomLineDiatonicId-2;n>=e;n-=2)if(t.containsDiatonicId(n)){let e=t.getDiatonicIdY(n);this.strokeLine(i-r/2,e,i+r/2,e)}}getRestRect(t){let{unitSize:e}=this,{flagCount:i}=r.Xp.get((0,r.PW)(t+"n")),s=0,o=0,a=0,h=0;if(r.Xp.equals(t,"1n"))s=e,o=e,a=0,h=e;else if(r.Xp.equals(t,"2n"))s=e,o=e,a=e,h=0;else if(r.Xp.equals(t,"4n"))s=1*e,o=1*e,a=3.2*e,h=3*e;else{let t=1-i%2;s=e*(1+.25*i),o=e*(1+.125*i),a=e*(.5+i-t),h=e*(1+i+t)}return new n.vW(-s,0,o,-a,0,h)}drawRest(t,e,i){let{unitSize:s}=this,{flagCount:n}=r.Xp.get((0,r.PW)(t+"n"));if(r.Xp.equals(t,"1n"))this.fillRect(e-s,i,2*s,s);else if(r.Xp.equals(t,"2n"))this.fillRect(e-s,i-s,2*s,s);else if(r.Xp.equals(t,"4n"))this.beginPath(),this.moveTo(e-.6*s,i-3.2*s),this.lineTo(e+.7*s,i-1.5*s),this.quadraticCurveTo(e-.8*s,i-.5*s,e+1*s,i+1.5*s),this.lineTo(e-1*s,i-.75*s),this.quadraticCurveTo(e+.2*s,i-1.5*s,e-.6*s,i-3.2*s),this.moveTo(e+1*s,i+1.5*s),this.quadraticCurveTo(e-.8*s,i+1*s,e-.2*s,i+2.8*s),this.bezierCurveTo(e-1.8*s,i+1.5*s,e-.6*s,i-.2*s,e+.9*s,i+1.5*s),this.fill(),this.stroke();else if(n>0){let t=1-n%2,r=t=>e+(.25*-t+.5)*s,o=e=>i+(e+t)*s;this.beginPath(),this.moveTo(r(1+n),o(1+n)),this.lineTo(r(-.5-n),o(-.5-n)),this.stroke();for(let e=0;e<n;e++){let t=n-2*e;this.beginPath(),this.moveTo(r(t-2.5),o(t-2.5)),this.quadraticCurveTo(r(t-.5)+.25*s,o(t-1.5),r(t-1.5)-1.5*s,o(t-1.5)),this.stroke(),this.beginPath(),this.arc(r(t-2)-1.5*s,o(t-2),.5*s,0,2*Math.PI),this.fill()}}}drawFlag(t,e){let i=t.left,s=t.right-i,r="up"===e?t.top:t.bottom,n="up"===e?t.bottom:t.top;this.beginPath(),this.moveTo(i,r),this.bezierCurveTo(i,.75*r+.25*n,i+1.5*s,.5*r+.5*n,i+.5*s,n),this.stroke()}color(t){return this.ctx&&(this.ctx.strokeStyle=this.ctx.fillStyle=this.paint.getColor(t)),this}lineColor(t){return this.ctx&&(this.ctx.strokeStyle=this.paint.getColor(t)),this}fillColor(t){return this.ctx&&(this.ctx.fillStyle=this.paint.getColor(t)),this}lineWidth(t){return this.ctx&&(this.ctx.lineWidth=this._lineWidth*(null!=t?t:1)),this}font(t){return this.ctx&&(this.ctx.font=t),this}beginPath(){return this.ctx&&this.ctx.beginPath(),this}stroke(){return this.ctx&&this.ctx.stroke(),this}fill(){return this.ctx&&this.ctx.fill(),this}moveTo(t,e){return this.ctx&&this.ctx.moveTo(t,e),this}lineTo(t,e){return this.ctx&&this.ctx.lineTo(t,e),this}bezierCurveTo(t,e,i,s,r,n){return this.ctx&&this.ctx.bezierCurveTo(t,e,i,s,r,n),this}quadraticCurveTo(t,e,i,s){return this.ctx&&this.ctx.quadraticCurveTo(t,e,i,s),this}fillRect(t,e,i,s){return this.ctx&&this.ctx.fillRect(t,e,i,s),this}setLineDash(t){return this.ctx&&this.ctx.setLineDash(t),this}drawImage(t,e,i,s,r){return this.ctx&&this.ctx.drawImage(t,e,i,s,r),this}ellipse(t,e,i,s,r,n,o){return this.ctx&&this.ctx.ellipse(t,e,i,s,r,n,o),this}clip(){return this.ctx&&this.ctx.clip(),this}save(){return this.ctx&&this.ctx.save(),this}restore(){return this.ctx&&this.ctx.restore(),this}rect(t,e,i,s){return this.ctx&&this.ctx.rect(t,e,i,s),this}scale(t,e){return this.ctx&&this.ctx.scale(t,e),this}strokeRect(t,e,i,s){return this.ctx&&this.ctx.strokeRect(t,e,i,s),this}fillText(t,e,i){return this.ctx&&this.ctx.fillText(t,e,i),this}getTextWidth(t,e){if(this.ctx){let i=this.ctx.font;this.ctx.font=e;let s=this.ctx.measureText(t);return this.ctx.font=i,s.width}return n.OZ.Dom.getCanvasTextWidth(t,e)}arc(t,e,i,s,r){return this.ctx&&this.ctx.arc(t,e,i,s,r),this}fillCircle(t,e,i){return this.ctx?(this.ctx.beginPath(),this.ctx.arc(t,e,i,0,2*Math.PI),this.ctx.fill(),this):this}strokeLine(t,e,i,s){return this.ctx?(this.ctx.beginPath(),this.ctx.moveTo(t,e),this.ctx.lineTo(i,s),this.ctx.stroke(),this):this}strokePartialLine(t,e,i,s,r,n){if(!this.ctx)return this;let o=t+(i-t)*r,a=e+(s-e)*r,h=t+(i-t)*n,c=e+(s-e)*n;return this.ctx.beginPath(),this.ctx.moveTo(o,a),this.ctx.lineTo(h,c),this.ctx.stroke(),this}drawBracket(t,e){if(!this.ctx)return this;let{left:i,right:s,width:r,top:n,bottom:o,height:a,anchorY:h}=t;switch([")","]","}",">"].includes(e)&&([i,s,r]=[s,i,-r]),e){case"(":case")":this.ctx.beginPath(),this.ctx.moveTo(s,n),this.ctx.bezierCurveTo(i-.2*r,n+.3*a,i-.2*r,n+.7*a,s,o),this.ctx.stroke();break;case"{":case"}":this.ctx.beginPath(),this.ctx.moveTo(s,n),this.ctx.bezierCurveTo(i+.1*r,n,i+.8*r,h,i,h),this.ctx.moveTo(s,o),this.ctx.bezierCurveTo(i+.1*r,o,i+.8*r,h,i,h),this.ctx.stroke();break;case"[":case"]":this.ctx.beginPath(),this.ctx.moveTo(s,n),this.ctx.lineTo(i,n),this.ctx.lineTo(i,o),this.ctx.lineTo(s,o),this.ctx.stroke();break;case"<":case">":this.ctx.beginPath(),this.ctx.moveTo(s,n),this.ctx.lineTo(i,h),this.ctx.lineTo(s,o),this.ctx.stroke()}return this}},lt=class{constructor(t){this.measure=t,(0,o.Mu)(this,"accidentalByDiatonicId",[])}getAccidentalFromKeySignature(t){let e=this.measure.getKeySignature().getOrderedAccidentalNotes().find(e=>e.diatonicClass===a.Note.getDiatonicClass(t));return e?e.accidental:void 0}setAccidental(t){this.accidentalByDiatonicId[t.diatonicId]=t.accidental}needAccidental(t){var e,i;let s=null!=(i=null!=(e=this.accidentalByDiatonicId[t.diatonicId])?e:this.getAccidentalFromKeySignature(t.diatonicId))?i:0;return t.accidental!==s}},dt=class extends G{constructor(t,e,i,s,r){super(t),this.image=e,this.anchorX=i,this.anchorY=s,this.imageScale=r,(0,o.Mu)(this,"mi"),this.mi=new ei(this)}getMusicInterface(){return this.mi}pick(t,e){return this.rect.contains(t,e)?[this]:[]}layout(t){let{anchorX:e,anchorY:i,image:s,imageScale:r}=this,{unitSize:o}=t;try{let t=s.naturalWidth*r*o,a=s.naturalHeight*r*o;this.rect=n.vW.createSections(t*e,t*(1-e),a*i,a*(1-i))}catch(a){this.rect=new n.vW}}offset(t,e){this.rect.offsetInPlace(t,e)}draw(t){let e=this.rect;t.drawDebugRect(e),t.drawImage(this.image,e.anchorX-e.leftw,e.anchorY-e.toph,e.width,e.height)}},ft=class extends G{constructor(t,e,i,s="black"){super(t),this.diatonicId=e,this.accidental=i,this.color=s,(0,o.Mu)(this,"mi"),this.mi=new Ge(this)}getMusicInterface(){return this.mi}pick(t,e){return this.rect.contains(t,e)?[this]:[]}layout(t){let{unitSize:e}=t;switch(this.accidental){case-2:this.rect=n.vW.createSections(1.25*e,1.25*e,4*e,1.2*e);break;case-1:this.rect=n.vW.createSections(.75*e,.75*e,4*e,1.2*e);break;case 0:this.rect=n.vW.createSections(.75*e,.75*e,2.2*e,2.2*e);break;case 1:this.rect=n.vW.createSections(.75*e,.75*e,2*e,2*e);break;case 2:this.rect=n.vW.createSections(1*e,1*e,1*e,1*e);break;default:throw new h.MusicError(h.MusicErrorType.Score,"Invalid accidental value: "+this.accidental)}}offset(t,e){this.rect.offsetInPlace(t,e)}draw(t){t.drawDebugRect(this.rect);let{unitSize:e}=t,{accidental:i}=this,s=this.rect.anchorX,r=this.rect.anchorY;t.color(this.color);const n=(i,s)=>{t.lineWidth(1).beginPath().moveTo(i-.75*e,s-4*e).lineTo(i-.75*e,s+1.1*e).bezierCurveTo(i+.75*e,s-0*e,i+.75*e,s-2.2*e,i-.75*e,s-.5*e).stroke()};-2===i?(n(s-.5*e,r),n(s+.5*e,r)):-1===i&&n(s,r),0===i?t.beginPath().lineWidth(1).moveTo(s-.5*e,r-2.2*e).lineTo(s-.5*e,r+1*e).moveTo(s+.5*e,r+2.2*e).lineTo(s+.5*e,r-1*e).stroke().beginPath().lineWidth(2).moveTo(s-.5*e,r+1*e).lineTo(s+.5*e,r+.6*e).moveTo(s+.5*e,r-1*e).lineTo(s-.5*e,r-.6*e).stroke():1===i?t.lineWidth(1).beginPath().moveTo(s-.3*e,r-1.6*e).lineTo(s-.3*e,r+2*e).moveTo(s+.3*e,r-2*e).lineTo(s+.3*e,r+1.6*e).stroke().lineWidth(2).beginPath().moveTo(s-.75*e,r-.5*e).lineTo(s+.75*e,r-.9*e).moveTo(s-.75*e,r+.9*e).lineTo(s+.75*e,r+.5*e).stroke():2===i&&t.lineWidth(1).beginPath().moveTo(s-.75*e,r-.75*e).lineTo(s+.75*e,r+.75*e).moveTo(s-.75*e,r+.75*e).lineTo(s+.75*e,r-.75*e).stroke().fillRect(s-1*e,r-1*e,.7*e,.7*e).fillRect(s+.3*e,r-1*e,.7*e,.7*e).fillRect(s-1*e,r+.3*e,.7*e,.7*e).fillRect(s+.3*e,r+.3*e,.7*e,.7*e)}},It=class extends G{constructor(t,e,i,s){var r,a,h,c,u,g;super(t),this.anchorX=i,this.anchorY=s,(0,o.Mu)(this,"text"),(0,o.Mu)(this,"scale"),(0,o.Mu)(this,"color"),(0,o.Mu)(this,"bold"),(0,o.Mu)(this,"italic"),(0,o.Mu)(this,"boxed"),(0,o.Mu)(this,"padding"),(0,o.Mu)(this,"bgcolor"),(0,o.Mu)(this,"font",""),(0,o.Mu)(this,"textLines"),(0,o.Mu)(this,"lineWidths",[]),(0,o.Mu)(this,"lineHeight",0),(0,o.Mu)(this,"mi");let l="string"==typeof e?{text:e}:e;this.text=l.text,this.scale=null!=(r=l.scale)?r:1,this.color=null!=(a=l.color)?a:"black",this.bold=null!=(h=l.bold)&&h,this.italic=null!=(c=l.italic)&&c,this.boxed=null!=(u=l.boxed)&&u,this.padding=null!=(g=l.padding)?g:this.boxed?.5:0,this.bgcolor=l.bgcolor,(!isFinite(this.padding)||this.padding<0)&&(this.padding=0),this.textLines=this.text.split("\n"),0===this.textLines.length&&(this.textLines=[""]),this.rect=new n.vW,this.mi=new Yi(this)}getMusicInterface(){return this.mi}getText(){return this.text}pick(t,e){return this.rect.contains(t,e)?[this]:[]}layout(t){let{scale:e,anchorX:i,anchorY:s,bold:r,italic:o}=this,a=t.fontSize*e;this.font=(o?"italic ":"")+(r?"bold ":"")+a+"px Times New Roman",this.lineWidths=this.textLines.map(e=>t.getTextWidth(e,this.font)),this.lineHeight=a;let h=this.padding*t.unitSize,c=h+Math.max(...this.lineWidths)+h,u=h+this.lineHeight*this.textLines.length+h;"square"!==this.boxed&&"circle"!==this.boxed||(u=c=Math.max(u,c)),this.rect=n.vW.createSections(c*i,c*(1-i),u*s,u*(1-s))}offset(t,e){this.rect.offsetInPlace(t,e)}draw(t){var e;t.drawDebugRect(this.rect),t.lineWidth(1).font(this.font);let{rect:i,padding:s,lineHeight:r,lineWidths:n,anchorX:o,anchorY:a,italic:h}=this;void 0!==this.bgcolor&&(t.save(),t.fillColor(null!=(e=this.bgcolor)?e:"black"),t.beginPath(),t.fillRect(i.left,i.top,i.width,i.height),t.fill(),t.restore());let c=this.textLines.length*r,u=-r*(h?.25:.2),g=s*t.unitSize,l=(i.left+g)*(1-o)+(i.right-g)*o,d=(i.top+g)*(1-a)+(i.bottom-g)*a;switch(t.color(this.color),this.textLines.forEach((e,i)=>{let s=l-n[i]*o,h=d-c*a+r*(i+1)+u;t.fillText(e,s,h)}),this.boxed){case"square":case"rectangle":t.strokeRect(i.left,i.top,i.width,i.height);break;case"circle":case"ellipse":t.beginPath(),t.ellipse(i.centerX,i.centerY,i.width/2,i.height/2,0,0,2*Math.PI),t.stroke()}}},mt=class extends G{constructor(t,e){super(t),this.measure=t,this.staff=e,(0,o.Mu)(this,"clefImage"),(0,o.Mu)(this,"eightBelowClef"),(0,o.Mu)(this,"measureNumber"),(0,o.Mu)(this,"ksNeutralizeAccidentals",[]),(0,o.Mu)(this,"ksNewAccidentals",[]),(0,o.Mu)(this,"beatCountText"),(0,o.Mu)(this,"beatSizeText"),(0,o.Mu)(this,"tempoText"),(0,o.Mu)(this,"mi"),this.mi=new ji(this)}get doc(){return this.measure.doc}getMusicInterface(){return this.mi}updateClefImage(t,e){if(e){let e=t.getPaint().getColor("staff.signature.clef");["black","#000","#000000"].includes(e)&&(e="");let i=t.getImageAsset(this.staff.clefImageAsset,e);this.clefImage=i?new dt(this,i,0,.5,.1):void 0,this.eightBelowClef=this.clefImage&&this.staff.isOctaveDown?new It(this,{text:"8",color:e},.5,0):void 0}else this.clefImage=void 0}updateMeasureNumber(t){if(t){let t="staff.signature.measurenum",e=this.measure.getMeasureNumber().toString();this.measureNumber=new It(this,{text:e,color:t},0,1)}else this.measureNumber=void 0}updateKeySignature(t){if(t){let{measure:t}=this,e="staff.signature.key",i=t.getPrevMeasure(),s=i?i.getKeySignature():void 0,r=t.getKeySignature();this.ksNeutralizeAccidentals=[],this.ksNewAccidentals=[],s&&!a.KeySignature.equals(r,s)&&s.getOrderedAccidentalNotes().forEach(t=>{this.ksNeutralizeAccidentals.push(new ft(this,this.getAccidentalDiatonicId(t),0,e))}),r.getOrderedAccidentalNotes().forEach(t=>{this.ksNewAccidentals.push(new ft(this,this.getAccidentalDiatonicId(t),t.accidental,e))})}else this.ksNeutralizeAccidentals=[],this.ksNewAccidentals=[]}updateTimeSignature(t){if(t){let t=this.measure.getTimeSignature(),e="staff.signature.time",i=t.beatCount.toString();this.beatCountText=new It(this,{text:i,color:e,scale:1.4},.5,.5);let s=t.beatSize.toString();this.beatSizeText=new It(this,{text:s,color:e,scale:1.4},.5,.5)}else this.beatCountText=this.beatSizeText=void 0}updateTempo(t){if(t){let t="staff.signature.tempo",e=(0,a.getTempoString)(this.measure.getTempo());this.tempoText=new It(this,{text:e,color:t},.5,1)}else this.tempoText=void 0}getAccidentalDiatonicId(t){let e,{clef:i}=this.staff.staffConfig;if("G"===i?t.accidental>0?e=this.staff.bottomLineDiatonicId+3:t.accidental<0&&(e=this.staff.bottomLineDiatonicId+1):"F"===i&&(t.accidental>0?e=this.staff.bottomLineDiatonicId+1:t.accidental<0&&(e=this.staff.bottomLineDiatonicId-1)),void 0!==e)return a.Note.findNextDiatonicIdAbove(t.diatonicId,e,!1);throw new h.MusicError(h.MusicErrorType.Score,"Cannot get accidental diatonicId because note has no accidental.")}pick(t,e){if(!this.rect.contains(t,e))return[];if(this.eightBelowClef){let i=this.eightBelowClef.pick(t,e);if(i.length>0)return[this,...i]}if(this.clefImage){let i=this.clefImage.pick(t,e);if(i.length>0)return[this,...i]}for(let i=0;i<this.ksNeutralizeAccidentals.length;i++){let s=this.ksNeutralizeAccidentals[i].pick(t,e);if(s.length>0)return[this,...s]}for(let i=0;i<this.ksNewAccidentals.length;i++){let s=this.ksNewAccidentals[i].pick(t,e);if(s.length>0)return[this,...s]}if(this.beatCountText){let i=this.beatCountText.pick(t,e);if(i.length>0)return[this,...i]}if(this.beatSizeText){let i=this.beatSizeText.pick(t,e);if(i.length>0)return[this,...i]}if(this.tempoText){let i=this.tempoText.pick(t,e);if(i.length>0)return[this,...i]}if(this.measureNumber){let i=this.measureNumber.pick(t,e);if(i.length>0)return[this,...i]}return[this]}layout(t){var e,i,s,r,o,a;let{unitSize:h}=t,{staff:c}=this,u=h,g=0;if(this.rect=new n.vW,this.clefImage&&(g+=u,this.clefImage.layout(t),this.clefImage.setAnchor(g,c.getDiatonicIdY(c.clefLineDiatonicId)),this.rect.expandInPlace(this.clefImage.getRect()),g=this.rect.right,this.eightBelowClef)){let e=this.clefImage.getRect();this.eightBelowClef.layout(t),this.eightBelowClef.setCenterX(e.centerX),this.eightBelowClef.setTop(Math.max(e.anchorY+.3*e.height,c.getBottomLineY())),this.rect.expandInPlace(this.eightBelowClef.getRect())}this.measureNumber&&(this.measureNumber.layout(t),this.measureNumber.setLeft(0),this.measureNumber.setBottom(Math.min(c.getTopLineY(),this.clefImage?this.clefImage.getRect().top:c.getTopLineY())),this.rect.expandInPlace(this.measureNumber.getRect()),g=Math.max(g,this.rect.right)),this.ksNeutralizeAccidentals.length>0&&(g+=u,this.ksNeutralizeAccidentals.forEach(e=>{e.layout(t),e.setLeft(g),e.setAnchorY(c.getDiatonicIdY(e.diatonicId)),this.rect.expandInPlace(e.getRect()),g=this.rect.right})),this.ksNewAccidentals&&(g+=u,this.ksNewAccidentals.forEach(e=>{e.layout(t),e.setLeft(g),e.setAnchorY(c.getDiatonicIdY(e.diatonicId)),this.rect.expandInPlace(e.getRect()),g=this.rect.right}));let l=g;null==(e=this.beatCountText)||e.layout(t),null==(i=this.beatSizeText)||i.layout(t);let d=Math.max(null!=(r=null==(s=this.beatCountText)?void 0:s.getRect().width)?r:0,null!=(a=null==(o=this.beatSizeText)?void 0:o.getRect().width)?a:0);this.beatCountText&&(this.beatCountText.setCenter(g+d/2+u,c.getDiatonicIdY(c.middleLineDiatonicId+2)),this.rect.expandInPlace(this.beatCountText.getRect()),l=Math.max(l,this.rect.right)),this.beatSizeText&&(this.beatSizeText.setCenter(g+d/2+u,c.getDiatonicIdY(c.bottomLineDiatonicId+2)),this.rect.expandInPlace(this.beatSizeText.getRect()),l=Math.max(l,this.rect.right)),g=l,this.tempoText&&(this.tempoText.layout(t),this.tempoText.setCenterX(g),this.tempoText.setBottom(c.getTopLineY()),this.clefImage&&n.vW.overlap(this.clefImage.getRect(),this.tempoText.getRect())&&this.tempoText.setBottom(this.clefImage.getRect().top),[...this.ksNeutralizeAccidentals,...this.ksNewAccidentals].forEach(t=>{this.tempoText&&n.vW.overlap(t.getRect(),this.tempoText.getRect())&&this.tempoText.setBottom(t.getRect().top)}),this.rect.expandInPlace(this.tempoText.getRect())),this.rect.right+=u}offset(t,e){var i,s,r,n,o,a;null==(i=this.clefImage)||i.offset(t,e),null==(s=this.eightBelowClef)||s.offset(t,e),null==(r=this.measureNumber)||r.offset(t,e),this.ksNeutralizeAccidentals.forEach(i=>i.offset(t,e)),this.ksNewAccidentals.forEach(i=>i.offset(t,e)),null==(n=this.beatCountText)||n.offset(t,e),null==(o=this.beatSizeText)||o.offset(t,e),null==(a=this.tempoText)||a.offset(t,e),this.rect.offsetInPlace(t,e)}draw(t){var e,i,s,r,n,o;null==(e=this.clefImage)||e.draw(t),null==(i=this.eightBelowClef)||i.draw(t),null==(s=this.measureNumber)||s.draw(t),this.ksNeutralizeAccidentals.forEach(e=>e.draw(t)),this.ksNewAccidentals.forEach(e=>e.draw(t)),null==(r=this.beatCountText)||r.draw(t),null==(n=this.beatSizeText)||n.draw(t),null==(o=this.tempoText)||o.draw(t)}},Ct=class extends G{constructor(t,e){super(t),this.measure=t,this.tab=e,(0,o.Mu)(this,"measureNumber"),(0,o.Mu)(this,"beatCountText"),(0,o.Mu)(this,"beatSizeText"),(0,o.Mu)(this,"tempoText"),(0,o.Mu)(this,"mi"),this.mi=new Oi(this)}getMusicInterface(){return this.mi}get doc(){return this.measure.doc}updateMeasureNumber(t){if(t){let t="tab.signature.measurenum",e=this.measure.getMeasureNumber().toString();this.measureNumber=new It(this,{text:e,color:t},0,1)}else this.measureNumber=void 0}updateTimeSignature(t){if(t){let t=this.measure.getTimeSignature(),e="tab.signature.time",i=t.beatCount.toString();this.beatCountText=new It(this,{text:i,color:e,scale:1.4},.5,.5);let s=t.beatSize.toString();this.beatSizeText=new It(this,{text:s,color:e,scale:1.4},.5,.5)}else this.beatCountText=this.beatSizeText=void 0}updateTempo(t){if(t){let t="tab.signature.tempo",e=(0,a.getTempoString)(this.measure.getTempo());this.tempoText=new It(this,{text:e,color:t},0,1)}else this.tempoText=void 0}pick(t,e){if(!this.rect.contains(t,e))return[];if(this.beatCountText){let i=this.beatCountText.pick(t,e);if(i.length>0)return[this,...i]}if(this.beatSizeText){let i=this.beatSizeText.pick(t,e);if(i.length>0)return[this,...i]}if(this.tempoText){let i=this.tempoText.pick(t,e);if(i.length>0)return[this,...i]}if(this.measureNumber){let i=this.measureNumber.pick(t,e);if(i.length>0)return[this,...i]}return[this]}layout(t){var e,i,s,r,o,a;let{unitSize:h}=t,{tab:c}=this,u=h,g=0,l=c.getTopLineY();this.rect=new n.vW,this.measureNumber&&(this.measureNumber.layout(t),this.measureNumber.setLeft(0),this.measureNumber.setBottom(l),this.rect.expandInPlace(this.measureNumber.getRect()),g=Math.max(g,this.rect.right)),null==(e=this.beatCountText)||e.layout(t),null==(i=this.beatSizeText)||i.layout(t);let d=Math.max(null!=(r=null==(s=this.beatCountText)?void 0:s.getRect().width)?r:0,null!=(a=null==(o=this.beatSizeText)?void 0:o.getRect().width)?a:0);this.beatCountText&&(this.beatCountText.setCenter(0+d/2+u,c.getRect().anchorY-this.beatCountText.getRect().bottomh),this.rect.expandInPlace(this.beatCountText.getRect())),this.beatSizeText&&(this.beatSizeText.setCenter(0+d/2+u,c.getRect().anchorY+this.beatSizeText.getRect().toph),this.rect.expandInPlace(this.beatSizeText.getRect())),this.tempoText&&(this.tempoText.layout(t),this.tempoText.setLeft(g+2*h),this.tempoText.setBottom(l),this.rect.expandInPlace(this.tempoText.getRect())),this.rect.right+=u}offset(t,e){var i,s,r,n;null==(i=this.measureNumber)||i.offset(t,e),null==(s=this.beatCountText)||s.offset(t,e),null==(r=this.beatSizeText)||r.offset(t,e),null==(n=this.tempoText)||n.offset(t,e),this.rect.offsetInPlace(t,e)}draw(t){var e,i,s,r;null==(e=this.measureNumber)||e.draw(t),null==(i=this.beatCountText)||i.draw(t),null==(s=this.beatSizeText)||s.draw(t),null==(r=this.tempoText)||r.draw(t)}},pt=class extends G{constructor(t,e,i){super(t),this.col=t,this.line=e,this.arpeggioDir=i,(0,o.Mu)(this,"topArrowHeight",0),(0,o.Mu)(this,"bottomArrowHeight",0),(0,o.Mu)(this,"cycleHeight",0),(0,o.Mu)(this,"numCycles",0),(0,o.Mu)(this,"color","black"),(0,o.Mu)(this,"mi"),this.mi=new Ue(this)}getMusicInterface(){return this.mi}pick(t,e){return this.rect.contains(t,e)?[this]:[]}layout(t){let{unitSize:e}=t;this.topArrowHeight="up"===this.arpeggioDir?e:0,this.bottomArrowHeight="down"===this.arpeggioDir?e:0;let i=this.line.getTopLineY(),s=this.line.getBottomLineY();this.cycleHeight=2*e,this.numCycles=Math.ceil((s-i)/this.cycleHeight)+2;let r=2*e,o=this.numCycles*this.cycleHeight;this.rect=new n.vW(-r/2,r/2,-o/2-this.topArrowHeight,o/2+this.bottomArrowHeight)}offset(t,e){this.rect.offsetInPlace(t,e)}draw(t){let{rect:e,topArrowHeight:i,bottomArrowHeight:s}=this;t.drawDebugRect(this.rect),t.color(this.color),t.lineWidth(2),t.beginPath();for(let r=0,n=e.top+i;r<this.numCycles;r++,n+=this.cycleHeight)t.moveTo(e.anchorX,n),t.quadraticCurveTo(e.left,n+this.cycleHeight/4,e.anchorX,n+this.cycleHeight/2),t.quadraticCurveTo(e.right,n+3*this.cycleHeight/4,e.anchorX,n+this.cycleHeight);t.stroke(),i>0&&(t.beginPath(),t.moveTo(e.anchorX,e.top),t.lineTo(e.right,e.top+i),t.lineTo(e.left,e.top+i),t.fill()),s>0&&(t.beginPath(),t.moveTo(e.anchorX,e.bottom),t.lineTo(e.left,e.bottom-s),t.lineTo(e.right,e.bottom-s),t.fill())}};var At=class extends G{constructor(t,e){super(t),this.staff=t,this.rest=e,(0,o.Mu)(this,"restRect",new n.vW),(0,o.Mu)(this,"dotRects",[]),(0,o.Mu)(this,"mi"),t.addObject(this),this.mi=new Ai(this)}getMusicInterface(){return this.mi}pick(t,e){return this.getRect().contains(t,e)?[this]:[]}offset(t,e){this.restRect.offsetInPlace(t,e),this.dotRects.forEach(i=>i.offsetInPlace(t,e)),this.requestRectUpdate(),this.rest.requestRectUpdate()}updateRect(){this.rect=this.restRect.clone(),this.dotRects.forEach(t=>this.rect.expandInPlace(t))}},bt=class t extends G{constructor(e,i,s,r,n){var h,c,u,g,l;super(e),this.col=e,this.voiceId=i,this.options=r,(0,o.Mu)(this,"color"),(0,o.Mu)(this,"hide"),(0,o.Mu)(this,"oldStyleTriplet"),(0,o.Mu)(this,"rhythmProps"),(0,o.Mu)(this,"setDiatonicId"),(0,o.Mu)(this,"runningDiatonicId"),(0,o.Mu)(this,"runningStemDir"),(0,o.Mu)(this,"beamGroup"),(0,o.Mu)(this,"staffObjects",[]),(0,o.Mu)(this,"mi"),this.setDiatonicId=null!=(c="number"==typeof(l=null==(h=this.options)?void 0:h.staffPos)?a.Note.getChromaticNote(l).diatonicId:"string"==typeof l?a.Note.getNote(l).diatonicId:l instanceof a.Note?l.diatonicId:void 0)?c:t.UndefinedDiatonicId;let d=this.row.getStaves().filter(t=>t.containsVoiceId(this.voiceId));this.setDiatonicId!==t.UndefinedDiatonicId&&d.length>0&&d[0].isSpace(this.setDiatonicId)&&(this.setDiatonicId+=this.setDiatonicId>=d[0].middleLineDiatonicId?1:-1),this.runningDiatonicId=this.setDiatonicId,this.runningStemDir="up",this.color=null!=(u=null==r?void 0:r.color)?u:"staff.rest",this.hide=null!=(g=null==r?void 0:r.hide)&&g,this.oldStyleTriplet=void 0===n&&a.NoteLengthProps.get(s).isTriplet,this.rhythmProps=a.RhythmProps.get(s,void 0,(null!=n?n:this.oldStyleTriplet)?a.Tuplet.Triplet:void 0),this.mi=new Ci(this)}getMusicInterface(){return this.mi}get doc(){return this.col.doc}get measure(){return this.col.measure}get row(){return this.col.row}get noteLength(){return this.rhythmProps.noteLength}getDiatonicId(e){return this.runningDiatonicId===t.UndefinedDiatonicId?e?a.NoteLengthProps.equals(this.noteLength,"1n")?e.middleLineDiatonicId+2:e.middleLineDiatonicId:a.Note.getNote("G4").diatonicId:this.runningDiatonicId}get stemDir(){return this.runningStemDir}updateRunningArguments(t,e,i){this.runningDiatonicId=t,this.runningStemDir=e}getStaticObjects(t){let e=[];return this.staffObjects.forEach(i=>{i.staff===t&&e.push(i)}),e}pick(t,e){if(!this.getRect().contains(t,e))return[];for(let i=0;i<this.staffObjects.length;i++){let s=this.staffObjects[i].pick(t,e);if(s.length>0)return[this,...s]}return[]}getBeamGroup(){return this.beamGroup}setBeamGroup(t){this.beamGroup=t}resetBeamGroup(){this.beamGroup=void 0}getBeamCoords(){return this.staffObjects.map(t=>{let e=t.staff,i=t.getRect().anchorX,s="up"===this.stemDir?t.getRect().top:t.getRect().bottom;return{staff:e,x:i,y:s,stemHeight:Math.abs(t.getRect().anchorY-s)}})}hasTuplet(){return void 0!==this.rhythmProps.tupletRatio}isEmpty(){return 0===this.staffObjects.length}visibleInStaff(t){return t.containsVoiceId(this.voiceId)&&this.staffObjects.some(e=>e instanceof At&&e.staff===t)}getRestDotVerticalDisplacement(t){switch(t){case 1:return 1;case 2:case 4:case 8:case 16:return-1;case 32:case 64:return-3;default:throw new h.MusicError(h.MusicErrorType.Score,`Get rest dot vertical displacement: Invalid note size: ${t}`)}}updateAccidentalState(t){}layout(t,e){if(this.requestRectUpdate(),this.staffObjects.length=0,this.hide)return;let{unitSize:i}=t,{noteSize:s,dotCount:r}=this.rhythmProps;this.row.getStaves().forEach(e=>{let o=this.getDiatonicId(e);if(!e.containsDiatonicId(o)||!e.containsVoiceId(this.voiceId))return;let a=new At(e,this);a.restRect=t.getRestRect(s);for(let t=0;t<r;t++){let e=J*i,r=a.restRect.rightw+(st+J*i)+t*J*i*1.5,o=this.getRestDotVerticalDisplacement(s)*i;a.dotRects.push(n.vW.createCentered(r,o,e,e))}a.setAnchor(0,e.getDiatonicIdY(o)),this.staffObjects.push(a),this.measure.addStaticObject(e,a)})}updateRect(){if(0===this.staffObjects.length)this.rect=new n.vW;else if(this.rect=this.staffObjects[0].getRect().clone(),this.staffObjects.length>1)for(let t=1;t<this.staffObjects.length;t++)this.rect.expandInPlace(this.staffObjects[t].getRect())}offset(t,e){this.staffObjects.forEach(e=>e.offset(t,0)),this.requestRectUpdate()}draw(t){if(0===this.staffObjects.length)return;t.drawDebugRect(this.getRect());let{noteSize:e}=this.rhythmProps;t.color(this.color).lineWidth(1),this.staffObjects.forEach(i=>{let{dotRects:s,restRect:r}=i;t.drawRest(e,r.anchorX,r.anchorY),s.forEach(e=>t.fillCircle(e.anchorX,e.anchorY,e.width/2))})}};(0,o.Mu)(bt,"UndefinedDiatonicId",1/0);var yt=bt;var Mt=class extends G{constructor(t,e){super(t),this.staff=t,this.noteGroup=e,(0,o.Mu)(this,"noteHeadRects",[]),(0,o.Mu)(this,"dotRects",[]),(0,o.Mu)(this,"accidentals",[]),(0,o.Mu)(this,"stemTip"),(0,o.Mu)(this,"stemBase"),(0,o.Mu)(this,"flagRects",[]),(0,o.Mu)(this,"prevTopNoteY",0),(0,o.Mu)(this,"prevBottomNoteY",0),(0,o.Mu)(this,"mi"),this.mi=new di(this)}getMusicInterface(){return this.mi}pick(t,e){if(!this.getRect().contains(t,e))return[];for(let i=0;i<this.accidentals.length;i++){let s=this.accidentals[i].pick(t,e);if(s.length>0)return[this,...s]}return[this]}updateRect(){this.rect=this.noteHeadRects[0].clone(),this.noteHeadRects.forEach(t=>this.rect.expandInPlace(t)),this.stemTip&&this.rect.expandInPlace(this.stemTip),this.stemBase&&this.rect.expandInPlace(this.stemBase),this.dotRects.forEach(t=>this.rect.expandInPlace(t)),this.flagRects.forEach(t=>this.rect.expandInPlace(t)),this.accidentals.forEach(t=>this.rect.expandInPlace(t.getRect()))}getRect(){let t=this.noteHeadRects[0],e=this.noteHeadRects[this.noteHeadRects.length-1];return this.prevTopNoteY===e.anchorY&&this.prevBottomNoteY===t.anchorY||(this.prevTopNoteY=e.anchorY,this.prevBottomNoteY=t.anchorY,this.requestRectUpdate()),super.getRect()}offset(t,e){var i,s;this.noteHeadRects.forEach(i=>i.offsetInPlace(t,e)),this.dotRects.forEach(i=>i.offsetInPlace(t,e)),this.accidentals.forEach(i=>i.offset(t,e)),null==(i=this.stemTip)||i.offsetInPlace(t,e),null==(s=this.stemBase)||s.offsetInPlace(t,e),this.flagRects.forEach(i=>i.offsetInPlace(t,e)),this.requestRectUpdate(),this.noteGroup.requestRectUpdate()}},vt=class extends G{constructor(t,e){super(t),this.tab=t,this.noteGroup=e,(0,o.Mu)(this,"fretNumbers",[]),(0,o.Mu)(this,"mi"),this.mi=new Ii(this)}getMusicInterface(){return this.mi}pick(t,e){return this.getRect().contains(t,e)?[this]:[]}updateRect(){this.rect=this.fretNumbers[0].getRect().clone(),this.fretNumbers.forEach(t=>this.rect.expandInPlace(t.getRect()))}offset(t,e){this.fretNumbers.forEach(i=>i.offset(t,e)),this.requestRectUpdate(),this.noteGroup.requestRectUpdate()}},wt=class t extends G{constructor(t,e,i,s,r,c){var u,g,l;if(super(t),this.col=t,this.voiceId=e,this.notes=i,this.options=r,(0,o.Mu)(this,"setDiatonicId"),(0,o.Mu)(this,"setStringsNumbers"),(0,o.Mu)(this,"runningDiatonicId"),(0,o.Mu)(this,"runningStemDir"),(0,o.Mu)(this,"runningStringNumbers"),(0,o.Mu)(this,"color"),(0,o.Mu)(this,"staccato"),(0,o.Mu)(this,"diamond"),(0,o.Mu)(this,"arpeggio"),(0,o.Mu)(this,"oldStyleTriplet"),(0,o.Mu)(this,"rhythmProps"),(0,o.Mu)(this,"startConnnectives",[]),(0,o.Mu)(this,"runningConnectives",[]),(0,o.Mu)(this,"leftBeamCount",0),(0,o.Mu)(this,"rightBeamCount",0),(0,o.Mu)(this,"beamGroup"),(0,o.Mu)(this,"staffObjects",[]),(0,o.Mu)(this,"tabObjects",[]),(0,o.Mu)(this,"isNoteDisplaced"),(0,o.Mu)(this,"mi"),!n.I8.isIntegerGte(i.length,1))throw new h.MusicError(h.MusicErrorType.Score,"Cannot create note group object because notes array is empty.");let{sortedNotes:d,sortedStrings:f}=function(t,e){let i=n.OZ.Arr.isArray(e)?e:void 0!==e?[e]:[],s=t.map((t,e)=>({note:t,string:i[e]}));return s=n.OZ.Arr.removeDuplicates(s,(t,e)=>a.Note.equals(t.note,e.note)).sort((t,e)=>a.Note.compareFunc(t.note,e.note)),{sortedNotes:s.map(t=>t.note),sortedStrings:s.every(t=>void 0===t.string)?void 0:s.map(t=>t.string)}}(i,null==r?void 0:r.string);var I;this.notes=d,this.setStringsNumbers=f,this.isNoteDisplaced=this.notes.map(()=>!1),this.setDiatonicId=Math.round((this.minDiatonicId+this.maxDiatonicId)/2),this.runningDiatonicId=this.setDiatonicId,this.runningStemDir="up",this.runningStringNumbers=[],this.color=null!=(u=null==r?void 0:r.color)?u:"staff.note",this.staccato=null!=(g=null==r?void 0:r.staccato)&&g,this.diamond=null!=(l=null==r?void 0:r.diamond)&&l,this.arpeggio=(I=null==r?void 0:r.arpeggio,n.I8.isEnumValue(I,M)?I:!0===I?"up":void 0),this.oldStyleTriplet=void 0===c&&a.NoteLengthProps.get(s).isTriplet,this.rhythmProps=a.RhythmProps.get(s,void 0,(null!=c?c:this.oldStyleTriplet)?a.Tuplet.Triplet:void 0),this.mi=new gi(this)}getMusicInterface(){return this.mi}get doc(){return this.col.doc}get measure(){return this.col.measure}get row(){return this.col.row}get minDiatonicId(){return this.notes[0].diatonicId}get maxDiatonicId(){return this.notes[this.notes.length-1].diatonicId}getDiatonicId(t){return this.runningDiatonicId}get stemDir(){return this.runningStemDir}setNoteDisplacement(t,e){let i=this.notes.indexOf(t);i>=0&&(this.isNoteDisplaced[i]=e)}enableConnective(t){return t.containsVoiceId(this.voiceId)&&(t instanceof ge||t.containsDiatonicId(this.runningDiatonicId))}startConnective(t){if(!this.row.hasStaff&&"tie"===t.connective)throw new h.MusicError(h.MusicErrorType.Score,"Ties not implemented for guitar tabs alone, staff is required!");if(!this.row.hasStaff&&"slur"===t.connective)throw new h.MusicError(h.MusicErrorType.Score,"Slurs not implemented for guitar tabs alone, staff is required!");this.startConnnectives.push(t),this.doc.addConnectiveProps(t)}updateRunningArguments(t,e,i){this.runningDiatonicId=t===yt.UndefinedDiatonicId?this.setDiatonicId:t,this.runningStemDir=e,this.runningStringNumbers=i}pick(t,e){if(!this.getRect().contains(t,e))return[];for(let i=0;i<this.staffObjects.length;i++){let s=this.staffObjects[i].pick(t,e);if(s.length>0)return[this,...s]}for(let i=0;i<this.tabObjects.length;i++){let s=this.tabObjects[i].pick(t,e);if(s.length>0)return[this,...s]}return[]}getTopNote(){return this.notes[this.notes.length-1]}getBottomNote(){return this.notes[0]}getConnectiveAnchorPoint(t,e,i,s,r){var n;if(!(e instanceof ue)){if(e instanceof ge){let s=null==(n=this.tabObjects.find(t=>t.tab===e))?void 0:n.fretNumbers[i];if(!s)return{x:0,y:0};let o,a=s.getRect(),h="right"===r?a.left:a.right,c=.9;if("slide"===t.connective){let i=t.noteGroups[0].getFretNumber(e,0),s=t.noteGroups[1].getFretNumber(e,0),n=void 0===i||void 0===s||i<=s;o="left"===r?(n?a.anchorY+a.bottomh:a.anchorY-a.toph)*c:(n?a.anchorY-a.toph:a.anchorY+a.bottomh)*c}else o=a.anchorY+a.bottomh*c;return{x:h,y:o}}return{x:0,y:0}}{if(i<0||i>=this.notes.length)throw new h.MusicError(h.MusicErrorType.Score,"Invalid noteIndex: "+i);let t=this.staffObjects.find(t=>t.staff===e);if(!t||i<0||i>=t.noteHeadRects.length){let t=this.getRect();return{x:t.anchorX,y:t.bottom}}let n=t.noteHeadRects[i],o=t.stemTip,a=this.stemDir,c=void 0!==o,u=c?"up"===a?"right":"left":void 0,g=n.height/2,l=n.anchorX,d=n.anchorY,f=n.left-g,I=n.right+g,m=n.top-g,C=n.bottom+g;switch("auto"===s?s="below":"stemTip"!==s||c||(s="up"===a?"above":"below"),s){case"center":return"left"===r?{x:I,y:d}:{x:f,y:d};case"above":return c&&"down"!==a?{x:"left"===r&&"right"===u?I:"right"===r&&"left"===u?f:l,y:m}:{x:l,y:m};case"below":return c&&"up"!==a?{x:"left"===r&&"right"===u?I:"right"===r&&"left"===u?f:l,y:C}:{x:l,y:C};case"stemTip":return{x:l,y:o.anchorY+("up"===a?-g:g)};default:throw new h.MusicError(h.MusicErrorType.Score,"Invalid noteAnchor: "+s)}}}getFretNumberString(t){return this.runningStringNumbers[t]}getFretNumber(t,e){let i=this.tabObjects.find(e=>e.tab===t),s=null==i?void 0:i.fretNumbers[e];return s?parseInt(s.getText()):void 0}getNextNoteGroup(){let e=this.measure.getVoiceSymbols(this.voiceId).filter(e=>e instanceof t),i=e.indexOf(this);if(i<0)return;if(i<e.length-1)return e[i+1];let s=this.measure.getNextMeasure();for(;s;){let e=s.getVoiceSymbols(this.voiceId).filter(e=>e instanceof t);if(e.length>0)return e[0];s=s.getNextMeasure()}}collectConnectiveProps(){this.startConnnectives.forEach(t=>{this.runningConnectives.push(t);let e=this.getNextNoteGroup();for(;e&&t.addNoteGroup(e);)e.runningConnectives.push(t),e=e.getNextNoteGroup()})}removeConnectiveProps(){this.runningConnectives=[]}getPlaySlur(){let t=this.runningConnectives.filter(t=>"slur"===t.connective).map(t=>t.startsWith(this)?"first":"slurred");return t.indexOf("first")>=0?"first":t.indexOf("slurred")>=0?"slurred":void 0}getBeamGroup(){return this.beamGroup}setBeamGroup(t){this.beamGroup=t}resetBeamGroup(){this.leftBeamCount=this.rightBeamCount=0,this.beamGroup=void 0}getBeamCoords(){return this.staffObjects.map(t=>{var e,i,s,r;let n=t.staff,o=null!=(i=null==(e=t.stemTip)?void 0:e.anchorX)?i:t.noteHeadRects[0].anchorX,a=null!=(r=null==(s=t.stemTip)?void 0:s.anchorY)?r:"up"===this.stemDir?t.getRect().top:t.getRect().bottom;return{staff:n,x:o,y:a,stemHeight:"up"===this.stemDir?Math.abs(t.noteHeadRects[0].anchorY-a):Math.abs(t.noteHeadRects[t.noteHeadRects.length-1].anchorY-a)}})}getStemHeight(t){let{unitSize:e}=t,{flagCount:i,hasStem:s}=this.rhythmProps;if(s){let t=this.hasBeamCount()?tt:$;return(K+Math.max(0,i-1)*t)*e}return 0}hasBeamCount(){return this.leftBeamCount>0||this.rightBeamCount>0}getLeftBeamCount(){return this.leftBeamCount}getRightBeamCount(){return this.rightBeamCount}setLeftBeamCount(t){this.leftBeamCount=t}setRightBeamCount(t){this.rightBeamCount=t}hasTuplet(){return void 0!==this.rhythmProps.tupletRatio}isEmpty(){return 0===this.staffObjects.length&&0===this.tabObjects.length}visibleInStaff(t){return t.containsVoiceId(this.voiceId)&&this.staffObjects.some(e=>e instanceof Mt&&e.staff===t)}getPlayTicks(t){let e=this.runningConnectives.filter(t=>"tie"===t.connective).map(e=>{let i=e.noteGroups,s=i.indexOf(this);if(s<0)return 0;if("stub"===e.span||"toMeasureEnd"===e.span)return Math.max(this.rhythmProps.ticks,this.measure.getMeasureTicks()-this.col.positionTicks);let r=i[s-1];return r&&r.notes.some(e=>a.Note.equals(e,t))?0:(i=i.slice(s),s=i.findIndex(e=>e.notes.every(e=>!a.Note.equals(e,t))),s>=0&&(i=i.slice(0,s)),n.OZ.Math.sum(i.map(t=>t.rhythmProps.ticks)))});return 0===e.length?this.rhythmProps.ticks:Math.max(...e)}updateAccidentalState(t){this.notes.forEach(e=>{t.needAccidental(e)&&t.setAccidental(e)})}layout(t,e){this.requestRectUpdate();let{unitSize:i}=t,{row:s,stemDir:r}=this,{dotCount:o,flagCount:a,hasStem:h}=this.rhythmProps,c=J*i,u=(this.diamond?X:H)*i,g=(this.diamond?X:q)*i;this.staffObjects.length=0,s.getStaves().forEach(s=>{if(!s.containsDiatonicId(this.runningDiatonicId)||!s.containsVoiceId(this.voiceId))return;let l=new Mt(s,this),d=s,f=s;this.notes.forEach((a,h)=>{var I;let m=0===h,C=h===this.notes.length-1,p=null!=(I=s.getActualStaff(a.diatonicId))?I:s,A=this.isNoteDisplaced[h]?u*("down"===r?-1:1):0,b=p.getDiatonicIdY(a.diatonicId),y=p.isLine(a.diatonicId);m&&"up"===r&&(d=p),C&&"up"===r&&(f=p),m&&"down"===r&&(f=p),C&&"down"===r&&(d=p);let M=l.noteHeadRects[h]=n.vW.createCentered(A,b,u,g);if(p.addObject(M),e.needAccidental(a)){let e=l.accidentals[h]=new ft(this,a.diatonicId,a.accidental,this.color);e&&(e.layout(t),e.setAnchor(-M.leftw-i*V-e.getRect().rightw,b)),p.addObject(e)}for(let t=0;t<o;t++){let e=M.right+F*i+c/2+t*c*1.5,o=b+this.getDotVerticalDisplacement(s,a.diatonicId,r)*i,h=n.vW.createCentered(e,o,c,c);l.dotRects.push(h),p.addObject(h)}if(this.staccato)if("up"===r&&m){let t=A,e=b+i*(y?3:2),s=n.vW.createCentered(t,e,c,c);l.dotRects.push(s),d.addObject(s)}else if("down"===r&&C){let t=A,e=b-i*(y?3:2),s=n.vW.createCentered(t,e,c,c);l.dotRects.push(s),d.addObject(s)}});let I=l.noteHeadRects[0].anchorY,m=l.noteHeadRects[l.noteHeadRects.length-1].anchorY,C="up"===r?u/2:-u/2,p=this.getStemHeight(t),A="up"===r?m-p:I+p,b="up"===r?I:m;if(h&&(l.stemTip=new n.vW(C,C,A,A),l.stemBase=new n.vW(C,C,b,b),f.addObject(l.stemTip),d.addObject(l.stemBase)),!this.hasBeamCount()){let t=0===a?0:Q*i,e=0===a?0:_*i;for(let s=0;s<a;s++){let o=s*i*$,a=l.flagRects[s]="up"===r?new n.vW(C,C+t,A+o,A+e+o):new n.vW(C,C+t,A-e-o,A-o);f.addObject(a)}}this.staffObjects.push(l),this.measure.addStaticObject(s,l)}),this.tabObjects.length=0,s.getTabs().forEach(e=>{if(!e.containsVoiceId(this.voiceId))return;let i=new vt(e,this);this.notes.forEach((s,r)=>{let o=this.runningStringNumbers[r];if(n.I8.isIntegerBetween(o,1,6)){let r=s.chromaticId-e.getTuningStrings()[o-1].chromaticId,n=new It(this,{text:String(r),color:"tab.note",bgcolor:"background"},.5,.5);n.layout(t),n.setAnchor(this.col.getRect().anchorX,e.getStringY(o-1)),i.fretNumbers.push(n)}}),i.fretNumbers.length>0&&(this.tabObjects.push(i),e.addObject(i),this.measure.addStaticObject(e,i))})}updateRect(){if(this.staffObjects.length>0)this.rect=this.staffObjects[0].noteHeadRects[0].clone();else{if(!(this.tabObjects.length>0&&this.tabObjects[0].fretNumbers.length>0))return void(this.rect=new n.vW);this.rect=this.tabObjects[0].fretNumbers[0].getRect().clone()}this.staffObjects.forEach(t=>this.rect.expandInPlace(t.getRect())),this.tabObjects.forEach(t=>this.rect.expandInPlace(t.getRect()))}setStemTipY(t,e){let i=this.staffObjects.find(e=>e.staff===t);this.hasBeamCount()&&(null==i?void 0:i.stemTip)&&e!==i.stemTip.anchorY&&(i.stemTip.top=i.stemTip.anchorY=i.stemTip.bottom=e,this.requestRectUpdate(),this.col.requestRectUpdate())}offset(t,e){this.staffObjects.forEach(e=>e.offset(t,0)),this.tabObjects.forEach(e=>e.offset(t,0)),this.requestRectUpdate()}draw(t){t.drawDebugRect(this.getRect());let{stemDir:e}=this,{isSolidNoteHead:i}=this.rhythmProps;this.staffObjects.forEach(s=>{s.accidentals.forEach(e=>e.draw(t)),t.color(this.color),t.lineWidth(1),s.noteHeadRects.forEach(e=>{this.diamond?i?(t.beginPath(),t.moveTo(e.anchorX,e.top),t.lineTo(e.right,e.anchorY),t.lineTo(e.anchorX,e.bottom),t.lineTo(e.left,e.anchorY),t.lineTo(e.anchorX,e.top),t.fill()):(t.beginPath(),t.lineWidth(2.5),t.moveTo(e.anchorX,e.top),t.lineTo(e.right,e.anchorY),t.moveTo(e.left,e.anchorY),t.lineTo(e.anchorX,e.bottom),t.stroke(),t.beginPath(),t.lineWidth(1),t.moveTo(e.right,e.anchorY),t.lineTo(e.anchorX,e.bottom),t.moveTo(e.anchorX,e.top),t.lineTo(e.left,e.anchorY),t.stroke()):(t.beginPath(),t.ellipse(e.anchorX,e.anchorY,e.leftw,e.toph,-.3,0,2*Math.PI),i?t.fill():t.stroke())}),s.dotRects.forEach(e=>t.fillCircle(e.anchorX,e.anchorY,e.width/2)),s.stemTip&&s.stemBase&&(t.beginPath(),t.moveTo(s.stemBase.anchorX,s.stemBase.anchorY),t.lineTo(s.stemTip.anchorX,s.stemTip.anchorY),t.stroke()),s.flagRects.forEach(i=>t.drawFlag(i,"up"===e?"up":"down"))}),this.tabObjects.forEach(e=>e.fretNumbers.forEach(e=>e.draw(t)))}getDotVerticalDisplacement(t,e,i){return t.isLine(e)?"up"===i?-1:1:0}static hasSameNotes(t,e){if(t.notes.length!==e.notes.length)return!1;for(let i=0;i<t.notes.length;i++){let s=t.notes[i],r=e.notes[i];if(s.diatonicId!==r.diatonicId||s.accidental!==r.accidental)return!1}return!0}},St=class extends G{constructor(t,e){super(t),this.measure=t,this.positionTicks=e,(0,o.Mu)(this,"voiceSymbol",new n.qG),(0,o.Mu)(this,"lyricsObject",new n.Yz),(0,o.Mu)(this,"minDiatonicId"),(0,o.Mu)(this,"maxDiatonicId"),(0,o.Mu)(this,"staffMinDiatonicId",new n.b1),(0,o.Mu)(this,"staffMaxDiatonicId",new n.b1),(0,o.Mu)(this,"arpeggioDir"),(0,o.Mu)(this,"arpeggios",[]),(0,o.Mu)(this,"playerProps"),(0,o.Mu)(this,"needLayout",!0),(0,o.Mu)(this,"shapeRects",[]),(0,o.Mu)(this,"mi"),this.playerProps=new Gt(this),this.mi=new yi(this)}getMusicInterface(){return this.mi}getPlayerProps(){return this.playerProps}getNextColumnInMeasure(){let t=this.measure.getColumns().indexOf(this);if(t>=0&&t<this.measure.getColumnCount())return this.measure.getColumn(t+1);throw new h.MusicError(h.MusicErrorType.Score,"Cannot get next column in measure because current column's id in mesure is invalid.")}getNextColumn(){var t;let e=this.getNextColumnInMeasure();return e||(null==(t=this.measure.getNextMeasure())?void 0:t.getColumn(0))}getTicksToNextColumn(){let t=this.getNextColumnInMeasure(),e=this.positionTicks,i=t?t.positionTicks:this.measure.getConsumedTicks();return Math.max(0,i-e)}getShapeRects(){return this.forceRectUpdate(),this.shapeRects}get doc(){return this.measure.doc}get row(){return this.measure.row}pick(t,e){const i=this.getRect().contains(t,e);for(let s=0;s<this.voiceSymbol.length;s++){let r=this.voiceSymbol.get(s);if(r instanceof yt){let s=r.pick(t,e);if(s.length>0)return i?[this,...s]:s}}if(!i)return[];for(let s=0;s<this.voiceSymbol.length;s++){let i=this.voiceSymbol.get(s);if(i instanceof wt){let s=i.pick(t,e);if(s.length>0)return[this,...s]}}for(let s=0;s<this.arpeggios.length;s++){let i=this.arpeggios[s].pick(t,e);if(i.length>0)return[this,...i]}return[]}hasArpeggio(){return void 0!==this.arpeggioDir}getArpeggioDir(){var t;return null!=(t=this.arpeggioDir)?t:"up"}setVoiceSymbol(t,e){f(t),this.voiceSymbol.set(t,e),e instanceof yt&&!e.hide?this.row.getStaves().forEach(t=>{let i=e.getDiatonicId(t);this.minDiatonicId=void 0===this.minDiatonicId?i:Math.min(this.minDiatonicId,i),this.maxDiatonicId=void 0===this.maxDiatonicId?i:Math.max(this.maxDiatonicId,i)}):e instanceof wt&&(this.minDiatonicId=void 0===this.minDiatonicId?e.notes[0].diatonicId:Math.min(this.minDiatonicId,e.notes[0].diatonicId),this.maxDiatonicId=void 0===this.maxDiatonicId?e.notes[e.notes.length-1].diatonicId:Math.max(this.maxDiatonicId,e.notes[e.notes.length-1].diatonicId),void 0!==e.arpeggio&&(this.arpeggioDir=e.arpeggio),this.updateNoteDisplacements()),this.requestLayout(),this.requestRectUpdate()}getVoiceSymbol(t){return this.voiceSymbol.get(t)}getLyricsObject(t,e,i){return this.lyricsObject.get(t,e,i)}addLyricsObject(t){this.lyricsObject.set(t.verse,t.line,t.vpos,t)}updateNoteDisplacements(){let t=[];this.voiceSymbol.forEach(e=>{e instanceof wt&&e.notes.forEach(i=>{e.setNoteDisplacement(i,!1),t.push({noteGroup:e,note:i})})});if(t.sort((t,e)=>{let i=a.Note.compareFunc(t.note,e.note);return 0===i?t.noteGroup.stemDir===e.noteGroup.stemDir?0:"up"===t.noteGroup.stemDir?1:-1:i}),!(t.length<2)){for(let e=0;e<t.length;e++){let i=t[e],s=t[e+1];s&&i.note.diatonicId===s.note.diatonicId&&(i.isDisplaced=s.isDisplaced=!1)}for(let e=0;e<t.length;e++){let i=t[e-1],s=t[e],r=t[e+1];void 0===s.isDisplaced&&(i&&s.note.diatonicId-i.note.diatonicId<=1?s.isDisplaced=!i.isDisplaced:r&&r.note.diatonicId-s.note.diatonicId<=1&&(s.isDisplaced=!r.isDisplaced))}t.forEach(t=>{var e;return t.noteGroup.setNoteDisplacement(t.note,null!=(e=t.isDisplaced)&&e)})}}isEmpty(){return 0===this.voiceSymbol.size||this.voiceSymbol.every(t=>t.isEmpty())}getPlayerNotes(){let t=[];return[0,1,2,3].forEach(e=>{const i=this.getVoiceSymbol(e);if(i instanceof wt){let e=i.getPlaySlur();i.notes.forEach(s=>{!function(e,i,s,r){if(i<=0)return;t.some(t=>e.diatonicId===t.note.diatonicId&&e.accidental===t.note.accidental&&(t.ticks=Math.max(t.ticks,i),!0))||t.push({note:e,ticks:i,staccato:s,slur:r})}(s,i.getPlayTicks(s),i.staccato,e)})}}),t.sort((t,e)=>a.Note.compareFunc(t.note,e.note)),this.hasArpeggio()&&"down"===this.getArpeggioDir()&&t.reverse(),t}requestLayout(){this.needLayout||(this.needLayout=!0,this.measure.requestLayout())}layout(t,e){if(!this.needLayout)return;let{row:i}=this;this.rect=new n.vW,this.requestRectUpdate();let s=0,r=0;if(this.voiceSymbol.forEach(i=>{i.layout(t,e);let n=i.getRect();s=Math.max(s,n.leftw),r=Math.max(r,n.rightw)}),void 0!==this.arpeggioDir){this.arpeggios=i.getNotationLines().map(t=>new pt(this,t,this.getArpeggioDir())),this.arpeggios.forEach(e=>e.layout(t));const e=this.arpeggios.map(t=>t.getRect().width).reduce((t,e)=>Math.max(t,e))+t.unitSize;this.arpeggios.forEach(t=>{t.setAnchor(-s-e/2,t.line.getRect().anchorY),t.line.addObject(t),this.measure.addStaticObject(t.line,t)}),s+=e}else this.arpeggios=[];const o=this.voiceSymbol.mapToArray(t=>t.rhythmProps.noteSize),a=Math.min(8,Math.max(1,...o)),h=Math.ceil(8/a)*H*t.unitSize*.75;s=Math.max(s,h/2),r=Math.max(r,h/2),s*=z,r*=z,this.rect.left=-s,this.rect.anchorX=0,this.rect.right=r,this.requestRectUpdate(),this.voiceSymbol.forEach(t=>t.updateAccidentalState(e)),this.row.getStaves().forEach(t=>{let e,i;this.voiceSymbol.forEach(s=>{if(s.visibleInStaff(t))if(s instanceof wt)e=void 0===e?s.minDiatonicId:Math.min(e,s.minDiatonicId),i=void 0===i?s.maxDiatonicId:Math.max(i,s.maxDiatonicId);else if(s instanceof yt){let r=s.getDiatonicId(t);e=void 0===e?r:Math.min(e,r),i=void 0===i?r:Math.max(i,r)}}),void 0!==e?this.staffMinDiatonicId.set(t,e):this.staffMinDiatonicId.delete(t),void 0!==i?this.staffMaxDiatonicId.set(t,i):this.staffMaxDiatonicId.delete(t)})}layoutReserveSpace(t){const e=this.measure.getColumns(),i=t.unitSize;this.getAnchoredLayoutObjects().forEach(t=>{if(t.layoutGroup.reserveSpace){const s=e.indexOf(this);if(s<0)return;const r=t.getRect().leftw-this.getRect().leftw;if(r>0){const n=e[s-1];n&&n.getAnchoredLayoutObjects().forEach(e=>{if(e.layoutGroupId===t.layoutGroupId){const t=e.getRect().rightw-n.getRect().rightw;this.rect.left-=Math.max(t+r,0)+i,this.requestRectUpdate()}})}const n=t.getRect().rightw-this.getRect().rightw;if(n>0){const r=e[s+1];r&&r.getAnchoredLayoutObjects().forEach(e=>{if(e.layoutGroupId===t.layoutGroupId){const t=e.getRect().leftw-r.getRect().leftw;this.rect.right+=Math.max(n+t,0)+i,this.requestRectUpdate()}})}}})}layoutDone(){this.needLayout=!1}updateRect(){this.shapeRects=[...this.voiceSymbol.filter(t=>void 0!==t).mapToArray(t=>t.getRect().clone()),...this.arpeggios.map(t=>t.getRect().clone())],this.rect.top=Math.min(...this.shapeRects.map(t=>t.top)),this.rect.bottom=Math.max(...this.shapeRects.map(t=>t.bottom)),this.rect.anchorY=(this.rect.top+this.rect.bottom)/2}offset(t,e){this.voiceSymbol.forEach(e=>e.offset(t,0)),this.arpeggios.forEach(e=>e.offset(t,0)),this.shapeRects.forEach(i=>i.offsetInPlace(t,e)),this.rect.offsetInPlace(t,e)}draw(t){t.color("staff.frame"),this.row.getStaves().forEach(e=>{let i=this.staffMinDiatonicId.get(e),s=this.staffMaxDiatonicId.get(e);void 0!==i&&t.drawLedgerLines(e,i,this.getRect().anchorX),void 0!==s&&t.drawLedgerLines(e,s,this.getRect().anchorX)}),this.voiceSymbol.forEach(e=>e.draw(t)),this.arpeggios.forEach(e=>e.draw(t))}},Rt=class t extends G{constructor(e,i,s="black"){switch(super(e),this.text=i,this.color=s,(0,o.Mu)(this,"components",[]),(0,o.Mu)(this,"mi"),this.text){case t.Coda:this.components=[new It(this,{text:"\ud834\udd0c",scale:1.7,color:s},.5,.3),new It(this,{text:" Coda",color:s},0,1)];break;case t.toCoda:this.components=[new It(this,{text:"toCoda ",color:s},1,1),new It(this,{text:"\ud834\udd0c",scale:1.7,color:s},.5,.3)];break;case t.Segno:this.components=[new It(this,{text:"\ud834\udd0b",scale:1.1,color:s},.5,1)];break;default:this.components=[]}this.mi=new Gi(this)}getMusicInterface(){return this.mi}getText(){return this.text}pick(t,e){return this.rect.contains(t,e)?[this]:[]}layout(e){switch(this.text){case t.Coda:{let t=this.components[0],i=this.components[1];t.layout(e),i.layout(e),t.setAnchorY(i.getRect().centerY),i.setLeft(t.getRect().right),this.rect=new n.vW(t.getRect().left,t.getRect().anchorX,i.getRect().right,i.getRect().top,i.getRect().anchorY,i.getRect().bottom);break}case t.toCoda:{let t=this.components[0],i=this.components[1];t.layout(e),i.layout(e),i.setAnchorY(t.getRect().centerY),t.setRight(i.getRect().left),this.rect=new n.vW(t.getRect().left,i.getRect().anchorX,i.getRect().right,t.getRect().top,t.getRect().anchorY,t.getRect().bottom);break}default:{let t=this.components[0];t.layout(e),this.rect=t.getRect().clone();break}}}offset(t,e){this.components.forEach(i=>i.offset(t,e)),this.rect.offsetInPlace(t,e)}draw(t){t.drawDebugRect(this.rect),this.components.forEach(e=>e.draw(t))}};(0,o.Mu)(Rt,"toCoda","\ud834\udd0c toCoda"),(0,o.Mu)(Rt,"Coda","Coda \ud834\udd0c"),(0,o.Mu)(Rt,"Segno","\ud834\udd0b");var xt=Rt;function Tt(t){return t instanceof It||t instanceof xt?t.getText():t instanceof se?"[measure]":""}var Lt=class{constructor(t){this.startColumn=t,(0,o.Mu)(this,"columnRange"),(0,o.Mu)(this,"stopObject"),this.columnRange=[t]}get endColumn(){return this.columnRange[this.columnRange.length-1]}addColumn(t){this.endColumn!==t&&this.columnRange.push(t)}setStopObject(t){this.stopObject=t}},Nt=class t extends D{constructor(t,e,i,s,r,n){super(t.musicObj),this.headObj=t,(0,o.Mu)(this,"length"),(0,o.Mu)(this,"visible"),(0,o.Mu)(this,"lineStyle"),(0,o.Mu)(this,"linePos"),(0,o.Mu)(this,"startColumn"),this.length=i+1,this.visible=s,this.lineStyle=r,this.linePos=n,this.startColumn=e}isVisible(){return this.visible}getLineStyle(){return this.lineStyle}getLinePos(){return this.linePos}whatStopped(e){const i=e.measure,s=i.getColumns(),r=e.getAnchoredLayoutObjects().filter(t=>t!==this.headObj&&t.layoutGroupId===this.headObj.layoutGroupId).map(t=>t.musicObj).filter(t=>t instanceof It||t instanceof xt)[0];return r||(e===s[s.length-1]&&i.hasEndSection()||i.hasEndSong()||t.StopNavigations.some(t=>i.hasNavigation(t))?i.getBarLineRight():void 0)}getRange(){let{startColumn:t,length:e}=this,i=t,s=new Lt(i),r=e;for(;;){if(!i||r<=0)return s;const t=this.whatStopped(i);if(void 0!==t)return s.setStopObject(t),s;s.addColumn(i),r-=i.getTicksToNextColumn(),i=i.getNextColumn()}}};(0,o.Mu)(Nt,"StopNavigations",["endRepeat","ending"]);var jt=Nt;function Et(t){switch(t){case"D.C. al Coda":return"D.C. al Coda";case"D.C. al Fine":return"D.C. al Fine";case"D.S. al Coda":return"D.S. al Coda";case"D.S. al Fine":return"D.S. al Fine";case"Fine":return"Fine";case"Segno":return xt.Segno;case"Coda":return xt.Coda;case"toCoda":return xt.toCoda;default:return t[0].toUpperCase()+t.substring(1)}}function Ot(t){if(/^(p+|f+|m|mp|mf)$/.test(t)){let e=.5-.1*n.OZ.Str.charCount(t,"p")+.1*n.OZ.Str.charCount(t,"f");return n.OZ.Math.clamp(e,0,1)}}function Pt(t,e){return"undefined"==typeof window?void 0:window.setTimeout(t,e)}function kt(t){"undefined"!=typeof window&&window.clearTimeout(t)}function Dt(){return Ot("m")}var Gt=class{constructor(t){this.col=t,(0,o.Mu)(this,"speed"),(0,o.Mu)(this,"volume"),this.speed=1,this.volume=Dt()}get measure(){return this.col.measure}reset(){this.speed=1,this.volume=Dt()}setSpeed(t){this.speed=t}getSpeed(){return this.speed}getTempo(){let t=n.OZ.Math.clamp(this.getSpeed(),.1,10);return(0,a.alterTempoSpeed)(this.measure.getTempo(),t)}setVolume(t){this.volume=t}getVolume(){return this.volume}hasFermata(){return this.measure.hasFermata(this.col)}getFermataHoldTicks(){if(!this.hasFermata())return 0;const{col:t}=this;if(t instanceof zt)return this.measure.getMeasureTicks()/2;{let e=[0,1,2,3].map(e=>t.getVoiceSymbol(e)).filter(t=>!!t).map(t=>t.rhythmProps.ticks);return 0===e.length?0:n.OZ.Math.sum(e)/e.length}}},Bt=class t{constructor(){(0,o.Mu)(this,"playTimer"),(0,o.Mu)(this,"playPos"),(0,o.Mu)(this,"playState",2),(0,o.Mu)(this,"doc"),(0,o.Mu)(this,"cursorPositionChangeListener"),(0,o.Mu)(this,"playStateChnageListener"),(0,o.Mu)(this,"playerColumnSequence",[])}setDocument(t){this.doc=t,this.doc.resetMeasures(),this.playerColumnSequence=this.collectPlayerColumnSequence(),this.updatePlayerProps()}setCursorPositionChangeListener(t){this.cursorPositionChangeListener=t}setPlayStateChnageListener(t){this.playStateChnageListener=t}notifyCursorPositionChanged(){this.cursorPositionChangeListener&&this.cursorPositionChangeListener(this.getCursorRect())}notifyPlayStateChanged(){let t=void 0!==this.playPos&&void 0!==this.playTimer?0:void 0!==this.playPos&&void 0===this.playTimer?1:2;this.playState!==t&&(this.playStateChnageListener&&this.playStateChnageListener(t),this.playState=t)}collectPlayerMeasureSequence(){var e;if(!this.doc)return[];let i,s=[],r=this.doc.getFirstMeasure(),n=r,o=!1,a=!1;for(;r;){if(r.incPassCount(),r.getEnding()){let e=r.getPassCount();r=t.getMeasureByEndingPassage(r,e)}if(r)if(s.push(r),r.hasNavigation("startRepeat")&&(n=r),r.hasNavigation("Segno")&&(i=r),a&&r.hasNavigation("toCoda"))for(;r&&!r.hasNavigation("Coda");)r=r.getNextMeasure();else if(o&&r.hasNavigation("Fine"))r=void 0;else if(r.hasNavigation("D.C. al Coda"))a=!0,r=this.doc.getFirstMeasure();else if(r.hasNavigation("D.C. al Fine"))o=!0,r=this.doc.getFirstMeasure();else if(r.hasNavigation("D.S. al Coda"))a=!0,r=i;else if(r.hasNavigation("D.S. al Fine"))o=!0,r=i;else if(r.hasNavigation("endRepeat")){let t=r.getPassCount(),i=r.getEndRepeatPlayCount()-1,s=!0===(null==(e=r.getNextMeasure())?void 0:e.hasNavigation("ending"));r=t<=i||s?n:r.getNextMeasure()}else r=r.hasEndSong()?void 0:r.getNextMeasure()}return s}collectPlayerColumnSequence(){let t=this.collectPlayerMeasureSequence(),e=[];for(let i=0;i<t.length;i++){let s=t[i];e=e.concat(s.getColumns()),s.hasFermata(s.getBarLineRight())&&e.push(s.getBarLineRight())}return e}updatePlayerProps(){if(this.playerColumnSequence.forEach(t=>t.getPlayerProps().reset()),!this.doc)return;let t=1,e=Dt(),i=new n.b1,s=new n.b1;const r=(t,e)=>i.getOrCreate(t,[]).push(e),o=(t,e)=>s.getOrCreate(t,[]).push(e);this.playerColumnSequence.forEach((a,h)=>{if(!(a instanceof St))return;a.getAnchoredLayoutObjects().forEach(i=>{const s=Tt(i.musicObj);let h;if("a tempo"===s)t=1;else if(void 0!==(h=Ot(s)))e=h;else if(function(t){return n.I8.isEnumValue(t,O)}(s)||function(t){return n.I8.isEnumValue(t,E)}(s)){const c=(i.musicObj.getLink()instanceof jt?i.musicObj.getLink():new jt(i,a,1/0,!1,"solid","bottom")).getRange(),u=c.stopObject?Tt(c.stopObject):"";let g=n.OZ.Math.sum(c.columnRange.map(t=>t.getTicksToNextColumn()));switch(s){case"accel.":{let e=t,i=2*e,s=0;c.columnRange.forEach(t=>{s+=t.getTicksToNextColumn(),r(t,e+(i-e)*s/g)});break}case"rit.":{let e=t,i=e/2,s=0;c.columnRange.forEach(t=>{s+=t.getTicksToNextColumn(),r(t,e+(i-e)*s/g)});break}case"cresc.":{let t=e,i=t+.5;c.stopObject&&void 0!==(h=Ot(u))&&h>t&&(i=h);let s=0;c.columnRange.forEach(e=>{s+=e.getTicksToNextColumn(),o(e,t+(i-t)*s/g)});break}case"decresc.":case"dim.":{let t=e,i=t-.5;c.stopObject&&void 0!==(h=Ot(u))&&h<t&&(i=h);let s=0;c.columnRange.forEach(e=>{s+=e.getTicksToNextColumn(),o(e,t+(i-t)*s/g)});break}}}});let c=i.getOrDefault(a,[]);c.length>0&&(t=n.OZ.Math.sum(c)/c.length);let u=s.getOrDefault(a,[]);u.length>0&&(e=n.OZ.Math.sum(u)/u.length),a.getPlayerProps().setSpeed(t),a.getPlayerProps().setVolume(e)})}static getMeasureByEndingPassage(t,e){for(let i=t;;i=i.getNextMeasure()){let t=null==i?void 0:i.getEnding();if(t&&t.hasPassage(e))return i;let s=null==i?void 0:i.getNextMeasure();if(!i||i.hasEndSong()||i.hasEndSection()||!s||s.hasNavigation("startRepeat"))return}}playStep(){if(this.notifyCursorPositionChanged(),this.notifyPlayStateChanged(),void 0===this.playPos)return void this.stop();const t=this.playerColumnSequence[this.playPos];if(!t)return void this.stop();const e=(t,e)=>{let i=function(t,e){let i=a.RhythmProps.get(e.options.beatLength,e.options.dotCount).ticks;return 60*t/(e.beatsPerMinute*i)}(t,e);return Math.max(0,i)};let i,s=t.getPlayerProps().getTempo(),r=t.getPlayerProps().getFermataHoldTicks();if(t instanceof zt)i=e(r,s);else{t.getPlayerNotes().forEach((i,n)=>{let o=t.hasArpeggio()?a.RhythmProps.get(a.NoteLength.ThirtySecond).ticks*n:0,h=e(i.ticks+r-o,s);if(h>0){i.staccato&&(h=Math.min(e(a.RhythmProps.get(a.NoteLength.Eighth).ticks,s)/2,h/2));let r=1.25*t.getPlayerProps().getVolume();if("slurred"===i.slur&&(r*=.5),o>0){Pt(()=>c.playNote(i.note,h,r),1e3*e(o,s))}else c.playNote(i.note,h,r)}}),i=e(t.getTicksToNextColumn()+r,s)}this.playTimer=Pt(()=>this.playStep(),1e3*i),this.playPos=this.getNextPlayPosition(this.playPos),this.notifyPlayStateChanged()}play(){if(0===this.playState)this.stop();else if(1===this.playState)return void this.playStep();let{doc:t}=this;t&&(t.getFirstMeasure()?(this.playPos=0,this.playStep()):this.playPos=void 0,this.notifyPlayStateChanged())}pause(){this.playTimer&&(kt(this.playTimer),this.playTimer=void 0),this.notifyCursorPositionChanged(),this.notifyPlayStateChanged()}stop(){this.playPos=void 0,this.playTimer&&(kt(this.playTimer),this.playTimer=void 0),this.notifyCursorPositionChanged(),this.notifyPlayStateChanged()}getNextPlayPosition(t){return void 0!==this.playPos&&++this.playPos>=this.playerColumnSequence.length&&(this.playPos=void 0),this.playPos}getCursorRect(){if(void 0===this.playPos)return;let t=this.playerColumnSequence[this.playPos];if(!t)return;let e=t.measure,i=t.getRect().anchorX,{top:s,height:r}=e.row.getRect();return new n.rw(i,s,0,r)}},Yt=class extends G{constructor(t,e,i){super(e),this.barLine=t,this.line=e,this.rowGroup=i,(0,o.Mu)(this,"vlines",[]),(0,o.Mu)(this,"dots",[]),(0,o.Mu)(this,"mi"),e.addObject(this),this.mi=new ci(this)}getMusicInterface(){return this.mi}pick(t,e){return this.getRect().contains(t,e)?[this]:[]}updateRect(){this.rect=new n.vW(0,0,this.line.getTopLineY(),this.line.getBottomLineY()),this.vlines.forEach(t=>this.rect.expandInPlace(new n.vW(t.left,t.left+t.width,this.rect.top,this.rect.bottom))),this.dots.forEach(t=>this.rect.expandInPlace(new n.vW(t.x-t.r,t.x+t.r,t.y-t.r,t.y+t.r)))}offset(t,e){this.vlines.forEach(e=>e.left+=t),this.dots.forEach(i=>{i.x+=t,i.y+=e}),this.rect.offsetInPlace(t,e)}},Wt=class extends G{constructor(t){super(t),this.measure=t,(0,o.Mu)(this,"notationLineObjects",[]),(0,o.Mu)(this,"notationLineObjectsByGrp",new n.b1),(0,o.Mu)(this,"barLineType",0)}get doc(){return this.measure.doc}get row(){return this.measure.row}pick(t,e){if(!this.getRect().contains(t,e))return[];for(let i=0;i<this.notationLineObjects.length;i++){let s=this.notationLineObjects[i].pick(t,e);if(s.length>0)return[this,...s]}return[this]}layout(t){this.requestRectUpdate(),this.barLineType=this.solveBarLineType();let{unitSize:e,_lineWidth:i}=t,{measure:s,barLineType:r}=this,{row:n}=s,o=i,a=.7*e,h=.7*e,c=J*e/2;this.notationLineObjects=[],this.notationLineObjectsByGrp.clear(),n.getRowGroups().forEach(t=>{t.lines.forEach(e=>{let i,s,n=new Yt(this,e,t);this.notationLineObjects.push(n),this.notationLineObjectsByGrp.getOrCreate(t,[]).push(n);const u=(t,e)=>{n.vlines.push({left:t,width:e})},g=t=>{for(let e=-1;e<=1;e+=2){let r=i+e*s;n.dots.push({x:t,y:r,r:c})}};switch(e instanceof ue?(i=e.getMiddleLineY(),s=e.getDiatonicSpacing()):(i=(e.getBottomLineY()+e.getTopLineY())/2,s=(e.getBottomLineY()-e.getTopLineY())/6),r){case 0:break;case 1:u(-o,o);break;case 2:u(-o-h-o,o),u(-o,o);break;case 3:u(-o-h-a,o),u(-a,a);break;case 4:u(0,a),u(a+h,o),g(a+h+o+h+c);break;case 5:u(-o-h-a,o),u(-a,a),g(-o-h-a-h-c);break;case 6:u(-a/2,a),u(-a/2-h-o,o),u(a/2+h,o),g(-a/2-h-o-h-c),g(a/2+h+o+h+c)}n.forceRectUpdate()})})}updateRect(){if(this.notationLineObjects.length>0){this.rect=this.notationLineObjects[0].getRect().clone();for(let t=1;t<this.notationLineObjects.length;t++)this.rect.expandInPlace(this.notationLineObjects[t].getRect())}else this.rect=new n.vW}offset(t,e){this.notationLineObjects.forEach(e=>e.offset(t,0)),this.requestRectUpdate()}draw(t){0!==this.barLineType&&(t.drawDebugRect(this.getRect()),this.notationLineObjects.forEach(e=>{e.vlines.forEach(i=>e.line.drawVerticalLine(t,i.left,i.width)),e.dots.forEach(e=>t.fillCircle(e.x,e.y,e.r))}))}},Ut=class extends Wt{constructor(t){super(t),(0,o.Mu)(this,"mi"),this.mi=new ai(this)}getMusicInterface(){return this.mi}solveBarLineType(){let t=this.measure,e=t.getPrevMeasure();return t.hasNavigation("startRepeat")?e&&e.row===t.row&&e.hasNavigation("endRepeat")?0:4:0}},zt=class extends Wt{constructor(t){super(t),(0,o.Mu)(this,"playerProps"),(0,o.Mu)(this,"mi"),this.playerProps=new Gt(this),this.mi=new ni(this)}getMusicInterface(){return this.mi}getPlayerProps(){return this.playerProps}solveBarLineType(){let t=this.measure,e=t.getNextMeasure();return t.hasNavigation("endRepeat")?e&&e.row===t.row&&e.hasNavigation("startRepeat")?6:5:t.doc.hasSingleMeasure()||!t.hasEndSong()&&t.getNextMeasure()?t.hasEndSection()||t===t.row.getLastMeasure()&&e&&e.row===t.row.getNextRow()&&e.hasNavigation("startRepeat")?2:e&&e.hasNavigation("startRepeat")?0:1:3}},Zt=class extends G{constructor(t,e,i){if(super(t),this.measure=t,this.color=e,this.passages=i,(0,o.Mu)(this,"endingText"),(0,o.Mu)(this,"shapeRects",[]),(0,o.Mu)(this,"mi"),this.mi=new Je(this),!n.I8.isIntegerGte(i.length,1))throw new h.MusicError(h.MusicErrorType.Score,"Passages is empty.");if(!this.passages.every(t=>n.I8.isIntegerGte(t,1)))throw new h.MusicError(h.MusicErrorType.Score,"Invalid passages: "+this.passages);this.passages.sort((t,e)=>t-e);const s=this.passages.map(t=>t+".").join("");this.endingText=new It(this,{text:s,color:e},0,1)}getMusicInterface(){return this.mi}getShapeRects(){return this.shapeRects}isSingleMeasureEnding(){let{measure:t}=this,e=t.getNextMeasure();return!0===(null==e?void 0:e.hasNavigation("ending"))||t.hasNavigation("endRepeat")||t.isLastMeasure()}hasPassage(t){return this.passages.some(e=>e===t)}getHighestPassage(){return Math.max(0,...this.passages)}pick(t,e){return this.rect.contains(t,e)?[this]:[]}layout(t){this.rect=new n.vW,this.shapeRects=[this.rect.clone()]}layoutFitToMeasure(t){let{unitSize:e}=t,{measure:i}=this;this.endingText.layout(t);let s=this.endingText.getRect(),r=i.getColumnsContentRect(),o=s.height;this.rect=new n.vW(r.left+e,r.right-e,-o,0),this.endingText.setLeft(this.rect.left+e/2),this.endingText.setBottom(this.rect.bottom),this.shapeRects=[new n.vW(this.rect.left,this.rect.left+1,this.rect.top,this.rect.bottom),new n.vW(this.rect.left,this.rect.right,this.rect.top,this.rect.top+1),new n.vW(this.rect.right-1,this.rect.right,this.rect.top,this.rect.bottom),this.endingText.getRect().clone()]}offset(t,e){this.endingText.offset(t,e),this.shapeRects.forEach(i=>i.offsetInPlace(t,e)),this.rect.offsetInPlace(t,e)}draw(t){let{rect:e}=this;t.drawDebugRect(this.rect),t.color(this.color).lineWidth(1),t.beginPath(),t.moveTo(e.left,e.bottom),t.lineTo(e.left,e.top),t.lineTo(e.right,e.top),this.isSingleMeasureEnding()&&t.lineTo(e.right,e.bottom),t.stroke(),this.endingText.draw(t)}},Ft=class{constructor(t,e,i,s,r){this.staff=t,this.beamGroup=e,this.symbol=i,this.x=s,this.y=r,(0,o.Mu)(this,"topBeamsHeight",0),(0,o.Mu)(this,"bottomBeamsHeight",0),t.addObject(this)}offset(t,e){this.x+=t,this.y+=e,this.beamGroup.requestRectUpdate()}getRect(){return new n.vW(this.x,this.x,this.x,this.y-this.topBeamsHeight,this.y,this.y+this.bottomBeamsHeight)}},Vt=class extends G{constructor(t,e){super(t),this.staff=t,this.beamGroup=e,(0,o.Mu)(this,"tupletNumber"),(0,o.Mu)(this,"tupletNumberOffsetY",0),(0,o.Mu)(this,"points",[]),(0,o.Mu)(this,"mi"),t.addObject(this),this.mi=new Ve(this)}getMusicInterface(){return this.mi}pick(t,e){return this.getRect().contains(t,e)?[this]:[]}offset(t,e){var i;this.points.forEach(e=>e.offset(t,0)),null==(i=this.tupletNumber)||i.offset(t,e),this.requestRectUpdate(),this.beamGroup.requestRectUpdate()}updateRect(){this.points.length>0?this.rect=this.points[0].getRect().clone():this.tupletNumber&&(this.rect=this.tupletNumber.getRect().clone()),this.points.forEach(t=>this.rect.expandInPlace(t.getRect())),this.tupletNumber&&this.rect.expandInPlace(this.tupletNumber.getRect())}},Ht=class{constructor(t,e){this.beamGroup=t,this.message=e}},qt=class t extends G{constructor(t,e){super(t[0].measure),this.symbols=t,this.tupletRatio=e,(0,o.Mu)(this,"mi"),(0,o.Mu)(this,"type"),(0,o.Mu)(this,"staffObjects",[]),this.mi=new Ze(this);let i=e?"Tuplet":"BeamGroup";if(!t.every(e=>e.measure===t[0].measure))throw new h.MusicError(h.MusicErrorType.Score,`All ${i} symbols are not in same measure.`);if(t.length<2)throw new h.MusicError(h.MusicErrorType.Score,`${i} needs minimum 2 symbols, but ${t.length} given.`);if(void 0!==e){let e=t.length<3||t.some(t=>!(t instanceof wt))||t.some(e=>e.rhythmProps.flagCount!==t[0].rhythmProps.flagCount);t.length>=3&&t[0]instanceof wt&&t[t.length-1]instanceof wt&&t[0].rhythmProps.flagCount===t[t.length-1].rhythmProps.flagCount&&(e=!1),t.some(t=>a.NoteLengthProps.cmp(t.rhythmProps.noteLength,a.NoteLength.Quarter)>=0)&&(e=!0),this.type=e?2:1,this.setTupletBeamCounts()}else this.type=0,this.setBeamCounts();if(!t.every(t=>void 0===t.getBeamGroup()))throw new h.MusicError(h.MusicErrorType.Score,`Cannot add ${i} because some symbol already has one.`);if(t.forEach(t=>t.setBeamGroup(this)),t[0].measure.addBeamGroup(this),0===this.type&&this.symbols.filter(t=>t instanceof wt).some((t,e)=>{let i=0===e,s=e===this.symbols.length-1;if(i&&0===t.getRightBeamCount()||s&&0===t.getLeftBeamCount()||!i&&!s&&(0===t.getLeftBeamCount()||0===t.getRightBeamCount()))throw new Ht(this,"Beam has zero left or right beam count!")}),t.some(e=>e.voiceId!==t[0].voiceId))throw 0===this.type?new Ht(this,"Beam symbols have different voiceId."):new h.MusicError(h.MusicErrorType.Score,"Tuplet symbols have different voiceId.");t[0].row.getStaves().forEach(e=>{e.getActualStaff(t[0].getDiatonicId(e))&&e.containsVoiceId(t[0].voiceId)&&t.forEach(t=>{let i=e.getActualStaff(t.getDiatonicId(e));if(!i||!i.containsVoiceId(t.voiceId))throw new Ht(this,"Some of beam or tuplet symbols are not visible!")})})}get stemDir(){return this.symbols[0].stemDir}get showTupletRatio(){var t;return!0===(null==(t=this.tupletRatio)?void 0:t.showRatio)}static createBeam(e){if(e.length>1&&e.every(t=>!t.hasTuplet()))try{return new t(e,void 0),!0}catch(i){if(!(i instanceof Ht))throw i;i.beamGroup.detach()}return!1}static createOldStyleTriplet(e){try{let i=e.slice(0,2),s=i.map(t=>t.rhythmProps.noteSize);if(2===i.length&&i.every(t=>t.oldStyleTriplet&&void 0===t.getBeamGroup())&&(2*s[0]===s[1]||2*s[1]===s[0]))return new t(i,a.Tuplet.Triplet),2;let r=e.slice(0,3),n=r.map(t=>t.rhythmProps.noteSize);if(3===r.length&&r.every(t=>t.oldStyleTriplet&&void 0===t.getBeamGroup())&&n.every(t=>t===n[0]))return new t(r,a.Tuplet.Triplet),3}catch(i){if(!(i instanceof Ht))throw i;console.error(i.message),i.beamGroup.detach()}return 0}static createTuplet(e,i){try{new t(e,i)}catch(s){if(!(s instanceof Ht))throw s;console.error(s.message),s.beamGroup.detach()}}getMusicInterface(){return this.mi}detach(){this.getSymbols().forEach(t=>t.resetBeamGroup())}isEmpty(){return 0===this.staffObjects.length}pick(t,e){if(!this.getRect().contains(t,e))return[];for(let i=0;i<this.staffObjects.length;i++){let s=this.staffObjects[i].pick(t,e);if(s.length>0)return[this,...s]}return[this]}getType(){return this.type}isTuplet(){return 1===this.type||2===this.type}getTupletRatioText(){var t,e,i;return this.showTupletRatio?String(null==(t=this.tupletRatio)?void 0:t.parts)+":"+String(null==(e=this.tupletRatio)?void 0:e.inTimeOf):String(null==(i=this.tupletRatio)?void 0:i.parts)}getSymbols(){return this.symbols}getFirstSymbol(){return this.symbols[0]}getLastSymbol(){return this.symbols[this.symbols.length-1]}get color(){return this.symbols[0].color}layout(t){this.requestRectUpdate(),this.staffObjects.length=0;let e=this.getSymbols();if(0===e.length)return;let{unitSize:i}=t,{stemDir:s,type:r}=this,o=e.map(t=>t.getBeamCoords());o[0].map(t=>null==t?void 0:t.staff).forEach((a,h)=>{var c,u;if(!a)return;let g=o.map(t=>{var e;return null==(e=t[h])?void 0:e.x}),l=o.map(t=>{var e;return null==(e=t[h])?void 0:e.y}),d=o.map(t=>{var e;return null==(e=t[h])?void 0:e.staff}),f=o.map(t=>{var e;return null==(e=t[h])?void 0:e.stemHeight}),I=e[0],m=g[0],C=l[0],p=d[0],A=e[e.length-1],b=g[g.length-1],y=l[l.length-1],M=d[l.length-1];if(void 0===m||void 0===C||void 0===p||void 0===b||void 0===y||void 0===M)return;let v=null!=(c=f[0])?c:0,w=null!=(u=f[f.length-1])?u:0;if(2!==r){let t=v<w?Math.sqrt(w-v):0,e=w<v?Math.sqrt(v-w):0;"up"===s&&(t*=-1,e*=-1),0!==t&&(C+=t,l[0]+=t),0!==e&&(y+=e,l[l.length-1]+=e)}let S=2*i*("up"===s?-1:1),R=(y+C)/2,x=((t,e)=>{let i=et;if(Number.isFinite(i)&&0!==i){let s=t/e/i;return s=Math.sign(s)*Math.sqrt(Math.abs(s)),t/s*i}return e})(b-m,y-C)/2;C=R-x,y=R+x;let T=0;l.forEach((t,e)=>{let i=g[e];if(void 0!==i&&void 0!==t){let e=t-n.OZ.Math.interpolateY(m,C,b,y,i);"up"===s&&e<0?T=Math.min(T,e):"down"===s&&e>0&&(T=Math.max(T,e))}}),C+=T,y+=T,l=l.map(t=>void 0===t?void 0:t+T);let L=new Vt(a,this);if(2===r){let t=i/(b-m),e=n.OZ.Math.interpolateCoord(m,C+S,b,y+S,-t),s=n.OZ.Math.interpolateCoord(m,C+S,b,y+S,1+t);L.points.push(new Ft(p,this,I,e.x,e.y)),L.points.push(new Ft(M,this,A,s.x,s.y)),L.tupletNumberOffsetY=0}else if(0===r||1===r){T*=.5;let r=t._lineWidth*it;const n=t=>{let r=e[t];if(r instanceof wt){let t=r instanceof wt?Math.max(r.getLeftBeamCount(),r.getRightBeamCount()):0;return tt*i*("up"===s?t-1:0)}return 0};e.forEach((t,e)=>{let i=d[e],o=g[e],a=l[e];if(i&&void 0!==o&&void 0!==a){let h=new Ft(i,this,t,o,a);switch(s){case"up":h.topBeamsHeight=r/2,h.bottomBeamsHeight=r/2+n(e);break;case"down":h.topBeamsHeight=r/2+n(e),h.bottomBeamsHeight=r/2}L.points.push(h)}}),L.tupletNumberOffsetY=S}this.isTuplet()&&(L.tupletNumber=new It(this,this.getTupletRatioText(),.5,.5),L.tupletNumber.layout(t),L.tupletNumber.offset((m+b)/2,(C+y)/2+L.tupletNumberOffsetY)),L.points.length>=2&&this.staffObjects.push(L)})}updateRect(){if(0===this.staffObjects.length)this.rect=new n.vW;else{this.staffObjects.forEach(t=>t.updateRect()),this.rect=this.staffObjects[0].getRect().clone();for(let t=1;t<this.staffObjects.length;t++)this.rect.expandInPlace(this.staffObjects[t].getRect())}}updateStemTips(){this.staffObjects.forEach(t=>{let e=t.points[0],i=t.points[t.points.length-1];2!==this.type&&t.points.forEach(t=>{t.symbol instanceof wt&&(t!==e&&t!==i&&(t.y=n.OZ.Math.interpolateY(e.x,e.y,i.x,i.y,t.x)),t.symbol.setStemTipY(t.staff,t.y))}),t.tupletNumber&&t.tupletNumber.setAnchorY((e.y+i.y)/2+t.tupletNumberOffsetY)})}offset(t,e){this.staffObjects.forEach(e=>e.offset(t,0)),this.requestRectUpdate()}draw(t){let{unitSize:e}=t,{stemDir:i,color:s,type:r}=this;if(2===r){t.color(s).lineWidth(1);let r=("up"===i?1:-1)*e;this.staffObjects.forEach(e=>{let{x:i,y:s}=e.points[0],{x:o,y:a}=e.points[e.points.length-1];if(e.tupletNumber){let r=e.tupletNumber.getRect().width/(o-i)*1.2,h=n.OZ.Math.interpolateCoord(i,s,o,a,.5-r/2),c=n.OZ.Math.interpolateCoord(i,s,o,a,.5+r/2);t.strokeLine(i,s,h.x,h.y),t.strokeLine(c.x,c.y,o,a)}else t.strokeLine(i,s,o,a);t.strokeLine(i,s,i,s+r),t.strokeLine(o,a,o,a+r)})}else 0!==r&&1!==r||(t.color(s).lineWidth(it),this.staffObjects.forEach(s=>{let r=s.points.filter(t=>t.symbol instanceof wt),{x:n,y:o}=r[0],{x:a,y:h}=r[r.length-1],c=tt*e*("up"===i?1:-1)*(1+.5*Math.abs(Math.atan2(h-o,a-n)));for(let e=0;e<r.length-1;e++){let{x:i,y:s,symbol:n}=r[e],{x:o,y:a,symbol:h}=r[e+1],u=n.getRightBeamCount(),g=h.getLeftBeamCount();for(let e=0;e<Math.max(u,g);e++)e<u&&e<g?t.strokeLine(i,s,o,a):u>g?t.strokePartialLine(i,s,o,a,0,.25):g>u&&t.strokePartialLine(i,s,o,a,.75,1),s+=c,a+=c}}));this.staffObjects.forEach(e=>{var i;return null==(i=e.tupletNumber)?void 0:i.draw(t)})}setBeamCounts(){const t=(t,e)=>{let{flagCount:i,noteSize:s,dotCount:r}=t.rhythmProps,{flagCount:n,noteSize:o,dotCount:a}=e.rhythmProps;return i>0&&n>0&&r>0&&0===a&&s*Math.pow(2,r)===o};let e,i=this.symbols.filter(t=>t instanceof wt);for(let s=0;s<i.length;s++){let e=i[s],r=i[s-1],n=i[s+1];e&&(e.setLeftBeamCount(0),e.setRightBeamCount(0),r&&(r.rhythmProps.flagCount===e.rhythmProps.flagCount||t(r,e)||t(e,r)?e.setLeftBeamCount(e.rhythmProps.flagCount):e.setLeftBeamCount(Math.min(r.rhythmProps.flagCount,e.rhythmProps.flagCount))),n&&(n.rhythmProps.flagCount===e.rhythmProps.flagCount||t(n,e)||t(e,n)?e.setRightBeamCount(e.rhythmProps.flagCount):e.setRightBeamCount(Math.min(n.rhythmProps.flagCount,e.rhythmProps.flagCount))))}do{e=!1;for(let t=0;t<i.length;t++){let s=i[t],r=i[t-1],n=i[t+1];s&&s.getLeftBeamCount()!==s.rhythmProps.flagCount&&s.getRightBeamCount()!==s.rhythmProps.flagCount&&(s.setLeftBeamCount(0),s.setRightBeamCount(0),r&&r.getRightBeamCount()>0&&(r.setRightBeamCount(0),e=!0),n&&n.getLeftBeamCount()>0&&(n.setLeftBeamCount(0),e=!0))}}while(e)}setTupletBeamCounts(){let t=this.getType(),e=this.getSymbols();1===t?e.forEach((t,i)=>{t instanceof wt&&(t.setLeftBeamCount(0===i?0:t.rhythmProps.flagCount),t.setRightBeamCount(i===e.length-1?0:t.rhythmProps.flagCount))}):2===t&&e.forEach(t=>{t instanceof wt&&(t.setLeftBeamCount(0),t.setRightBeamCount(0))})}},Xt=class extends G{constructor(t,e,i){super(t),this.pos=e,this.color=i,(0,o.Mu)(this,"mi"),this.mi=new Qe(this)}getMusicInterface(){return this.mi}static getFermataPositions(t){let{measure:e}=t,{row:i}=e;return i.getTopStaff()!==i.getBottomStaff()?[0,1]:[0]}pick(t,e){return this.rect.contains(t,e)?[this]:[]}layout(t){let{unitSize:e}=t,i=4*e,s=3*e;this.rect=new n.vW(-i/2,i/2,-s,0)}offset(t,e){this.rect.offsetInPlace(t,e)}draw(t){let{unitSize:e}=t,i=1===this.pos,s=.7*(i?e:-e),r=this.rect.left,n=this.rect.right,o=(i?this.rect.bottom:this.rect.top)+s,a=(i?this.rect.top:this.rect.bottom)+s,h=a-o;t.drawDebugRect(this.rect),t.color(this.color).lineWidth(1),t.beginPath(),t.moveTo(r,a),t.bezierCurveTo(r,o,n,o,n,a),t.bezierCurveTo(n,o+h/5,r,o+h/5,r,a),t.stroke(),t.fill();let c=h/6;t.fillCircle((r+n)/2,a-c,Math.abs(c))}};function Jt(t){let e=t;for(;e;){if(e.row instanceof fe)return e.row;if(e.measure instanceof se)return e.measure.row;e=e.getParent()}}function Kt(t){return t instanceof zt||t instanceof It||t instanceof xt}var Qt=class extends G{constructor(t,e,i,s){super(t),this.measure=t,this.line=e,this.extension=i,this.cols=s,(0,o.Mu)(this,"mi"),i.addTail(this),this.mi=new qi(this)}get row(){return this.measure.row}getMusicInterface(){return this.mi}getLeftObj(){return this.cols[0]}getLineLeft(t){let e=this.getLeftObj();if(function(t){return t instanceof It||t instanceof xt}(e))return e.getRect().right+t.unitSize;if(e instanceof Ut)return e.getRect().anchorX;if(e instanceof St){const t=e.measure.getColumns();if(e===t[0])return e.measure.getRect().left}return e.getRect().right}getRightObj(){const t=this.cols[this.cols.length-1];if(Kt(t)){const e=Jt(t),i=this.cols[this.cols.length-2],s=Jt(i);return e&&s&&e!==s?i:t}return t}getLineRight(t){let e=this.getRightObj();if(Kt(e))return e.getRect().left-t.unitSize;if(e instanceof St){const t=e.measure.getColumns();if(e===t[t.length-1])return e.measure.getRect().right;let i=e.getNextColumn();if(i&&i.measure===e.measure)return(e.getRect().right+i.getRect().left)/2}return e.getRect().anchorX}layoutFitToMeasure(t){let e=t.unitSize,i=this.getLineLeft(t),s=this.getLineRight(t);[i,s]=[Math.min(i,s),Math.max(i,s)],this.rect=new n.vW(i,s,-e/2,e/2)}pick(t,e){return this.rect.contains(t,e)?[this]:[]}layout(t){this.rect=new n.vW}offset(t,e){this.rect.offsetInPlace(t,e)}draw(t){let{rect:e}=this;const i=this.extension.headObj.musicObj,s=String(i.userData["extension-color"]);"dashed"===this.extension.getLineStyle()&&t.setLineDash([7,3]),t.color(s).lineWidth(1),t.strokeLine(e.left,e.anchorY,e.right,e.anchorY),t.setLineDash([]);let r=this.extension.getTails();if(this===r[r.length-1]&&!Kt(this.getRightObj())){let i=e.anchorY>this.line.getRect().anchorY?-t.unitSize:t.unitSize;t.strokeLine(e.right,e.anchorY,e.right,e.anchorY+i)}}},_t=class extends G{constructor(t,e,i,s,r,...a){var h;super(i),this.connectiveProps=t,this.measure=i,(0,o.Mu)(this,"lx",0),(0,o.Mu)(this,"ly",0),(0,o.Mu)(this,"rx",0),(0,o.Mu)(this,"ry",0),(0,o.Mu)(this,"cp1x",0),(0,o.Mu)(this,"cp1y",0),(0,o.Mu)(this,"cp2x",0),(0,o.Mu)(this,"cp2y",0),(0,o.Mu)(this,"arcHeight",0),(0,o.Mu)(this,"line"),(0,o.Mu)(this,"leftNoteGroup"),(0,o.Mu)(this,"leftNoteId"),(0,o.Mu)(this,"rightNoteGroup"),(0,o.Mu)(this,"rightNoteId"),(0,o.Mu)(this,"tieType"),(0,o.Mu)(this,"mi"),this.line=null!=(h=this.measure.row.findMatchingLine(e))?h:e,this.leftNoteGroup=s,this.leftNoteId=r,a[0]instanceof wt&&"number"==typeof a[1]?(this.rightNoteGroup=a[0],this.rightNoteId=a[1],this.tieType=void 0):n.I8.isEnumValue(a[0],v)&&(this.rightNoteGroup=void 0,this.rightNoteId=void 0,this.tieType=a[0]),this.measure.addConnectiveObject(this),this.mi=new Ye(this)}getMusicInterface(){return this.mi}get doc(){return this.measure.doc}isInsideMeasure(){return void 0===this.rightNoteGroup||this.leftNoteGroup.measure===this.rightNoteGroup.measure}pick(t,e){return this.rect.contains(t,e)?[this]:[]}layout(t){let e,i,s,r,o,a,{unitSize:c}=t,{measure:u,line:g,leftNoteGroup:l,leftNoteId:d,rightNoteGroup:f,rightNoteId:I,connectiveProps:m}=this,{noteAnchor:C,arcDir:p}=m,{row:A}=u,b=A.getPrevRow(),y=A.getNextRow(),M=A.getConnectivesContentRect();if(e=l.getConnectiveAnchorPoint(m,g,d,C,"left"),i=void 0!==f&&void 0!==I?f.getConnectiveAnchorPoint(m,g,I,C,"right"):"toMeasureEnd"===this.tieType?{x:u.getColumnsContentRect().right,y:e.y}:{x:e.x+c*nt,y:e.y},void 0===f)s=e.x,r=e.y,o=i.x,a=i.y;else if(l.row===A&&f.row===A)s=e.x,r=e.y,o=i.x,a=i.y;else if(l.row===b&&f.row===A){let t=b.getConnectivesContentRect().right-e.x,n=i.x-M.left;s=M.left,r=e.y+(i.y-e.y)*t/(t+n),o=i.x,a=i.y}else{if(l.row!==A||f.row!==y)throw new h.MusicError(h.MusicErrorType.Score,"Cannot layout connective object because no valid left and right note groups.");{let t=y.getConnectivesContentRect(),n=M.right-e.x,h=i.x-t.left;s=e.x,r=e.y,o=M.right,a=e.y+(i.y-e.y)*n/(n+h)}}let v=("up"===p?-1:1)*c*Math.log2(o-s)/3;this.lx=s,this.ly=r,this.rx=o,this.ry=a,this.arcHeight="slide"===this.connectiveProps.connective?0:v;let{nx:w,ny:S}=n.OZ.Math.calcNormal(s,r,o,a);this.cp1x=.7*s+.3*o+w*this.arcHeight,this.cp1y=.7*r+.3*a+S*this.arcHeight,this.cp2x=.3*s+.7*o+w*this.arcHeight,this.cp2y=.3*r+.7*a+S*this.arcHeight,this.rect=new n.vW(Math.min(this.lx,this.cp1x,this.cp2x,this.rx),Math.max(this.lx,this.cp1x,this.cp2x,this.rx),Math.min(this.ly,this.cp1y,this.cp2y,this.ry),Math.max(this.ly,this.cp1y,this.cp2y,this.ry)),this.line.addObject(this)}offset(t,e){this.lx+=t,this.ly+=e,this.rx+=t,this.ry+=e,this.cp1x+=t,this.cp1y+=e,this.cp2x+=t,this.cp2y+=e,this.rect.offsetInPlace(t,e)}draw(t){if(void 0===this.rightNoteGroup);else if(this.leftNoteGroup.measure===this.rightNoteGroup.measure);else if(this.leftNoteGroup.row.getNextRow()===this.rightNoteGroup.row);else if(this.measure!==this.rightNoteGroup.measure)return;let{rect:e}=this,{_lineWidth:i}=t;t.drawDebugRect(e);let s=1.5*i,r=.25*i;t.color(this.line instanceof ge?"tab.connective":"staff.connective"),t.lineWidth(1),0===this.arcHeight?(t.beginPath(),t.moveTo(this.lx,this.ly),t.lineTo(this.rx,this.ry),t.stroke()):(t.beginPath(),t.moveTo(this.lx,this.ly-r),t.bezierCurveTo(this.cp1x,this.cp1y-s,this.cp2x,this.cp2y-s,this.rx,this.ry-r),t.lineTo(this.rx,this.ry+r),t.bezierCurveTo(this.cp2x,this.cp2y+s,this.cp1x,this.cp1y+s,this.lx,this.ly+r),t.fill())}},$t=class{constructor(t,e,i,s){this.connective=t,this.span=e,this.noteAnchor=i,(0,o.Mu)(this,"noteGroups"),(0,o.Mu)(this,"arcDir","down"),this.noteGroups=[s]}getStartNoteGroup(){return this.noteGroups[0]}startsWith(t){return this.noteGroups[0]===t}addNoteGroup(t){return"stub"!==this.span&&"toMeasureEnd"!==this.span&&(this.span>this.noteGroups.length&&(this.noteGroups.push(t),!0))}computeParams(t){let{stemDir:e}=this.noteGroups[0],{hasStem:i}=this.noteGroups[0].rhythmProps;if("stemTip"===this.noteAnchor)this.arcDir="up"===e?"up":"down";else if("auto"===this.noteAnchor)this.arcDir="up"!==e&&i?"up":"down",this.noteGroups[0].notes.length>1||"slide"===this.connective?this.noteAnchor="center":"up"===this.arcDir?this.noteAnchor="above":this.noteAnchor="below";else if("center"===this.noteAnchor){let e=t instanceof ue?t:void 0,i=this.noteGroups[0].getDiatonicId(e);this.arcDir=!e||i<e.middleLineDiatonicId?"down":"up"}else"above"===this.noteAnchor?this.arcDir="up":"below"===this.noteAnchor&&(this.arcDir="down")}removeConnectives(){this.noteGroups.forEach(t=>{t.measure.removeConnectiveObjects(),t.removeConnectiveProps()}),this.noteGroups.length=1}createConnectives(){if(0===this.noteGroups.length)return;this.getStartNoteGroup().collectConnectiveProps();let{connective:t,span:e}=this;this.noteGroups[0].row.getNotationLines().forEach(i=>{if(this.computeParams(i),"tie"===t){if(n.I8.isEnumValue(e,v)){let t=this.noteGroups[0];for(let s=0;s<t.notes.length;s++)this.createObjConnectiveWithTieType(i,t,s,e)}else if(this.noteGroups.length>=2)for(let t=0;t<this.noteGroups.length-1;t++){let e=this.noteGroups[t],s=this.noteGroups[t+1];e.notes.forEach((t,r)=>{let n=s.notes.findIndex(e=>a.Note.equals(e,t));n>=0&&this.createObjConnective(i,e,r,s,n)})}}else if("slur"===t){if("number"==typeof e&&e>=2&&this.noteGroups.length===e){let t=this.noteGroups[0],e=this.noteGroups[this.noteGroups.length-1];this.createObjConnective(i,t,0,e,0)}}else if("slide"===t&&this.noteGroups.length>=2)for(let t=0;t<this.noteGroups.length-1;t++){let e=this.noteGroups[t],s=this.noteGroups[t+1];this.createObjConnective(i,e,0,s,0)}})}createObjConnectiveWithTieType(t,e,i,s){if(e.enableConnective(t))if(t instanceof ue)new _t(this,t,e.measure,e,i,s);else if(t instanceof ge){void 0!==e.getFretNumberString(i)&&new _t(this,t,e.measure,e,i,s)}}createObjConnective(t,e,i,s,r){const n=(e,i,s,r,n)=>{if(i.enableConnective(t)&&r.enableConnective(t))if(t instanceof ue)new _t(this,t,e,i,s,r,n);else if(t instanceof ge){let o=i.getFretNumberString(s),a=r.getFretNumberString(n);void 0===o||void 0===a||o!==a&&"slur"!==this.connective||new _t(this,t,e,i,s,r,n)}};if(e.measure===s.measure)n(e.measure,e,i,s,r);else{if(e.measure.getNextMeasure()!==s.measure)throw new h.MusicError(h.MusicErrorType.Score,"Cannot create connective because it is jumping measures.");n(e.measure,e,i,s,r),n(s.measure,e,i,s,r)}}},te=class extends G{constructor(t,e,i,s,a,h,c){super(t),this.col=t,this.verse=e,this.line=i,this.vpos=s,(0,o.Mu)(this,"nextLyricsObject"),(0,o.Mu)(this,"rhythmProps"),(0,o.Mu)(this,"color","black"),(0,o.Mu)(this,"hyphen"),(0,o.Mu)(this,"text"),(0,o.Mu)(this,"mi"),this.rhythmProps=r.R6.get(a);let u="left"===(null==c?void 0:c.align)?0:"right"===(null==c?void 0:c.align)?1:.5;this.hyphen=n.I8.isEnumValue(null==c?void 0:c.hyphen,T)?null==c?void 0:c.hyphen:void 0,this.text=new It(this,{text:h,color:this.color,scale:.8},u,0),this.rect=this.text.getRect().clone(),this.mi=new Ui(this)}getMusicInterface(){return this.mi}get measure(){return this.col.measure}getText(){return this.text.getText()}setNextLyricsObject(t){this.nextLyricsObject=t}pick(t,e){return this.getRect().contains(t,e)?[this]:[]}layout(t){this.text.layout(t),this.rect=this.text.getRect().clone()}offset(t,e){this.text.offset(t,e),this.rect.offsetInPlace(t,e)}draw(t){var e;if(this.text.draw(t),void 0!==this.hyphen){t.color(this.color).lineWidth(1);let i=this.getRect(),s=null==(e=this.nextLyricsObject)?void 0:e.getRect(),r=1.5*t.unitSize,n=s?.85*(s.left-i.right):r,o="-"===this.hyphen?Math.min(r,n):n;if(o>0){let e=s?(i.right+s.left)/2:i.right+o/.85,r=i.centerY;t.moveTo(e-o/2,r),t.lineTo(e+o/2,r),t.stroke()}}}},ee=class extends G{constructor(t,e){super(t),this.measure=t,this.tab=e,(0,o.Mu)(this,"voiceId"),(0,o.Mu)(this,"mi"),(0,o.Mu)(this,"tupletPartsTextObjMap",new n.b1),this.voiceId=[0,1,2,3].filter(t=>e.containsVoiceId(t)),this.rect=new n.vW,this.mi=new ki(this)}getMusicInterface(){return this.mi}get doc(){return this.measure.doc}pick(t,e){return this.rect.contains(t,e)?[this]:[]}layout(t){let e=this.measure.getColumns(),i=[0,1,2,3].map(t=>n.OZ.Math.sum(e.map(e=>e.getVoiceSymbol(t)?1:0)));this.voiceId.sort((t,e)=>n.OZ.Math.cmp(i[t],i[e])),this.rect=new n.vW}hasTuplets(){return this.measure.getBeamGroups().some(t=>t.isTuplet())}layoutFitToMeasure(t){let{unitSize:e,fontSize:i}=t,{measure:s}=this,r=s.getColumnsContentRect(),n=5*e;this.rect.left=r.left,this.rect.anchorX=r.centerX,this.rect.right=r.right,this.rect.top=this.hasTuplets()?-i:0,this.rect.anchorY=0,this.rect.bottom=n}offset(t,e){this.rect.offsetInPlace(t,e)}draw(t){t.drawDebugRect(this.rect),t.lineWidth(1);let{unitSize:e,fontSize:i}=t,s=e,r=e,o=.25*e,{bottom:a,anchorY:h}=this.getRect(),c=h,u=a,g=this.measure.getColumns();for(let l=0;l<g.length;l++){let e=g[l],a=this.voiceId.map(t=>e.getVoiceSymbol(t)).find(t=>void 0!==t);if(!a)continue;let h=a.getBeamGroup(),d=h?h.getSymbols():[a];for(let f=0;f<d.length;f++){let e=d[f],a=d[f+1],I=e.col.getRect().anchorX;if(e instanceof wt){if(t.lineWidth(1),t.color(ts("tab.note")),e.rhythmProps.noteSize>=2&&(t.lineWidth(4===e.rhythmProps.noteSize?2:1),t.strokeLine(I,u,I,c)),1===d.length)for(let i=0;i<e.rhythmProps.flagCount;i++)t.drawFlag(new n.vW(I,I+s,c+i*s,c+(i+2)*s),"up");for(let i=0;i<e.rhythmProps.dotCount;i++)t.fillCircle(I+r*(i+1),u-o,o)}else if(e instanceof yt){t.lineWidth(1),t.color(ts("tab.rest"));let i=I,s=(c+u)/2,n=.65;t.save(),t.scale(n,n),t.drawRest(e.rhythmProps.noteSize,i/n,s/n),t.restore();for(let a=0;a<e.rhythmProps.dotCount;a++)i+=1.5*r,t.fillCircle(i,s+r,o)}if(a){let i=e,n=a,h=i.col.getRect().anchorX,g=n.col.getRect().anchorX,l=i.hasTuplet()?1:i instanceof wt?i.getRightBeamCount():1,d=n.hasTuplet()?1:n instanceof wt?n.getLeftBeamCount():1,f=Math.max(l,d);t.color(ts("tab.note")),t.lineWidth(2);for(let e=0;e<f;e++){let i=d>l&&e>=l?.75:0,r=l>d&&e>=d?.25:1;t.strokePartialLine(h,c+e*s,g,c+e*s,i,r)}t.lineWidth(1);for(let e=0;e<i.rhythmProps.dotCount;e++)t.fillCircle(h+r*(e+1),u-o,o);for(let e=0;e<n.rhythmProps.dotCount;e++)t.fillCircle(g+r*(e+1),u-o,o)}if(h&&h.isTuplet()){t.color(ts("tab.note"));let e=(d[0].col.getRect().anchorX+d[d.length-1].col.getRect().anchorX)/2,s=h.getTupletRatioText(),r=this.tupletPartsTextObjMap.get(s);r||(this.tupletPartsTextObjMap.set(s,r=new It(this,{text:s,scale:.75},.5,.5)),r.layout(t)),r.setCenter(e,c-i/2),r.draw(t)}d.length>1&&(l=g.indexOf(d[d.length-1].col),l<0&&(l=g.length))}}}};var ie=class{constructor(){(0,o.Mu)(this,"tabTuning_0",0),(0,o.Mu)(this,"signature_1",0),(0,o.Mu)(this,"leftBarLine_2",0),(0,o.Mu)(this,"padding_3",0),(0,o.Mu)(this,"columnsMin_4",0),(0,o.Mu)(this,"padding_5",0),(0,o.Mu)(this,"rightBarLine_6",0)}get leftSolid(){return this.tabTuning_0+this.signature_1+this.leftBarLine_2+this.padding_3}get columnsMin(){return this.columnsMin_4}get rightSolid(){return this.padding_5+this.rightBarLine_6}},se=class extends G{constructor(t,e){super(t),this.row=t,this.options=e,(0,o.Mu)(this,"prevMeasure"),(0,o.Mu)(this,"nextMeasure"),(0,o.Mu)(this,"keySignature",(0,a.getDefaultKeySignature)()),(0,o.Mu)(this,"timeSignature",(0,a.getDefaultTimeSignature)()),(0,o.Mu)(this,"tempo",(0,a.getDefaultTempo)()),(0,o.Mu)(this,"alterKeySignature"),(0,o.Mu)(this,"alterTimeSignature"),(0,o.Mu)(this,"alterTempo"),(0,o.Mu)(this,"signatures",[]),(0,o.Mu)(this,"tabStringNotes",[]),(0,o.Mu)(this,"barLineLeft"),(0,o.Mu)(this,"columns",[]),(0,o.Mu)(this,"barLineRight"),(0,o.Mu)(this,"connectives",[]),(0,o.Mu)(this,"beamGroups",[]),(0,o.Mu)(this,"measureId"),(0,o.Mu)(this,"regions",new ie),(0,o.Mu)(this,"needLayout",!0),(0,o.Mu)(this,"voiceSymbols",(0,n.Sl)(new n.qG)),(0,o.Mu)(this,"lastAddedRhythmColumn"),(0,o.Mu)(this,"lastAddedRhythmSymbol"),(0,o.Mu)(this,"addExtensionTo",[]),(0,o.Mu)(this,"layoutObjects",[]),(0,o.Mu)(this,"postMeasureBreakWidth",0),(0,o.Mu)(this,"passCount",0),(0,o.Mu)(this,"needBeamsUpdate",!0),(0,o.Mu)(this,"navigationSet",new n.wu),(0,o.Mu)(this,"isEndSong",!1),(0,o.Mu)(this,"isEndSection",!1),(0,o.Mu)(this,"endRepeatPlayCount",2),(0,o.Mu)(this,"endRepeatPlayCountText"),(0,o.Mu)(this,"staticObjectsCache",new n.b1),(0,o.Mu)(this,"lyricsObjectsCache",new n.Yz),(0,o.Mu)(this,"mi"),this.mi=new si(this),this.prevMeasure=t.doc.getLastMeasure(),this.prevMeasure&&(this.prevMeasure.nextMeasure=this),this.barLineLeft=new Ut(this),this.barLineRight=new zt(this),this.measureId=this.prevMeasure?this.prevMeasure.measureId+1:0,this.updateKeySignature(),this.updateTimeSignature(),this.updateTempo(),this.row.getTabs().forEach(t=>{this.addLayoutObject(new ee(this,t),t,0,0)})}getMusicInterface(){return this.mi}get doc(){return this.row.doc}isPartialMeasure(){return this.getConsumedTicks()<this.getMeasureTicks()}isUpBeat(){return this===this.doc.getFirstMeasure()}resetPassCount(){this.passCount=0}incPassCount(){this.passCount++}getPassCount(){return this.passCount}updateRunningArguments(t){var e;null!=t||(t=[]);let i=n.OZ.Math.sum([0,1,2,3].map(t=>this.getVoiceSymbols(t).length>0?1:0));[0,1,2,3].forEach(e=>{var s;let r=null!=(s=t[e])?s:t[e]={diatonicId:(()=>{let t=this.row.getStaves().filter(t=>t.containsVoiceId(e)),i=this.row.getTabs().filter(t=>t.containsVoiceId(e));return t.length>0?t[0].middleLineDiatonicId:i.length>0?i[0].getTuningStrings()[3].diatonicId:a.Note.getNote("G4").diatonicId})(),stemDir:"auto",stringNumbers:[]};this.getVoiceSymbols(e).forEach((t,e,s)=>{var n,o;if(t.setDiatonicId===yt.UndefinedDiatonicId?i<2&&(r.diatonicId=yt.UndefinedDiatonicId):r.diatonicId=t.setDiatonicId,t instanceof wt)switch(t.setStringsNumbers&&(r.stringNumbers=t.setStringsNumbers),null==(n=t.options)?void 0:n.stem){case"up":case"up":r.stemDir="up";break;case"down":case"down":r.stemDir="down";break;case"auto":case"auto":r.stemDir="auto"}let a,h=null==(o=t.getBeamGroup())?void 0:o.getSymbols();a=void 0===h?"auto"===r.stemDir?this.row.solveAutoStemDir([t]):r.stemDir:t===h[0]?"auto"===r.stemDir?this.row.solveAutoStemDir(h):r.stemDir:h[0].stemDir,t.updateRunningArguments(r.diatonicId,a,r.stringNumbers)})}),null==(e=this.getNextMeasure())||e.updateRunningArguments(t)}pick(t,e){if(!this.getRect().contains(t,e))return[];for(let i=0;i<this.signatures.length;i++){let s=this.signatures[i].pick(t,e);if(s.length>0)return[this,...s]}for(let i=0;i<this.tabStringNotes.length;i++){let s=this.tabStringNotes[i].pick(t,e);if(s.length>0)return[this,...s]}for(let i=0;i<this.columns.length;i++){let s=this.columns[i].pick(t,e);if(s.length>0)return[this,...s]}if(this.barLineLeft){let i=this.barLineLeft.pick(t,e);if(i.length>0)return[this,...i]}if(this.barLineRight){let i=this.barLineRight.pick(t,e);if(i.length>0)return[this,...i]}if(this.endRepeatPlayCountText){let i=this.endRepeatPlayCountText.pick(t,e);if(i.length>0)return[this,...i]}for(let i=0;i<this.connectives.length;i++){let s=this.connectives[i].pick(t,e);if(s.length>0)return[this,...s]}for(let i=0;i<this.beamGroups.length;i++){let s=this.beamGroups[i].pick(t,e);if(s.length>0)return[this,...s]}for(let i=0;i<this.layoutObjects.length;i++){let s=this.layoutObjects[i].musicObj.pick(t,e);if(s.length>0)return[this,...s]}return[this]}getMeasureNumber(){let t=this.doc.getFirstMeasure();return t&&t.isPartialMeasure()?this.measureId:this.measureId+1}getColumns(){return this.columns}getColumnCount(){return this.columns.length}getColumn(t){return this.getColumns()[t]}isFirstMeasure(){return void 0===this.prevMeasure}isLastMeasure(){return void 0===this.nextMeasure}isFirstMeasureInRow(){return this===this.row.getFirstMeasure()}isLastMeasureInRow(){return this===this.row.getLastMeasure()}getNextMeasure(){return this.nextMeasure}getPrevMeasure(){return this.prevMeasure}getKeySignature(){return this.keySignature}setKeySignature(...t){var e;if(null==(e=this.getPrevMeasure())||e.endSection(),t[0]instanceof a.KeySignature)this.alterKeySignature=t[0];else if(t[0]instanceof a.Scale)this.alterKeySignature=t[0];else if(n.I8.isNonEmptyString(t[0]))if(1===t.length)this.alterKeySignature=(0,a.getScale)(t[0]);else if(2===t.length)try{let e=""+t[0],i=(0,a.validateScaleType)(""+t[1]);this.alterKeySignature=(0,a.getScale)(e,i)}catch(i){throw new h.MusicError(h.MusicErrorType.Score,"Cannot set key signature because invalid args: "+t)}this.updateKeySignature()}updateKeySignature(){this.keySignature=this.prevMeasure?this.prevMeasure.keySignature:(0,a.getDefaultKeySignature)(),this.alterKeySignature&&(this.keySignature=this.alterKeySignature),this.nextMeasure&&this.nextMeasure.updateKeySignature(),this.requestLayout()}getTimeSignature(){return this.timeSignature}setTimeSignature(t){var e;null==(e=this.getPrevMeasure())||e.endSection(),this.alterTimeSignature=t,this.updateTimeSignature()}updateTimeSignature(){this.timeSignature=this.prevMeasure?this.prevMeasure.timeSignature:(0,a.getDefaultTimeSignature)(),this.alterTimeSignature&&(this.timeSignature=this.alterTimeSignature),this.nextMeasure&&this.nextMeasure.updateTimeSignature(),this.requestLayout()}getTempo(){return this.tempo}setTempo(t,e){var i;if(null==(i=this.getPrevMeasure())||i.endSection(),void 0===e)this.alterTempo={beatsPerMinute:t};else{let i=a.NoteLengthProps.get(e).dotCount,s={beatLength:(0,a.validateNoteLength)(e),dotCount:i>0?i:void 0};this.alterTempo={beatsPerMinute:t,options:s}}this.updateTempo()}updateTempo(){var t;if(this.tempo=this.prevMeasure?this.prevMeasure.tempo:(0,a.getDefaultTempo)(),this.alterTempo){let e,i,s=this.alterTempo.beatsPerMinute;this.alterTempo.options?(e=this.alterTempo.options.beatLength,i=null!=(t=this.alterTempo.options.dotCount)?t:0):this.alterTimeSignature?(e=this.alterTimeSignature.beatLength,i=0):(e=this.tempo.options.beatLength,i=this.tempo.options.dotCount),this.tempo={beatsPerMinute:s,options:{beatLength:e,dotCount:i}}}this.nextMeasure&&this.nextMeasure.updateTempo(),this.requestLayout()}hasPostMeasureBreak(){return this.isEndSong&&this!==this.row.getLastMeasure()}getPostMeasureBreakWidth(){return this.postMeasureBreakWidth}addLayoutObject(t,e,i,s){const r=new ae(t,e,i,s);return this.layoutObjects.push(r),this.requestLayout(),this.requestRectUpdate(),r}forEachStaffGroup(t,e,i){const s=this.row.getNotationLines(),r=(t,o,a=[])=>{if("number"==typeof t)s[t]&&i(s[t],o);else if("string"==typeof t&&t.length>0){let h=s.filter(e=>e.name===t);if(h.forEach(t=>i(t,o)),0===h.length){let i=this.doc.getStaffGroup(t);if(i&&!a.includes(t)){let s=[...a,t];(n.I8.isArray(i.staffsTabsAndGroups)?i.staffsTabsAndGroups:[i.staffsTabsAndGroups]).forEach(t=>{switch(i.verticalPosition){case"above":r(t,0,s);break;case"below":r(t,1,s);break;case"both":r(t,0,s),r(t,1,s);break;case"auto":r(t,e,s)}})}}}};void 0===t?s.length>=2&&s[0]instanceof ue&&s[1]instanceof ue&&void 0!==s[0].staffConfig.grandId&&s[0].staffConfig.grandId===s[1].staffConfig.grandId?r(1===e?1:0,e):r(0,e):n.I8.isArray(t)?t.forEach(t=>r(t,e)):r(t,e)}addFermata(t,e){let i="atMeasureEnd"===e?this.barLineRight:this.lastAddedRhythmColumn;if(!i)throw new h.MusicError(h.MusicErrorType.Score,"Cannot add Fermata because anchor is undefined.");this.forEachStaffGroup(t,0,(t,e)=>{const s=t instanceof ge?"staff.element.fermata":"tab.element.fermata";this.addLayoutObject(new Xt(i,e,s),t,1,e)}),this.disableExtension(),this.requestLayout()}hasFermata(t){return this.layoutObjects.some(e=>e.musicObj instanceof Xt&&e.anchor===t)}addNavigation(t,e,...i){let s;switch(e){case"ending":if(this.navigationSet.has(e))throw new h.MusicError(h.MusicErrorType.Score,"Cannot add ending beasure measure already has one.");let r=this,o=i;s={createObj:t=>new Zt(r,t instanceof ge?"staff.element.navigation":"tab.element.navigation",o),layoutGroupId:4,defaultVerticalPos:0};break;case"D.C. al Coda":case"D.C. al Fine":case"D.S. al Coda":case"D.S. al Fine":{let i=this.barLineRight,r=Et(e);s={createObj:t=>new It(i,{text:r,color:t instanceof ge?"staff.element.navigation":"tab.element.navigation"},1,1),layoutGroupId:3,defaultVerticalPos:0},this.addNavigation(t,"endRepeat"),this.endSong();break}case"Fine":{let t=this.barLineRight,i=Et(e);s={createObj:e=>new It(t,{text:i,color:e instanceof ge?"staff.element.navigation":"tab.element.navigation"},1,1),layoutGroupId:3,defaultVerticalPos:0};break}case"Segno":case"Coda":{let t=this.barLineLeft,i=Et(e);s={createObj:e=>new xt(t,i,e instanceof ge?"staff.element.navigation":"tab.element.navigation"),layoutGroupId:3,defaultVerticalPos:0};break}case"toCoda":{let t=this.barLineRight,i=Et(e);s={createObj:e=>new xt(t,i,e instanceof ge?"staff.element.navigation":"tab.element.navigation"),layoutGroupId:3,defaultVerticalPos:0};break}case"endRepeat":if(0===i.length)this.endRepeatPlayCount=2;else{if(!n.I8.isIntegerGte(i[0],2))throw new h.MusicError(h.MusicErrorType.Score,"Invalid end repeat play count (should be 2 or greater integer): "+i[0]);this.endRepeatPlayCount=i[0]}if(2!==this.endRepeatPlayCount){const t={text:`${this.endRepeatPlayCount}x`,scale:.8,color:"staff.frame"};this.endRepeatPlayCountText=new It(this,t,.5,1)}}s&&this.forEachStaffGroup(t,s.defaultVerticalPos,(t,e)=>{this.addLayoutObject(s.createObj(t),t,s.layoutGroupId,e)}),this.navigationSet.add(e),this.disableExtension()}hasNavigation(t){return this.navigationSet.has(t)}addAnnotation(t,e,i){let s=this.lastAddedRhythmColumn;if(!s)throw new h.MusicError(h.MusicErrorType.Score,"Cannot add annotation because anchor is undefined.");if(0===i.length)throw new h.MusicError(h.MusicErrorType.Score,"Cannot add annotation because annotation text is empty.");let r,n,o,a={text:i};switch(e){case"dynamics":r=6,n=0,a.italic=!0,o="bottom";break;case"tempo":r=5,n=0,a.italic=!0,o="bottom"}const c=function(t){switch(t){case"bottom":return.8;case"middle":return.5}}(o);this.disableExtension(),this.forEachStaffGroup(t,n,(t,e)=>{const i=t instanceof ge?"tab.element.annotation":"staff.element.annotation";a.color=i;let n=new It(s,a,.5,c);const o=this.addLayoutObject(n,t,r,e);this.enableExtension(o,i)})}addLabel(t,e,i){let s=this.lastAddedRhythmColumn;if(!s)throw new h.MusicError(h.MusicErrorType.Score,"Cannot add label because anchor is undefined.");if(0===i.length)throw new h.MusicError(h.MusicErrorType.Score,"Cannot add label because label text is empty.");let r,n,o={text:i};switch(e){case"note":r=2,n=1;break;case"chord":r=7,n=0}this.disableExtension(),this.forEachStaffGroup(t,n,(t,e)=>{const i=t instanceof ge?"staff.element.label":"tab.element.label";o.color=i;let n=new It(s,o,.5,1);const a=this.addLayoutObject(n,t,r,e);this.enableExtension(a,i)})}addConnective(t,...e){let i=this.lastAddedRhythmSymbol;if(!(i instanceof wt))throw new h.MusicError(h.MusicErrorType.Score,"Connective can be added to note group only.");if("tie"===t){let t=n.I8.isInteger(e[0])||n.I8.isEnumValue(e[0],v)?e[0]:2,s=n.I8.isEnumValue(e[1],w)?e[1]:"auto";i.startConnective(new $t("tie",t,s,i))}else if("slur"===t){let t=n.I8.isInteger(e[0])?e[0]:2,s=n.I8.isEnumValue(e[1],w)?e[1]:"auto";i.startConnective(new $t("slur",t,s,i))}else if("slide"===t){let t=n.I8.isEnumValue(e[0],w)?e[0]:"auto";i.startConnective(new $t("slide",2,t,i))}}addExtension(t,e){if(this.addExtensionTo.forEach(i=>{const{layoutObj:s,color:r}=i,{musicObj:o}=s;o.userData["extension-color"]=r;const c=o.getParent();if(!(o instanceof It&&c instanceof St))throw new h.MusicError(h.MusicErrorType.Score,"Cannot add extension becaue no compatible music object to attach it to.");{let i="dashed",r="bottom",h=new jt(s,c,function(t){if("string"==typeof t&&(t=[t]),n.I8.isArray(t)){let e=0;for(let i=0;i<t.length;){let s=t[i],r=t[i+1];if("string"==typeof s){i++;let t=a.RhythmProps.get(s).ticks;"number"==typeof r&&(i++,t*=r),e+=t}else i++}return e}return t}(t),e,i,r);o.setLink(h)}}),0===this.addExtensionTo.length)throw new h.MusicError(h.MusicErrorType.Score,"Cannot add extension because music object to attach it to is undefined.");this.disableExtension(),this.requestLayout()}enableExtension(t,e){this.addExtensionTo.push({layoutObj:t,color:e})}disableExtension(){this.addExtensionTo=[]}getEnding(){return this.layoutObjects.map(t=>t.musicObj).find(t=>t instanceof Zt)}getEndRepeatPlayCount(){return this.endRepeatPlayCount}endSong(){this.isEndSong=!0,this.requestLayout(),this.disableExtension()}hasEndSong(){return this.isEndSong}endSection(){this.isEndSection=!0,this.requestLayout(),this.disableExtension()}hasEndSection(){return this.isEndSection}endRow(){this.doc.requestNewRow(),this.disableExtension()}addRhythmSymbol(t){let{col:e,voiceId:i}=t;e.setVoiceSymbol(i,t),this.voiceSymbols.add(i,t),t.oldStyleTriplet&&this.createOldStyleTriplets(i),this.requestBeamsUpdate(),this.lastAddedRhythmColumn=e,this.lastAddedRhythmSymbol=t}addNoteGroup(t,e,i,s,r){let n=e.map(t=>"string"==typeof t?a.Note.getNote(t):t),o=this.getRhythmColumn(t),h=new wt(o,t,n,i,s,r);return this.addRhythmSymbol(h),h}addRest(t,e,i,s){let r=this.getRhythmColumn(t),n=new yt(r,t,e,i,s);return this.addRhythmSymbol(n),n}addLyrics(t,e,i,s,r){this.forEachStaffGroup(t,1,(t,o)=>{var c;let u=this.getRhythmColumn({verse:e,line:t,vpos:o}),g=new te(u,e,t,o,(0,a.validateNoteLength)(s),i,r);u.addLyricsObject(g);let l=this.lyricsObjectsCache.getOrCreate(t,o,e,[]);l.push(g),l.sort((t,e)=>n.OZ.Math.cmp(t.col.positionTicks,e.col.positionTicks)),null==(c=g.measure.getPrevLyricsObject(g))||c.setNextLyricsObject(g),this.addLayoutObject(g,t,function(t){switch(t){case 1:return 8;case 2:return 9;case 3:return 10;default:throw new h.MusicError(h.MusicErrorType.Unknown,"VerseNumber is not 1, 2 or 3.")}}(e),o),this.lastAddedRhythmColumn=u})}getRhythmColumn(t){let e=0;for(let i=this.columns.length-1;i>=0&&0===e;i--){let s=this.columns[i],r="number"==typeof t?s.getVoiceSymbol(t):s.getLyricsObject(t.verse,t.line,t.vpos);r&&(e=s.positionTicks+r.rhythmProps.ticks)}for(let i=0;i<=this.columns.length;i++){let t=this.columns[i];if(t&&t.positionTicks===e)return t;if(!t||t.positionTicks>e){let t=new St(this,e);return this.columns.splice(i,0,t),t}}throw new h.MusicError(h.MusicErrorType.Score,"Error in rhythm column. Should never get here.")}getMeasureTicks(){return this.getTimeSignature().measureTicks}getConsumedTicks(t){let e=0;return this.columns.forEach(i=>{[0,1,2,3].forEach(s=>{let r=i.getVoiceSymbol(s);!r||void 0!==t&&t!==s||(e=Math.max(e,i.positionTicks+r.rhythmProps.ticks))})}),e}getColumnsContentRect(){return new n.vW(this.barLineLeft.getRect().anchorX,this.barLineRight.getRect().anchorX,this.getRect().top,this.getRect().bottom)}getLeftSolidWidth(){return this.regions.leftSolid}getMinColumnsWidth(){return this.regions.columnsMin}getRightSolidWidth(){return this.regions.rightSolid}getTotalSolidWidth(){return this.getLeftSolidWidth()+this.getRightSolidWidth()}getMinWidth(){return this.getLeftSolidWidth()+this.getMinColumnsWidth()+this.getRightSolidWidth()}getStaffLineLeft(){let t=this.getPrevMeasure();return t&&t.row===this.row&&!t.hasPostMeasureBreak()?t.getStaffLineRight():this.getRect().left+this.regions.tabTuning_0}getStaffLineRight(){return this.barLineRight.getRect().anchorX}getPrevLyricsObject(t){var e;let{line:i,verse:s,vpos:r}=t,n=this.lyricsObjectsCache.getOrDefault(i,r,s,[]),o=n.indexOf(t);if(o>0)return n[o-1];if(0===o){let n=null==(e=t.measure.getPrevMeasure())?void 0:e.lyricsObjectsCache.get(i,r,s);if(n&&n.length>0)return n[n.length-1]}}getStaticObjects(t){let e=this.layoutObjects.filter(e=>e.line===t&&e.isPositionResolved()).map(t=>t.musicObj),i=e.length>0?[...this.staticObjectsCache.getOrDefault(t,[]),...e]:this.staticObjectsCache.getOrDefault(t,[]);return i.forEach(t=>t.getRect()),i}addStaticObject(t,e){this.staticObjectsCache.getOrCreate(t,[]).push(e)}removeLayoutObjects(t){this.layoutObjects=this.layoutObjects.filter(e=>{if(e.musicObj===t){let t=e.musicObj.getLink();return t&&t.detachTail(e.musicObj),e.layoutGroup.remove(e),!1}return!0})}addConnectiveObject(t){this.connectives.push(t),this.requestLayout()}removeConnectiveObjects(){this.connectives.length>0&&(this.connectives=[],this.requestLayout())}createExtensions(){this.layoutObjects.forEach(t=>{let{musicObj:e,measure:i,layoutGroupId:s,verticalPos:r,line:n}=t;if(e.getLink()instanceof jt){let t=e.getLink();if(t.getHead()!==e)return;if(t.getTails().forEach(t=>i.removeLayoutObjects(t)),!t.isVisible())return;const o=t.getRange(),a=o.columnRange.slice();for(let i=!0;a.length>1;i=!1){const{measure:h}=a[0],c=a.findIndex(t=>t.measure!==h),u=a.splice(0,c>0?c:a.length);if(u.length<2)continue;const g=h.row.findMatchingLine(n);if(!g)continue;const l=0===a.length,d=[...i?[e]:[],...u,...l&&o.stopObject?[o.stopObject]:[]];h.addLayoutObject(new Qt(h,g,t,d),g,s,r)}}})}addBeamGroup(t){this.beamGroups.push(t)}requestBeamsUpdate(){this.needBeamsUpdate=!0}createOldStyleTriplets(t){let e=this.getVoiceSymbols(t);for(let i=0;i<e.length;)if(e[i].oldStyleTriplet){let t=qt.createOldStyleTriplet(e.slice(i,i+3));i+=0===t?1:t}else i++;this.requestLayout()}getBeamGroups(){return this.beamGroups}createBeams(){if(!this.needBeamsUpdate)return;this.beamGroups=this.beamGroups.filter(t=>!!t.isTuplet()||(t.detach(),!1));let t=this.getTimeSignature();this.needBeamsUpdate&&0!==t.beamGroupSizes.length&&([0,1,2,3].forEach(e=>{let i=this.getVoiceSymbols(e).slice();if(i.length<2)return;let s=this.isUpBeat()?Math.max(0,this.getMeasureTicks()-this.getConsumedTicks()):0,r=0;for(let o=0;o<t.beamGroupSizes.length;o++){let e=t.beamGroupSizes[o],h=[e];e.length>1&&h.unshift([n.OZ.Math.sum(e)]);let c=!1,u=r;for(;h.length>0&&!c;){let t=h.shift();r=u,t.forEach(t=>{let e=t*a.NoteLengthProps.get("8n").ticks,o=r+e,u=i.filter(t=>{let e=s+t.col.positionTicks,i=e+t.rhythmProps.ticks;return e>=r&&i<=o});n.OZ.Math.sum(u.map(t=>t.rhythmProps.ticks))===e&&u.every(t=>t instanceof wt)&&(u.every(t=>1===t.rhythmProps.flagCount)||0===h.length)&&qt.createBeam(u)&&(c=!0),r+=e})}}}),this.needBeamsUpdate=!1,this.requestLayout())}getBarLineLeft(){return this.barLineLeft}getBarLineRight(){return this.barLineRight}getVoiceSymbols(t){return this.voiceSymbols.getAll(t)}fillWithRests(...t){if(0!==t.length)if(t.length>1)t.forEach(t=>this.fillWithRests(t));else{const e=t[0];f(e);let i=this.getMeasureTicks()-this.getConsumedTicks(e),s=[];for(;i>0;)for(let t=a.NoteLengthProps.LongestNoteSize;t<=a.NoteLengthProps.ShortestNoteSize;t*=2){let e=a.NoteLengthProps.create(t).noteLength;for(let t=a.NoteLengthProps.get(e).maxDotCount;t>=0;t--){let r=a.RhythmProps.get(e,t);for(;r.ticks<=i;)s.push(r),i-=r.ticks}}s.reverse().forEach(t=>this.addRest(e,a.NoteLengthProps.create(t.noteLength,t.dotCount).noteLength))}else 0===this.getConsumedTicks()?this.fillWithRests(0):this.fillWithRests(...[0,1,2,3].filter(t=>this.getConsumedTicks(t)>0))}requestLayout(){this.needLayout||(this.needLayout=!0,this.row.requestLayout())}layout(t){var e;if(!this.needLayout)return;this.staticObjectsCache.clear(),this.requestRectUpdate();let{unitSize:i}=t;this.postMeasureBreakWidth=this.hasPostMeasureBreak()?Z*i:0;let s=this.isFirstMeasureInRow(),r=!0===(null==(e=this.getPrevMeasure())?void 0:e.hasPostMeasureBreak());this.regions.tabTuning_0=s&&this.row.hasTab?4*i:0;let n=s||r,o=!1!==this.options.showNumber&&(!0===this.options.showNumber||s&&!this.row.isFirstRow()),h=s||r||!!this.alterKeySignature,c=!!this.alterTimeSignature,u=!!this.alterTempo;this.signatures=[],this.row.getNotationLines().forEach((e,i)=>{if(e instanceof ue&&(n||o||h||c||u)){let s=this.signatures.filter(t=>t instanceof mt).find(t=>t.staff===e),r=null!=s?s:new mt(this,e);r.staff.addObject(r),r.updateClefImage(t,n),r.updateMeasureNumber(o&&0===i),r.updateKeySignature(h),r.updateTimeSignature(c),r.updateTempo(u&&0===i),r.layout(t),this.signatures.push(r)}else if(e instanceof ge&&(o||c||u)){let s=this.signatures.filter(t=>t instanceof Ct).find(t=>t.tab===e),r=null!=s?s:new Ct(this,e);r.tab.addObject(r),r.updateMeasureNumber(o&&0===i),r.updateTimeSignature(c),r.updateTempo(u&&0===i),r.layout(t),this.signatures.push(r)}}),this.tabStringNotes.length=0,this.isFirstMeasureInRow()&&this.row.getTabs().forEach(e=>{for(let i=0;i<6;i++){let s=e.getTuningStrings()[i].format(a.PitchNotation.Helmholtz,a.SymbolSet.Unicode),r=new It(this,{text:s,scale:.8,color:ts("tab.tuning")},1,.5);r.layout(t),r.setRight(.8*this.regions.tabTuning_0),r.setCenterY(e.getStringY(i)),this.tabStringNotes.push(r),e.addObject(r)}}),this.barLineLeft.layout(t);const g=new lt(this);this.columns.forEach(e=>e.layout(t,g)),this.columns.forEach(e=>e.layoutReserveSpace(t)),this.barLineRight.layout(t),this.endRepeatPlayCountText&&this.endRepeatPlayCountText.layout(t),this.layoutObjects.forEach(e=>e.layout(t));let l=t.unitSize;this.regions.signature_1=Math.max(0,...this.signatures.map(t=>t.getRect().width)),this.regions.leftBarLine_2=this.barLineLeft.getRect().width,this.regions.padding_3=l,this.regions.columnsMin_4=Math.max(U*i,this.columns.map(t=>t.getRect().width).reduce((t,e)=>t+e,0)),this.regions.padding_5=l,this.regions.rightBarLine_6=this.barLineRight.getRect().width}layoutWidth(t,e){if(!this.needLayout)return;e=Math.max(e,this.getMinWidth()),this.rect=new n.vW,this.rect.anchorX=this.rect.left+e/2,this.rect.right=this.rect.left+e,this.signatures.forEach(t=>{t.setLeft(this.rect.left+this.regions.tabTuning_0),t.setAnchorY(this.rect.anchorY)});let i=Math.max(0,...this.signatures.map(t=>t.getRect().width));this.barLineLeft.setLeft(this.rect.left+this.regions.tabTuning_0+i),this.barLineLeft.setAnchorY(this.rect.anchorY),this.barLineRight.setRight(this.rect.right),this.barLineRight.setAnchorY(this.rect.anchorY),this.endRepeatPlayCountText&&(this.endRepeatPlayCountText.setCenterX(this.barLineRight.getRect().left),this.endRepeatPlayCountText.setBottom(this.barLineRight.getRect().top));let s=this.rect.left+this.regions.leftSolid,r=(this.rect.right-this.regions.rightSolid-s)/this.regions.columnsMin,o=s;this.columns.forEach(t=>{let e=t.getRect(),i=o+e.leftw*r;t.setAnchor(i,this.rect.anchorY),o+=e.width*r}),[0,1,2,3].forEach(t=>{const e=this.getVoiceSymbols(t),i=1===e.length&&e[0]instanceof yt?e[0]:void 0;if(!i)return;0===[0,1,2,3].map(t=>i.col.getVoiceSymbol(t)).filter(t=>void 0!==t&&t!==i).length||i.setAnchorX(this.getColumnsContentRect().centerX)})}layoutConnectives(t){this.needLayout&&this.connectives.forEach(e=>{e.layout(t),this.rect.top=Math.min(this.rect.top,e.getRect().top),this.rect.bottom=Math.max(this.rect.bottom,e.getRect().bottom)})}layoutBeams(t){this.needLayout&&this.beamGroups.forEach(e=>{e.layout(t),this.rect.top=Math.min(this.rect.top,e.getRect().top),this.rect.bottom=Math.max(this.rect.bottom,e.getRect().bottom)})}alignStemsToBeams(){this.beamGroups.forEach(t=>t.updateStemTips())}layoutDone(){this.columns.forEach(t=>t.layoutDone()),this.needLayout=!1}updateRect(){this.rect.top=Math.min(...this.signatures.map(t=>t.getRect().top),...this.tabStringNotes.map(t=>t.getRect().top),this.barLineLeft.getRect().top,...this.columns.filter(t=>!t.isEmpty()).map(t=>t.getRect().top),this.barLineRight.getRect().top,...this.connectives.map(t=>t.getRect().top),...this.beamGroups.filter(t=>!t.isEmpty()).map(t=>t.getRect().top),...this.layoutObjects.filter(t=>t.isPositionResolved()).map(t=>t.musicObj.getRect().top)),this.rect.bottom=Math.max(...this.signatures.map(t=>t.getRect().bottom),...this.tabStringNotes.map(t=>t.getRect().bottom),this.barLineLeft.getRect().bottom,...this.columns.filter(t=>!t.isEmpty()).map(t=>t.getRect().bottom),this.barLineRight.getRect().bottom,...this.connectives.map(t=>t.getRect().bottom),...this.beamGroups.filter(t=>!t.isEmpty()).map(t=>t.getRect().bottom),...this.layoutObjects.filter(t=>t.isPositionResolved()).map(t=>t.musicObj.getRect().bottom)),this.isLastMeasureInRow()&&(this.rect.right=Math.max(this.rect.right,...this.layoutObjects.filter(t=>t.isPositionResolved()&&t.musicObj instanceof Xt).map(t=>t.musicObj.getRect().right))),this.row.getNotationLines().forEach(t=>{this.rect.top=Math.min(this.rect.top,t.calcTop()),this.rect.bottom=Math.max(this.rect.bottom,t.calcBottom())}),this.row.requestRectUpdate()}offset(t,e){this.signatures.forEach(e=>e.offset(t,0)),this.tabStringNotes.forEach(e=>e.offset(t,0)),this.barLineLeft.offset(t,e),this.columns.forEach(i=>i.offset(t,e)),this.barLineRight.offset(t,e),this.endRepeatPlayCountText&&this.endRepeatPlayCountText.offset(t,e),this.connectives.forEach(e=>e.offset(t,0)),this.beamGroups.forEach(i=>i.offset(t,e)),this.layoutObjects.forEach(e=>e.offset(t,0)),this.rect.offsetInPlace(t,e),this.requestRectUpdate()}draw(t){t.drawDebugRect(this.getRect()),t.lineWidth(1);let e=this.getStaffLineLeft(),i=this.getStaffLineRight();const s=(s,r)=>t.color(r).strokeLine(e,s,i,s);this.row.getNotationLines().forEach(t=>{if(t instanceof ue)for(let e=t.bottomLineDiatonicId;e<=t.topLineDiatonicId;e+=2)s(t.getDiatonicIdY(e),ts("staff.frame"));else if(t instanceof ge)for(let e=0;e<6;e++)s(t.getStringY(e),ts("tab.frame"))}),this.isFirstMeasureInRow()&&1===this.row.getNotationLines().length&&this.row.getTabs().forEach(e=>{if(e.getRowGroup().hasBrace)return;const i=this.getStaffLineLeft(),s=e.getTopLineY(),r=e.getBottomLineY();t.color("tab.frame").lineWidth(1).strokeLine(i,s,i,r)}),this.signatures.forEach(e=>e.draw(t)),this.tabStringNotes.forEach(e=>e.draw(t)),this.barLineLeft.draw(t),this.columns.forEach(e=>e.draw(t)),this.barLineRight.draw(t),this.endRepeatPlayCountText&&this.endRepeatPlayCountText.draw(t),this.connectives.forEach(e=>e.draw(t)),this.layoutObjects.forEach(e=>e.musicObj.draw(t)),this.beamGroups.forEach(e=>e.draw(t))}},re=(t=>(t[t.TabRhythm=0]="TabRhythm",t[t.Fermata=1]="Fermata",t[t.NoteLabel=2]="NoteLabel",t[t.Navigation=3]="Navigation",t[t.Ending=4]="Ending",t[t.TempoAnnotation=5]="TempoAnnotation",t[t.DynamicsAnnotation=6]="DynamicsAnnotation",t[t.ChordLabel=7]="ChordLabel",t[t.LyricsVerse1=8]="LyricsVerse1",t[t.LyricsVerse2=9]="LyricsVerse2",t[t.LyricsVerse3=10]="LyricsVerse3",t))(re||{}),ne=new n.b1([[0,{rowAlign:!0}],[1,{reserveSpace:!0}],[2,{reserveSpace:!0}],[3,{rowAlign:!0}],[4,{rowAlign:!0,padding:2}],[5,{rowAlign:!0,padding:2}],[6,{rowAlign:!0,padding:2}],[7,{reserveSpace:!0,rowAlign:!0}],[8,{reserveSpace:!0,rowAlign:!0}],[9,{reserveSpace:!0,rowAlign:!0}],[10,{reserveSpace:!0,rowAlign:!0}]]);var oe=class{constructor(t,e,i){this.groupName=t,this.staffsTabsAndGroups=e,this.verticalPosition=i}},ae=class{constructor(t,e,i,s){this.musicObj=t,this.line=e,this.layoutGroupId=i,this.verticalPos=s,(0,o.Mu)(this,"anchor"),(0,o.Mu)(this,"measure"),(0,o.Mu)(this,"row"),(0,o.Mu)(this,"layoutGroup"),(0,o.Mu)(this,"positionResolved",!0),this.measure=function(t){for(;t;){if(t instanceof se)return t;t=t.getParent()}throw new h.MusicError(h.MusicErrorType.Score,"Parent measure is required but not found!")}(this.musicObj),this.row=this.measure.row;let r=this.musicObj.getParent();if(!r)throw new h.MusicError(h.MusicErrorType.Score,"Parent music object is required as an anchor.");this.anchor=r,this.anchor.addAnchoredLayoutObject(this),this.layoutGroup=this.line.getLayoutGroup(i),this.layoutGroup.add(this)}resetPositionResolved(){this.positionResolved=!1}setPositionResolved(){this.positionResolved=!0}isPositionResolved(){return this.positionResolved}resolveClosestToStaffY(t){let{musicObj:e,measure:i,verticalPos:s,line:r}=this,o=r.getTopLineY(),a=r.getBottomLineY(),h=2*t.unitSize,c=1===s?a+h+e.getRect().toph:o-h-e.getRect().bottomh,u=i.getStaticObjects(r),g=e.getShapeRects();return u.forEach(t=>{let e=t.getShapeRects();g.forEach(t=>{e.forEach(e=>{n.vW.overlapX(t,e)&&(c=1===s?Math.max(c,e.bottom+t.toph+t.anchorY):Math.min(c,e.top-t.bottomh-t.anchorY))})})}),c}layout(t){this.line.addObject(this)}offset(t,e){this.musicObj.offset(t,e)}setAnchorY(t){this.musicObj.setAnchorY(t)}getRect(){return this.musicObj.getRect()}},he=class{constructor(t){var e,i,s,r;this.layoutGroupId=t,(0,o.Mu)(this,"layoutObject",(0,n.Sl)(new n.qG)),(0,o.Mu)(this,"rowAlign"),(0,o.Mu)(this,"reserveSpace"),(0,o.Mu)(this,"padding"),this.rowAlign=!0===(null==(e=ne.get(t))?void 0:e.rowAlign),this.reserveSpace=!0===(null==(i=ne.get(t))?void 0:i.reserveSpace),this.padding=null!=(r=null==(s=ne.get(t))?void 0:s.padding)?r:0}getLayoutObjects(t){return this.layoutObject.getAll(t)}add(t){this.layoutObject.add(t.verticalPos,t)}remove(t){this.layoutObject.remove(t.verticalPos,t)}layout(t){for(const e of this.layoutObject.values())e.resetPositionResolved(),e.musicObj.layout(t)}getPadding(t){return this.padding*t.unitSize}},ce=class extends G{constructor(t){super(t),this.row=t,(0,o.Mu)(this,"objects",[]),(0,o.Mu)(this,"layoutGroups",new n.b1)}getRowGroup(){return this.row.getRowGroupByLineId(this.id)}addObject(t){this.objects.push(t)}removeObjects(){this.objects.length=0}getLayoutGroup(t){return this.layoutGroups.getOrCreate(t,()=>new he(t))}resetLayoutGroups(t){this.layoutGroups.forEach(e=>e.layout(t))}layoutLayoutGroups(t){for(const e of n.OZ.Enum.getEnumValues(re)){const i=this.getLayoutGroup(e);i&&(this.layoutLayoutGroup(t,i,0),this.layoutLayoutGroup(t,i,1))}}setObjectY(t,e){void 0!==e&&(t.setAnchorY(e-t.getRect().anchorY),t.setPositionResolved())}alignObjectsY(t,e,i){const s=e.filter(t=>!t.isPositionResolved()&&t.verticalPos===i);if(0===s.length)return;const r=1===i?1:-1;let n=s.map(e=>e.resolveClosestToStaffY(t)+e.layoutGroup.getPadding(t)*r);const o=1===i?Math.max(...n):Math.min(...n);s.forEach(t=>this.setObjectY(t,o))}layoutLayoutGroup(t,e,i){let s=e.getLayoutObjects(i).filter(t=>!t.isPositionResolved());s.forEach(e=>{let{musicObj:i,anchor:s}=e;i instanceof Zt||i instanceof Qt||i instanceof ee?i.layoutFitToMeasure(t):i.setAnchorX(s.getRect().anchorX)}),e.rowAlign?this.alignObjectsY(t,s,i):s.forEach(e=>{let r=e.musicObj.getLink();if(r&&r.getHead()===e.musicObj){let e=[r.getHead(),...r.getTails()],n=s.filter(t=>e.some(e=>e===t.musicObj));this.alignObjectsY(t,n,i)}else this.alignObjectsY(t,[e],i)})}drawVerticalLine(t,e,i,s=!1){t.color("tab"===this.getConfig().type?"tab.frame":"staff.frame");const r=this.row.getNotationLines().indexOf(this),n=r>=0?this.row.getNotationLines()[r+1]:void 0,o=this.getRowGroup().lines.length>1,a=this instanceof ue&&this.isGrandTreble(),h=this.getTopLineY(),c=n&&(s||o||a)?n.getTopLineY():this.getBottomLineY();t.fillRect(e,h,i,c-h)}},ue=class extends ce{constructor(t,e,i){super(t),this.staffConfig=e,this.id=i,(0,o.Mu)(this,"clefImageAsset"),(0,o.Mu)(this,"clefLineDiatonicId"),(0,o.Mu)(this,"topLineDiatonicId"),(0,o.Mu)(this,"middleLineDiatonicId"),(0,o.Mu)(this,"bottomLineDiatonicId"),(0,o.Mu)(this,"minDiatonicId"),(0,o.Mu)(this,"maxDiatonicId"),(0,o.Mu)(this,"joinedGrandStaff"),(0,o.Mu)(this,"topLineY",0),(0,o.Mu)(this,"bottomLineY",0),(0,o.Mu)(this,"mi");const s=(t,e)=>a.Note.getNote(t).diatonicId-(e?7:0);if("G"===e.clef)this.clefImageAsset=0,this.clefLineDiatonicId=s("G4",!0===e.isOctaveDown),this.middleLineDiatonicId=this.clefLineDiatonicId+2;else{if("F"!==e.clef)throw new h.MusicError(h.MusicErrorType.Score,`Invalid staffConfig.clef ${e.clef}.`);this.clefImageAsset=1,this.clefLineDiatonicId=s("F3",!0===e.isOctaveDown),this.middleLineDiatonicId=this.clefLineDiatonicId-2}this.topLineDiatonicId=this.middleLineDiatonicId+4,this.bottomLineDiatonicId=this.middleLineDiatonicId-4,this.minDiatonicId=void 0!==e.minNote?Math.min(s(e.minNote,!1),this.bottomLineDiatonicId):void 0,this.maxDiatonicId=void 0!==e.maxNote?Math.max(s(e.maxNote,!1),this.topLineDiatonicId):void 0,this.mi=new xi(this)}getMusicInterface(){return this.mi}get isOctaveDown(){return!0===this.staffConfig.isOctaveDown}get name(){var t;return null!=(t=this.staffConfig.name)?t:""}getConfig(){return this.staffConfig}getTopLineY(){return this.topLineY}getMiddleLineY(){return(this.topLineY+this.bottomLineY)/2}getBottomLineY(){return this.bottomLineY}joinGrandStaff(t){t!==this&&(this.joinedGrandStaff=t)}isGrandTreble(){return void 0!==this.joinedGrandStaff&&"G"===this.staffConfig.clef}isGrandBass(){return void 0!==this.joinedGrandStaff&&"F"===this.staffConfig.clef}getLineSpacing(){return(this.bottomLineY-this.topLineY)/4}getDiatonicSpacing(){return this.getLineSpacing()/2}containsDiatonicId(t){return a.Note.validateDiatonicId(t),(void 0===this.minDiatonicId||t>=this.minDiatonicId)&&(void 0===this.maxDiatonicId||t<=this.maxDiatonicId)}getDiatonicIdY(t){if(this.containsDiatonicId(t))return this.bottomLineY+(this.bottomLineDiatonicId-t)*this.getDiatonicSpacing();if(this.joinedGrandStaff&&this.joinedGrandStaff.containsDiatonicId(t))return this.joinedGrandStaff.getDiatonicIdY(t);throw new h.MusicError(h.MusicErrorType.Score,"Staff does not contain diatonicId "+t)}getActualStaff(t){if(this.containsDiatonicId(t))return this;if(this.joinedGrandStaff&&this.joinedGrandStaff.containsDiatonicId(t))return this.joinedGrandStaff;throw new h.MusicError(h.MusicErrorType.Score,"Staff does not contain diatonicId "+t)}getDiatonicIdAt(t){let e=Math.round(this.bottomLineDiatonicId-(t-this.bottomLineY)/this.getDiatonicSpacing());return this.containsDiatonicId(e)?e:void 0}isLine(t){return t%2==this.middleLineDiatonicId%2}isSpace(t){return t%2!=this.middleLineDiatonicId%2}containsVoiceId(t){return n.I8.isUndefined(this.staffConfig.voiceId)||n.OZ.Arr.toArray(this.staffConfig.voiceId).includes(t)}calcTop(){let t=this.topLineY;if(this.objects.forEach(e=>t=Math.min(t,e.getRect().top)),void 0!==this.maxDiatonicId){let e=this.getDiatonicIdY(this.maxDiatonicId),i=this.getDiatonicIdY(this.maxDiatonicId-1);t=Math.min(t,e-Math.abs(i-e)+1)}return t}calcBottom(){let t=this.bottomLineY;if(this.objects.forEach(e=>t=Math.max(t,e.getRect().bottom)),void 0!==this.minDiatonicId){let e=this.getDiatonicIdY(this.minDiatonicId),i=this.getDiatonicIdY(this.minDiatonicId+1);t=Math.max(t,e+Math.abs(i-e)-1)}return t}pick(t,e){return this.getRect().contains(t,e)?[this]:[]}layoutHeight(t){let{unitSize:e}=t,i=e*ot;this.topLineY=-i/2,this.bottomLineY=i/2,this.rect=new n.vW(0,0,this.topLineY,this.bottomLineY)}layoutWidth(t){this.rect.left=this.row.getRect().left,this.rect.right=this.row.getRect().right}offset(t,e){this.topLineY+=e,this.bottomLineY+=e,this.objects.forEach(t=>{t.offsetInPlace?t.offsetInPlace(0,e):t.offset&&t.offset(0,e)}),this.rect.offsetInPlace(t,e)}draw(t){}},ge=class extends ce{constructor(t,e,i){super(t),this.tabConfig=e,this.id=i,(0,o.Mu)(this,"top",0),(0,o.Mu)(this,"bottom",0),(0,o.Mu)(this,"tuningName"),(0,o.Mu)(this,"tuningStrings"),(0,o.Mu)(this,"mi"),n.I8.isArray(e.tuning)?(this.tuningName=void 0,this.tuningStrings=e.tuning.map(t=>a.Note.getNote(t)).reverse()):"string"==typeof e.tuning?(this.tuningName=(0,a.validateTuningName)(e.tuning),this.tuningStrings=(0,a.getTuningStrings)(this.tuningName)):(this.tuningName="Standard",this.tuningStrings=(0,a.getTuningStrings)(this.tuningName)),this.mi=new Li(this)}getMusicInterface(){return this.mi}get name(){var t;return null!=(t=this.tabConfig.name)?t:""}getConfig(){return this.tabConfig}getTuningName(){return this.tuningName}getTuningStrings(){return this.tuningStrings}getStringY(t){return this.top+(this.bottom-this.top)/6*(t+.5)}getTopStringY(){return this.getStringY(0)}getBottomStringY(){return this.getStringY(5)}getTopLineY(){return this.getTopStringY()}getBottomLineY(){return this.getBottomStringY()}getTop(){return this.top}getBottom(){return this.bottom}containsVoiceId(t){return n.I8.isUndefined(this.tabConfig.voiceId)||n.OZ.Arr.toArray(this.tabConfig.voiceId).includes(t)}containsDiatonicId(t){return!0}calcTop(){let{top:t}=this;return this.objects.forEach(e=>t=Math.min(t,e.getRect().top)),t}calcBottom(){let{bottom:t}=this;return this.objects.forEach(e=>t=Math.max(t,e.getRect().bottom)),t}pick(t,e){return this.getRect().contains(t,e)?[this]:[]}layoutHeight(t){let{unitSize:e}=t,i=e*at;this.top=-i/2,this.bottom=i/2,this.rect=new n.vW(0,0,this.top,this.bottom)}layoutWidth(t){this.rect.left=this.row.getRect().left,this.rect.right=this.row.getRect().right}offset(t,e){this.top+=e,this.bottom+=e,this.objects.forEach(t=>{t.offsetInPlace?t.offsetInPlace(0,e):t.offset&&t.offset(0,e)}),this.rect.offsetInPlace(t,e)}draw(t){}};var le=class extends G{constructor(t){var e;super(t[0].row),this.lines=t,(0,o.Mu)(this,"space",0),(0,o.Mu)(this,"instrument"),(0,o.Mu)(this,"hasBrace"),(0,o.Mu)(this,"instrText"),(0,o.Mu)(this,"braceRect",new n.vW),(0,o.Mu)(this,"mi");const i=function(t){return{instrName:(t.startsWith("!{")?t.substring(2):t.startsWith("!")?t.substring(1):t).trim(),hideInstr:t.startsWith("!"),hideBrace:t.startsWith("!{")}}(null!=(e=t[0].getConfig().instrument)?e:"");this.instrument=i.instrName,this.hasBrace=!i.hideBrace&&(this.hasInstrument&&t.length>=2);const s=i.hideInstr?"":this.instrument;this.instrText=new It(this,{text:s,color:"rowgroup.instrument",scale:1},1,.5),this.mi=new Si(this)}getMusicInterface(){return this.mi}get row(){return this.lines[0].row}get hasInstrument(){return this.instrument.length>0}hasNotationLine(t){return this.lines.includes(t)}pick(t,e){if(!this.getRect().contains(t,e))return[];let i=this.instrText.pick(t,e);return i.length>0?[this,...i]:[this]}updateRect(){this.instrText.setRight(this.braceRect.left-this.space),this.instrText.setCenterY(this.braceRect.anchorY),this.rect=this.instrText.getRect().clone().expandInPlace(this.braceRect)}layout(t){this.space=t.unitSize,this.instrText.layout(t),this.braceRect=new n.vW(-(this.hasBrace?5*t.unitSize:0),0,0,0),this.forceRectUpdate()}layoutToNotationLines(){this.braceRect.top=this.lines[0].getTopLineY(),this.braceRect.bottom=this.lines[this.lines.length-1].getBottomLineY(),this.braceRect.anchorY=this.braceRect.centerY,this.forceRectUpdate()}offset(t,e){this.instrText.offset(t,e),this.braceRect.offsetInPlace(t,e),this.rect.offsetInPlace(t,e)}draw(t){if(this.instrText.draw(t),this.hasBrace){const e=this.braceRect;t.color("rowgroup.frame").lineWidth(1).drawBracket(e,"{")}}},de=class{constructor(){(0,o.Mu)(this,"instrWidth",0),(0,o.Mu)(this,"staffWidth",0)}resetWidths(){this.instrWidth=this.staffWidth=0}addRowInstrWidth(t){this.instrWidth=Math.max(this.instrWidth,t)}addRowstaffWidth(t){this.staffWidth=Math.max(this.staffWidth,t)}get instrLeft(){return 0}get instrRight(){return this.instrWidth}get staffLeft(){return this.instrRight}get staffRight(){return this.staffLeft+this.staffWidth}get left(){return this.instrLeft}get right(){return this.staffRight}get width(){return this.instrWidth+this.staffWidth}},fe=class extends G{constructor(t,e,i){super(t),this.doc=t,this.prevRow=e,this.scoreConfig=i,(0,o.Mu)(this,"nextRow"),(0,o.Mu)(this,"notationLines"),(0,o.Mu)(this,"rowGroups"),(0,o.Mu)(this,"staves"),(0,o.Mu)(this,"tabs"),(0,o.Mu)(this,"measures",[]),(0,o.Mu)(this,"rowGroupByLine"),(0,o.Mu)(this,"needLayout",!0),(0,o.Mu)(this,"mi"),this.notationLines=this.createNotationLines(),this.staves=this.notationLines.filter(t=>t instanceof ue),this.tabs=this.notationLines.filter(t=>t instanceof ge);let s=[];for(let r=0;r<this.notationLines.length;r++){let t=this.notationLines[r],e=s[s.length-1];void 0===e||void 0===e[0].getConfig().instrument||e[0].getConfig().instrument!==t.getConfig().instrument?s.push([t]):e.push(t)}this.rowGroups=s.filter(t=>t.length>0).map(t=>new le(t)),this.rowGroupByLine=this.notationLines.map(t=>this.rowGroups.find(e=>e.lines.includes(t))),this.prevRow&&(this.prevRow.nextRow=this),this.mi=new vi(this)}getMusicInterface(){return this.mi}createNotationLines(){let t=this.scoreConfig.map((t,e)=>"staff"===t.type?new ue(this,t,e):new ge(this,t,e));for(let e=0;e<t.length-1;e++){let i=t[e],s=t[e+1];i instanceof ue&&s instanceof ue&&void 0!==i.staffConfig.grandId&&i.staffConfig.grandId===s.staffConfig.grandId&&(i.joinGrandStaff(s),s.joinGrandStaff(i))}return t}getNotationLines(){return this.notationLines}getRowGroups(){return this.rowGroups}getRowGroupByLineId(t){return this.rowGroupByLine[t]}findMatchingLine(t){return t.row===this?t:this.notationLines.find(e=>n.OZ.Obj.deepEqual(t.row.scoreConfig,e.row.scoreConfig)&&t.id===e.id||n.I8.isNonEmptyString(t.getConfig().name)&&t.getConfig().name===e.getConfig().name&&t.getConfig().type===e.getConfig().type)}get regions(){return this.doc.regions}getStaves(){return this.staves}getTabs(){return this.tabs}get hasStaff(){return this.staves.length>0}get hasTab(){return this.tabs.length>0}getTopStaff(){let t=this.staves[0];if(t)return t;throw new h.MusicError(h.MusicErrorType.Score,"Top staff is required!")}getBottomStaff(){let t=this.staves[this.staves.length-1];if(t)return t;throw new h.MusicError(h.MusicErrorType.Score,"Bottom staff is required!")}getStaff(t){a.Note.validateDiatonicId(t);for(let e=0;e<this.notationLines.length;e++){let i=this.notationLines[e];if(i instanceof ue&&i.containsDiatonicId(t))return i}}resetLayoutGroups(t){this.notationLines.forEach(e=>e.resetLayoutGroups(t))}layoutLayoutGroups(t){this.notationLines.forEach(e=>e.layoutLayoutGroups(t))}pick(t,e){if(!this.getRect().contains(t,e))return[];for(let i=0;i<this.measures.length;i++){let s=this.measures[i].pick(t,e);if(s.length>0)return[this,...s]}for(let i=0;i<this.rowGroups.length;i++){let s=this.rowGroups[i].pick(t,e);if(s.length>0)return[this,...s]}for(let i=0;i<this.notationLines.length;i++){let s=this.notationLines[i].pick(t,e);if(s.length>0)return[this,...s]}return[this]}getConnectivesContentRect(){let t=this.getRect(),e=this.getFirstMeasure(),i=e?e.getColumnsContentRect().left:t.left;return new n.vW(i,(i+t.right)/2,t.right,t.top,t.anchorY,t.bottom)}getDiatonicIdAt(t){for(let e=0;e<this.notationLines.length;e++){let i=this.notationLines[e],s=i instanceof ue?i.getDiatonicIdAt(t):void 0;if(void 0!==s)return s}}addMeasure(t){this.measures.push(t)}getMeasures(){return this.measures}isFirstRow(){return this===this.doc.getFirstRow()}isLastRow(){return this===this.doc.getLastRow()}getPrevRow(){return this.prevRow}getNextRow(){return this.nextRow}getFirstMeasure(){return this.measures.length>0?this.measures[0]:void 0}getLastMeasure(){return this.measures.length>0?this.measures[this.measures.length-1]:void 0}solveAutoStemDir(t){if(0===t.length)return"up";{let e=t[0].voiceId,i=t.filter(t=>t instanceof wt).map(t=>t.setDiatonicId),s=t.filter(t=>t instanceof yt&&t.setDiatonicId!==yt.UndefinedDiatonicId).map(t=>t.setDiatonicId);if(0===i.length&&0===s.length)return"up";let r=i.length>0?i:s,o=Math.floor(n.OZ.Math.avg(...r)),a=this.getStaves().filter(t=>t.containsVoiceId(e)&&t.containsDiatonicId(o));return a.length>0&&o>=a[0].middleLineDiatonicId?"down":"up"}}requestLayout(){this.needLayout||(this.needLayout=!0,this.doc.requestLayout())}layout(t){if(!this.needLayout)return;this.requestRectUpdate(),this.notationLines.forEach(e=>{e.removeObjects(),e.layoutHeight(t)}),this.rowGroups.forEach(e=>{e.layout(t),this.regions.addRowInstrWidth(e.getRect().width)}),this.measures.forEach(e=>e.layout(t));let e=this.measures.map(t=>t.getMinWidth()+t.getPostMeasureBreakWidth()).reduce((t,e)=>t+e);this.regions.addRowstaffWidth(e)}layoutStretch(t){if(!this.needLayout)return;this.rect=new n.vW(this.regions.left,this.regions.right,0,0),this.notationLines.forEach(e=>e.layoutWidth(t)),this.rowGroups.forEach(t=>t.setRight(this.regions.instrRight));let e=this.regions.staffWidth,i=0;this.measures.forEach(t=>{e-=t.getTotalSolidWidth()+t.getPostMeasureBreakWidth(),i+=t.getMinColumnsWidth()});let s=e/i,r=this.regions.staffLeft;this.measures.forEach(e=>{let i=e.getTotalSolidWidth()+e.getMinColumnsWidth()*s;e.layoutWidth(t,i);let n=e.getRect();e.setLeft(r),e.setAnchorY(0),r+=n.width,r+=e.getPostMeasureBreakWidth()}),this.measures.forEach(e=>{e.layoutConnectives(t),e.layoutBeams(t)})}updateRect(){var t;let e=this.regions.left,i=this.regions.right,s=0,r=0;const o=null==(t=this.getLastMeasure())?void 0:t.getBarLineRight().getAnchoredLayoutObjects().map(t=>t.musicObj).find(t=>t instanceof Xt);o&&(i=Math.max(i,o.getRect().right)),this.measures.length>0&&(s=Math.min(...this.measures.map(t=>t.getRect().top)),r=Math.max(...this.measures.map(t=>t.getRect().bottom))),this.rect=new n.vW(e,i,s,r)}alignStemsToBeams(){this.measures.forEach(t=>t.alignStemsToBeams())}layoutSetNotationLines(t){let{unitSize:e}=t;for(let i=1;i<this.notationLines.length;i++){let t=this.notationLines[i-1],s=this.notationLines[i];if(t instanceof ue&&s instanceof ue&&void 0!==t.staffConfig.grandId&&t.staffConfig.grandId===s.staffConfig.grandId){let i=t.getBottomLineY()-s.getTopLineY()+6*e;s.offsetY(i)}else{let i=t.calcBottom()-s.calcTop()+3*e;s.offsetY(i)}}this.measures.forEach(t=>{t.requestRectUpdate(),t.getBarLineLeft().requestRectUpdate(),t.getBarLineRight().requestRectUpdate(),t.getColumns().forEach(t=>{t.requestRectUpdate(),[0,1,2,3].forEach(e=>{var i;return null==(i=t.getVoiceSymbol(e))?void 0:i.requestRectUpdate()})})}),this.rowGroups.forEach(t=>t.layoutToNotationLines()),this.alignStemsToBeams(),this.requestRectUpdate()}layoutDone(){this.measures.forEach(t=>t.layoutDone()),this.needLayout=!1}offset(t,e){this.measures.forEach(i=>i.offset(t,e)),this.rect.offsetInPlace(t,e),this.notationLines.forEach(i=>i.offset(t,e)),this.rowGroups.forEach(i=>i.offset(t,e))}getStaffLineLeft(){var t;return null==(t=this.getFirstMeasure())?void 0:t.getStaffLineLeft()}draw(t){t.drawDebugRect(this.getRect());const{left:e,top:i,width:s,height:r}=this.getRect(),n=t._lineWidth;t.save(),t.rect(e-n,i,s+2*n,r),t.clip(),this.measures.forEach(e=>e.draw(t)),this.notationLines.forEach(e=>e.draw(t));const o=this.getStaffLineLeft();void 0!==o&&this.notationLines.length>1&&this.notationLines.forEach(e=>e.drawVerticalLine(t,o,t._lineWidth,!0)),this.rowGroups.forEach(e=>e.draw(t)),t.restore()}},Ie=class extends G{constructor(t,e,i,s){super(t),this.doc=t,this.title=e,this.composer=i,this.arranger=s,(0,o.Mu)(this,"titleText"),(0,o.Mu)(this,"composerText"),(0,o.Mu)(this,"arrangerText"),(0,o.Mu)(this,"mi"),this.mi=new $e(this),this.titleText=this.title?new It(this,{text:this.title,color:"header.title",scale:2},.5,0):void 0,this.composerText=this.composer?new It(this,{text:this.composer,color:"header.composer"},1,0):void 0,this.arrangerText=this.arranger?new It(this,{text:"Arr.: "+this.arranger,color:"header.arranger"},1,0):void 0}getMusicInterface(){return this.mi}pick(t,e){if(!this.rect.contains(t,e))return[];if(this.titleText){let i=this.titleText.pick(t,e);if(i)return[this,...i]}if(this.composerText){let i=this.composerText.pick(t,e);if(i)return[this,...i]}if(this.arrangerText){let i=this.arrangerText.pick(t,e);if(i)return[this,...i]}return[this]}layout(t){let e=0;const i=this.doc.regions.staffLeft,s=this.doc.regions.staffRight;this.rect=new n.vW(i,s,0,0),this.titleText&&(this.titleText.layout(t),this.titleText.setCenterX((i+s)/2),this.titleText.setTop(e),e+=this.titleText.getRect().height,this.rect.expandInPlace(this.titleText.getRect())),this.composerText&&(this.composerText.layout(t),this.composerText.setRight(s),this.composerText.setTop(e),e+=this.composerText.getRect().height,this.rect.expandInPlace(this.composerText.getRect())),this.arrangerText&&(this.arrangerText.layout(t),this.arrangerText.setRight(s),this.arrangerText.setTop(e),e+=this.arrangerText.getRect().height,this.rect.expandInPlace(this.arrangerText.getRect()))}offset(t,e){this.titleText&&this.titleText.offset(t,e),this.composerText&&this.composerText.offset(t,e),this.arrangerText&&this.arrangerText.offset(t,e),this.rect.offsetInPlace(t,e)}draw(t){this.titleText&&this.titleText.draw(t),this.composerText&&this.composerText.draw(t),this.arrangerText&&this.arrangerText.draw(t)}},me=class extends G{constructor(){super(void 0),(0,o.Mu)(this,"needLayout",!0),(0,o.Mu)(this,"ctx"),(0,o.Mu)(this,"regions",new de),(0,o.Mu)(this,"rows",[]),(0,o.Mu)(this,"measures",[]),(0,o.Mu)(this,"measuresPerRow",1/0),(0,o.Mu)(this,"curScoreConfig",[{type:"staff",clef:"G"}]),(0,o.Mu)(this,"header"),(0,o.Mu)(this,"newRowRequested",!1),(0,o.Mu)(this,"allConnectiveProps",[]),(0,o.Mu)(this,"staffGroups",new n.b1),(0,o.Mu)(this,"mi"),this.mi=new qe(this)}getMusicInterface(){return this.mi}setScoreConfiguration(t){if(n.I8.isEnumValue(t,u))switch(t){default:case"treble":this.curScoreConfig=[{type:"staff",clef:"G"}];break;case"bass":this.curScoreConfig=[{type:"staff",clef:"F"}];break;case"grand":this.curScoreConfig=[{type:"staff",clef:"G",grandId:"grand1"},{type:"staff",clef:"F",grandId:"grand1"}];break;case"guitarTreble":this.curScoreConfig=[{type:"staff",clef:"G",isOctaveDown:!0}];break;case"guitarTab":this.curScoreConfig=[{type:"tab",tuning:"Standard"}];break;case"guitarCombined":this.curScoreConfig=[{type:"staff",clef:"G",isOctaveDown:!0},{type:"tab",tuning:"Standard"}]}else n.I8.isArray(t)?this.curScoreConfig=t:this.curScoreConfig=[t];for(let e=0,i=[];e<this.curScoreConfig.length;){let t=this.curScoreConfig[e],s=this.curScoreConfig[e+1];if(t&&s&&"staff"===t.type&&"staff"===s.type&&void 0!==t.grandId&&t.grandId===s.grandId){if(i.includes(t.grandId))throw new h.MusicError(h.MusicErrorType.Score,`Grand staff error: grandId "${t.grandId}" already used!`);if("G"!==t.clef)throw new h.MusicError(h.MusicErrorType.Score,`Grand staff error: Invalid treble clef "${t.clef}"!`);if("F"!==s.clef)throw new h.MusicError(h.MusicErrorType.Score,`Grand staff error: Invalid treble clef "${t.clef}"!`);if(t.isOctaveDown||s.isOctaveDown)throw new h.MusicError(h.MusicErrorType.Score,"Grand staff error: cannot use isOctaveDown option!");i.push(t.grandId),t.minNote="C4",s.maxNote="B3",e+=2}else{if(t&&"staff"===t.type&&void 0!==t.grandId)throw new h.MusicError(h.MusicErrorType.Score,`Grand staff error: invalid use of grandId "${t.grandId}"!`);e++}}this.requestNewRow()}setMeasuresPerRow(t){this.measuresPerRow=t}addConnectiveProps(t){this.allConnectiveProps.push(t)}setRenderContext(t){if(this.ctx===t)return;let e=this.ctx;this.ctx=t,e&&e.setDocument(void 0),t&&t.setDocument(this.mi),this.requestFullLayout()}setHeader(t,e,i){this.header=new Ie(this,t,e,i),this.requestLayout()}getTitle(){var t;return null==(t=this.header)?void 0:t.title}getComposer(){var t;return null==(t=this.header)?void 0:t.composer}getArranger(){var t;return null==(t=this.header)?void 0:t.arranger}hasSingleMeasure(){return 1===this.measures.length}getFirstMeasure(){return this.measures.length>0?this.measures[0]:void 0}getLastMeasure(){return this.measures.length>0?this.measures[this.measures.length-1]:void 0}addNewRow(t){let e=new fe(this,t,this.curScoreConfig);return this.rows.push(e),e}getFirstRow(){return 0===this.rows.length?this.addNewRow(void 0):this.rows[0]}getLastRow(){return 0===this.rows.length?this.addNewRow(void 0):this.rows[this.rows.length-1]}getRows(){return this.rows}getMeasures(){return this.measures}requestNewRow(){this.newRowRequested=!0}addMeasure(t){let e=this.rows[this.rows.length-1];(!e||this.newRowRequested&&e.getMeasures().length>0||e.getMeasures().length>=this.measuresPerRow)&&(e=this.addNewRow(e),this.newRowRequested=!1);let i=new se(e,t);return this.measures.push(i),e.addMeasure(i),this.requestLayout(),i}addStaffGroup(t,e,i){this.staffGroups.set(t,new oe(t,e,i))}getStaffGroup(t){return this.staffGroups.get(t)}getVoiceSymbols(t){let e=[];return this.forEachMeasure(i=>e=e.concat(i.getVoiceSymbols(t))),e}removeLayoutObjects(t){this.forEachMeasure(e=>e.removeLayoutObjects(t))}forEachMeasure(t){let e=this.getFirstMeasure();for(;e;)t(e),e=e.getNextMeasure()}resetMeasures(){this.measures.forEach(t=>t.resetPassCount())}updateCursorRect(t){this.ctx&&this.ctx.updateCursorRect(t)}requestLayout(){this.needLayout=!0}requestFullLayout(){this.rows.forEach(t=>t.requestLayout()),this.forEachMeasure(t=>{t.getColumns().forEach(t=>t.requestLayout()),t.requestLayout()}),this.requestLayout()}layout(){var t;if(!this.needLayout)return;const{ctx:e}=this;if(!e)return;let{unitSize:i}=e;this.forEachMeasure(t=>t.createBeams()),null==(t=this.getFirstMeasure())||t.updateRunningArguments(),this.forEachMeasure(t=>t.createExtensions()),this.allConnectiveProps.forEach(t=>t.removeConnectives()),this.allConnectiveProps.forEach(t=>t.createConnectives()),this.rows.forEach(t=>t.resetLayoutGroups(e)),this.regions.resetWidths(),this.regions.addRowstaffWidth(W*i),this.rows.forEach(t=>t.layout(e)),this.rows.forEach(t=>t.layoutStretch(e)),this.rows.forEach(t=>t.layoutLayoutGroups(e)),this.rows.forEach(t=>t.layoutSetNotationLines(e)),this.rect=new n.vW,this.header&&(this.header.layout(e),this.rect.expandInPlace(this.header.getRect())),this.rows.forEach(t=>{t.setLeft(0),t.setTop(this.rect.bottom+2*i),this.rect.expandInPlace(t.getRect())}),this.rows.forEach(t=>t.layoutDone()),this.needLayout=!1}offset(t,e){}drawContent(){const{ctx:t}=this;t&&(this.rows.forEach(e=>e.draw(t)),this.header&&this.header.draw(t))}pickStaffPosAt(t,e){if(this.rect.contains(t,e))for(let i=0;i<this.rows.length;i++){let s=this.rows[i];if(!s.hasStaff)continue;if(!s.getRect().contains(t,e))continue;let r=s.getDiatonicIdAt(e);if(void 0!==r)return{scoreRow:s,diatonicId:r}}}pick(t,e){if(!this.rect.contains(t,e))return[];if(this.header){let i=this.header.pick(t,e);if(i.length>0)return[this,...i]}for(let i=0;i<this.rows.length;i++){let s=this.rows[i].pick(t,e);if(s.length>0)return[this,...s]}return[this]}},Ce="";function pe(t,...e){let i=e.map(t=>n.OZ.Str.stringify(t)).join(", ");Ce=`DocumentBuilder.${t}(${i})`}function Ae(...t){t.forEach(t=>{if(!t)throw new h.MusicError(h.MusicErrorType.Score,Ce)})}function be(t,e){if(!t)throw new h.MusicError(h.MusicErrorType.Score,e)}function ye(t,e,i){be(!n.I8.isTypedObject(t,[e]),i)}function Me(t){Ae(n.I8.isObject(t),n.I8.isStringOrUndefined(t.name),n.I8.isUndefined(t.voiceId)||d(t.voiceId)||n.I8.isArray(t.voiceId)&&t.voiceId.every(t=>d(t))),ye(t,"voiceIds","Baseconfig.voiceIds was removed. Use BaseConfig.voiceId instead."),n.I8.isArray(t.voiceId)&&(t.voiceId=n.OZ.Arr.removeDuplicates(t.voiceId)),Ae(n.I8.isStringOrUndefined(t.instrument))}function ve(t){Me(t),Ae(n.I8.isObject(t),n.I8.isStrictEqual(t.type,"staff"),n.I8.isEnumValue(t.clef,g),n.I8.isBooleanOrUndefined(t.isOctaveDown),n.I8.isUndefined(t.minNote)||a.Note.isNote(t.minNote),n.I8.isUndefined(t.maxNote)||a.Note.isNote(t.maxNote),n.I8.isStringOrUndefined(t.grandId)),ye(t,"isGrand","StaffConfig.isGrand was removed. Use StaffConfig.grandId instead.")}function we(t){Me(t),Ae(n.I8.isObject(t),n.I8.isStrictEqual(t.type,"tab"),n.I8.isUndefined(t.tuning)||n.I8.isString(t.tuning)&&n.I8.isIncluded(t.tuning,a.TuningNameList)||n.I8.isArray(t.tuning)&&n.I8.isStrictEqual(t.tuning.length,t.tuning.every(t=>a.Note.isNote(t))))}function Se(t){Ae(n.I8.isObject(t),n.I8.isEnumValueOrUndefined(t.stem,y),n.I8.isStringOrUndefined(t.color),n.I8.isBooleanOrUndefined(t.arpeggio)||n.I8.isEnumValue(t.arpeggio,M),n.I8.isBooleanOrUndefined(t.staccato),n.I8.isBooleanOrUndefined(t.diamond),n.I8.isUndefined(t.string)||m(t.string)||n.I8.isEmptyArray(t.string)||n.I8.isNonEmptyArray(t.string)&&t.string.every(t=>m(t))),ye(t,"dotted","NoteOptions.dotted was removed."),ye(t,"triplet","NoteOptions.triplet was removed."),ye(t,"tieSpan",'NoteOptions.tieSpan was removed. Use addConnective("tie", tieSpan)'),ye(t,"slurSpan",'NoteOptions.slurSpan was removed. Use addConnective("slur", slurSpan)')}function Re(t){Ae(n.I8.isObject(t),n.I8.isStringOrUndefined(t.staffPos)||n.I8.isInteger(t.staffPos)||t.staffPos instanceof a.Note,n.I8.isStringOrUndefined(t.color),n.I8.isBooleanOrUndefined(t.hide)),ye(t,"dotted","RestOptions.dotted was removed."),ye(t,"triplet","RestOptions.triplet was removed.")}function xe(t){Ae(n.I8.isStringOrUndefined(t)||n.I8.isIntegerGte(t,0)||n.I8.isNonEmptyArray(t)&&t.every(t=>n.I8.isString(t)||n.I8.isIntegerGte(t,0)))}var Te=class t{constructor(){(0,o.Mu)(this,"doc"),(0,o.Mu)(this,"currentLyricsAlign","center"),this.doc=new me}setScoreConfiguration(t){return pe("setScoreConfiguration",t),n.I8.isEnumValue(t,u)?this.doc.setScoreConfiguration(t):n.I8.isObject(t)&&"staff"===t.type?(ve(t),this.doc.setScoreConfiguration(t)):n.I8.isObject(t)&&"tab"===t.type?(we(t),this.doc.setScoreConfiguration(t)):n.I8.isNonEmptyArray(t)?(t.forEach(t=>{n.I8.isObject(t)&&"staff"===t.type?ve(t):n.I8.isObject(t)&&"tab"===t.type?we(t):Ae(!1)}),this.doc.setScoreConfiguration(t)):Ae(!1),this}getMeasure(){var e;return null!=(e=this.doc.getLastMeasure())?e:this.doc.addMeasure(t.DefaultMeasureOptions)}getDocument(){return this.getMeasure(),this.doc.getMusicInterface()}setHeader(t,e,i){return pe("setHeader",t,e,i),Ae(n.I8.isStringOrUndefined(t),n.I8.isStringOrUndefined(e),n.I8.isStringOrUndefined(i)),this.doc.setHeader(t,e,i),this}setMeasuresPerRow(t){return pe("setMeasuresPerRow",t),Ae(n.I8.isIntegerGte(t,1)||n.I8.isPosInfinity(t)),this.doc.setMeasuresPerRow(t),this}addMeasure(t){return pe("addMeasure",t),null!=t||(t={}),function(t){Ae(n.I8.isObject(t),n.I8.isBooleanOrUndefined(t.showNumber))}(t),this.doc.addMeasure(t),this}setKeySignature(...t){return pe("setKeySignature",...t),Ae(t[0]instanceof a.Scale||t[0]instanceof a.KeySignature||n.I8.isNonEmptyString(t[0])&&n.I8.isEnumValueOrUndefined(t[1],a.ScaleType)),this.getMeasure().setKeySignature(...t),this}setTimeSignature(...t){return pe("setTimeSignature",...t),t[0]instanceof a.TimeSignature?this.getMeasure().setTimeSignature(t[0]):n.I8.isEnumValue(t[0],a.TimeSignatures)&&n.I8.isEnumValueOrUndefined(t[1],a.BeamGrouping)?this.getMeasure().setTimeSignature(new a.TimeSignature(t[0],t[1])):n.I8.isIntegerGte(t[0],1)&&n.I8.isIntegerGte(t[1],1)&&n.I8.isEnumValueOrUndefined(t[2],a.BeamGrouping)?this.getMeasure().setTimeSignature(new a.TimeSignature(t[0],t[1],t[2])):Ae(!1),this}setTempo(t,e){return pe("setTempo",t,e),Ae(n.I8.isIntegerGte(t,1),n.I8.isUndefined(e)||(0,a.isNoteLength)(e)),this.getMeasure().setTempo(t,e),this}addNote(t,e,i,s){if(pe("addNote",t,e,i,s),Ae(d(t),e instanceof a.Note||n.I8.isNonEmptyString(e)||n.I8.isArray(e)&&e.every(t=>t instanceof a.Note||n.I8.isNonEmptyString(t)),(0,a.isNoteLength)(i)),null!=s||(s={}),Se(s),n.I8.isArray(e)){let r=s.string;e.forEach((e,o)=>{s.string=n.I8.isArray(r)?r[o]:r,this.getMeasure().addNoteGroup(t,[e],i,s)})}else this.getMeasure().addNoteGroup(t,[e],i,s);return this}addChord(t,e,i,s){return pe("addChord",t,e,i,s),Ae(d(t),n.I8.isNonEmptyArray(e)&&e.every(t=>t instanceof a.Note||n.I8.isNonEmptyString(t)),(0,a.isNoteLength)(i)),null!=s||(s={}),Se(s),this.getMeasure().addNoteGroup(t,e,i,s),this}addRest(t,e,i){return pe("addRest",t,e,i),Ae(d(t),(0,a.isNoteLength)(e)),null!=i||(i={}),Re(i),this.getMeasure().addRest(t,e,i),this}addTuplet(t,e,i){pe("addTuplet",t,e),Ae(d(t),n.I8.isFunction(i),(0,a.isTupletRatio)(e)&&n.I8.isBooleanOrUndefined(e.showRatio));let s=[];const r={addNote:(i,o,h)=>{if(pe("addTuplet => addNote",i,o,h),Ae(i instanceof a.Note||n.I8.isNonEmptyString(i)||n.I8.isArray(i)&&i.every(t=>t instanceof a.Note||n.I8.isNonEmptyString(t)),(0,a.isNoteLength)(o)),null!=h||(h={}),Se(h),n.I8.isArray(i)){let r=h.string;i.forEach((i,a)=>{h.string=n.I8.isArray(r)?r[a]:r;let c=this.getMeasure().addNoteGroup(t,[i],o,h,e);s.push(c)})}else{let r=this.getMeasure().addNoteGroup(t,[i],o,h,e);s.push(r)}return r},addChord:(i,o,h)=>{pe("addTuplet => addChord",i,o,h),Ae(n.I8.isNonEmptyArray(i)&&i.every(t=>t instanceof a.Note||n.I8.isNonEmptyString(t)),(0,a.isNoteLength)(o)),null!=h||(h={}),Se(h);let c=this.getMeasure().addNoteGroup(t,i,o,h,e);return s.push(c),r},addRest:(i,n)=>{pe("addTuplet => addRest",i,n),Ae((0,a.isNoteLength)(i)),null!=n||(n={}),Re(n);let o=this.getMeasure().addRest(t,i,n,e);return s.push(o),r}};return i(r),qt.createTuplet(s,e),this}addLyricsInternal(t,e,i,s,r){return xe(t),Ae(A(e),n.I8.isEnumValue(s,a.NoteLength),n.I8.isString(i)||n.I8.isArray(i)&&i.every(t=>n.I8.isString(t))),null!=r||(r={}),function(t){Ae(n.I8.isObject(t),n.I8.isEnumValueOrUndefined(t.align,x),n.I8.isEnumValueOrUndefined(t.hyphen,T))}(r),void 0!==r.align?this.currentLyricsAlign=r.align:null!=r.align||(r.align=this.currentLyricsAlign),n.I8.isArray(i)?i.forEach(i=>this.getMeasure().addLyrics(t,e,i,s,r)):this.getMeasure().addLyrics(t,e,i,s,r),this}addLyrics(t,e,i,s){return pe("addLyrics",t,i,e,s),this.addLyricsInternal(void 0,t,e,i,s)}addLyricsTo(t,e,i,s,r){return pe("addLyricsTo",e,s,i,r),this.addLyricsInternal(t,e,i,s,r)}addFermataInternal(t,e){return xe(t),Ae(n.I8.isEnumValue(e,L)),this.getMeasure().addFermata(t,e),this}addFermata(t="atNote"){return pe("addFermata",t),this.addFermataInternal(void 0,t)}addFermataTo(t,e="atNote"){return pe("addFermataTo",t,e),this.addFermataInternal(t,e)}addNavigationInternal(t,e,...i){return xe(t),Ae(n.I8.isStrictEqual(e,"endRepeat")&&n.I8.isStrictEqual(i.length,1)||n.I8.isStrictEqual(e,"ending")&&n.I8.isIntegerGte(i.length,1)&&i.every(t=>n.I8.isIntegerGte(t,1))||n.I8.isEnumValue(e,N)&&n.I8.isEmptyArray(i)),this.getMeasure().addNavigation(t,e,...i),this}addNavigation(t,...e){return pe("addNavigation",t,...e),this.addNavigationInternal(void 0,t,...e)}addNavigationTo(t,e,...i){return pe("addNavigationTo",t,e,...i),this.addNavigationInternal(t,e,...i)}addAnnotationInternal(t,e,i){if(null!=e||(e=function(t){return n.I8.isEnumValue(t,E)?"dynamics":n.I8.isEnumValue(t,O)?"tempo":void 0}(i)),void 0===e)throw new h.MusicError(h.MusicErrorType.Score,`Annotation text "${i}" is not known annotation.`);return xe(t),Ae(n.I8.isEnumValue(e,j),n.I8.isNonEmptyString(i)),this.getMeasure().addAnnotation(t,e,i),this}addAnnotation(...t){return pe("addAnnotation",...t),1===t.length?this.addAnnotationInternal(void 0,void 0,t[0]):this.addAnnotationInternal(void 0,t[0],t[1])}addAnnotationTo(t,...e){return pe("addAnnotationTo",t,...e),1===e.length?this.addAnnotationInternal(t,void 0,e[0]):this.addAnnotationInternal(t,e[0],e[1])}addLabelInternal(t,e,i){return xe(t),Ae(n.I8.isEnumValue(e,P),n.I8.isNonEmptyString(i)),this.getMeasure().addLabel(t,e,i),this}addLabel(t,e){return pe("addLabel",t,e),this.addLabelInternal(void 0,t,e)}addLabelTo(t,e,i){return pe("addLabelTo",t,e,i),this.addLabelInternal(t,e,i)}addConnective(t,...e){if(pe("addConnective",t,...e),Ae(n.I8.isEnumValue(t,S)),"tie"===t){Ae(n.I8.isIntegerOrUndefined(e[0])||n.I8.isEnumValue(e[0],v)),Ae(n.I8.isEnumValueOrUndefined(e[1],w));let i=e[0],s=e[1];this.getMeasure().addConnective(t,i,s)}else if("slur"===t){Ae(n.I8.isIntegerOrUndefined(e[0])),Ae(n.I8.isEnumValueOrUndefined(e[1],w));let i=e[0],s=e[1];this.getMeasure().addConnective(t,i,s)}else if("slide"===t){Ae(n.I8.isEnumValueOrUndefined(e[0],w));let i=e[0];this.getMeasure().addConnective(t,i)}return this}addExtension(t){pe("addExtension"),be(n.I8.isFunctionOrUndefined(t),"addExtension() has new usage, e.g. addExtension(ext => ext.measures(2)).");let e=0,i=!0;const s={notes:(t,i)=>(pe("addExtension.notes",t,i),Ae((0,a.isNoteLength)(t)),Ae(n.I8.isUndefined(i)||n.I8.isNumber(i)&&i>=0),e+=a.RhythmProps.get(t).ticks*(null!=i?i:1),s),measures:t=>(pe("addExtension.measures",t),Ae(n.I8.isNumber(t)&&t>=1),e+=this.getMeasure().getMeasureTicks()*t,s),infinity:()=>(pe("addExtension.infinity"),e=1/0,s),hide:()=>(pe("addExtension.hide"),i=!1,s)};return t?t(s):e=1/0,this.getMeasure().addExtension(e,i),this}addStaffGroup(t,e,i="auto"){return pe("addStaffGroup",t,e,i),Ae(n.I8.isNonEmptyString(t),n.I8.isNonEmptyString(e)||n.I8.isIntegerGte(e,0)||n.I8.isNonEmptyArray(e)&&e.every(t=>n.I8.isNonEmptyString(t)||n.I8.isIntegerGte(t,0)),n.I8.isEnumValue(i,R)),this.doc.addStaffGroup(t,e,i),this}endSong(){return pe("endSong"),this.getMeasure().endSong(),this}endSection(){return pe("endSection"),this.getMeasure().endSection(),this}endRow(){var t;return pe("endRow"),null==(t=this.doc.getLastMeasure())||t.endRow(),this}fillWithRests(...t){return pe("fillWithRests",...t),Ae(n.I8.isArray(t)&&(0===t.length||t.every(t=>d(t)))),this.getMeasure().fillWithRests(...t),this}addScaleArpeggio(t,e,i){pe("addScaleArpeggio",t,e,i),Ae(n.I8.isNonEmptyString(e),n.I8.isIntegerGte(i,1));let s=this.getMeasure().getTimeSignature(),r=t.getScaleNotes(e,i);for(let n=0;n<r.length;n++){n%s.beatCount===0&&n>0&&this.addMeasure();let t=r[n];this.addNote(0,t,s.beatLength),this.addLabel("note",t.formatOmitOctave(a.SymbolSet.Unicode))}return this}repeat(t,e){pe("repeat",e),Ae(n.I8.isIntegerGte(t,0),n.I8.isFunction(e));for(let i=0;i<t;i++)e(this);return this}};(0,o.Mu)(Te,"DefaultMeasureOptions",{});var Le=Te,Ne=class{constructor(t){this.type=t}},je=class extends Ne{constructor(t,e,i,s){super(t),this.renderContext=e,this.scoreRow=i,this.diatonicId=s}},Ee=class extends Ne{constructor(t,e,i){if(super(t),this.renderContext=e,this.objects=i,0===arguments.length)throw new h.MusicError(h.MusicErrorType.Score,"Empty array in score object event!")}get topObject(){return this.objects[this.objects.length-1]}findObject(t){return this.objects.find(e=>t(e))}};function Oe(t,e,i){if(!t)throw new h.MusicError(h.MusicErrorType.Score,`Invalid arg: ${e} = ${i}`)}function Pe(t){if(t instanceof ue||t instanceof ge)return t.getMusicInterface();throw new h.MusicError(h.MusicErrorType.Score,"Notation line not staff nor tab.")}var ke=class{constructor(t){this.name=t}getParent(){var t;return null==(t=this.getMusicObject().getParent())?void 0:t.getMusicInterface()}},De=class t extends ke{constructor(e){super(t.Name),this.obj=e}getMusicObject(){return this.obj}getAccidental(){return this.obj.accidental}};(0,o.Mu)(De,"Name","Accidental");var Ge=De,Be=class t extends ke{constructor(e){super(t.Name),this.obj=e}getMusicObject(){return this.obj}};(0,o.Mu)(Be,"Name","Connective");var Ye=Be,We=class t extends ke{constructor(e){super(t.Name),this.obj=e}getMusicObject(){return this.obj}getRhythmColumn(){return this.obj.col.getMusicInterface()}getNotationLine(){return Pe(this.obj.line)}};(0,o.Mu)(We,"Name","Arpeggio");var Ue=We,ze=class t extends ke{constructor(e){super(t.Name),this.obj=e}getMusicObject(){return this.obj}};(0,o.Mu)(ze,"Name","BeamGroup");var Ze=ze,Fe=class t extends ke{constructor(e){super(t.Name),this.obj=e}getMusicObject(){return this.obj}getStaff(){return this.obj.staff.getMusicInterface()}};(0,o.Mu)(Fe,"Name","StaffBeamGroup");var Ve=Fe,He=class t extends ke{constructor(e){super(t.Name),this.obj=e}getMusicObject(){return this.obj}getTitle(){return this.obj.getTitle()}getComposer(){return this.obj.getComposer()}getArranger(){return this.obj.getArranger()}getRows(){return this.obj.getRows().map(t=>t.getMusicInterface())}getMeasures(){return this.obj.getMeasures().map(t=>t.getMusicInterface())}play(t){return Oe(n.I8.isFunctionOrUndefined(t),"playStateChangeListener",t),new os(this,t).play()}};(0,o.Mu)(He,"Name","Document");var qe=He,Xe=class t extends ke{constructor(e){super(t.Name),this.obj=e}getMusicObject(){return this.obj}getPassages(){return this.obj.passages}hasPassage(t){return Oe(n.I8.isIntegerGte(t,1),"passage",t),this.obj.hasPassage(t)}};(0,o.Mu)(Xe,"Name","Ending");var Je=Xe,Ke=class t extends ke{constructor(e){super(t.Name),this.obj=e}getMusicObject(){return this.obj}};(0,o.Mu)(Ke,"Name","Fermata");var Qe=Ke,_e=class t extends ke{constructor(e){super(t.Name),this.obj=e}getMusicObject(){return this.obj}getTitle(){return this.obj.title}getComposer(){return this.obj.composer}getArranger(){return this.obj.arranger}};(0,o.Mu)(_e,"Name","Header");var $e=_e,ti=class t extends ke{constructor(e){super(t.Name),this.obj=e}getMusicObject(){return this.obj}};(0,o.Mu)(ti,"Name","Image");var ei=ti,ii=class t extends ke{constructor(e){super(t.Name),this.obj=e}getMusicObject(){return this.obj}getMeasureNumber(){return this.obj.getMeasureNumber()}getRhythmColumns(){return this.obj.getColumns().map(t=>t.getMusicInterface())}getRow(){return this.obj.row.getMusicInterface()}};(0,o.Mu)(ii,"Name","Measure");var si=ii,ri=class t extends ke{constructor(e){super(t.Name),this.obj=e}getMusicObject(){return this.obj}};(0,o.Mu)(ri,"Name","BarLineRight");var ni=ri,oi=class t extends ke{constructor(e){super(t.Name),this.obj=e}getMusicObject(){return this.obj}};(0,o.Mu)(oi,"Name","BarLineLeft");var ai=oi,hi=class t extends ke{constructor(e){super(t.Name),this.obj=e}getMusicObject(){return this.obj}getBarLine(){let t=this.obj.barLine;if(t instanceof Ut||t instanceof zt)return t.getMusicInterface();throw new h.MusicError(h.MusicErrorType.Score,"Bar line not left nor right.")}getNotationLine(){return Pe(this.obj.line)}};(0,o.Mu)(hi,"Name","StaffBarLine");var ci=hi,ui=class t extends ke{constructor(e){super(t.Name),this.obj=e}getMusicObject(){return this.obj}getNotes(){return this.obj.notes}getRhythmProps(){return this.obj.rhythmProps}getRhythmColumn(){return this.obj.col.getMusicInterface()}getMeasure(){return this.obj.measure.getMusicInterface()}};(0,o.Mu)(ui,"Name","NoteGroup");var gi=ui,li=class t extends ke{constructor(e){super(t.Name),this.obj=e}getMusicObject(){return this.obj}getNoteGroup(){return this.obj.noteGroup.getMusicInterface()}getRhythmColumn(){return this.getNoteGroup().getRhythmColumn()}getMeasure(){return this.getNoteGroup().getMeasure()}getStaff(){return this.obj.staff.getMusicInterface()}};(0,o.Mu)(li,"Name","StaffNoteGroup");var di=li,fi=class t extends ke{constructor(e){super(t.Name),this.obj=e}getMusicObject(){return this.obj}getNoteGroup(){return this.obj.noteGroup.getMusicInterface()}getRhythmColumn(){return this.getNoteGroup().getRhythmColumn()}getMeasure(){return this.getNoteGroup().getMeasure()}getTab(){return this.obj.tab.getMusicInterface()}};(0,o.Mu)(fi,"Name","TabNoteGroup");var Ii=fi,mi=class t extends ke{constructor(e){super(t.Name),this.obj=e}getMusicObject(){return this.obj}getRhythmProps(){return this.obj.rhythmProps}getRhythmColumn(){return this.obj.col.getMusicInterface()}getMeasure(){return this.obj.measure.getMusicInterface()}};(0,o.Mu)(mi,"Name","Rest");var Ci=mi,pi=class t extends ke{constructor(e){super(t.Name),this.obj=e}getMusicObject(){return this.obj}getRest(){return this.obj.rest.getMusicInterface()}getRhythmColumn(){return this.getRest().getRhythmColumn()}getMeasure(){return this.getRest().getMeasure()}getStaff(){return this.obj.staff.getMusicInterface()}};(0,o.Mu)(pi,"Name","StaffRest");var Ai=pi,bi=class t extends ke{constructor(e){super(t.Name),this.obj=e}getMusicObject(){return this.obj}getRhythmSymbol(t){var e;return Oe(d(t),"voiceId",t),null==(e=this.obj.getVoiceSymbol(t))?void 0:e.getMusicInterface()}getMeasure(){return this.obj.measure.getMusicInterface()}};(0,o.Mu)(bi,"Name","RhythmColumn");var yi=bi,Mi=class t extends ke{constructor(e){super(t.Name),this.obj=e}getMusicObject(){return this.obj}getDocument(){return this.obj.doc.getMusicInterface()}getMeasures(){return this.obj.getMeasures().map(t=>t.getMusicInterface())}getNotationLines(){return this.obj.getNotationLines().map(t=>Pe(t))}};(0,o.Mu)(Mi,"Name","ScoreRow");var vi=Mi,wi=class t extends ke{constructor(e){super(t.Name),this.obj=e}getMusicObject(){return this.obj}getInstrument(){return this.obj.instrument}};(0,o.Mu)(wi,"Name","ScoreRowGroup");var Si=wi,Ri=class t extends ke{constructor(e){super(t.Name),this.obj=e}getMusicObject(){return this.obj}getId(){return this.obj.id}getName(){return this.obj.name.length>0?this.obj.name:void 0}getRow(){return this.obj.row.getMusicInterface()}};(0,o.Mu)(Ri,"Name","Staff");var xi=Ri,Ti=class t extends ke{constructor(e){super(t.Name),this.obj=e}getMusicObject(){return this.obj}getId(){return this.obj.id}getName(){return this.obj.name.length>0?this.obj.name:void 0}getRow(){return this.obj.row.getMusicInterface()}};(0,o.Mu)(Ti,"Name","Tab");var Li=Ti,Ni=class t extends ke{constructor(e){super(t.Name),this.obj=e}getMusicObject(){return this.obj}getStaff(){return this.obj.staff.getMusicInterface()}};(0,o.Mu)(Ni,"Name","StaffSignature");var ji=Ni,Ei=class t extends ke{constructor(e){super(t.Name),this.obj=e}getMusicObject(){return this.obj}getTab(){return this.obj.tab.getMusicInterface()}};(0,o.Mu)(Ei,"Name","TabSignature");var Oi=Ei,Pi=class t extends ke{constructor(e){super(t.Name),this.obj=e}getMusicObject(){return this.obj}getMeasure(){return this.obj.measure.getMusicInterface()}getTab(){return this.obj.tab.getMusicInterface()}};(0,o.Mu)(Pi,"Name","TabRhythm");var ki=Pi,Di=class t extends ke{constructor(e){super(t.Name),this.obj=e}getMusicObject(){return this.obj}getText(){return this.obj.getText()}};(0,o.Mu)(Di,"Name","SpecialText");var Gi=Di,Bi=class t extends ke{constructor(e){super(t.Name),this.obj=e}getMusicObject(){return this.obj}getText(){return this.obj.getText()}};(0,o.Mu)(Bi,"Name","Text");var Yi=Bi,Wi=class t extends ke{constructor(e){super(t.Name),this.obj=e}getMusicObject(){return this.obj}getText(){return this.obj.getText()}};(0,o.Mu)(Wi,"Name","Lyrics");var Ui=Wi,zi=class t extends ke{constructor(e){super(t.Name),this.obj=e}getMusicObject(){return this.obj}};(0,o.Mu)(zi,"Name","ExtensionLine");var Zi,Fi,Vi,Hi,qi=zi;(Fi=Zi=Zi||(Zi={})).AliceBlue="aliceblue",Fi.AntiqueWhite="antiquewhite",Fi.Aqua="aqua",Fi.Aquamarine="aquamarine",Fi.Azure="azure",Fi.Beige="beige",Fi.Bisque="bisque",Fi.Black="black",Fi.BlanchedAlmond="blanchedalmond",Fi.Blue="blue",Fi.BlueViolet="blueviolet",Fi.Brown="brown",Fi.BurlyWood="burlywood",Fi.CadetBlue="cadetblue",Fi.Chartreuse="chartreuse",Fi.Chocolate="chocolate",Fi.Coral="coral",Fi.CornflowerBlue="cornflowerblue",Fi.CornSilk="cornsilk",Fi.Crimson="crimson",Fi.Cyan="cyan",Fi.DarkBlue="darkblue",Fi.DarkCyan="darkcyan",Fi.DarkGoldenRod="darkgoldenrod",Fi.DarkGray="darkgray",Fi.DarkGreen="darkgreen",Fi.DarkGrey="darkgrey",Fi.DarkKhaki="darkkhaki",Fi.DarkMagenta="darkmagenta",Fi.DarkOliveGreen="darkolivegreen",Fi.DarkOrange="darkorange",Fi.DarkOrchid="darkorchid",Fi.DarkRed="darkred",Fi.DarkSalmon="darksalmon",Fi.DarkSeaGreen="darkseagreen",Fi.DarkSlateBlue="darkslateblue",Fi.DarkSlateGray="darkslategray",Fi.DarkSlateGrey="darkslategrey",Fi.DarkTurquoise="darkturquoise",Fi.DarkViolet="darkviolet",Fi.DeepPink="deeppink",Fi.DeepSkyBlue="deepskyblue",Fi.DimGray="dimgray",Fi.DimGrey="dimgrey",Fi.DodgerBlue="dodgerblue",Fi.FireBrick="firebrick",Fi.FloralWhite="floralwhite",Fi.ForestGreen="forestgreen",Fi.Fuchsia="fuchsia",Fi.Gainsboro="gainsboro",Fi.GhostWhite="ghostwhite",Fi.Gold="gold",Fi.GoldenRod="goldenrod",Fi.Gray="gray",Fi.Green="green",Fi.GreenYellow="greenyellow",Fi.Grey="grey",Fi.Honeydew="honeydew",Fi.HotPink="hotpink",Fi.IndianRed="indianred",Fi.Indigo="indigo",Fi.Ivory="ivory",Fi.Khaki="khaki",Fi.Lavender="lavender",Fi.LavenderBlush="lavenderblush",Fi.LawnGreen="lawngreen",Fi.LemonChiffon="lemonchiffon",Fi.LightBlue="lightblue",Fi.LightCoral="lightcoral",Fi.LightCyan="lightcyan",Fi.LightGoldenRodYellow="lightgoldenrodyellow",Fi.LightGray="lightgray",Fi.LightGreen="lightgreen",Fi.LightGrey="lightgrey",Fi.LightPink="lightpink",Fi.LightSalmon="lightsalmon",Fi.LightSeaGreen="lightseagreen",Fi.LightSkyBlue="lightskyblue",Fi.LightSlateGray="lightslategray",Fi.LightSlateGrey="lightslategrey",Fi.LightSteelBlue="lightsteelblue",Fi.LightYellow="lightyellow",Fi.Lime="lime",Fi.LimeGreen="limegreen",Fi.Linen="linen",Fi.Magenta="magenta",Fi.Maroon="maroon",Fi.MediumAquamarine="mediumaquamarine",Fi.MediumBlue="mediumblue",Fi.MediumOrchid="mediumorchid",Fi.MediumPurple="mediumpurple",Fi.MediumSeaGreen="mediumseagreen",Fi.MediumSlateBlue="mediumslateblue",Fi.MediumSpringGreen="mediumspringgreen",Fi.MediumTurquoise="mediumturquoise",Fi.MediumVioletRed="mediumvioletred",Fi.MidnightBlue="midnightblue",Fi.MintCream="mintcream",Fi.MistyRose="mistyrose",Fi.Moccasin="moccasin",Fi.NavajoWhite="navajowhite",Fi.Navy="navy",Fi.OldLace="oldlace",Fi.Olive="olive",Fi.OliveDrab="olivedrab",Fi.Orange="orange",Fi.OrangeRed="orangered",Fi.Orchid="orchid",Fi.PaleGoldenRod="palegoldenrod",Fi.PaleGreen="palegreen",Fi.PaleTurquoise="paleturquoise",Fi.PaleVioletRed="palevioletred",Fi.PapayaWhip="papayawhip",Fi.PeachPuff="peachpuff",Fi.Peru="peru",Fi.Pink="pink",Fi.Plum="plum",Fi.PowderBlue="powderblue",Fi.Purple="purple",Fi.RebeccaPurple="rebeccapurple",Fi.Red="red",Fi.RosyBrown="rosybrown",Fi.RoyalBlue="royalblue",Fi.SaddleBrown="saddlebrown",Fi.Salmon="salmon",Fi.SandyBrown="sandybrown",Fi.SeaGreen="seagreen",Fi.SeaShell="seashell",Fi.Sienna="sienna",Fi.Silver="silver",Fi.SkyBlue="skyblue",Fi.SlateBlue="slateblue",Fi.SlateGray="slategray",Fi.SlateGrey="slategrey",Fi.Snow="snow",Fi.SpringGreen="springgreen",Fi.SteelBlue="steelblue",Fi.Tan="tan",Fi.Teal="teal",Fi.Thistle="thistle",Fi.Tomato="tomato",Fi.Turquoise="turquoise",Fi.Violet="violet",Fi.Wheat="wheat",Fi.White="white",Fi.WhiteSmoke="whitesmoke",Fi.Yellow="yellow",Fi.YellowGreen="yellowgreen",(Hi=Vi=Vi||(Vi={})).Hex="hex",Hi.RGB="rgb",Hi.Array="array";var Xi={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};for(const us in Xi)Object.freeze(Xi[us]);var Ji=Object.freeze(Xi),Ki={hash:!0,lowercase:!1,short:!1};var Qi=(0,o.ko)((0,o.IA)({},Ki),{fallback:!0,alpha:1,format:Vi.Hex});function _i(t,e={}){const i=(0,o.IA)((0,o.IA)({},Qi),e),{fallback:s,format:r,hash:n,lowercase:a,short:h,alpha:c}=i,u=(t=`${t}`).toLowerCase().replaceAll(/[^a-z]/g,"");let g=Ji[u];if(!g){if(!s)throw new Error(`no matching color found for '${t}'`);const e=t.toLowerCase().replaceAll(/[^\da-f]/g,"");g=(e.length<=3?[e.slice(0,1).repeat(2),e.slice(1,2).repeat(2),e.slice(2,3).repeat(2)]:[e.slice(0,2),e.slice(2,4),e.slice(4,6)]).map(t=>Number.parseInt(t.length<2?`${"0".repeat(2-t.length)}${t}`:t,16))}switch(r){case Vi.Array:return[...g];case Vi.RGB:return function(t,e=1){return(e=Math.min(1,Math.max(0,e)))<1?`rgba(${t[0]}, ${t[1]}, ${t[2]}, ${e})`:`rgb(${t[0]}, ${t[1]}, ${t[2]})`}(g,c);default:return function(t,e){const i=(0,o.IA)((0,o.IA)({},Ki),e),{hash:s,lowercase:r,short:n}=i;let a=t.map(t=>{let e=t.toString(16);return e=1===e.length?`0${e}`:e,e}).join("");if(n){const t=[...a];t[0]===t[1]&&t[2]===t[3]&&t[4]===t[5]&&(a=`${t[0]}${t[2]}${t[4]}`)}return a=r?a.toLowerCase():a.toUpperCase(),s&&(a=`#${a}`),a}(g,{hash:n,lowercase:a,short:h})}}var $i=t=>t.toLowerCase();function ts(t){return t}var es=class t{constructor(){(0,o.Mu)(this,"colors",{"hilight.staffpos":"#55cc55","hilight.object":"#55cc55","play.cursor":"#44aa44",background:"white","header.title":"black","header.composer":"black","header.arranger":"black","rowgroup.instrument":"black","rowgroup.frame":"black","staff.frame":"black","staff.note":"black","staff.rest":"black","staff.lyrics":"black","staff.connective":"black","staff.signature.clef":"black","staff.signature.key":"black","staff.signature.time":"black","staff.signature.tempo":"black","staff.signature.measurenum":"black","staff.element.fermata":"black","staff.element.annotation":"black","staff.element.navigation":"black","staff.element.label":"black","tab.frame":"black","tab.note":"black","tab.rest":"black","tab.lyrics":"black","tab.connective":"black","tab.tuning":"black","tab.signature.clef":"black","tab.signature.key":"black","tab.signature.time":"black","tab.signature.tempo":"black","tab.signature.measurenum":"black","tab.element.fermata":"black","tab.element.annotation":"black","tab.element.navigation":"black","tab.element.label":"black"})}setColor(t,e){if("all"===t){for(const t of Object.keys(this.colors))"background"!==t&&"hilight.object"!==t&&"hilight.staffpos"!==t&&"play.cursor"!==t&&(this.colors[t]=e||"black");return}const i="string"==typeof t&&"background"===$i(t)||n.I8.isArray(t)&&1===t.length&&"background"===$i(t[0]),s=e||(i?"white":"black");if(i)return void(this.colors.background=s);if("string"==typeof t&&t in this.colors)return void(this.colors[t]=s);const r=n.I8.isArray(t)?t:t.split(".");if(0===r.length)return;const o=r.map($i);let a=!1;for(const n of Object.keys(this.colors)){const t=n.split(".").map($i);o.every(e=>t.includes(e))&&(this.colors[n]=s,a=!0)}a||console.error(`Color attrs ${n.OZ.Str.stringify(r)} did not match any color.`)}getColor(t){var e;return null!=(e=this.colors[t])?e:t}getColorCode(e){return t.colorNameToCode(this.getColor(e))}getColorRGBA(e){return t.colorNameToRGBA(this.getColor(e))}static colorNameToCode(t){return _i(t)}static colorNameToRGBA(t,e=1){const i=_i(t).replace("#","");return[parseInt(i.slice(0,2),16),parseInt(i.slice(2,4),16),parseInt(i.slice(4,6),16),Math.round(255*e)]}};(0,o.Mu)(es,"default",new es);var is=es;function ss(t,e,i){if(!t)throw new h.MusicError(h.MusicErrorType.Score,`Invalid arg: ${e} = ${i}`)}function rs(t,e){if(null==t)throw new TypeError(e);return t}var ns=class t{constructor(t,e){(0,o.Mu)(this,"player"),ss(t instanceof qe,"doc",t),ss(n.I8.isFunctionOrUndefined(e),"playStateChangeListener",e),this.player=new Bt,this.player.setDocument(t.getMusicObject()),this.player.setCursorPositionChangeListener(e=>{t.getMusicObject().updateCursorRect(e)}),e&&this.player.setPlayStateChnageListener(e)}static stopAll(){this.currentlyPlaying.forEach(t=>t.stop()),c.stop()}play(){return t.currentlyPlaying.add(this),this.player.play(),this}pause(){return this.player.pause(),this}stop(){return this.player.stop(),t.currentlyPlaying.delete(this),this}};(0,o.Mu)(ns,"currentlyPlaying",new n.wu);var os=ns,as=class{constructor(){(0,o.Mu)(this,"ctx"),this.ctx=new gt(this)}setPaint(t){return ss(n.I8.isUndefined(t)||t instanceof is,"paint",t),this.ctx.setPaint(t),this}setDocument(t){return ss(n.I8.isUndefined(t)||t instanceof qe,"doc",t),this.ctx.setDocument(t),this}setCanvas(t){return t=rs(n.OZ.Dom.getCanvas(t),"string"==typeof t?"Cannot set render canvas because invalid canvas id: "+t:"Cannot set render canvas because given canvas is undefined."),this.ctx.setCanvas(t),this}setScoreEventListener(t){ss(n.I8.isFunctionOrUndefined(t),"scoreEventListener",t),this.ctx.setScoreEventListener(t)}hilightObject(t){this.ctx.hilightObject(null==t?void 0:t.getMusicObject())}hilightStaffPos(t){this.ctx.hilightStaffPos(t?{scoreRow:t.scoreRow.getMusicObject(),diatonicId:t.diatonicId}:void 0)}draw(){try{this.ctx.draw()}catch(t){console.log("Draw failed in music render context!",t)}}},hs=class t{constructor(){(0,o.Mu)(this,"playButton"),(0,o.Mu)(this,"stopButton"),(0,o.Mu)(this,"playStopButton"),(0,o.Mu)(this,"pauseButton"),(0,o.Mu)(this,"onPlay"),(0,o.Mu)(this,"onStop"),(0,o.Mu)(this,"onPlayStop"),(0,o.Mu)(this,"onPause"),(0,o.Mu)(this,"playLabel","Play"),(0,o.Mu)(this,"stopLabel","Stop"),(0,o.Mu)(this,"pauseLabel","Pause"),(0,o.Mu)(this,"playState",2),(0,o.Mu)(this,"player"),this.onPlay=()=>{var t;return null==(t=this.player)?void 0:t.play()},this.onStop=()=>{var t;return null==(t=this.player)?void 0:t.stop()},this.onPlayStop=()=>{var t,e;0===this.playState?null==(t=this.player)||t.stop():null==(e=this.player)||e.play()},this.onPause=()=>{var t;return null==(t=this.player)?void 0:t.pause()},this.updateButtons()}setDocument(t){return ss(n.I8.isUndefined(t)||t instanceof qe,"doc",t),this.onStop(),this.player=t?new os(t,t=>{this.playState=t,this.updateButtons()}):void 0,this.updateButtons(),this}detachDocument(){this.setDocument(void 0)}updateButtons(){this.playButton&&(this.playButton.disabled=!this.player||0===this.playState,this.playButton.innerText=this.playLabel),this.stopButton&&(this.stopButton.disabled=!this.player||2===this.playState,this.stopButton.innerText=this.stopLabel),this.playStopButton&&(this.playStopButton.disabled=!this.player,this.playStopButton.innerText=0===this.playState?this.stopLabel:this.playLabel),this.pauseButton&&(this.pauseButton.disabled=!this.player||0!==this.playState,this.pauseButton.innerText=this.pauseLabel)}setPlayButton(e,i){return ss(n.I8.isStringOrUndefined(i),"btnLabel",i),t.removeOnClickListeners(this.playButton,this.onPlay),this.playButton=rs(n.OZ.Dom.getButton(e),"Play button required!"),this.playLabel=null!=i?i:"Play",t.removeOnClickListeners(this.playButton,"all"),t.addOnClickListener(this.playButton,this.onPlay),this.updateButtons(),this}setStopButton(e,i){return ss(n.I8.isStringOrUndefined(i),"btnLabel",i),t.removeOnClickListeners(this.stopButton,this.onStop),this.stopButton=rs(n.OZ.Dom.getButton(e),"Stop button required!"),this.stopLabel=null!=i?i:"Stop",t.removeOnClickListeners(this.stopButton,"all"),t.addOnClickListener(this.stopButton,this.onStop),this.updateButtons(),this}setPlayStopButton(e,i,s){return ss(n.I8.isStringOrUndefined(i),"playLabel",i),ss(n.I8.isStringOrUndefined(s),"stopLabel",s),t.removeOnClickListeners(this.playStopButton,this.onPlayStop),this.playStopButton=rs(n.OZ.Dom.getButton(e),"Play/stop button required!"),this.playLabel=null!=i?i:"Play",this.stopLabel=null!=s?s:"Stop",t.removeOnClickListeners(this.playStopButton,"all"),t.addOnClickListener(this.playStopButton,this.onPlayStop),this.updateButtons(),this}setPauseButton(e,i){return ss(n.I8.isStringOrUndefined(i),"btnLabel",i),t.removeOnClickListeners(this.pauseButton,this.onPause),this.pauseButton=rs(n.OZ.Dom.getButton(e),"Pause button required!"),this.pauseLabel=null!=i?i:"Pause",t.removeOnClickListeners(this.pauseButton,"all"),t.addOnClickListener(this.pauseButton,this.onPause),this.updateButtons(),this}static removeOnClickListeners(t,e){if(!t)return;let i=this.savedOnClickListeners.getOrDefault(t,[]);i=i.filter(i=>e!==i&&"all"!==e||(t.removeEventListener("click",i),!1)),this.savedOnClickListeners.set(t,i)}static addOnClickListener(t,e){ss(n.I8.isFunction(e),"onClick",e),t.addEventListener("click",e),this.savedOnClickListeners.getOrCreate(t,[]).push(e)}};(0,o.Mu)(hs,"savedOnClickListeners",new n.b1);var cs=hs;(0,h.init)()},8453(t,e,i){i.d(e,{R:()=>o,x:()=>a});var s=i(6540);const r={},n=s.createContext(r);function o(t){const e=s.useContext(n);return s.useMemo(function(){return"function"==typeof t?t(e):{...e,...t}},[e,t])}function a(t){let e;return e=t.disableParentContext?"function"==typeof t.components?t.components(r):t.components||r:o(t.components),s.createElement(n.Provider,{value:e},t.children)}}}]);